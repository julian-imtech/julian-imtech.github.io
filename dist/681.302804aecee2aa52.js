(self.webpackChunkweb_proyect=self.webpackChunkweb_proyect||[]).push([[681],{8681:(X0,Ih,tn)=>{"use strict";tn.r(Ih),tn.d(Ih,{PublicModule:()=>ew});var Hr=tn(9808),Za=tn(2382),Dh=tn(1962),m=tn(5861),k=tn(4893),as=tn(9300),ur=tn(4004),ct=tn(5577),yi=tn(2313);let ti=(()=>{class h{constructor(t,n,s,l){this.titleService=t,this.meta=n,this.router=s,this.activatedRoute=l}updateMeta(t){this.router.events.pipe((0,as.h)(n=>n instanceof Dh.m2)).pipe((0,ur.U)(()=>this.activatedRoute)).pipe((0,ur.U)(n=>{for(;n.firstChild;)n=n.firstChild;return n})).pipe((0,as.h)(n=>"primary"===n.outlet)).pipe((0,ct.z)(n=>n.data)).subscribe(n=>{this.updateTitle(n.title),this.updateTitleMeta(null==n.titleMeta?n.title:n.titleMeta),this.updateDescription(n.title+" "+n.description),this.updateKeywords(n.keywords),this.updateOgUrl(n.ogUrl),this.updateOgTitle(n.ogTitle),this.updateOgDescription(n.ogDescription),this.updateOgImage(n.ogImage),t()})}updateTitle(t){this.titleService.setTitle(t)}updateTitleMeta(t){this.meta.updateTag({name:"Title",content:t})}updateDescription(t){this.meta.updateTag({name:"description",content:t})}updateKeywords(t){this.meta.updateTag({name:"keywords",content:t})}updateOgUrl(t){this.meta.updateTag({name:"og:url",content:t})}updateOgTitle(t){this.meta.updateTag({name:"og:title",content:t})}updateOgDescription(t){this.meta.updateTag({name:"og:description",content:t})}updateOgImage(t){this.meta.updateTag({name:"og:image",content:t})}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(yi.Dx),k.LFG(yi.h_),k.LFG(Dh.F0),k.LFG(Dh.gz))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})();var $s=tn(7838);const pa="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,Ai=(h,e,t=null)=>{for(;e!==t;){const n=e.nextSibling;h.removeChild(e),e=n}},Fn=`{{lit-${String(Math.random()).slice(2)}}}`,Mc=`\x3c!--${Fn}--\x3e`,ma=new RegExp(`${Fn}|${Mc}`);class fa{constructor(e,t){this.parts=[],this.element=t;const n=[],s=[],l=document.createTreeWalker(t.content,133,null,!1);let u=0,f=-1,v=0;const{strings:b,values:{length:S}}=e;for(;v<S;){const C=l.nextNode();if(null!==C){if(f++,1===C.nodeType){if(C.hasAttributes()){const I=C.attributes,{length:D}=I;let O=0;for(let N=0;N<D;N++)Xs(I[N].name,"$lit$")&&O++;for(;O-- >0;){const j=Es.exec(b[v])[2],U=j.toLowerCase()+"$lit$",Q=C.getAttribute(U);C.removeAttribute(U);const Y=Q.split(ma);this.parts.push({type:"attribute",index:f,name:j,strings:Y}),v+=Y.length-1}}"TEMPLATE"===C.tagName&&(s.push(C),l.currentNode=C.content)}else if(3===C.nodeType){const I=C.data;if(I.indexOf(Fn)>=0){const D=C.parentNode,O=I.split(ma),N=O.length-1;for(let j=0;j<N;j++){let U,Q=O[j];if(""===Q)U=Ts();else{const Y=Es.exec(Q);null!==Y&&Xs(Y[2],"$lit$")&&(Q=Q.slice(0,Y.index)+Y[1]+Y[2].slice(0,-5)+Y[3]),U=document.createTextNode(Q)}D.insertBefore(U,C),this.parts.push({type:"node",index:++f})}""===O[N]?(D.insertBefore(Ts(),C),n.push(C)):C.data=O[N],v+=N}}else if(8===C.nodeType)if(C.data===Fn){const I=C.parentNode;null!==C.previousSibling&&f!==u||(f++,I.insertBefore(Ts(),C)),u=f,this.parts.push({type:"node",index:f}),null===C.nextSibling?C.data="":(n.push(C),f--),v++}else{let I=-1;for(;-1!==(I=C.data.indexOf(Fn,I+1));)this.parts.push({type:"node",index:-1}),v++}}else l.currentNode=s.pop()}for(const C of n)C.parentNode.removeChild(C)}}const Xs=(h,e)=>{const t=h.length-e.length;return t>=0&&h.slice(t)===e},Pi=h=>-1!==h.index,Ts=()=>document.createComment(""),Es=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;function qa(h,e){const{element:{content:t},parts:n}=h,s=document.createTreeWalker(t,133,null,!1);let l=Pn(n),u=n[l],f=-1,v=0;const b=[];let S=null;for(;s.nextNode();){f++;const C=s.currentNode;for(C.previousSibling===S&&(S=null),e.has(C)&&(b.push(C),null===S&&(S=C)),null!==S&&v++;void 0!==u&&u.index===f;)u.index=null!==S?-1:u.index-v,l=Pn(n,l),u=n[l]}b.forEach(C=>C.parentNode.removeChild(C))}const Sc=h=>{let e=11===h.nodeType?0:1;const t=document.createTreeWalker(h,133,null,!1);for(;t.nextNode();)e++;return e},Pn=(h,e=-1)=>{for(let t=e+1;t<h.length;t++)if(Pi(h[t]))return t;return-1},Tc=new WeakMap,lo=h=>"function"==typeof h&&Tc.has(h),jr={},Ec={};class zo{constructor(e,t,n){this.__parts=[],this.template=e,this.processor=t,this.options=n}update(e){let t=0;for(const n of this.__parts)void 0!==n&&n.setValue(e[t]),t++;for(const n of this.__parts)void 0!==n&&n.commit()}_clone(){const e=pa?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],n=this.template.parts,s=document.createTreeWalker(e,133,null,!1);let l,u=0,f=0,v=s.nextNode();for(;u<n.length;)if(l=n[u],Pi(l)){for(;f<l.index;)f++,"TEMPLATE"===v.nodeName&&(t.push(v),s.currentNode=v.content),null===(v=s.nextNode())&&(s.currentNode=t.pop(),v=s.nextNode());if("node"===l.type){const b=this.processor.handleTextExpression(this.options);b.insertAfterNode(v.previousSibling),this.__parts.push(b)}else this.__parts.push(...this.processor.handleAttributeExpressions(v,l.name,l.strings,this.options));u++}else this.__parts.push(void 0),u++;return pa&&(document.adoptNode(e),customElements.upgrade(e)),e}}const $a=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:h=>h}),co=` ${Fn} `;class Oo{constructor(e,t,n,s){this.strings=e,this.values=t,this.type=n,this.processor=s}getHTML(){const e=this.strings.length-1;let t="",n=!1;for(let s=0;s<e;s++){const l=this.strings[s],u=l.lastIndexOf("\x3c!--");n=(u>-1||n)&&-1===l.indexOf("--\x3e",u+1);const f=Es.exec(l);t+=null===f?l+(n?co:Mc):l.substr(0,f.index)+f[1]+f[2]+"$lit$"+f[3]+Fn}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");let t=this.getHTML();return void 0!==$a&&(t=$a.createHTML(t)),e.innerHTML=t,e}}const Xa=h=>null===h||!("object"==typeof h||"function"==typeof h),Wr=h=>Array.isArray(h)||!(!h||!h[Symbol.iterator]);class Cc{constructor(e,t,n){this.dirty=!0,this.element=e,this.name=t,this.strings=n,this.parts=[];for(let s=0;s<n.length-1;s++)this.parts[s]=this._createPart()}_createPart(){return new nn(this)}_getValue(){const e=this.strings,t=e.length-1,n=this.parts;if(1===t&&""===e[0]&&""===e[1]){const l=n[0].value;if("symbol"==typeof l)return String(l);if("string"==typeof l||!Wr(l))return l}let s="";for(let l=0;l<t;l++){s+=e[l];const u=n[l];if(void 0!==u){const f=u.value;if(Xa(f)||!Wr(f))s+="string"==typeof f?f:String(f);else for(const v of f)s+="string"==typeof v?v:String(v)}}return s+=e[t],s}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class nn{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===jr||Xa(e)&&e===this.value||(this.value=e,lo(e)||(this.committer.dirty=!0))}commit(){for(;lo(this.value);){const e=this.value;this.value=jr,e(this)}this.value!==jr&&this.committer.commit()}}class ir{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(Ts()),this.endNode=e.appendChild(Ts())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=Ts()),e.__insert(this.endNode=Ts())}insertAfterPart(e){e.__insert(this.startNode=Ts()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;lo(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=jr,t(this)}const e=this.__pendingValue;e!==jr&&(Xa(e)?e!==this.value&&this.__commitText(e):e instanceof Oo?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):Wr(e)?this.__commitIterable(e):e===Ec?(this.value=Ec,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,n="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=n:this.__commitNode(document.createTextNode(n)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof zo&&this.value.template===t)this.value.update(e.values);else{const n=new zo(t,e.processor,this.options),s=n._clone();n.update(e.values),this.__commitNode(s),this.value=n}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let n,s=0;for(const l of e)n=t[s],void 0===n&&(n=new ir(this.options),t.push(n),0===s?n.appendIntoPart(this):n.insertAfterPart(t[s-1])),n.setValue(l),n.commit(),s++;s<t.length&&(t.length=s,this.clear(n&&n.endNode))}clear(e=this.startNode){Ai(this.startNode.parentNode,e.nextSibling,this.endNode)}}class ga{constructor(e,t,n){if(this.value=void 0,this.__pendingValue=void 0,2!==n.length||""!==n[0]||""!==n[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=n}setValue(e){this.__pendingValue=e}commit(){for(;lo(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=jr,t(this)}if(this.__pendingValue===jr)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=jr}}class Ys extends Cc{constructor(e,t,n){super(e,t,n),this.single=2===n.length&&""===n[0]&&""===n[1]}_createPart(){return new Bl(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class Bl extends nn{}let Bo=!1;(()=>{try{const h={get capture(){return Bo=!0,!1}};window.addEventListener("test",h,h),window.removeEventListener("test",h,h)}catch(h){}})();class Ac{constructor(e,t,n){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=n,this.__boundHandleEvent=s=>this.handleEvent(s)}setValue(e){this.__pendingValue=e}commit(){for(;lo(this.__pendingValue);){const l=this.__pendingValue;this.__pendingValue=jr,l(this)}if(this.__pendingValue===jr)return;const e=this.__pendingValue,t=this.value,n=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),s=null!=e&&(null==t||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),s&&(this.__options=Ya(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=jr}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const Ya=h=>h&&(Bo?{capture:h.capture,passive:h.passive,once:h.once}:h.capture);function ho(h){let e=vi.get(h.type);void 0===e&&(e={stringsArray:new WeakMap,keyString:new Map},vi.set(h.type,e));let t=e.stringsArray.get(h.strings);if(void 0!==t)return t;const n=h.strings.join(Fn);return t=e.keyString.get(n),void 0===t&&(t=new fa(h,h.getTemplateElement()),e.keyString.set(n,t)),e.stringsArray.set(h.strings,t),t}const vi=new Map,ls=new WeakMap,Pc=(h,e,t)=>{let n=ls.get(e);void 0===n&&(Ai(e,e.firstChild),ls.set(e,n=new ir(Object.assign({templateFactory:ho},t))),n.appendInto(e)),n.setValue(h),n.commit()},Zr=new class{handleAttributeExpressions(h,e,t,n){const s=e[0];return"."===s?new Ys(h,e.slice(1),t).parts:"@"===s?[new Ac(h,e.slice(1),n.eventContext)]:"?"===s?[new ga(h,e.slice(1),t)]:new Cc(h,e,t).parts}handleTextExpression(h){return new ir(h)}};"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const uo=(h,...e)=>new Oo(h,e,"html",Zr),zi=(h,e)=>`${h}--${e}`;let Js=!0;void 0===window.ShadyCSS?Js=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),Js=!1);const Ja=h=>e=>{const t=zi(e.type,h);let n=vi.get(t);void 0===n&&(n={stringsArray:new WeakMap,keyString:new Map},vi.set(t,n));let s=n.stringsArray.get(e.strings);if(void 0!==s)return s;const l=e.strings.join(Fn);if(s=n.keyString.get(l),void 0===s){const u=e.getTemplateElement();Js&&window.ShadyCSS.prepareTemplateDom(u,h),s=new fa(e,u),n.keyString.set(l,s)}return n.stringsArray.set(e.strings,s),s},Cs=["html","svg"],_a=new Set;window.JSCompiler_renameProperty=(h,e)=>h;const Ka={toAttribute(h,e){switch(e){case Boolean:return h?"":null;case Object:case Array:return null==h?h:JSON.stringify(h)}return h},fromAttribute(h,e){switch(e){case Boolean:return null!==h;case Number:return null===h?null:Number(h);case Object:case Array:return JSON.parse(h)}return h}},Qa=(h,e)=>e!==h&&(e==e||h==h),Fo={attribute:!0,type:String,converter:Ka,reflect:!1,hasChanged:Qa};let As=(()=>{class h extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();const t=[];return this._classProperties.forEach((n,s)=>{const l=this._attributeNameForProperty(s,n);void 0!==l&&(this._attributeToPropertyMap.set(l,s),t.push(l))}),t}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const t=Object.getPrototypeOf(this)._classProperties;void 0!==t&&t.forEach((n,s)=>this._classProperties.set(s,n))}}static createProperty(t,n=Fo){if(this._ensureClassProperties(),this._classProperties.set(t,n),n.noAccessor||this.prototype.hasOwnProperty(t))return;const s="symbol"==typeof t?Symbol():`__${t}`,l=this.getPropertyDescriptor(t,s,n);void 0!==l&&Object.defineProperty(this.prototype,t,l)}static getPropertyDescriptor(t,n,s){return{get(){return this[n]},set(l){const u=this[t];this[n]=l,this.requestUpdateInternal(t,u,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this._classProperties&&this._classProperties.get(t)||Fo}static finalize(){const t=Object.getPrototypeOf(this);if(t.hasOwnProperty("finalized")||t.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const n=this.properties,s=[...Object.getOwnPropertyNames(n),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(n):[]];for(const l of s)this.createProperty(l,n[l])}}static _attributeNameForProperty(t,n){const s=n.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof t?t.toLowerCase():void 0}static _valueHasChanged(t,n,s=Qa){return s(t,n)}static _propertyValueFromAttribute(t,n){const l=n.converter||Ka,u="function"==typeof l?l:l.fromAttribute;return u?u(t,n.type):t}static _propertyValueToAttribute(t,n){if(void 0===n.reflect)return;const l=n.converter;return(l&&l.toAttribute||Ka.toAttribute)(t,n.type)}initialize(){this._updateState=0,this._updatePromise=new Promise(t=>this._enableUpdatingResolver=t),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach((t,n)=>{if(this.hasOwnProperty(n)){const s=this[n];delete this[n],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(n,s)}})}_applyInstanceProperties(){this._instanceProperties.forEach((t,n)=>this[n]=t),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(t,n,s){n!==s&&this._attributeToProperty(t,s)}_propertyToAttribute(t,n,s=Fo){const l=this.constructor,u=l._attributeNameForProperty(t,s);if(void 0!==u){const f=l._propertyValueToAttribute(n,s);if(void 0===f)return;this._updateState=8|this._updateState,null==f?this.removeAttribute(u):this.setAttribute(u,f),this._updateState=-9&this._updateState}}_attributeToProperty(t,n){if(8&this._updateState)return;const s=this.constructor,l=s._attributeToPropertyMap.get(t);if(void 0!==l){const u=s.getPropertyOptions(l);this._updateState=16|this._updateState,this[l]=s._propertyValueFromAttribute(n,u),this._updateState=-17&this._updateState}}requestUpdateInternal(t,n,s){let l=!0;if(void 0!==t){const u=this.constructor;s=s||u.getPropertyOptions(t),u._valueHasChanged(this[t],n,s.hasChanged)?(this._changedProperties.has(t)||this._changedProperties.set(t,n),!0!==s.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(t,s))):l=!1}!this._hasRequestedUpdate&&l&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(t,n){return this.requestUpdateInternal(t,n),this.updateComplete}_enqueueUpdate(){var t=this;return(0,m.Z)(function*(){t._updateState=4|t._updateState;try{yield t._updatePromise}catch(s){}const n=t.performUpdate();return null!=n&&(yield n),!t._hasRequestedUpdate})()}get _hasRequestedUpdate(){return 4&this._updateState}get hasUpdated(){return 1&this._updateState}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let t=!1;const n=this._changedProperties;try{t=this.shouldUpdate(n),t?this.update(n):this._markUpdated()}catch(s){throw t=!1,this._markUpdated(),s}t&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(n)),this.updated(n))}_markUpdated(){this._changedProperties=new Map,this._updateState=-5&this._updateState}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._updatePromise}shouldUpdate(t){return!0}update(t){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((n,s)=>this._propertyToAttribute(s,this[s],n)),this._reflectingProperties=void 0),this._markUpdated()}updated(t){}firstUpdated(t){}}return h.finalized=!0,h})();const el=(h,e)=>"method"===e.kind&&e.descriptor&&!("value"in e.descriptor)?Object.assign(Object.assign({},e),{finisher(t){t.createProperty(e.key,h)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){"function"==typeof e.initializer&&(this[e.key]=e.initializer.call(this))},finisher(t){t.createProperty(e.key,h)}};function si(h){return(e,t)=>void 0!==t?void e.constructor.createProperty(t,h):el(h,e)}const cs=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Uo=Symbol();class Ic{constructor(e,t){if(t!==Uo)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(cs?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");const ya={};class va extends As{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const e=this.getStyles();if(Array.isArray(e)){const t=(l,u)=>l.reduceRight((f,v)=>Array.isArray(v)?t(v,f):(f.add(v),f),u),n=t(e,new Set),s=[];n.forEach(l=>s.unshift(l)),this._styles=s}else this._styles=void 0===e?[]:[e];this._styles=this._styles.map(t=>{if(t instanceof CSSStyleSheet&&!cs){const n=Array.prototype.slice.call(t.cssRules).reduce((s,l)=>s+l.cssText,"");return new Ic(String(n),Uo)}return t})}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow(this.constructor.shadowRootOptions)}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?cs?this.renderRoot.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map(t=>t.cssText),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){const t=this.render();super.update(e),t!==ya&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(n=>{const s=document.createElement("style");s.textContent=n.cssText,this.renderRoot.appendChild(s)}))}render(){return ya}}va.finalized=!0,va.render=(h,e,t)=>{if(!t||"object"!=typeof t||!t.scopeName)throw new Error("The `scopeName` option is required.");const n=t.scopeName,s=ls.has(e),l=Js&&11===e.nodeType&&!!e.host,u=l&&!_a.has(n),f=u?document.createDocumentFragment():e;if(Pc(h,f,Object.assign({templateFactory:Ja(n)},t)),u){const v=ls.get(f);ls.delete(f),((h,e,t)=>{_a.add(h);const n=t?t.element:document.createElement("template"),s=e.querySelectorAll("style"),{length:l}=s;if(0===l)return void window.ShadyCSS.prepareTemplateStyles(n,h);const u=document.createElement("style");for(let b=0;b<l;b++){const S=s[b];S.parentNode.removeChild(S),u.textContent+=S.textContent}var b;b=h,Cs.forEach(S=>{const C=vi.get(zi(S,b));void 0!==C&&C.keyString.forEach(I=>{const{element:{content:D}}=I,O=new Set;Array.from(D.querySelectorAll("style")).forEach(N=>{O.add(N)}),qa(I,O)})});const f=n.content;t?function(b,S,C=null){const{element:{content:I},parts:D}=b;if(null==C)return void I.appendChild(S);const O=document.createTreeWalker(I,133,null,!1);let N=Pn(D),j=0,U=-1;for(;O.nextNode();)for(U++,O.currentNode===C&&(j=Sc(S),C.parentNode.insertBefore(S,C));-1!==N&&D[N].index===U;){if(j>0){for(;-1!==N;)D[N].index+=j,N=Pn(D,N);return}N=Pn(D,N)}}(t,u,f.firstChild):f.insertBefore(u,f.firstChild),window.ShadyCSS.prepareTemplateStyles(n,h);const v=f.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==v)e.insertBefore(v.cloneNode(!0),e.firstChild);else if(t){f.insertBefore(u,f.firstChild);const b=new Set;b.add(u),qa(t,b)}})(n,f,v.value instanceof zo?v.value.template:void 0),Ai(e,e.firstChild),e.appendChild(f),ls.set(e,v)}!s&&l&&window.ShadyCSS.styleElement(e.host)},va.shadowRootOptions={mode:"open"};class qr{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const s=n.indexOf(t);-1!==s&&n.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let s=0,l=n.length;s<l;s++)n[s].call(this,e);e.target=null}}}const Jn=[];for(let h=0;h<256;h++)Jn[h]=(h<16?"0":"")+h.toString(16);let tl=1234567;const po=Math.PI/180,xa=180/Math.PI;function or(){const h=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Jn[255&h]+Jn[h>>8&255]+Jn[h>>16&255]+Jn[h>>24&255]+"-"+Jn[255&e]+Jn[e>>8&255]+"-"+Jn[e>>16&15|64]+Jn[e>>24&255]+"-"+Jn[63&t|128]+Jn[t>>8&255]+"-"+Jn[t>>16&255]+Jn[t>>24&255]+Jn[255&n]+Jn[n>>8&255]+Jn[n>>16&255]+Jn[n>>24&255]).toUpperCase()}function ar(h,e,t){return Math.max(e,Math.min(t,h))}function hs(h,e){return(h%e+e)%e}function Ps(h,e,t){return(1-t)*h+t*e}function No(h){return 0==(h&h-1)&&0!==h}function ba(h){return Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))}function Vo(h){return Math.pow(2,Math.floor(Math.log(h)/Math.LN2))}var Ul=Object.freeze({__proto__:null,DEG2RAD:po,RAD2DEG:xa,generateUUID:or,clamp:ar,euclideanModulo:hs,mapLinear:function(h,e,t,n,s){return n+(h-e)*(s-n)/(t-e)},inverseLerp:function(h,e,t){return h!==e?(t-h)/(e-h):0},lerp:Ps,damp:function(h,e,t,n){return Ps(h,e,1-Math.exp(-t*n))},pingpong:function(h,e=1){return e-Math.abs(hs(h,2*e)-e)},smoothstep:function(h,e,t){return h<=e?0:h>=t?1:(h=(h-e)/(t-e))*h*(3-2*h)},smootherstep:function(h,e,t){return h<=e?0:h>=t?1:(h=(h-e)/(t-e))*h*h*(h*(6*h-15)+10)},randInt:function(h,e){return h+Math.floor(Math.random()*(e-h+1))},randFloat:function(h,e){return h+Math.random()*(e-h)},randFloatSpread:function(h){return h*(.5-Math.random())},seededRandom:function(h){return void 0!==h&&(tl=h%2147483647),tl=16807*tl%2147483647,(tl-1)/2147483646},degToRad:function(h){return h*po},radToDeg:function(h){return h*xa},isPowerOfTwo:No,ceilPowerOfTwo:ba,floorPowerOfTwo:Vo,setQuaternionFromProperEuler:function(h,e,t,n,s){const l=Math.cos,u=Math.sin,f=l(t/2),v=u(t/2),b=l((e+n)/2),S=u((e+n)/2),C=l((e-n)/2),I=u((e-n)/2),D=l((n-e)/2),O=u((n-e)/2);switch(s){case"XYX":h.set(f*S,v*C,v*I,f*b);break;case"YZY":h.set(v*I,f*S,v*C,f*b);break;case"ZXZ":h.set(v*C,v*I,f*S,f*b);break;case"XZX":h.set(f*S,v*O,v*D,f*b);break;case"YXY":h.set(v*D,f*S,v*O,f*b);break;case"ZYZ":h.set(v*O,v*D,f*S,f*b);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}});class Mt{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),l=this.x-e.x,u=this.y-e.y;return this.x=l*n-u*s+e.x,this.y=l*s+u*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Mt.prototype.isVector2=!0;class se{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,s,l,u,f,v,b){const S=this.elements;return S[0]=e,S[1]=s,S[2]=f,S[3]=t,S[4]=l,S[5]=v,S[6]=n,S[7]=u,S[8]=b,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,l=this.elements,u=n[0],f=n[3],v=n[6],b=n[1],S=n[4],C=n[7],I=n[2],D=n[5],O=n[8],N=s[0],j=s[3],U=s[6],Q=s[1],Y=s[4],Z=s[7],te=s[2],oe=s[5],de=s[8];return l[0]=u*N+f*Q+v*te,l[3]=u*j+f*Y+v*oe,l[6]=u*U+f*Z+v*de,l[1]=b*N+S*Q+C*te,l[4]=b*j+S*Y+C*oe,l[7]=b*U+S*Z+C*de,l[2]=I*N+D*Q+O*te,l[5]=I*j+D*Y+O*oe,l[8]=I*U+D*Z+O*de,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],l=e[3],u=e[4],f=e[5],v=e[6],b=e[7],S=e[8];return t*u*S-t*f*b-n*l*S+n*f*v+s*l*b-s*u*v}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],l=e[3],u=e[4],f=e[5],v=e[6],b=e[7],S=e[8],C=S*u-f*b,I=f*v-S*l,D=b*l-u*v,O=t*C+n*I+s*D;if(0===O)return this.set(0,0,0,0,0,0,0,0,0);const N=1/O;return e[0]=C*N,e[1]=(s*b-S*n)*N,e[2]=(f*n-s*u)*N,e[3]=I*N,e[4]=(S*t-s*v)*N,e[5]=(s*l-f*t)*N,e[6]=D*N,e[7]=(n*v-b*t)*N,e[8]=(u*t-n*l)*N,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,l,u,f){const v=Math.cos(l),b=Math.sin(l);return this.set(n*v,n*b,-n*(v*u+b*f)+u+e,-s*b,s*v,-s*(-b*u+v*f)+f+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),s=this.elements,l=s[0],u=s[3],f=s[6],v=s[1],b=s[4],S=s[7];return s[0]=t*l+n*v,s[3]=t*u+n*b,s[6]=t*f+n*S,s[1]=-n*l+t*v,s[4]=-n*u+t*b,s[7]=-n*f+t*S,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function W(h){for(let e=h.length-1;e>=0;--e)if(h[e]>65535)return!0;return!1}function X(h){return document.createElementNS("http://www.w3.org/1999/xhtml",h)}se.prototype.isMatrix3=!0;const ae={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fe={h:0,s:0,l:0},Me={h:0,s:0,l:0};function Ue(h,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?h+6*(e-h)*t:t<.5?e:t<2/3?h+6*(e-h)*(2/3-t):h}function Be(h){return h<.04045?.0773993808*h:Math.pow(.9478672986*h+.0521327014,2.4)}function Ae(h){return h<.0031308?12.92*h:1.055*Math.pow(h,.41666)-.055}class we{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=hs(e,1),t=ar(t,0,1),n=ar(n,0,1),0===t)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,l=2*n-s;this.r=Ue(l,s,e+1/3),this.g=Ue(l,s,e),this.b=Ue(l,s,e-1/3)}return this}setStyle(e){function t(s){void 0!==s&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let s;const u=n[2];switch(n[1]){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,t(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,t(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u)){const f=parseFloat(s[1])/360,v=parseInt(s[2],10)/100,b=parseInt(s[3],10)/100;return t(s[4]),this.setHSL(f,v,b)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=n[1],l=s.length;if(3===l)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=ae[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Be(e.r),this.g=Be(e.g),this.b=Be(e.b),this}copyLinearToSRGB(e){return this.r=Ae(e.r),this.g=Ae(e.g),this.b=Ae(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,s=this.b,l=Math.max(t,n,s),u=Math.min(t,n,s);let f,v;const b=(u+l)/2;if(u===l)f=0,v=0;else{const S=l-u;switch(v=b<=.5?S/(l+u):S/(2-l-u),l){case t:f=(n-s)/S+(n<s?6:0);break;case n:f=(s-t)/S+2;break;case s:f=(t-n)/S+4}f/=6}return e.h=f,e.s=v,e.l=b,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(fe),fe.h+=e,fe.s+=t,fe.l+=n,this.setHSL(fe.h,fe.s,fe.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(fe),e.getHSL(Me);const n=Ps(fe.h,Me.h,t),s=Ps(fe.s,Me.s,t),l=Ps(fe.l,Me.l,t);return this.setHSL(n,s,l),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let rt;we.NAMES=ae,we.prototype.isColor=!0,we.prototype.r=1,we.prototype.g=1,we.prototype.b=1;class At{static getDataURL(e){if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===rt&&(rt=X("canvas")),rt.width=e.width,rt.height=e.height;const n=rt.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=rt}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=X("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),l=s.data;for(let u=0;u<l.length;u++)l[u]=255*Be(l[u]/255);return n.putImageData(s,0,0),t}if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t[n]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Be(t[n]/255)):Be(t[n]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class ut{constructor(e=null){this.uuid=or(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(null!==s){let l;if(Array.isArray(s)){l=[];for(let u=0,f=s.length;u<f;u++)l.push(Qt(s[u].isDataTexture?s[u].image:s[u]))}else l=Qt(s);n.url=l}return t||(e.images[this.uuid]=n),n}}function Qt(h){return"undefined"!=typeof HTMLImageElement&&h instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&h instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&h instanceof ImageBitmap?At.getDataURL(h):h.data?{data:Array.prototype.slice.call(h.data),width:h.width,height:h.height,type:h.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}ut.prototype.isSource=!0;let Jt=0;class Dt extends qr{constructor(e=Dt.DEFAULT_IMAGE,t=Dt.DEFAULT_MAPPING,n=1001,s=1001,l=1006,u=1008,f=1023,v=1009,b=1,S=3e3){super(),Object.defineProperty(this,"id",{value:Jt++}),this.uuid=or(),this.name="",this.source=new ut(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=s,this.magFilter=l,this.minFilter=u,this.anisotropy=b,this.format=f,this.internalFormat=null,this.type=v,this.offset=new Mt(0,0),this.repeat=new Mt(1,1),this.center=new Mt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new se,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=S,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}Dt.DEFAULT_IMAGE=null,Dt.DEFAULT_MAPPING=300,Dt.prototype.isTexture=!0;class Rt{constructor(e=0,t=0,n=0,s=1){this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,l=this.w,u=e.elements;return this.x=u[0]*t+u[4]*n+u[8]*s+u[12]*l,this.y=u[1]*t+u[5]*n+u[9]*s+u[13]*l,this.z=u[2]*t+u[6]*n+u[10]*s+u[14]*l,this.w=u[3]*t+u[7]*n+u[11]*s+u[15]*l,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,l;const v=e.elements,b=v[0],S=v[4],C=v[8],I=v[1],D=v[5],O=v[9],N=v[2],j=v[6],U=v[10];if(Math.abs(S-I)<.01&&Math.abs(C-N)<.01&&Math.abs(O-j)<.01){if(Math.abs(S+I)<.1&&Math.abs(C+N)<.1&&Math.abs(O+j)<.1&&Math.abs(b+D+U-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const Y=(b+1)/2,Z=(D+1)/2,te=(U+1)/2,oe=(S+I)/4,de=(C+N)/4,Ce=(O+j)/4;return Y>Z&&Y>te?Y<.01?(n=0,s=.707106781,l=.707106781):(n=Math.sqrt(Y),s=oe/n,l=de/n):Z>te?Z<.01?(n=.707106781,s=0,l=.707106781):(s=Math.sqrt(Z),n=oe/s,l=Ce/s):te<.01?(n=.707106781,s=.707106781,l=0):(l=Math.sqrt(te),n=de/l,s=Ce/l),this.set(n,s,l,t),this}let Q=Math.sqrt((j-O)*(j-O)+(C-N)*(C-N)+(I-S)*(I-S));return Math.abs(Q)<.001&&(Q=1),this.x=(j-O)/Q,this.y=(C-N)/Q,this.z=(I-S)/Q,this.w=Math.acos((b+D+U-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Rt.prototype.isVector4=!0;class Fe extends qr{constructor(e,t,n={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Rt(0,0,e,t),this.scissorTest=!1,this.viewport=new Rt(0,0,e,t),this.texture=new Dt({width:e,height:t,depth:1},n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Fe.prototype.isWebGLRenderTarget=!0;class Di extends Dt{constructor(e=null,t=1,n=1,s=1){super(null),this.image={data:e,width:t,height:n,depth:s},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Di.prototype.isDataArrayTexture=!0,class extends Fe{constructor(h,e,t){super(h,e),this.depth=t,this.texture=new Di(null,h,e,t),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGLArrayRenderTarget=!0;class Ut extends Dt{constructor(e=null,t=1,n=1,s=1){super(null),this.image={data:e,width:t,height:n,depth:s},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ut.prototype.isData3DTexture=!0,class extends Fe{constructor(h,e,t){super(h,e),this.depth=t,this.texture=new Ut(null,h,e,t),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGL3DRenderTarget=!0,class extends Fe{constructor(h,e,t,n={}){super(h,e,n);const s=this.texture;this.texture=[];for(let l=0;l<t;l++)this.texture[l]=s.clone(),this.texture[l].isRenderTargetTexture=!0}setSize(h,e,t=1){if(this.width!==h||this.height!==e||this.depth!==t){this.width=h,this.height=e,this.depth=t;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=h,this.texture[n].image.height=e,this.texture[n].image.depth=t;this.dispose()}return this.viewport.set(0,0,h,e),this.scissor.set(0,0,h,e),this}copy(h){this.dispose(),this.width=h.width,this.height=h.height,this.depth=h.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=h.depthBuffer,this.stencilBuffer=h.stencilBuffer,this.depthTexture=h.depthTexture,this.texture.length=0;for(let e=0,t=h.texture.length;e<t;e++)this.texture[e]=h.texture[e].clone();return this}}.prototype.isWebGLMultipleRenderTargets=!0;class ui{constructor(e=0,t=0,n=0,s=1){this._x=e,this._y=t,this._z=n,this._w=s}static slerp(e,t,n,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,s)}static slerpFlat(e,t,n,s,l,u,f){let v=n[s+0],b=n[s+1],S=n[s+2],C=n[s+3];const I=l[u+0],D=l[u+1],O=l[u+2],N=l[u+3];if(0===f)return e[t+0]=v,e[t+1]=b,e[t+2]=S,void(e[t+3]=C);if(1===f)return e[t+0]=I,e[t+1]=D,e[t+2]=O,void(e[t+3]=N);if(C!==N||v!==I||b!==D||S!==O){let j=1-f;const U=v*I+b*D+S*O+C*N,Q=U>=0?1:-1,Y=1-U*U;if(Y>Number.EPSILON){const te=Math.sqrt(Y),oe=Math.atan2(te,U*Q);j=Math.sin(j*oe)/te,f=Math.sin(f*oe)/te}const Z=f*Q;if(v=v*j+I*Z,b=b*j+D*Z,S=S*j+O*Z,C=C*j+N*Z,j===1-f){const te=1/Math.sqrt(v*v+b*b+S*S+C*C);v*=te,b*=te,S*=te,C*=te}}e[t]=v,e[t+1]=b,e[t+2]=S,e[t+3]=C}static multiplyQuaternionsFlat(e,t,n,s,l,u){const f=n[s],v=n[s+1],b=n[s+2],S=n[s+3],C=l[u],I=l[u+1],D=l[u+2],O=l[u+3];return e[t]=f*O+S*C+v*D-b*I,e[t+1]=v*O+S*I+b*C-f*D,e[t+2]=b*O+S*D+f*I-v*C,e[t+3]=S*O-f*C-v*I-b*D,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,s=e._y,l=e._z,u=e._order,f=Math.cos,v=Math.sin,b=f(n/2),S=f(s/2),C=f(l/2),I=v(n/2),D=v(s/2),O=v(l/2);switch(u){case"XYZ":this._x=I*S*C+b*D*O,this._y=b*D*C-I*S*O,this._z=b*S*O+I*D*C,this._w=b*S*C-I*D*O;break;case"YXZ":this._x=I*S*C+b*D*O,this._y=b*D*C-I*S*O,this._z=b*S*O-I*D*C,this._w=b*S*C+I*D*O;break;case"ZXY":this._x=I*S*C-b*D*O,this._y=b*D*C+I*S*O,this._z=b*S*O+I*D*C,this._w=b*S*C-I*D*O;break;case"ZYX":this._x=I*S*C-b*D*O,this._y=b*D*C+I*S*O,this._z=b*S*O-I*D*C,this._w=b*S*C+I*D*O;break;case"YZX":this._x=I*S*C+b*D*O,this._y=b*D*C+I*S*O,this._z=b*S*O-I*D*C,this._w=b*S*C-I*D*O;break;case"XZY":this._x=I*S*C-b*D*O,this._y=b*D*C-I*S*O,this._z=b*S*O+I*D*C,this._w=b*S*C+I*D*O;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+u)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],l=t[8],u=t[1],f=t[5],v=t[9],b=t[2],S=t[6],C=t[10],I=n+f+C;if(I>0){const D=.5/Math.sqrt(I+1);this._w=.25/D,this._x=(S-v)*D,this._y=(l-b)*D,this._z=(u-s)*D}else if(n>f&&n>C){const D=2*Math.sqrt(1+n-f-C);this._w=(S-v)/D,this._x=.25*D,this._y=(s+u)/D,this._z=(l+b)/D}else if(f>C){const D=2*Math.sqrt(1+f-n-C);this._w=(l-b)/D,this._x=(s+u)/D,this._y=.25*D,this._z=(v+S)/D}else{const D=2*Math.sqrt(1+C-n-f);this._w=(u-s)/D,this._x=(l+b)/D,this._y=(v+S)/D,this._z=.25*D}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ar(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,l=e._z,u=e._w,f=t._x,v=t._y,b=t._z,S=t._w;return this._x=n*S+u*f+s*b-l*v,this._y=s*S+u*v+l*f-n*b,this._z=l*S+u*b+n*v-s*f,this._w=u*S-n*f-s*v-l*b,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,s=this._y,l=this._z,u=this._w;let f=u*e._w+n*e._x+s*e._y+l*e._z;if(f<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,f=-f):this.copy(e),f>=1)return this._w=u,this._x=n,this._y=s,this._z=l,this;const v=1-f*f;if(v<=Number.EPSILON){const D=1-t;return this._w=D*u+t*this._w,this._x=D*n+t*this._x,this._y=D*s+t*this._y,this._z=D*l+t*this._z,this.normalize(),this._onChangeCallback(),this}const b=Math.sqrt(v),S=Math.atan2(b,f),C=Math.sin((1-t)*S)/b,I=Math.sin(t*S)/b;return this._w=u*C+this._w*I,this._x=n*C+this._x*I,this._y=s*C+this._y*I,this._z=l*C+this._z*I,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),s=2*Math.PI*Math.random(),l=2*Math.PI*Math.random();return this.set(t*Math.cos(s),n*Math.sin(l),n*Math.cos(l),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ui.prototype.isQuaternion=!0;class me{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(mo.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(mo.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,l=e.elements;return this.x=l[0]*t+l[3]*n+l[6]*s,this.y=l[1]*t+l[4]*n+l[7]*s,this.z=l[2]*t+l[5]*n+l[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,l=e.elements,u=1/(l[3]*t+l[7]*n+l[11]*s+l[15]);return this.x=(l[0]*t+l[4]*n+l[8]*s+l[12])*u,this.y=(l[1]*t+l[5]*n+l[9]*s+l[13])*u,this.z=(l[2]*t+l[6]*n+l[10]*s+l[14])*u,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,l=e.x,u=e.y,f=e.z,v=e.w,b=v*t+u*s-f*n,S=v*n+f*t-l*s,C=v*s+l*n-u*t,I=-l*t-u*n-f*s;return this.x=b*v+I*-l+S*-f-C*-u,this.y=S*v+I*-u+C*-l-b*-f,this.z=C*v+I*-f+b*-u-S*-l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,l=e.elements;return this.x=l[0]*t+l[4]*n+l[8]*s,this.y=l[1]*t+l[5]*n+l[9]*s,this.z=l[2]*t+l[6]*n+l[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,l=e.z,u=t.x,f=t.y,v=t.z;return this.x=s*v-l*f,this.y=l*u-n*v,this.z=n*f-s*u,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Go.copy(this).projectOnVector(e),this.sub(Go)}reflect(e){return this.sub(Go.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ar(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}me.prototype.isVector3=!0;const Go=new me,mo=new ui;class yt{constructor(e=new me(1/0,1/0,1/0),t=new me(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,s=1/0,l=-1/0,u=-1/0,f=-1/0;for(let v=0,b=e.length;v<b;v+=3){const S=e[v],C=e[v+1],I=e[v+2];S<t&&(t=S),C<n&&(n=C),I<s&&(s=I),S>l&&(l=S),C>u&&(u=C),I>f&&(f=I)}return this.min.set(t,n,s),this.max.set(l,u,f),this}setFromBufferAttribute(e){let t=1/0,n=1/0,s=1/0,l=-1/0,u=-1/0,f=-1/0;for(let v=0,b=e.count;v<b;v++){const S=e.getX(v),C=e.getY(v),I=e.getZ(v);S<t&&(t=S),C<n&&(n=C),I<s&&(s=I),S>l&&(l=S),C>u&&(u=C),I>f&&(f=I)}return this.min.set(t,n,s),this.max.set(l,u,f),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=pi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const l=n.attributes.position;for(let u=0,f=l.count;u<f;u++)pi.fromBufferAttribute(l,u).applyMatrix4(e.matrixWorld),this.expandByPoint(pi)}else null===n.boundingBox&&n.computeBoundingBox(),Is.copy(n.boundingBox),Is.applyMatrix4(e.matrixWorld),this.union(Is);const s=e.children;for(let l=0,u=s.length;l<u;l++)this.expandByObject(s[l],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,pi),pi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(on),Lh.subVectors(this.max,on),Ds.subVectors(e.a,on),gi.subVectors(e.b,on),Ls.subVectors(e.c,on),us.subVectors(gi,Ds),Un.subVectors(Ls,gi),lr.subVectors(Ds,Ls);let t=[0,-us.z,us.y,0,-Un.z,Un.y,0,-lr.z,lr.y,us.z,0,-us.x,Un.z,0,-Un.x,lr.z,0,-lr.x,-us.y,us.x,0,-Un.y,Un.x,0,-lr.y,lr.x,0];return!!Ma(t,Ds,gi,Ls,Lh)&&(t=[1,0,0,0,1,0,0,0,1],!!Ma(t,Ds,gi,Ls,Lh)&&(wa.crossVectors(us,Un),t=[wa.x,wa.y,wa.z],Ma(t,Ds,gi,Ls,Lh)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return pi.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(pi).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(fi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),fi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),fi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),fi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),fi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),fi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),fi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),fi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(fi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}yt.prototype.isBox3=!0;const fi=[new me,new me,new me,new me,new me,new me,new me,new me],pi=new me,Is=new yt,Ds=new me,gi=new me,Ls=new me,us=new me,Un=new me,lr=new me,on=new me,Lh=new me,wa=new me,fo=new me;function Ma(h,e,t,n,s){for(let l=0,u=h.length-3;l<=u;l+=3){fo.fromArray(h,l);const f=s.x*Math.abs(fo.x)+s.y*Math.abs(fo.y)+s.z*Math.abs(fo.z),v=e.dot(fo),b=t.dot(fo),S=n.dot(fo);if(Math.max(-Math.max(v,b,S),Math.min(v,b,S))>f)return!1}return!0}const Rh=new yt,kh=new me,Ii=new me,Sa=new me;class Ks{constructor(e=new me,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Rh.setFromPoints(e).getCenter(n);let s=0;for(let l=0,u=e.length;l<u;l++)s=Math.max(s,n.distanceToSquared(e[l]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Sa.subVectors(e,this.center);const t=Sa.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=.5*(n-this.radius);this.center.add(Sa.multiplyScalar(s/n)),this.radius+=s}return this}union(e){return!0===this.center.equals(e.center)?Ii.set(0,0,1).multiplyScalar(e.radius):Ii.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(kh.copy(e.center).add(Ii)),this.expandByPoint(kh.copy(e.center).sub(Ii)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const cn=new me,Ar=new me,$r=new me,Qs=new me,In=new me,Rs=new me,eo=new me;class Dn{constructor(e=new me,t=new me(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,cn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=cn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(cn.copy(this.direction).multiplyScalar(t).add(this.origin),cn.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){Ar.copy(e).add(t).multiplyScalar(.5),$r.copy(t).sub(e).normalize(),Qs.copy(this.origin).sub(Ar);const l=.5*e.distanceTo(t),u=-this.direction.dot($r),f=Qs.dot(this.direction),v=-Qs.dot($r),b=Qs.lengthSq(),S=Math.abs(1-u*u);let C,I,D,O;if(S>0)if(C=u*v-f,I=u*f-v,O=l*S,C>=0)if(I>=-O)if(I<=O){const N=1/S;C*=N,I*=N,D=C*(C+u*I+2*f)+I*(u*C+I+2*v)+b}else I=l,C=Math.max(0,-(u*I+f)),D=-C*C+I*(I+2*v)+b;else I=-l,C=Math.max(0,-(u*I+f)),D=-C*C+I*(I+2*v)+b;else I<=-O?(C=Math.max(0,-(-u*l+f)),I=C>0?-l:Math.min(Math.max(-l,-v),l),D=-C*C+I*(I+2*v)+b):I<=O?(C=0,I=Math.min(Math.max(-l,-v),l),D=I*(I+2*v)+b):(C=Math.max(0,-(u*l+f)),I=C>0?l:Math.min(Math.max(-l,-v),l),D=-C*C+I*(I+2*v)+b);else I=u>0?-l:l,C=Math.max(0,-(u*I+f)),D=-C*C+I*(I+2*v)+b;return n&&n.copy(this.direction).multiplyScalar(C).add(this.origin),s&&s.copy($r).multiplyScalar(I).add(Ar),D}intersectSphere(e,t){cn.subVectors(e.center,this.origin);const n=cn.dot(this.direction),s=cn.dot(cn)-n*n,l=e.radius*e.radius;if(s>l)return null;const u=Math.sqrt(l-s),f=n-u,v=n+u;return f<0&&v<0?null:this.at(f<0?v:f,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,l,u,f,v;const b=1/this.direction.x,S=1/this.direction.y,C=1/this.direction.z,I=this.origin;return b>=0?(n=(e.min.x-I.x)*b,s=(e.max.x-I.x)*b):(n=(e.max.x-I.x)*b,s=(e.min.x-I.x)*b),S>=0?(l=(e.min.y-I.y)*S,u=(e.max.y-I.y)*S):(l=(e.max.y-I.y)*S,u=(e.min.y-I.y)*S),n>u||l>s?null:((l>n||n!=n)&&(n=l),(u<s||s!=s)&&(s=u),C>=0?(f=(e.min.z-I.z)*C,v=(e.max.z-I.z)*C):(f=(e.max.z-I.z)*C,v=(e.min.z-I.z)*C),n>v||f>s?null:((f>n||n!=n)&&(n=f),(v<s||s!=s)&&(s=v),s<0?null:this.at(n>=0?n:s,t)))}intersectsBox(e){return null!==this.intersectBox(e,cn)}intersectTriangle(e,t,n,s,l){In.subVectors(t,e),Rs.subVectors(n,e),eo.crossVectors(In,Rs);let u,f=this.direction.dot(eo);if(f>0){if(s)return null;u=1}else{if(!(f<0))return null;u=-1,f=-f}Qs.subVectors(this.origin,e);const v=u*this.direction.dot(Rs.crossVectors(Qs,Rs));if(v<0)return null;const b=u*this.direction.dot(In.cross(Qs));if(b<0||v+b>f)return null;const S=-u*Qs.dot(eo);return S<0?null:this.at(S/f,l)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ii{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,s,l,u,f,v,b,S,C,I,D,O,N,j){const U=this.elements;return U[0]=e,U[4]=t,U[8]=n,U[12]=s,U[1]=l,U[5]=u,U[9]=f,U[13]=v,U[2]=b,U[6]=S,U[10]=C,U[14]=I,U[3]=D,U[7]=O,U[11]=N,U[15]=j,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ii).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/_r.setFromMatrixColumn(e,0).length(),l=1/_r.setFromMatrixColumn(e,1).length(),u=1/_r.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*l,t[5]=n[5]*l,t[6]=n[6]*l,t[7]=0,t[8]=n[8]*u,t[9]=n[9]*u,t[10]=n[10]*u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,s=e.y,l=e.z,u=Math.cos(n),f=Math.sin(n),v=Math.cos(s),b=Math.sin(s),S=Math.cos(l),C=Math.sin(l);if("XYZ"===e.order){const I=u*S,D=u*C,O=f*S,N=f*C;t[0]=v*S,t[4]=-v*C,t[8]=b,t[1]=D+O*b,t[5]=I-N*b,t[9]=-f*v,t[2]=N-I*b,t[6]=O+D*b,t[10]=u*v}else if("YXZ"===e.order){const I=v*S,D=v*C,O=b*S,N=b*C;t[0]=I+N*f,t[4]=O*f-D,t[8]=u*b,t[1]=u*C,t[5]=u*S,t[9]=-f,t[2]=D*f-O,t[6]=N+I*f,t[10]=u*v}else if("ZXY"===e.order){const I=v*S,D=v*C,O=b*S,N=b*C;t[0]=I-N*f,t[4]=-u*C,t[8]=O+D*f,t[1]=D+O*f,t[5]=u*S,t[9]=N-I*f,t[2]=-u*b,t[6]=f,t[10]=u*v}else if("ZYX"===e.order){const I=u*S,D=u*C,O=f*S,N=f*C;t[0]=v*S,t[4]=O*b-D,t[8]=I*b+N,t[1]=v*C,t[5]=N*b+I,t[9]=D*b-O,t[2]=-b,t[6]=f*v,t[10]=u*v}else if("YZX"===e.order){const I=u*v,D=u*b,O=f*v,N=f*b;t[0]=v*S,t[4]=N-I*C,t[8]=O*C+D,t[1]=C,t[5]=u*S,t[9]=-f*S,t[2]=-b*S,t[6]=D*C+O,t[10]=I-N*C}else if("XZY"===e.order){const I=u*v,D=u*b,O=f*v,N=f*b;t[0]=v*S,t[4]=-C,t[8]=b*S,t[1]=I*C+N,t[5]=u*S,t[9]=D*C-O,t[2]=O*C-D,t[6]=f*S,t[10]=N*C+I}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Nl,e,Nm)}lookAt(e,t,n){const s=this.elements;return Xr.subVectors(e,t),0===Xr.lengthSq()&&(Xr.z=1),Xr.normalize(),cr.crossVectors(n,Xr),0===cr.lengthSq()&&(1===Math.abs(n.z)?Xr.x+=1e-4:Xr.z+=1e-4,Xr.normalize(),cr.crossVectors(n,Xr)),cr.normalize(),zh.crossVectors(Xr,cr),s[0]=cr.x,s[4]=zh.x,s[8]=Xr.x,s[1]=cr.y,s[5]=zh.y,s[9]=Xr.y,s[2]=cr.z,s[6]=zh.z,s[10]=Xr.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,l=this.elements,u=n[0],f=n[4],v=n[8],b=n[12],S=n[1],C=n[5],I=n[9],D=n[13],O=n[2],N=n[6],j=n[10],U=n[14],Q=n[3],Y=n[7],Z=n[11],te=n[15],oe=s[0],de=s[4],Ce=s[8],Le=s[12],Oe=s[1],Ze=s[5],et=s[9],ot=s[13],Ve=s[2],at=s[6],it=s[10],wt=s[14],pt=s[3],Ct=s[7],dt=s[11],ei=s[15];return l[0]=u*oe+f*Oe+v*Ve+b*pt,l[4]=u*de+f*Ze+v*at+b*Ct,l[8]=u*Ce+f*et+v*it+b*dt,l[12]=u*Le+f*ot+v*wt+b*ei,l[1]=S*oe+C*Oe+I*Ve+D*pt,l[5]=S*de+C*Ze+I*at+D*Ct,l[9]=S*Ce+C*et+I*it+D*dt,l[13]=S*Le+C*ot+I*wt+D*ei,l[2]=O*oe+N*Oe+j*Ve+U*pt,l[6]=O*de+N*Ze+j*at+U*Ct,l[10]=O*Ce+N*et+j*it+U*dt,l[14]=O*Le+N*ot+j*wt+U*ei,l[3]=Q*oe+Y*Oe+Z*Ve+te*pt,l[7]=Q*de+Y*Ze+Z*at+te*Ct,l[11]=Q*Ce+Y*et+Z*it+te*dt,l[15]=Q*Le+Y*ot+Z*wt+te*ei,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],l=e[12],u=e[1],f=e[5],v=e[9],b=e[13],S=e[2],C=e[6],I=e[10],D=e[14];return e[3]*(+l*v*C-s*b*C-l*f*I+n*b*I+s*f*D-n*v*D)+e[7]*(+t*v*D-t*b*I+l*u*I-s*u*D+s*b*S-l*v*S)+e[11]*(+t*b*C-t*f*D-l*u*C+n*u*D+l*f*S-n*b*S)+e[15]*(-s*f*S-t*v*C+t*f*I+s*u*C-n*u*I+n*v*S)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],l=e[3],u=e[4],f=e[5],v=e[6],b=e[7],S=e[8],C=e[9],I=e[10],D=e[11],O=e[12],N=e[13],j=e[14],U=e[15],Q=C*j*b-N*I*b+N*v*D-f*j*D-C*v*U+f*I*U,Y=O*I*b-S*j*b-O*v*D+u*j*D+S*v*U-u*I*U,Z=S*N*b-O*C*b+O*f*D-u*N*D-S*f*U+u*C*U,te=O*C*v-S*N*v-O*f*I+u*N*I+S*f*j-u*C*j,oe=t*Q+n*Y+s*Z+l*te;if(0===oe)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const de=1/oe;return e[0]=Q*de,e[1]=(N*I*l-C*j*l-N*s*D+n*j*D+C*s*U-n*I*U)*de,e[2]=(f*j*l-N*v*l+N*s*b-n*j*b-f*s*U+n*v*U)*de,e[3]=(C*v*l-f*I*l-C*s*b+n*I*b+f*s*D-n*v*D)*de,e[4]=Y*de,e[5]=(S*j*l-O*I*l+O*s*D-t*j*D-S*s*U+t*I*U)*de,e[6]=(O*v*l-u*j*l-O*s*b+t*j*b+u*s*U-t*v*U)*de,e[7]=(u*I*l-S*v*l+S*s*b-t*I*b-u*s*D+t*v*D)*de,e[8]=Z*de,e[9]=(O*C*l-S*N*l-O*n*D+t*N*D+S*n*U-t*C*U)*de,e[10]=(u*N*l-O*f*l+O*n*b-t*N*b-u*n*U+t*f*U)*de,e[11]=(S*f*l-u*C*l-S*n*b+t*C*b+u*n*D-t*f*D)*de,e[12]=te*de,e[13]=(S*N*s-O*C*s+O*n*I-t*N*I-S*n*j+t*C*j)*de,e[14]=(O*f*s-u*N*s-O*n*v+t*N*v+u*n*j-t*f*j)*de,e[15]=(u*C*s-S*f*s+S*n*v-t*C*v-u*n*I+t*f*I)*de,this}scale(e){const t=this.elements,n=e.x,s=e.y,l=e.z;return t[0]*=n,t[4]*=s,t[8]*=l,t[1]*=n,t[5]*=s,t[9]*=l,t[2]*=n,t[6]*=s,t[10]*=l,t[3]*=n,t[7]*=s,t[11]*=l,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),l=1-n,u=e.x,f=e.y,v=e.z,b=l*u,S=l*f;return this.set(b*u+n,b*f-s*v,b*v+s*f,0,b*f+s*v,S*f+n,S*v-s*u,0,b*v-s*f,S*v+s*u,l*v*v+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,l,u){return this.set(1,n,l,0,e,1,u,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,l=t._x,u=t._y,f=t._z,v=t._w,b=l+l,S=u+u,C=f+f,I=l*b,D=l*S,O=l*C,N=u*S,j=u*C,U=f*C,Q=v*b,Y=v*S,Z=v*C,te=n.x,oe=n.y,de=n.z;return s[0]=(1-(N+U))*te,s[1]=(D+Z)*te,s[2]=(O-Y)*te,s[3]=0,s[4]=(D-Z)*oe,s[5]=(1-(I+U))*oe,s[6]=(j+Q)*oe,s[7]=0,s[8]=(O+Y)*de,s[9]=(j-Q)*de,s[10]=(1-(I+N))*de,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let l=_r.set(s[0],s[1],s[2]).length();const u=_r.set(s[4],s[5],s[6]).length(),f=_r.set(s[8],s[9],s[10]).length();this.determinant()<0&&(l=-l),e.x=s[12],e.y=s[13],e.z=s[14],yr.copy(this);const v=1/l,b=1/u,S=1/f;return yr.elements[0]*=v,yr.elements[1]*=v,yr.elements[2]*=v,yr.elements[4]*=b,yr.elements[5]*=b,yr.elements[6]*=b,yr.elements[8]*=S,yr.elements[9]*=S,yr.elements[10]*=S,t.setFromRotationMatrix(yr),n.x=l,n.y=u,n.z=f,this}makePerspective(e,t,n,s,l,u){void 0===u&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const f=this.elements,b=2*l/(n-s),S=(t+e)/(t-e),C=(n+s)/(n-s),I=-(u+l)/(u-l),D=-2*u*l/(u-l);return f[0]=2*l/(t-e),f[4]=0,f[8]=S,f[12]=0,f[1]=0,f[5]=b,f[9]=C,f[13]=0,f[2]=0,f[6]=0,f[10]=I,f[14]=D,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,this}makeOrthographic(e,t,n,s,l,u){const f=this.elements,v=1/(t-e),b=1/(n-s),S=1/(u-l),C=(t+e)*v,I=(n+s)*b,D=(u+l)*S;return f[0]=2*v,f[4]=0,f[8]=0,f[12]=-C,f[1]=0,f[5]=2*b,f[9]=0,f[13]=-I,f[2]=0,f[6]=0,f[10]=-2*S,f[14]=-D,f[3]=0,f[7]=0,f[11]=0,f[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}ii.prototype.isMatrix4=!0;const _r=new me,yr=new ii,Nl=new me(0,0,0),Nm=new me(1,1,1),cr=new me,zh=new me,Xr=new me,Yr=new ii,Dc=new ui;class vr{constructor(e=0,t=0,n=0,s=vr.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,l=s[0],u=s[4],f=s[8],v=s[1],b=s[5],S=s[9],C=s[2],I=s[6],D=s[10];switch(t){case"XYZ":this._y=Math.asin(ar(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-S,D),this._z=Math.atan2(-u,l)):(this._x=Math.atan2(I,b),this._z=0);break;case"YXZ":this._x=Math.asin(-ar(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(f,D),this._z=Math.atan2(v,b)):(this._y=Math.atan2(-C,l),this._z=0);break;case"ZXY":this._x=Math.asin(ar(I,-1,1)),Math.abs(I)<.9999999?(this._y=Math.atan2(-C,D),this._z=Math.atan2(-u,b)):(this._y=0,this._z=Math.atan2(v,l));break;case"ZYX":this._y=Math.asin(-ar(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(I,D),this._z=Math.atan2(v,l)):(this._x=0,this._z=Math.atan2(-u,b));break;case"YZX":this._z=Math.asin(ar(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(-S,b),this._y=Math.atan2(-C,l)):(this._x=0,this._y=Math.atan2(f,D));break;case"XZY":this._z=Math.asin(-ar(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(I,b),this._y=Math.atan2(f,l)):(this._x=Math.atan2(-S,D),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Yr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Yr,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Dc.setFromEuler(this),this.setFromQuaternion(Dc,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}vr.prototype.isEuler=!0,vr.DefaultOrder="XYZ",vr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Lc{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Oh=0;const Gu=new me,Ho=new ui,to=new ii,Bh=new me,Vl=new me,Vm=new me,gp=new ui,_p=new me(1,0,0),Rc=new me(0,1,0),Gl=new me(0,0,1),yp={type:"added"},Hu={type:"removed"};class Ni extends qr{constructor(){super(),Object.defineProperty(this,"id",{value:Oh++}),this.uuid=or(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ni.DefaultUp.clone();const e=new me,t=new vr,n=new ui,s=new me(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ii},normalMatrix:{value:new se}}),this.matrix=new ii,this.matrixWorld=new ii,this.matrixAutoUpdate=Ni.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Lc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ho.setFromAxisAngle(e,t),this.quaternion.multiply(Ho),this}rotateOnWorldAxis(e,t){return Ho.setFromAxisAngle(e,t),this.quaternion.premultiply(Ho),this}rotateX(e){return this.rotateOnAxis(_p,e)}rotateY(e){return this.rotateOnAxis(Rc,e)}rotateZ(e){return this.rotateOnAxis(Gl,e)}translateOnAxis(e,t){return Gu.copy(e).applyQuaternion(this.quaternion),this.position.add(Gu.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_p,e)}translateY(e){return this.translateOnAxis(Rc,e)}translateZ(e){return this.translateOnAxis(Gl,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(to.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Bh.copy(e):Bh.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),Vl.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?to.lookAt(Vl,Bh,this.up):to.lookAt(Bh,Vl,this.up),this.quaternion.setFromRotationMatrix(to),s&&(to.extractRotation(s.matrixWorld),Ho.setFromRotationMatrix(to),this.quaternion.premultiply(Ho.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(yp)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Hu)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Hu)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),to.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),to.multiply(e.parent.matrixWorld)),e.applyMatrix4(to),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const l=this.children[n].getObjectByProperty(e,t);if(void 0!==l)return l}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vl,e,Vm),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vl,gp,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const s=this.children;for(let l=0,u=s.length;l<u;l++)s[l].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function l(f,v){return void 0===f[v.uuid]&&(f[v.uuid]=v.toJSON(e)),v.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=l(e.geometries,this.geometry);const f=this.geometry.parameters;if(void 0!==f&&void 0!==f.shapes){const v=f.shapes;if(Array.isArray(v))for(let b=0,S=v.length;b<S;b++)l(e.shapes,v[b]);else l(e.shapes,v)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(l(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const f=[];for(let v=0,b=this.material.length;v<b;v++)f.push(l(e.materials,this.material[v]));s.material=f}else s.material=l(e.materials,this.material);if(this.children.length>0){s.children=[];for(let f=0;f<this.children.length;f++)s.children.push(this.children[f].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let f=0;f<this.animations.length;f++)s.animations.push(l(e.animations,this.animations[f]))}if(t){const f=u(e.geometries),v=u(e.materials),b=u(e.textures),S=u(e.images),C=u(e.shapes),I=u(e.skeletons),D=u(e.animations),O=u(e.nodes);f.length>0&&(n.geometries=f),v.length>0&&(n.materials=v),b.length>0&&(n.textures=b),S.length>0&&(n.images=S),C.length>0&&(n.shapes=C),I.length>0&&(n.skeletons=I),D.length>0&&(n.animations=D),O.length>0&&(n.nodes=O)}return n.object=s,n;function u(f){const v=[];for(const b in f){const S=f[b];delete S.metadata,v.push(S)}return v}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++)this.add(e.children[n].clone());return this}}Ni.DefaultUp=new me(0,1,0),Ni.DefaultMatrixAutoUpdate=!0,Ni.prototype.isObject3D=!0;const dr=new me,Nn=new me,il=new me,ds=new me,ks=new me,ps=new me,kc=new me,nl=new me,rl=new me,Yt=new me;class Ln{constructor(e=new me,t=new me,n=new me){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),dr.subVectors(e,t),s.cross(dr);const l=s.lengthSq();return l>0?s.multiplyScalar(1/Math.sqrt(l)):s.set(0,0,0)}static getBarycoord(e,t,n,s,l){dr.subVectors(s,t),Nn.subVectors(n,t),il.subVectors(e,t);const u=dr.dot(dr),f=dr.dot(Nn),v=dr.dot(il),b=Nn.dot(Nn),S=Nn.dot(il),C=u*b-f*f;if(0===C)return l.set(-2,-1,-1);const I=1/C,D=(b*v-f*S)*I,O=(u*S-f*v)*I;return l.set(1-D-O,O,D)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,ds),ds.x>=0&&ds.y>=0&&ds.x+ds.y<=1}static getUV(e,t,n,s,l,u,f,v){return this.getBarycoord(e,t,n,s,ds),v.set(0,0),v.addScaledVector(l,ds.x),v.addScaledVector(u,ds.y),v.addScaledVector(f,ds.z),v}static isFrontFacing(e,t,n,s){return dr.subVectors(n,t),Nn.subVectors(e,t),dr.cross(Nn).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return dr.subVectors(this.c,this.b),Nn.subVectors(this.a,this.b),.5*dr.cross(Nn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ln.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ln.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,s,l){return Ln.getUV(e,this.a,this.b,this.c,t,n,s,l)}containsPoint(e){return Ln.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ln.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,l=this.c;let u,f;ks.subVectors(s,n),ps.subVectors(l,n),nl.subVectors(e,n);const v=ks.dot(nl),b=ps.dot(nl);if(v<=0&&b<=0)return t.copy(n);rl.subVectors(e,s);const S=ks.dot(rl),C=ps.dot(rl);if(S>=0&&C<=S)return t.copy(s);const I=v*C-S*b;if(I<=0&&v>=0&&S<=0)return u=v/(v-S),t.copy(n).addScaledVector(ks,u);Yt.subVectors(e,l);const D=ks.dot(Yt),O=ps.dot(Yt);if(O>=0&&D<=O)return t.copy(l);const N=D*b-v*O;if(N<=0&&b>=0&&O<=0)return f=b/(b-O),t.copy(n).addScaledVector(ps,f);const j=S*O-D*C;if(j<=0&&C-S>=0&&D-O>=0)return kc.subVectors(l,s),f=(C-S)/(C-S+(D-O)),t.copy(s).addScaledVector(kc,f);const U=1/(j+N+I);return u=N*U,f=I*U,t.copy(n).addScaledVector(ks,u).addScaledVector(ps,f)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let vp=0;class Mn extends qr{constructor(){super(),Object.defineProperty(this,"id",{value:vp++}),this.uuid=or(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const s=this[t];void 0!==s?s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function s(l){const u=[];for(const f in l){const v=l[f];delete v.metadata,u.push(v)}return u}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const l=s(e.textures),u=s(e.images);l.length>0&&(n.textures=l),u.length>0&&(n.images=u)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const s=t.length;n=new Array(s);for(let l=0;l!==s;++l)n[l]=t[l].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Mn.prototype.isMaterial=!0,Mn.fromType=function(){return null};class Pr extends Mn{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new we(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Pr.prototype.isMeshBasicMaterial=!0;const hn=new me,Hl=new Mt;class un{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,l=this.itemSize;s<l;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let s=0,l=e.length;s<l;s++){let u=e[s];void 0===u&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),u=new we),t[n++]=u.r,t[n++]=u.g,t[n++]=u.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let s=0,l=e.length;s<l;s++){let u=e[s];void 0===u&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),u=new Mt),t[n++]=u.x,t[n++]=u.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let s=0,l=e.length;s<l;s++){let u=e[s];void 0===u&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),u=new me),t[n++]=u.x,t[n++]=u.y,t[n++]=u.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let s=0,l=e.length;s<l;s++){let u=e[s];void 0===u&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),u=new Rt),t[n++]=u.x,t[n++]=u.y,t[n++]=u.z,t[n++]=u.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Hl.fromBufferAttribute(this,t),Hl.applyMatrix3(e),this.setXY(t,Hl.x,Hl.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)hn.fromBufferAttribute(this,t),hn.applyMatrix3(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)hn.x=this.getX(t),hn.y=this.getY(t),hn.z=this.getZ(t),hn.applyMatrix4(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)hn.x=this.getX(t),hn.y=this.getY(t),hn.z=this.getZ(t),hn.applyNormalMatrix(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)hn.x=this.getX(t),hn.y=this.getY(t),hn.z=this.getZ(t),hn.transformDirection(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,l){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=l,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}un.prototype.isBufferAttribute=!0;class ju extends un{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class zc extends un{constructor(e,t,n){super(new Uint32Array(e),t,n)}}(class extends un{constructor(h,e,t){super(new Uint16Array(h),e,t)}}).prototype.isFloat16BufferAttribute=!0;class vn extends un{constructor(e,t,n){super(new Float32Array(e),t,n)}}let jl=0;const Jr=new ii,Wl=new Ni,Ta=new me,ms=new yt,jo=new yt,Vn=new me;class an extends qr{constructor(){super(),Object.defineProperty(this,"id",{value:jl++}),this.uuid=or(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(W(e)?zc:ju)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const l=(new se).getNormalMatrix(e);n.applyNormalMatrix(l),n.needsUpdate=!0}const s=this.attributes.tangent;return void 0!==s&&(s.transformDirection(e),s.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Jr.makeRotationFromQuaternion(e),this.applyMatrix4(Jr),this}rotateX(e){return Jr.makeRotationX(e),this.applyMatrix4(Jr),this}rotateY(e){return Jr.makeRotationY(e),this.applyMatrix4(Jr),this}rotateZ(e){return Jr.makeRotationZ(e),this.applyMatrix4(Jr),this}translate(e,t,n){return Jr.makeTranslation(e,t,n),this.applyMatrix4(Jr),this}scale(e,t,n){return Jr.makeScale(e,t,n),this.applyMatrix4(Jr),this}lookAt(e){return Wl.lookAt(e),Wl.updateMatrix(),this.applyMatrix4(Wl.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ta).negate(),this.translate(Ta.x,Ta.y,Ta.z),this}setFromPoints(e){const t=[];for(let n=0,s=e.length;n<s;n++){const l=e[n];t.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new vn(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new yt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new me(-1/0,-1/0,-1/0),new me(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++)ms.setFromBufferAttribute(t[n]),this.morphTargetsRelative?(Vn.addVectors(this.boundingBox.min,ms.min),this.boundingBox.expandByPoint(Vn),Vn.addVectors(this.boundingBox.max,ms.max),this.boundingBox.expandByPoint(Vn)):(this.boundingBox.expandByPoint(ms.min),this.boundingBox.expandByPoint(ms.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ks);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new me,1/0);if(e){const n=this.boundingSphere.center;if(ms.setFromBufferAttribute(e),t)for(let l=0,u=t.length;l<u;l++)jo.setFromBufferAttribute(t[l]),this.morphTargetsRelative?(Vn.addVectors(ms.min,jo.min),ms.expandByPoint(Vn),Vn.addVectors(ms.max,jo.max),ms.expandByPoint(Vn)):(ms.expandByPoint(jo.min),ms.expandByPoint(jo.max));ms.getCenter(n);let s=0;for(let l=0,u=e.count;l<u;l++)Vn.fromBufferAttribute(e,l),s=Math.max(s,n.distanceToSquared(Vn));if(t)for(let l=0,u=t.length;l<u;l++){const f=t[l],v=this.morphTargetsRelative;for(let b=0,S=f.count;b<S;b++)Vn.fromBufferAttribute(f,b),v&&(Ta.fromBufferAttribute(e,b),Vn.add(Ta)),s=Math.max(s,n.distanceToSquared(Vn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,s=t.position.array,l=t.normal.array,u=t.uv.array,f=s.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new un(new Float32Array(4*f),4));const v=this.getAttribute("tangent").array,b=[],S=[];for(let Oe=0;Oe<f;Oe++)b[Oe]=new me,S[Oe]=new me;const C=new me,I=new me,D=new me,O=new Mt,N=new Mt,j=new Mt,U=new me,Q=new me;function Y(Oe,Ze,et){C.fromArray(s,3*Oe),I.fromArray(s,3*Ze),D.fromArray(s,3*et),O.fromArray(u,2*Oe),N.fromArray(u,2*Ze),j.fromArray(u,2*et),I.sub(C),D.sub(C),N.sub(O),j.sub(O);const ot=1/(N.x*j.y-j.x*N.y);isFinite(ot)&&(U.copy(I).multiplyScalar(j.y).addScaledVector(D,-N.y).multiplyScalar(ot),Q.copy(D).multiplyScalar(N.x).addScaledVector(I,-j.x).multiplyScalar(ot),b[Oe].add(U),b[Ze].add(U),b[et].add(U),S[Oe].add(Q),S[Ze].add(Q),S[et].add(Q))}let Z=this.groups;0===Z.length&&(Z=[{start:0,count:n.length}]);for(let Oe=0,Ze=Z.length;Oe<Ze;++Oe){const et=Z[Oe],ot=et.start;for(let Ve=ot,at=ot+et.count;Ve<at;Ve+=3)Y(n[Ve+0],n[Ve+1],n[Ve+2])}const te=new me,oe=new me,de=new me,Ce=new me;function Le(Oe){de.fromArray(l,3*Oe),Ce.copy(de);const Ze=b[Oe];te.copy(Ze),te.sub(de.multiplyScalar(de.dot(Ze))).normalize(),oe.crossVectors(Ce,Ze);const et=oe.dot(S[Oe])<0?-1:1;v[4*Oe]=te.x,v[4*Oe+1]=te.y,v[4*Oe+2]=te.z,v[4*Oe+3]=et}for(let Oe=0,Ze=Z.length;Oe<Ze;++Oe){const et=Z[Oe],ot=et.start;for(let Ve=ot,at=ot+et.count;Ve<at;Ve+=3)Le(n[Ve+0]),Le(n[Ve+1]),Le(n[Ve+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new un(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let I=0,D=n.count;I<D;I++)n.setXYZ(I,0,0,0);const s=new me,l=new me,u=new me,f=new me,v=new me,b=new me,S=new me,C=new me;if(e)for(let I=0,D=e.count;I<D;I+=3){const O=e.getX(I+0),N=e.getX(I+1),j=e.getX(I+2);s.fromBufferAttribute(t,O),l.fromBufferAttribute(t,N),u.fromBufferAttribute(t,j),S.subVectors(u,l),C.subVectors(s,l),S.cross(C),f.fromBufferAttribute(n,O),v.fromBufferAttribute(n,N),b.fromBufferAttribute(n,j),f.add(S),v.add(S),b.add(S),n.setXYZ(O,f.x,f.y,f.z),n.setXYZ(N,v.x,v.y,v.z),n.setXYZ(j,b.x,b.y,b.z)}else for(let I=0,D=t.count;I<D;I+=3)s.fromBufferAttribute(t,I+0),l.fromBufferAttribute(t,I+1),u.fromBufferAttribute(t,I+2),S.subVectors(u,l),C.subVectors(s,l),S.cross(C),n.setXYZ(I+0,S.x,S.y,S.z),n.setXYZ(I+1,S.x,S.y,S.z),n.setXYZ(I+2,S.x,S.y,S.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const s in n){if(void 0===e.attributes[s])continue;const l=n[s].array,u=e.attributes[s],f=u.array,v=u.itemSize*t,b=Math.min(f.length,l.length-v);for(let S=0,C=v;S<b;S++,C++)l[C]=f[S]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Vn.fromBufferAttribute(e,t),Vn.normalize(),e.setXYZ(t,Vn.x,Vn.y,Vn.z)}toNonIndexed(){function e(f,v){const b=f.array,S=f.itemSize,C=f.normalized,I=new b.constructor(v.length*S);let D=0,O=0;for(let N=0,j=v.length;N<j;N++){D=f.isInterleavedBufferAttribute?v[N]*f.data.stride+f.offset:v[N]*S;for(let U=0;U<S;U++)I[O++]=b[D++]}return new un(I,S,C)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new an,n=this.index.array,s=this.attributes;for(const f in s){const v=e(s[f],n);t.setAttribute(f,v)}const l=this.morphAttributes;for(const f in l){const v=[],b=l[f];for(let S=0,C=b.length;S<C;S++){const I=e(b[S],n);v.push(I)}t.morphAttributes[f]=v}t.morphTargetsRelative=this.morphTargetsRelative;const u=this.groups;for(let f=0,v=u.length;f<v;f++){const b=u[f];t.addGroup(b.start,b.count,b.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const v=this.parameters;for(const b in v)void 0!==v[b]&&(e[b]=v[b]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const v in n)e.data.attributes[v]=n[v].toJSON(e.data);const s={};let l=!1;for(const v in this.morphAttributes){const b=this.morphAttributes[v],S=[];for(let C=0,I=b.length;C<I;C++)S.push(b[C].toJSON(e.data));S.length>0&&(s[v]=S,l=!0)}l&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const u=this.groups;u.length>0&&(e.data.groups=JSON.parse(JSON.stringify(u)));const f=this.boundingSphere;return null!==f&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const s=e.attributes;for(const b in s)this.setAttribute(b,s[b].clone(t));const l=e.morphAttributes;for(const b in l){const S=[],C=l[b];for(let I=0,D=C.length;I<D;I++)S.push(C[I].clone(t));this.morphAttributes[b]=S}this.morphTargetsRelative=e.morphTargetsRelative;const u=e.groups;for(let b=0,S=u.length;b<S;b++){const C=u[b];this.addGroup(C.start,C.count,C.materialIndex)}const f=e.boundingBox;null!==f&&(this.boundingBox=f.clone());const v=e.boundingSphere;return null!==v&&(this.boundingSphere=v.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}an.prototype.isBufferGeometry=!0;const Kr=new ii,Wo=new Dn,sl=new Ks,zs=new me,go=new me,io=new me,Zl=new me,ql=new me,$l=new me,ol=new me,Oc=new me,Bc=new me,Zo=new Mt,Fh=new Mt,Uh=new Mt,Nh=new me,Vh=new me;class di extends Ni{constructor(e=new an,t=new Pr){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,u=s.length;l<u;l++){const f=s[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=l}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,s=this.material,l=this.matrixWorld;if(void 0===s||(null===n.boundingSphere&&n.computeBoundingSphere(),sl.copy(n.boundingSphere),sl.applyMatrix4(l),!1===e.ray.intersectsSphere(sl))||(Kr.copy(l).invert(),Wo.copy(e.ray).applyMatrix4(Kr),null!==n.boundingBox&&!1===Wo.intersectsBox(n.boundingBox)))return;let u;if(n.isBufferGeometry){const f=n.index,v=n.attributes.position,b=n.morphAttributes.position,S=n.morphTargetsRelative,C=n.attributes.uv,I=n.attributes.uv2,D=n.groups,O=n.drawRange;if(null!==f)if(Array.isArray(s))for(let N=0,j=D.length;N<j;N++){const U=D[N],Q=s[U.materialIndex];for(let Y=Math.max(U.start,O.start),Z=Math.min(f.count,Math.min(U.start+U.count,O.start+O.count));Y<Z;Y+=3){const te=f.getX(Y),oe=f.getX(Y+1),de=f.getX(Y+2);u=Gh(this,Q,e,Wo,v,b,S,C,I,te,oe,de),u&&(u.faceIndex=Math.floor(Y/3),u.face.materialIndex=U.materialIndex,t.push(u))}}else for(let N=Math.max(0,O.start),j=Math.min(f.count,O.start+O.count);N<j;N+=3){const U=f.getX(N),Q=f.getX(N+1),Y=f.getX(N+2);u=Gh(this,s,e,Wo,v,b,S,C,I,U,Q,Y),u&&(u.faceIndex=Math.floor(N/3),t.push(u))}else if(void 0!==v)if(Array.isArray(s))for(let N=0,j=D.length;N<j;N++){const U=D[N],Q=s[U.materialIndex];for(let Y=Math.max(U.start,O.start),Z=Math.min(v.count,Math.min(U.start+U.count,O.start+O.count));Y<Z;Y+=3)u=Gh(this,Q,e,Wo,v,b,S,C,I,Y,Y+1,Y+2),u&&(u.faceIndex=Math.floor(Y/3),u.face.materialIndex=U.materialIndex,t.push(u))}else for(let N=Math.max(0,O.start),j=Math.min(v.count,O.start+O.count);N<j;N+=3)u=Gh(this,s,e,Wo,v,b,S,C,I,N,N+1,N+2),u&&(u.faceIndex=Math.floor(N/3),t.push(u))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Gh(h,e,t,n,s,l,u,f,v,b,S,C){zs.fromBufferAttribute(s,b),go.fromBufferAttribute(s,S),io.fromBufferAttribute(s,C);const I=h.morphTargetInfluences;if(l&&I){ol.set(0,0,0),Oc.set(0,0,0),Bc.set(0,0,0);for(let O=0,N=l.length;O<N;O++){const j=I[O],U=l[O];0!==j&&(Zl.fromBufferAttribute(U,b),ql.fromBufferAttribute(U,S),$l.fromBufferAttribute(U,C),u?(ol.addScaledVector(Zl,j),Oc.addScaledVector(ql,j),Bc.addScaledVector($l,j)):(ol.addScaledVector(Zl.sub(zs),j),Oc.addScaledVector(ql.sub(go),j),Bc.addScaledVector($l.sub(io),j)))}zs.add(ol),go.add(Oc),io.add(Bc)}h.isSkinnedMesh&&(h.boneTransform(b,zs),h.boneTransform(S,go),h.boneTransform(C,io));const D=function(O,N,j,U,Q,Y,Z,te){let oe;if(oe=1===N.side?U.intersectTriangle(Z,Y,Q,!0,te):U.intersectTriangle(Q,Y,Z,2!==N.side,te),null===oe)return null;Vh.copy(te),Vh.applyMatrix4(O.matrixWorld);const de=j.ray.origin.distanceTo(Vh);return de<j.near||de>j.far?null:{distance:de,point:Vh.clone(),object:O}}(h,e,t,n,zs,go,io,Nh);if(D){f&&(Zo.fromBufferAttribute(f,b),Fh.fromBufferAttribute(f,S),Uh.fromBufferAttribute(f,C),D.uv=Ln.getUV(Nh,zs,go,io,Zo,Fh,Uh,new Mt)),v&&(Zo.fromBufferAttribute(v,b),Fh.fromBufferAttribute(v,S),Uh.fromBufferAttribute(v,C),D.uv2=Ln.getUV(Nh,zs,go,io,Zo,Fh,Uh,new Mt));const O={a:b,b:S,c:C,normal:new me,materialIndex:0};Ln.getNormal(zs,go,io,O.normal),D.face=O}return D}di.prototype.isMesh=!0;class _o extends an{constructor(e=1,t=1,n=1,s=1,l=1,u=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:l,depthSegments:u};const f=this;s=Math.floor(s),l=Math.floor(l),u=Math.floor(u);const v=[],b=[],S=[],C=[];let I=0,D=0;function O(N,j,U,Q,Y,Z,te,oe,de,Ce,Le){const Oe=Z/de,Ze=te/Ce,et=Z/2,ot=te/2,Ve=oe/2,at=de+1,it=Ce+1;let wt=0,pt=0;const Ct=new me;for(let dt=0;dt<it;dt++){const ei=dt*Ze-ot;for(let Zt=0;Zt<at;Zt++)Ct[N]=(Zt*Oe-et)*Q,Ct[j]=ei*Y,Ct[U]=Ve,b.push(Ct.x,Ct.y,Ct.z),Ct[N]=0,Ct[j]=0,Ct[U]=oe>0?1:-1,S.push(Ct.x,Ct.y,Ct.z),C.push(Zt/de),C.push(1-dt/Ce),wt+=1}for(let dt=0;dt<Ce;dt++)for(let ei=0;ei<de;ei++){const Xt=I+ei+at*(dt+1),ni=I+(ei+1)+at*(dt+1),Te=I+(ei+1)+at*dt;v.push(I+ei+at*dt,Xt,Te),v.push(Xt,ni,Te),pt+=6}f.addGroup(D,pt,Le),D+=pt,I+=wt}O("z","y","x",-1,-1,n,t,e,u,l,0),O("z","y","x",1,-1,n,t,-e,u,l,1),O("x","z","y",1,1,e,n,t,s,u,2),O("x","z","y",1,-1,e,n,-t,s,u,3),O("x","y","z",1,-1,e,t,n,s,l,4),O("x","y","z",-1,-1,e,t,-n,s,l,5),this.setIndex(v),this.setAttribute("position",new vn(b,3)),this.setAttribute("normal",new vn(S,3)),this.setAttribute("uv",new vn(C,2))}static fromJSON(e){return new _o(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qo(h){const e={};for(const t in h){e[t]={};for(const n in h[t]){const s=h[t][n];e[t][n]=s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.clone():Array.isArray(s)?s.slice():s}}return e}function Gn(h){const e={};for(let t=0;t<h.length;t++){const n=qo(h[t]);for(const s in n)e[s]=n[s]}return e}const Wu={clone:qo,merge:Gn};class xr extends Mn{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qo(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const l=this.uniforms[s].value;t.uniforms[s]=l&&l.isTexture?{type:"t",value:l.toJSON(e).uuid}:l&&l.isColor?{type:"c",value:l.getHex()}:l&&l.isVector2?{type:"v2",value:l.toArray()}:l&&l.isVector3?{type:"v3",value:l.toArray()}:l&&l.isVector4?{type:"v4",value:l.toArray()}:l&&l.isMatrix3?{type:"m3",value:l.toArray()}:l&&l.isMatrix4?{type:"m4",value:l.toArray()}:{value:l}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const s in this.extensions)!0===this.extensions[s]&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}xr.prototype.isShaderMaterial=!0;class Fc extends Ni{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new ii,this.projectionMatrix=new ii,this.projectionMatrixInverse=new ii}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Fc.prototype.isCamera=!0;class bn extends Fc{constructor(e=50,t=1,n=.1,s=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*xa*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*po*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*xa*Math.atan(Math.tan(.5*po*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,s,l,u){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=l,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*po*this.fov)/this.zoom,n=2*t,s=this.aspect*n,l=-.5*s;const u=this.view;if(null!==this.view&&this.view.enabled){const v=u.fullWidth,b=u.fullHeight;l+=u.offsetX*s/v,t-=u.offsetY*n/b,s*=u.width/v,n*=u.height/b}const f=this.filmOffset;0!==f&&(l+=e*f/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+s,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}bn.prototype.isPerspectiveCamera=!0;class al extends Ni{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const s=new bn(90,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new me(1,0,0)),this.add(s);const l=new bn(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new me(-1,0,0)),this.add(l);const u=new bn(90,1,e,t);u.layers=this.layers,u.up.set(0,0,1),u.lookAt(new me(0,1,0)),this.add(u);const f=new bn(90,1,e,t);f.layers=this.layers,f.up.set(0,0,-1),f.lookAt(new me(0,-1,0)),this.add(f);const v=new bn(90,1,e,t);v.layers=this.layers,v.up.set(0,-1,0),v.lookAt(new me(0,0,1)),this.add(v);const b=new bn(90,1,e,t);b.layers=this.layers,b.up.set(0,-1,0),b.lookAt(new me(0,0,-1)),this.add(b)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[s,l,u,f,v,b]=this.children,S=e.xr.enabled,C=e.getRenderTarget();e.xr.enabled=!1;const I=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,s),e.setRenderTarget(n,1),e.render(t,l),e.setRenderTarget(n,2),e.render(t,u),e.setRenderTarget(n,3),e.render(t,f),e.setRenderTarget(n,4),e.render(t,v),n.texture.generateMipmaps=I,e.setRenderTarget(n,5),e.render(t,b),e.setRenderTarget(C),e.xr.enabled=S,n.texture.needsPMREMUpdate=!0}}class yo extends Dt{constructor(e,t,n,s,l,u,f,v,b,S){super(e=void 0!==e?e:[],t=void 0!==t?t:301,n,s,l,u,f,v,b,S),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}yo.prototype.isCubeTexture=!0;class $o extends Fe{constructor(e,t={}){super(e,e,t);const n={width:e,height:e,depth:1};this.texture=new yo([n,n,n,n,n,n],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:1006}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=1023,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n_uniforms={tEquirect:{value:null}},n_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",n_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new _o(5,5,5),l=new xr({name:"CubemapFromEquirect",uniforms:qo(n_uniforms),vertexShader:n_vertexShader,fragmentShader:n_fragmentShader,side:1,blending:0});l.uniforms.tEquirect.value=t;const u=new di(s,l),f=t.minFilter;return 1008===t.minFilter&&(t.minFilter=1006),new al(1,10,this).update(e,u),t.minFilter=f,u.geometry.dispose(),u.material.dispose(),this}clear(e,t,n,s){const l=e.getRenderTarget();for(let u=0;u<6;u++)e.setRenderTarget(this,u),e.clear(t,n,s);e.setRenderTarget(l)}}$o.prototype.isWebGLCubeRenderTarget=!0;const Hh=new me,Zu=new me,Hi=new se;class Ir{constructor(e=new me(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=Hh.subVectors(n,t).cross(Zu.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Hh),s=this.normal.dot(n);if(0===s)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const l=-(e.start.dot(this.normal)+this.constant)/s;return l<0||l>1?null:t.copy(n).multiplyScalar(l).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Hi.getNormalMatrix(e),s=this.coplanarPoint(Hh).applyMatrix4(e),l=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(l),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Ir.prototype.isPlane=!0;const ll=new Ks,Xl=new me;class Ea{constructor(e=new Ir,t=new Ir,n=new Ir,s=new Ir,l=new Ir,u=new Ir){this.planes=[e,t,n,s,l,u]}set(e,t,n,s,l,u){const f=this.planes;return f[0].copy(e),f[1].copy(t),f[2].copy(n),f[3].copy(s),f[4].copy(l),f[5].copy(u),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,s=n[0],l=n[1],u=n[2],f=n[3],v=n[4],b=n[5],S=n[6],C=n[7],I=n[8],D=n[9],O=n[10],N=n[11],j=n[12],U=n[13],Q=n[14],Y=n[15];return t[0].setComponents(f-s,C-v,N-I,Y-j).normalize(),t[1].setComponents(f+s,C+v,N+I,Y+j).normalize(),t[2].setComponents(f+l,C+b,N+D,Y+U).normalize(),t[3].setComponents(f-l,C-b,N-D,Y-U).normalize(),t[4].setComponents(f-u,C-S,N-O,Y-Q).normalize(),t[5].setComponents(f+u,C+S,N+O,Y+Q).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ll.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ll)}intersectsSprite(e){return ll.center.set(0,0,0),ll.radius=.7071067811865476,ll.applyMatrix4(e.matrixWorld),this.intersectsSphere(ll)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let l=0;l<6;l++)if(t[l].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(Xl.x=s.normal.x>0?e.max.x:e.min.x,Xl.y=s.normal.y>0?e.max.y:e.min.y,Xl.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Xl)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function xp(){let h=null,e=!1,t=null,n=null;function s(l,u){t(l,u),n=h.requestAnimationFrame(s)}return{start:function(){!0!==e&&null!==t&&(n=h.requestAnimationFrame(s),e=!0)},stop:function(){h.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(l){t=l},setContext:function(l){h=l}}}function Gm(h,e){const t=e.isWebGL2,n=new WeakMap;return{get:function(s){return s.isInterleavedBufferAttribute&&(s=s.data),n.get(s)},remove:function(s){s.isInterleavedBufferAttribute&&(s=s.data);const l=n.get(s);l&&(h.deleteBuffer(l.buffer),n.delete(s))},update:function(s,l){if(s.isGLBufferAttribute){const f=n.get(s);return void((!f||f.version<s.version)&&n.set(s,{buffer:s.buffer,type:s.type,bytesPerElement:s.elementSize,version:s.version}))}s.isInterleavedBufferAttribute&&(s=s.data);const u=n.get(s);void 0===u?n.set(s,function(f,v){const b=f.array,S=f.usage,C=h.createBuffer();let I;if(h.bindBuffer(v,C),h.bufferData(v,b,S),f.onUploadCallback(),b instanceof Float32Array)I=5126;else if(b instanceof Uint16Array)if(f.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");I=5131}else I=5123;else if(b instanceof Int16Array)I=5122;else if(b instanceof Uint32Array)I=5125;else if(b instanceof Int32Array)I=5124;else if(b instanceof Int8Array)I=5120;else if(b instanceof Uint8Array)I=5121;else{if(!(b instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+b);I=5121}return{buffer:C,type:I,bytesPerElement:b.BYTES_PER_ELEMENT,version:f.version}}(s,l)):u.version<s.version&&(function(f,v,b){const S=v.array,C=v.updateRange;h.bindBuffer(b,f),-1===C.count?h.bufferSubData(b,0,S):(t?h.bufferSubData(b,C.offset*S.BYTES_PER_ELEMENT,S,C.offset,C.count):h.bufferSubData(b,C.offset*S.BYTES_PER_ELEMENT,S.subarray(C.offset,C.offset+C.count)),C.count=-1)}(u.buffer,s,l),u.version=s.version)}}}class Xo extends an{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const l=e/2,u=t/2,f=Math.floor(n),v=Math.floor(s),b=f+1,S=v+1,C=e/f,I=t/v,D=[],O=[],N=[],j=[];for(let U=0;U<S;U++){const Q=U*I-u;for(let Y=0;Y<b;Y++)O.push(Y*C-l,-Q,0),N.push(0,0,1),j.push(Y/f),j.push(1-U/v)}for(let U=0;U<v;U++)for(let Q=0;Q<f;Q++){const Z=Q+b*(U+1),te=Q+1+b*(U+1),oe=Q+1+b*U;D.push(Q+b*U,Z,oe),D.push(Z,te,oe)}this.setIndex(D),this.setAttribute("position",new vn(O,3)),this.setAttribute("normal",new vn(N,3)),this.setAttribute("uv",new vn(j,2))}static fromJSON(e){return new Xo(e.width,e.height,e.widthSegments,e.heightSegments)}}const Li={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ]\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tfloat texelIndex = float( vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Ht={common:{diffuse:{value:new we(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new se},uv2Transform:{value:new se},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Mt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new we(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new we(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new se}},sprite:{diffuse:{value:new we(16777215)},opacity:{value:1},center:{value:new Mt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new se}}},Dr={basic:{uniforms:Gn([Ht.common,Ht.specularmap,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.fog]),vertexShader:Li.meshbasic_vert,fragmentShader:Li.meshbasic_frag},lambert:{uniforms:Gn([Ht.common,Ht.specularmap,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.fog,Ht.lights,{emissive:{value:new we(0)}}]),vertexShader:Li.meshlambert_vert,fragmentShader:Li.meshlambert_frag},phong:{uniforms:Gn([Ht.common,Ht.specularmap,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.fog,Ht.lights,{emissive:{value:new we(0)},specular:{value:new we(1118481)},shininess:{value:30}}]),vertexShader:Li.meshphong_vert,fragmentShader:Li.meshphong_frag},standard:{uniforms:Gn([Ht.common,Ht.envmap,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.roughnessmap,Ht.metalnessmap,Ht.fog,Ht.lights,{emissive:{value:new we(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Li.meshphysical_vert,fragmentShader:Li.meshphysical_frag},toon:{uniforms:Gn([Ht.common,Ht.aomap,Ht.lightmap,Ht.emissivemap,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.gradientmap,Ht.fog,Ht.lights,{emissive:{value:new we(0)}}]),vertexShader:Li.meshtoon_vert,fragmentShader:Li.meshtoon_frag},matcap:{uniforms:Gn([Ht.common,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,Ht.fog,{matcap:{value:null}}]),vertexShader:Li.meshmatcap_vert,fragmentShader:Li.meshmatcap_frag},points:{uniforms:Gn([Ht.points,Ht.fog]),vertexShader:Li.points_vert,fragmentShader:Li.points_frag},dashed:{uniforms:Gn([Ht.common,Ht.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Li.linedashed_vert,fragmentShader:Li.linedashed_frag},depth:{uniforms:Gn([Ht.common,Ht.displacementmap]),vertexShader:Li.depth_vert,fragmentShader:Li.depth_frag},normal:{uniforms:Gn([Ht.common,Ht.bumpmap,Ht.normalmap,Ht.displacementmap,{opacity:{value:1}}]),vertexShader:Li.meshnormal_vert,fragmentShader:Li.meshnormal_frag},sprite:{uniforms:Gn([Ht.sprite,Ht.fog]),vertexShader:Li.sprite_vert,fragmentShader:Li.sprite_frag},background:{uniforms:{uvTransform:{value:new se},t2D:{value:null}},vertexShader:Li.background_vert,fragmentShader:Li.background_frag},cube:{uniforms:Gn([Ht.envmap,{opacity:{value:1}}]),vertexShader:Li.cube_vert,fragmentShader:Li.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Li.equirect_vert,fragmentShader:Li.equirect_frag},distanceRGBA:{uniforms:Gn([Ht.common,Ht.displacementmap,{referencePosition:{value:new me},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Li.distanceRGBA_vert,fragmentShader:Li.distanceRGBA_frag},shadow:{uniforms:Gn([Ht.lights,Ht.fog,{color:{value:new we(0)},opacity:{value:1}}]),vertexShader:Li.shadow_vert,fragmentShader:Li.shadow_frag}};function Uc(h,e,t,n,s,l){const u=new we(0);let f,v,b=!0===s?0:1,S=null,C=0,I=null;function D(O,N){t.buffers.color.setClear(O.r,O.g,O.b,N,l)}return{getClearColor:function(){return u},setClearColor:function(O,N=1){u.set(O),b=N,D(u,b)},getClearAlpha:function(){return b},setClearAlpha:function(O){b=O,D(u,b)},render:function(O,N){let j=!1,U=!0===N.isScene?N.background:null;U&&U.isTexture&&(U=e.get(U));const Q=h.xr,Y=Q.getSession&&Q.getSession();Y&&"additive"===Y.environmentBlendMode&&(U=null),null===U?D(u,b):U&&U.isColor&&(D(U,1),j=!0),(h.autoClear||j)&&h.clear(h.autoClearColor,h.autoClearDepth,h.autoClearStencil),U&&(U.isCubeTexture||306===U.mapping)?(void 0===v&&(v=new di(new _o(1,1,1),new xr({name:"BackgroundCubeMaterial",uniforms:qo(Dr.cube.uniforms),vertexShader:Dr.cube.vertexShader,fragmentShader:Dr.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),v.geometry.deleteAttribute("normal"),v.geometry.deleteAttribute("uv"),v.onBeforeRender=function(Z,te,oe){this.matrixWorld.copyPosition(oe.matrixWorld)},Object.defineProperty(v.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(v)),v.material.uniforms.envMap.value=U,v.material.uniforms.flipEnvMap.value=U.isCubeTexture&&!1===U.isRenderTargetTexture?-1:1,S===U&&C===U.version&&I===h.toneMapping||(v.material.needsUpdate=!0,S=U,C=U.version,I=h.toneMapping),O.unshift(v,v.geometry,v.material,0,0,null)):U&&U.isTexture&&(void 0===f&&(f=new di(new Xo(2,2),new xr({name:"BackgroundMaterial",uniforms:qo(Dr.background.uniforms),vertexShader:Dr.background.vertexShader,fragmentShader:Dr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),Object.defineProperty(f.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(f)),f.material.uniforms.t2D.value=U,!0===U.matrixAutoUpdate&&U.updateMatrix(),f.material.uniforms.uvTransform.value.copy(U.matrix),S===U&&C===U.version&&I===h.toneMapping||(f.material.needsUpdate=!0,S=U,C=U.version,I=h.toneMapping),O.unshift(f,f.geometry,f.material,0,0,null))}}}function qu(h,e,t,n){const s=h.getParameter(34921),l=n.isWebGL2?null:e.get("OES_vertex_array_object"),u=n.isWebGL2||null!==l,f={},v=I(null);let b=v;function S(Z){return n.isWebGL2?h.bindVertexArray(Z):l.bindVertexArrayOES(Z)}function C(Z){return n.isWebGL2?h.deleteVertexArray(Z):l.deleteVertexArrayOES(Z)}function I(Z){const te=[],oe=[],de=[];for(let Ce=0;Ce<s;Ce++)te[Ce]=0,oe[Ce]=0,de[Ce]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:te,enabledAttributes:oe,attributeDivisors:de,object:Z,attributes:{},index:null}}function D(){const Z=b.newAttributes;for(let te=0,oe=Z.length;te<oe;te++)Z[te]=0}function O(Z){N(Z,0)}function N(Z,te){const de=b.enabledAttributes,Ce=b.attributeDivisors;b.newAttributes[Z]=1,0===de[Z]&&(h.enableVertexAttribArray(Z),de[Z]=1),Ce[Z]!==te&&((n.isWebGL2?h:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Z,te),Ce[Z]=te)}function j(){const Z=b.newAttributes,te=b.enabledAttributes;for(let oe=0,de=te.length;oe<de;oe++)te[oe]!==Z[oe]&&(h.disableVertexAttribArray(oe),te[oe]=0)}function U(Z,te,oe,de,Ce,Le){!0!==n.isWebGL2||5124!==oe&&5125!==oe?h.vertexAttribPointer(Z,te,oe,de,Ce,Le):h.vertexAttribIPointer(Z,te,oe,Ce,Le)}function Q(){Y(),b!==v&&(b=v,S(b.object))}function Y(){v.geometry=null,v.program=null,v.wireframe=!1}return{setup:function(Z,te,oe,de,Ce){let Le=!1;if(u){const Oe=function(Ze,et,ot){const Ve=!0===ot.wireframe;let at=f[Ze.id];void 0===at&&(at={},f[Ze.id]=at);let it=at[et.id];void 0===it&&(it={},at[et.id]=it);let wt=it[Ve];return void 0===wt&&(wt=I(n.isWebGL2?h.createVertexArray():l.createVertexArrayOES()),it[Ve]=wt),wt}(de,oe,te);b!==Oe&&(b=Oe,S(b.object)),Le=function(Ze,et){const ot=b.attributes,Ve=Ze.attributes;let at=0;for(const it in Ve){const wt=ot[it],pt=Ve[it];if(void 0===wt||wt.attribute!==pt||wt.data!==pt.data)return!0;at++}return b.attributesNum!==at||b.index!==et}(de,Ce),Le&&function(Ze,et){const ot={},Ve=Ze.attributes;let at=0;for(const it in Ve){const wt=Ve[it],pt={};pt.attribute=wt,wt.data&&(pt.data=wt.data),ot[it]=pt,at++}b.attributes=ot,b.attributesNum=at,b.index=et}(de,Ce)}else{const Oe=!0===te.wireframe;b.geometry===de.id&&b.program===oe.id&&b.wireframe===Oe||(b.geometry=de.id,b.program=oe.id,b.wireframe=Oe,Le=!0)}!0===Z.isInstancedMesh&&(Le=!0),null!==Ce&&t.update(Ce,34963),Le&&(function(Oe,Ze,et,ot){if(!1===n.isWebGL2&&(Oe.isInstancedMesh||ot.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;D();const Ve=ot.attributes,at=et.getAttributes(),it=Ze.defaultAttributeValues;for(const wt in at){const pt=at[wt];if(pt.location>=0){let Ct=Ve[wt];if(void 0===Ct&&("instanceMatrix"===wt&&Oe.instanceMatrix&&(Ct=Oe.instanceMatrix),"instanceColor"===wt&&Oe.instanceColor&&(Ct=Oe.instanceColor)),void 0!==Ct){const dt=Ct.normalized,ei=Ct.itemSize,Zt=t.get(Ct);if(void 0===Zt)continue;const Xt=Zt.buffer,ni=Zt.type,Te=Zt.bytesPerElement;if(Ct.isInterleavedBufferAttribute){const ve=Ct.data,tt=ve.stride,st=Ct.offset;if(ve.isInstancedInterleavedBuffer){for(let Pe=0;Pe<pt.locationSize;Pe++)N(pt.location+Pe,ve.meshPerAttribute);!0!==Oe.isInstancedMesh&&void 0===ot._maxInstanceCount&&(ot._maxInstanceCount=ve.meshPerAttribute*ve.count)}else for(let Pe=0;Pe<pt.locationSize;Pe++)O(pt.location+Pe);h.bindBuffer(34962,Xt);for(let Pe=0;Pe<pt.locationSize;Pe++)U(pt.location+Pe,ei/pt.locationSize,ni,dt,tt*Te,(st+ei/pt.locationSize*Pe)*Te)}else{if(Ct.isInstancedBufferAttribute){for(let ve=0;ve<pt.locationSize;ve++)N(pt.location+ve,Ct.meshPerAttribute);!0!==Oe.isInstancedMesh&&void 0===ot._maxInstanceCount&&(ot._maxInstanceCount=Ct.meshPerAttribute*Ct.count)}else for(let ve=0;ve<pt.locationSize;ve++)O(pt.location+ve);h.bindBuffer(34962,Xt);for(let ve=0;ve<pt.locationSize;ve++)U(pt.location+ve,ei/pt.locationSize,ni,dt,ei*Te,ei/pt.locationSize*ve*Te)}}else if(void 0!==it){const dt=it[wt];if(void 0!==dt)switch(dt.length){case 2:h.vertexAttrib2fv(pt.location,dt);break;case 3:h.vertexAttrib3fv(pt.location,dt);break;case 4:h.vertexAttrib4fv(pt.location,dt);break;default:h.vertexAttrib1fv(pt.location,dt)}}}}j()}(Z,te,oe,de),null!==Ce&&h.bindBuffer(34963,t.get(Ce).buffer))},reset:Q,resetDefaultState:Y,dispose:function(){Q();for(const Z in f){const te=f[Z];for(const oe in te){const de=te[oe];for(const Ce in de)C(de[Ce].object),delete de[Ce];delete te[oe]}delete f[Z]}},releaseStatesOfGeometry:function(Z){if(void 0===f[Z.id])return;const te=f[Z.id];for(const oe in te){const de=te[oe];for(const Ce in de)C(de[Ce].object),delete de[Ce];delete te[oe]}delete f[Z.id]},releaseStatesOfProgram:function(Z){for(const te in f){const oe=f[te];if(void 0===oe[Z.id])continue;const de=oe[Z.id];for(const Ce in de)C(de[Ce].object),delete de[Ce];delete oe[Z.id]}},initAttributes:D,enableAttribute:O,disableUnusedAttributes:j}}function $u(h,e,t,n){const s=n.isWebGL2;let l;this.setMode=function(u){l=u},this.render=function(u,f){h.drawArrays(l,u,f),t.update(f,l,1)},this.renderInstances=function(u,f,v){if(0===v)return;let b,S;if(s)b=h,S="drawArraysInstanced";else if(b=e.get("ANGLE_instanced_arrays"),S="drawArraysInstancedANGLE",null===b)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");b[S](l,u,f,v),t.update(f,l,v)}}function bp(h,e,t){let n;function s(Z){if("highp"===Z){if(h.getShaderPrecisionFormat(35633,36338).precision>0&&h.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Z="mediump"}return"mediump"===Z&&h.getShaderPrecisionFormat(35633,36337).precision>0&&h.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const l="undefined"!=typeof WebGL2RenderingContext&&h instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&h instanceof WebGL2ComputeRenderingContext;let u=void 0!==t.precision?t.precision:"highp";const f=s(u);f!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",f,"instead."),u=f);const v=l||e.has("WEBGL_draw_buffers"),b=!0===t.logarithmicDepthBuffer,S=h.getParameter(34930),C=h.getParameter(35660),I=h.getParameter(3379),D=h.getParameter(34076),O=h.getParameter(34921),N=h.getParameter(36347),j=h.getParameter(36348),U=h.getParameter(36349),Q=C>0,Y=l||e.has("OES_texture_float");return{isWebGL2:l,drawBuffers:v,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const Z=e.get("EXT_texture_filter_anisotropic");n=h.getParameter(Z.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:s,precision:u,logarithmicDepthBuffer:b,maxTextures:S,maxVertexTextures:C,maxTextureSize:I,maxCubemapSize:D,maxAttributes:O,maxVertexUniforms:N,maxVaryings:j,maxFragmentUniforms:U,vertexTextures:Q,floatFragmentTextures:Y,floatVertexTextures:Q&&Y,maxSamples:l?h.getParameter(36183):0}}function jh(h){const e=this;let t=null,n=0,s=!1,l=!1;const u=new Ir,f=new se,v={value:null,needsUpdate:!1};function b(){v.value!==t&&(v.value=t,v.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function S(C,I,D,O){const N=null!==C?C.length:0;let j=null;if(0!==N){if(j=v.value,!0!==O||null===j){const U=D+4*N,Q=I.matrixWorldInverse;f.getNormalMatrix(Q),(null===j||j.length<U)&&(j=new Float32Array(U));for(let Y=0,Z=D;Y!==N;++Y,Z+=4)u.copy(C[Y]).applyMatrix4(Q,f),u.normal.toArray(j,Z),j[Z+3]=u.constant}v.value=j,v.needsUpdate=!0}return e.numPlanes=N,e.numIntersection=0,j}this.uniform=v,this.numPlanes=0,this.numIntersection=0,this.init=function(C,I,D){const O=0!==C.length||I||0!==n||s;return s=I,t=S(C,D,0),n=C.length,O},this.beginShadows=function(){l=!0,S(null)},this.endShadows=function(){l=!1,b()},this.setState=function(C,I,D){const O=C.clippingPlanes,N=C.clipIntersection,j=C.clipShadows,U=h.get(C);if(!s||null===O||0===O.length||l&&!j)l?S(null):b();else{const Q=l?0:n,Y=4*Q;let Z=U.clippingState||null;v.value=Z,Z=S(O,I,Y,D);for(let te=0;te!==Y;++te)Z[te]=t[te];U.clippingState=Z,this.numIntersection=N?this.numPlanes:0,this.numPlanes+=Q}}}function Wh(h){let e=new WeakMap;function t(s,l){return 303===l?s.mapping=301:304===l&&(s.mapping=302),s}function n(s){const l=s.target;l.removeEventListener("dispose",n);const u=e.get(l);void 0!==u&&(e.delete(l),u.dispose())}return{get:function(s){if(s&&s.isTexture&&!1===s.isRenderTargetTexture){const l=s.mapping;if(303===l||304===l){if(e.has(s))return t(e.get(s).texture,s.mapping);{const u=s.image;if(u&&u.height>0){const f=new $o(u.height/2);return f.fromEquirectangularTexture(h,s),e.set(s,f),s.addEventListener("dispose",n),t(f.texture,s.mapping)}return null}}}return s},dispose:function(){e=new WeakMap}}}Dr.physical={uniforms:Gn([Dr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Mt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new we(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Mt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new we(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new we(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Li.meshphysical_vert,fragmentShader:Li.meshphysical_frag};class It extends Fc{constructor(e=-1,t=1,n=1,s=-1,l=.1,u=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=l,this.far=u,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,l,u){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=l,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let l=n-e,u=n+e,f=s+t,v=s-t;if(null!==this.view&&this.view.enabled){const b=(this.right-this.left)/this.view.fullWidth/this.zoom,S=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l+=b*this.view.offsetX,u=l+b*this.view.width,f-=S*this.view.offsetY,v=f-S*this.view.height}this.projectionMatrix.makeOrthographic(l,u,f,v,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}It.prototype.isOrthographicCamera=!0;const fs=[.125,.215,.35,.446,.526,.582],cl=new It,Xu=new we;let Zh=null;const Os=(1+Math.sqrt(5))/2,Qr=1/Os,Yl=[new me(1,1,1),new me(-1,1,1),new me(1,1,-1),new me(-1,1,-1),new me(0,Os,Qr),new me(0,Os,-Qr),new me(Qr,0,Os),new me(-Qr,0,Os),new me(Os,Qr,0),new me(-Os,Qr,0)];class Yo{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100){Zh=this._renderer.getRenderTarget(),this._setSize(256);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,n,s,l),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Ko(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Yu(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Zh),e.scissorTest=!1,Jl(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(301===e.mapping||302===e.mapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),Zh=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize-32,n={magFilter:1006,minFilter:1006,generateMipmaps:!1,type:1016,format:1023,encoding:3e3,depthBuffer:!1},s=Jo(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Jo(e,t,n);const{_lodMax:l}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(u){const f=[],v=[],b=[];let S=u;const C=u-4+1+fs.length;for(let I=0;I<C;I++){const D=Math.pow(2,S);v.push(D);let O=1/D;I>u-4?O=fs[I-u+4-1]:0===I&&(O=0),b.push(O);const N=1/(D-1),j=-N/2,U=1+N/2,Q=[j,j,U,j,U,U,j,j,U,U,j,U],Y=6,Z=6,te=3,oe=2,de=1,Ce=new Float32Array(te*Z*Y),Le=new Float32Array(oe*Z*Y),Oe=new Float32Array(de*Z*Y);for(let et=0;et<Y;et++){const ot=et%3*2/3-1,Ve=et>2?0:-1;Ce.set([ot,Ve,0,ot+2/3,Ve,0,ot+2/3,Ve+1,0,ot,Ve,0,ot+2/3,Ve+1,0,ot,Ve+1,0],te*Z*et),Le.set(Q,oe*Z*et),Oe.set([et,et,et,et,et,et],de*Z*et)}const Ze=new an;Ze.setAttribute("position",new un(Ce,te)),Ze.setAttribute("uv",new un(Le,oe)),Ze.setAttribute("faceIndex",new un(Oe,de)),f.push(Ze),S>4&&S--}return{lodPlanes:f,sizeLods:v,sigmas:b}}(l)),this._blurMaterial=function(u,f,v){const b=new Float32Array(20),S=new me(0,1,0);return new xr({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/f,CUBEUV_TEXEL_HEIGHT:1/v,CUBEUV_MAX_MIP:`${u}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:b},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:S}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(l,e,t)}return s}_compileMaterial(e){const t=new di(this._lodPlanes[0],e);this._renderer.compile(t,cl)}_sceneToCubeUV(e,t,n,s){const l=new bn(90,1,t,n),u=[1,-1,1,1,1,1],f=[1,1,1,-1,-1,-1],v=this._renderer,b=v.autoClear,S=v.toneMapping;v.getClearColor(Xu),v.toneMapping=0,v.autoClear=!1;const C=new Pr({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),I=new di(new _o,C);let D=!1;const O=e.background;O?O.isColor&&(C.color.copy(O),e.background=null,D=!0):(C.color.copy(Xu),D=!0);for(let N=0;N<6;N++){const j=N%3;0===j?(l.up.set(0,u[N],0),l.lookAt(f[N],0,0)):1===j?(l.up.set(0,0,u[N]),l.lookAt(0,f[N],0)):(l.up.set(0,u[N],0),l.lookAt(0,0,f[N]));const U=this._cubeSize;Jl(s,j*U,N>2?U:0,U,U),v.setRenderTarget(s),D&&v.render(I,l),v.render(e,l)}I.geometry.dispose(),I.material.dispose(),v.toneMapping=S,v.autoClear=b,e.background=O}_textureToCubeUV(e,t){const n=this._renderer,s=301===e.mapping||302===e.mapping;s?(null===this._cubemapMaterial&&(this._cubemapMaterial=Ko()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Yu());const l=s?this._cubemapMaterial:this._equirectMaterial,u=new di(this._lodPlanes[0],l);l.uniforms.envMap.value=e;const f=this._cubeSize;Jl(t,0,0,3*f,2*f),n.setRenderTarget(t),n.render(u,cl)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const l=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]);this._blur(e,s-1,s,l,Yl[(s-1)%Yl.length])}t.autoClear=n}_blur(e,t,n,s,l){const u=this._pingPongRenderTarget;this._halfBlur(e,u,t,n,s,"latitudinal",l),this._halfBlur(u,e,n,n,s,"longitudinal",l)}_halfBlur(e,t,n,s,l,u,f){const v=this._renderer,b=this._blurMaterial;"latitudinal"!==u&&"longitudinal"!==u&&console.error("blur direction must be either latitudinal or longitudinal!");const S=new di(this._lodPlanes[s],b),C=b.uniforms,I=this._sizeLods[n]-1,D=isFinite(l)?Math.PI/(2*I):2*Math.PI/39,O=l/D,N=isFinite(l)?1+Math.floor(3*O):20;N>20&&console.warn(`sigmaRadians, ${l}, is too large and will clip, as it requested ${N} samples when the maximum is set to 20`);const j=[];let U=0;for(let Z=0;Z<20;++Z){const te=Z/O,oe=Math.exp(-te*te/2);j.push(oe),0===Z?U+=oe:Z<N&&(U+=2*oe)}for(let Z=0;Z<j.length;Z++)j[Z]=j[Z]/U;C.envMap.value=e.texture,C.samples.value=N,C.weights.value=j,C.latitudinal.value="latitudinal"===u,f&&(C.poleAxis.value=f);const{_lodMax:Q}=this;C.dTheta.value=D,C.mipInt.value=Q-n;const Y=this._sizeLods[s];Jl(t,3*Y*(s>Q-4?s-Q+4:0),4*(this._cubeSize-Y),3*Y,2*Y),v.setRenderTarget(t),v.render(S,cl)}}function Jo(h,e,t){const n=new Fe(h,e,t);return n.texture.mapping=306,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Jl(h,e,t,n,s){h.viewport.set(e,t,n,s),h.scissor.set(e,t,n,s)}function Yu(){return new xr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Ko(){return new xr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Ju(h){let e=new WeakMap,t=null;function n(s){const l=s.target;l.removeEventListener("dispose",n);const u=e.get(l);void 0!==u&&(e.delete(l),u.dispose())}return{get:function(s){if(s&&s.isTexture){const l=s.mapping,u=303===l||304===l,f=301===l||302===l;if(u||f){if(s.isRenderTargetTexture&&!0===s.needsPMREMUpdate){s.needsPMREMUpdate=!1;let v=e.get(s);return null===t&&(t=new Yo(h)),v=u?t.fromEquirectangular(s,v):t.fromCubemap(s,v),e.set(s,v),v.texture}if(e.has(s))return e.get(s).texture;{const v=s.image;if(u&&v&&v.height>0||f&&v&&function(b){let S=0;for(let I=0;I<6;I++)void 0!==b[I]&&S++;return 6===S}(v)){null===t&&(t=new Yo(h));const b=u?t.fromEquirectangular(s):t.fromCubemap(s);return e.set(s,b),s.addEventListener("dispose",n),b.texture}return null}}}return s},dispose:function(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function $h(h){const e={};function t(n){if(void 0!==e[n])return e[n];let s;switch(n){case"WEBGL_depth_texture":s=h.getExtension("WEBGL_depth_texture")||h.getExtension("MOZ_WEBGL_depth_texture")||h.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=h.getExtension("WEBGL_compressed_texture_s3tc")||h.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=h.getExtension("WEBGL_compressed_texture_pvrtc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=h.getExtension(n)}return e[n]=s,s}return{has:function(n){return null!==t(n)},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const s=t(n);return null===s&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function Nc(h,e,t,n){const s={},l=new WeakMap;function u(v){const b=v.target;null!==b.index&&e.remove(b.index);for(const C in b.attributes)e.remove(b.attributes[C]);b.removeEventListener("dispose",u),delete s[b.id];const S=l.get(b);S&&(e.remove(S),l.delete(b)),n.releaseStatesOfGeometry(b),!0===b.isInstancedBufferGeometry&&delete b._maxInstanceCount,t.memory.geometries--}function f(v){const b=[],S=v.index,C=v.attributes.position;let I=0;if(null!==S){const N=S.array;I=S.version;for(let j=0,U=N.length;j<U;j+=3){const Q=N[j+0],Y=N[j+1],Z=N[j+2];b.push(Q,Y,Y,Z,Z,Q)}}else{I=C.version;for(let j=0,U=C.array.length/3-1;j<U;j+=3){const Q=j+0,Y=j+1,Z=j+2;b.push(Q,Y,Y,Z,Z,Q)}}const D=new(W(b)?zc:ju)(b,1);D.version=I;const O=l.get(v);O&&e.remove(O),l.set(v,D)}return{get:function(v,b){return!0===s[b.id]||(b.addEventListener("dispose",u),s[b.id]=!0,t.memory.geometries++),b},update:function(v){const b=v.attributes;for(const C in b)e.update(b[C],34962);const S=v.morphAttributes;for(const C in S){const I=S[C];for(let D=0,O=I.length;D<O;D++)e.update(I[D],34962)}},getWireframeAttribute:function(v){const b=l.get(v);if(b){const S=v.index;null!==S&&b.version<S.version&&f(v)}else f(v);return l.get(v)}}}function Vc(h,e,t,n){const s=n.isWebGL2;let l,u,f;this.setMode=function(v){l=v},this.setIndex=function(v){u=v.type,f=v.bytesPerElement},this.render=function(v,b){h.drawElements(l,b,u,v*f),t.update(b,l,1)},this.renderInstances=function(v,b,S){if(0===S)return;let C,I;if(s)C=h,I="drawElementsInstanced";else if(C=e.get("ANGLE_instanced_arrays"),I="drawElementsInstancedANGLE",null===C)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");C[I](l,b,u,v*f,S),t.update(b,l,S)}}function Ku(h){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,s){switch(e.calls++,n){case 4:e.triangles+=s*(t/3);break;case 1:e.lines+=s*(t/2);break;case 3:e.lines+=s*(t-1);break;case 2:e.lines+=s*t;break;case 0:e.points+=s*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Qu(h,e){return h[0]-e[0]}function Gc(h,e){return Math.abs(e[1])-Math.abs(h[1])}function vo(h,e){let t=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?t=127:n instanceof Int16Array?t=32767:n instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),h.divideScalar(t)}function ed(h,e,t){const n={},s=new Float32Array(8),l=new WeakMap,u=new Rt,f=[];for(let v=0;v<8;v++)f[v]=[v,0];return{update:function(v,b,S,C){const I=v.morphTargetInfluences;if(!0===e.isWebGL2){const D=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,O=void 0!==D?D.length:0;let N=l.get(b);if(void 0===N||N.count!==O){void 0!==N&&N.texture.dispose();const Q=void 0!==b.morphAttributes.position,Y=void 0!==b.morphAttributes.normal,Z=void 0!==b.morphAttributes.color,te=b.morphAttributes.position||[],oe=b.morphAttributes.normal||[],de=b.morphAttributes.color||[];let Ce=0;!0===Q&&(Ce=1),!0===Y&&(Ce=2),!0===Z&&(Ce=3);let Le=b.attributes.position.count*Ce,Oe=1;Le>e.maxTextureSize&&(Oe=Math.ceil(Le/e.maxTextureSize),Le=e.maxTextureSize);const Ze=new Float32Array(Le*Oe*4*O),et=new Di(Ze,Le,Oe,O);et.format=1023,et.type=1015,et.needsUpdate=!0;const ot=4*Ce;for(let Ve=0;Ve<O;Ve++){const at=te[Ve],it=oe[Ve],wt=de[Ve],pt=Le*Oe*4*Ve;for(let Ct=0;Ct<at.count;Ct++){const dt=Ct*ot;!0===Q&&(u.fromBufferAttribute(at,Ct),!0===at.normalized&&vo(u,at),Ze[pt+dt+0]=u.x,Ze[pt+dt+1]=u.y,Ze[pt+dt+2]=u.z,Ze[pt+dt+3]=0),!0===Y&&(u.fromBufferAttribute(it,Ct),!0===it.normalized&&vo(u,it),Ze[pt+dt+4]=u.x,Ze[pt+dt+5]=u.y,Ze[pt+dt+6]=u.z,Ze[pt+dt+7]=0),!0===Z&&(u.fromBufferAttribute(wt,Ct),!0===wt.normalized&&vo(u,it),Ze[pt+dt+8]=u.x,Ze[pt+dt+9]=u.y,Ze[pt+dt+10]=u.z,Ze[pt+dt+11]=4===wt.itemSize?u.w:1)}}N={count:O,texture:et,size:new Mt(Le,Oe)},l.set(b,N),b.addEventListener("dispose",function Ve(){et.dispose(),l.delete(b),b.removeEventListener("dispose",Ve)})}let j=0;for(let Q=0;Q<I.length;Q++)j+=I[Q];const U=b.morphTargetsRelative?1:1-j;C.getUniforms().setValue(h,"morphTargetBaseInfluence",U),C.getUniforms().setValue(h,"morphTargetInfluences",I),C.getUniforms().setValue(h,"morphTargetsTexture",N.texture,t),C.getUniforms().setValue(h,"morphTargetsTextureSize",N.size)}else{const D=void 0===I?0:I.length;let O=n[b.id];if(void 0===O||O.length!==D){O=[];for(let Y=0;Y<D;Y++)O[Y]=[Y,0];n[b.id]=O}for(let Y=0;Y<D;Y++){const Z=O[Y];Z[0]=Y,Z[1]=I[Y]}O.sort(Gc);for(let Y=0;Y<8;Y++)Y<D&&O[Y][1]?(f[Y][0]=O[Y][0],f[Y][1]=O[Y][1]):(f[Y][0]=Number.MAX_SAFE_INTEGER,f[Y][1]=0);f.sort(Qu);const N=b.morphAttributes.position,j=b.morphAttributes.normal;let U=0;for(let Y=0;Y<8;Y++){const Z=f[Y],te=Z[0],oe=Z[1];te!==Number.MAX_SAFE_INTEGER&&oe?(N&&b.getAttribute("morphTarget"+Y)!==N[te]&&b.setAttribute("morphTarget"+Y,N[te]),j&&b.getAttribute("morphNormal"+Y)!==j[te]&&b.setAttribute("morphNormal"+Y,j[te]),s[Y]=oe,U+=oe):(N&&!0===b.hasAttribute("morphTarget"+Y)&&b.deleteAttribute("morphTarget"+Y),j&&!0===b.hasAttribute("morphNormal"+Y)&&b.deleteAttribute("morphNormal"+Y),s[Y]=0)}const Q=b.morphTargetsRelative?1:1-U;C.getUniforms().setValue(h,"morphTargetBaseInfluence",Q),C.getUniforms().setValue(h,"morphTargetInfluences",s)}}}}function td(h,e,t,n){let s=new WeakMap;function l(u){const f=u.target;f.removeEventListener("dispose",l),t.remove(f.instanceMatrix),null!==f.instanceColor&&t.remove(f.instanceColor)}return{update:function(u){const f=n.render.frame,b=e.get(u,u.geometry);return s.get(b)!==f&&(e.update(b),s.set(b,f)),u.isInstancedMesh&&(!1===u.hasEventListener("dispose",l)&&u.addEventListener("dispose",l),t.update(u.instanceMatrix,34962),null!==u.instanceColor&&t.update(u.instanceColor,34962)),b},dispose:function(){s=new WeakMap}}}const Hc=new Dt,Xh=new Di,id=new Ut,xo=new yo,nd=[],rd=[],sd=new Float32Array(16),od=new Float32Array(9),ad=new Float32Array(4);function bo(h,e,t){const n=h[0];if(n<=0||n>0)return h;const s=e*t;let l=nd[s];if(void 0===l&&(l=new Float32Array(s),nd[s]=l),0!==e){n.toArray(l,0);for(let u=1,f=0;u!==e;++u)f+=t,h[u].toArray(l,f)}return l}function ji(h,e){if(h.length!==e.length)return!1;for(let t=0,n=h.length;t<n;t++)if(h[t]!==e[t])return!1;return!0}function dn(h,e){for(let t=0,n=e.length;t<n;t++)h[t]=e[t]}function Ca(h,e){let t=rd[e];void 0===t&&(t=new Int32Array(e),rd[e]=t);for(let n=0;n!==e;++n)t[n]=h.allocateTextureUnit();return t}function Hm(h,e){const t=this.cache;t[0]!==e&&(h.uniform1f(this.addr,e),t[0]=e)}function jm(h,e){const t=this.cache;if(void 0!==e.x)t[0]===e.x&&t[1]===e.y||(h.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ji(t,e))return;h.uniform2fv(this.addr,e),dn(t,e)}}function Qo(h,e){const t=this.cache;if(void 0!==e.x)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(h.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)t[0]===e.r&&t[1]===e.g&&t[2]===e.b||(h.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ji(t,e))return;h.uniform3fv(this.addr,e),dn(t,e)}}function wp(h,e){const t=this.cache;if(void 0!==e.x)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(h.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ji(t,e))return;h.uniform4fv(this.addr,e),dn(t,e)}}function hl(h,e){const t=this.cache,n=e.elements;if(void 0===n){if(ji(t,e))return;h.uniformMatrix2fv(this.addr,!1,e),dn(t,e)}else{if(ji(t,n))return;ad.set(n),h.uniformMatrix2fv(this.addr,!1,ad),dn(t,n)}}function wo(h,e){const t=this.cache,n=e.elements;if(void 0===n){if(ji(t,e))return;h.uniformMatrix3fv(this.addr,!1,e),dn(t,e)}else{if(ji(t,n))return;od.set(n),h.uniformMatrix3fv(this.addr,!1,od),dn(t,n)}}function ul(h,e){const t=this.cache,n=e.elements;if(void 0===n){if(ji(t,e))return;h.uniformMatrix4fv(this.addr,!1,e),dn(t,e)}else{if(ji(t,n))return;sd.set(n),h.uniformMatrix4fv(this.addr,!1,sd),dn(t,n)}}function Bt(h,e){const t=this.cache;t[0]!==e&&(h.uniform1i(this.addr,e),t[0]=e)}function Mp(h,e){const t=this.cache;ji(t,e)||(h.uniform2iv(this.addr,e),dn(t,e))}function Yh(h,e){const t=this.cache;ji(t,e)||(h.uniform3iv(this.addr,e),dn(t,e))}function jc(h,e){const t=this.cache;ji(t,e)||(h.uniform4iv(this.addr,e),dn(t,e))}function Kl(h,e){const t=this.cache;t[0]!==e&&(h.uniform1ui(this.addr,e),t[0]=e)}function ld(h,e){const t=this.cache;ji(t,e)||(h.uniform2uiv(this.addr,e),dn(t,e))}function Sp(h,e){const t=this.cache;ji(t,e)||(h.uniform3uiv(this.addr,e),dn(t,e))}function Jh(h,e){const t=this.cache;ji(t,e)||(h.uniform4uiv(this.addr,e),dn(t,e))}function Wc(h,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(h.uniform1i(this.addr,s),n[0]=s),t.setTexture2D(e||Hc,s)}function cd(h,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(h.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||id,s)}function Tp(h,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(h.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||xo,s)}function hd(h,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(h.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||Xh,s)}function Kh(h,e){h.uniform1fv(this.addr,e)}function Zc(h,e){const t=bo(e,this.size,2);h.uniform2fv(this.addr,t)}function Qh(h,e){const t=bo(e,this.size,3);h.uniform3fv(this.addr,t)}function Ep(h,e){const t=bo(e,this.size,4);h.uniform4fv(this.addr,t)}function Cp(h,e){const t=bo(e,this.size,4);h.uniformMatrix2fv(this.addr,!1,t)}function Ap(h,e){const t=bo(e,this.size,9);h.uniformMatrix3fv(this.addr,!1,t)}function ud(h,e){const t=bo(e,this.size,16);h.uniformMatrix4fv(this.addr,!1,t)}function Pp(h,e){h.uniform1iv(this.addr,e)}function Ip(h,e){h.uniform2iv(this.addr,e)}function Dp(h,e){h.uniform3iv(this.addr,e)}function dd(h,e){h.uniform4iv(this.addr,e)}function Lp(h,e){h.uniform1uiv(this.addr,e)}function Rp(h,e){h.uniform2uiv(this.addr,e)}function kp(h,e){h.uniform3uiv(this.addr,e)}function qc(h,e){h.uniform4uiv(this.addr,e)}function pd(h,e,t){const n=e.length,s=Ca(t,n);h.uniform1iv(this.addr,s);for(let l=0;l!==n;++l)t.setTexture2D(e[l]||Hc,s[l])}function zp(h,e,t){const n=e.length,s=Ca(t,n);h.uniform1iv(this.addr,s);for(let l=0;l!==n;++l)t.setTexture3D(e[l]||id,s[l])}function Ql(h,e,t){const n=e.length,s=Ca(t,n);h.uniform1iv(this.addr,s);for(let l=0;l!==n;++l)t.setTextureCube(e[l]||xo,s[l])}function Op(h,e,t){const n=e.length,s=Ca(t,n);h.uniform1iv(this.addr,s);for(let l=0;l!==n;++l)t.setTexture2DArray(e[l]||Xh,s[l])}function eu(h,e,t){this.id=h,this.addr=t,this.cache=[],this.setValue=function(n){switch(n){case 5126:return Hm;case 35664:return jm;case 35665:return Qo;case 35666:return wp;case 35674:return hl;case 35675:return wo;case 35676:return ul;case 5124:case 35670:return Bt;case 35667:case 35671:return Mp;case 35668:case 35672:return Yh;case 35669:case 35673:return jc;case 5125:return Kl;case 36294:return ld;case 36295:return Sp;case 36296:return Jh;case 35678:case 36198:case 36298:case 36306:case 35682:return Wc;case 35679:case 36299:case 36307:return cd;case 35680:case 36300:case 36308:case 36293:return Tp;case 36289:case 36303:case 36311:case 36292:return hd}}(e.type)}function tu(h,e,t){this.id=h,this.addr=t,this.cache=[],this.size=e.size,this.setValue=function(n){switch(n){case 5126:return Kh;case 35664:return Zc;case 35665:return Qh;case 35666:return Ep;case 35674:return Cp;case 35675:return Ap;case 35676:return ud;case 5124:case 35670:return Pp;case 35667:case 35671:return Ip;case 35668:case 35672:return Dp;case 35669:case 35673:return dd;case 5125:return Lp;case 36294:return Rp;case 36295:return kp;case 36296:return qc;case 35678:case 36198:case 36298:case 36306:case 35682:return pd;case 35679:case 36299:case 36307:return zp;case 35680:case 36300:case 36308:case 36293:return Ql;case 36289:case 36303:case 36311:case 36292:return Op}}(e.type)}function $c(h){this.id=h,this.seq=[],this.map={}}tu.prototype.updateCache=function(h){const e=this.cache;h instanceof Float32Array&&e.length!==h.length&&(this.cache=new Float32Array(h.length)),dn(e,h)},$c.prototype.setValue=function(h,e,t){const n=this.seq;for(let s=0,l=n.length;s!==l;++s){const u=n[s];u.setValue(h,e[u.id],t)}};const iu=/(\w+)(\])?(\[|\.)?/g;function md(h,e){h.seq.push(e),h.map[e.id]=e}function nu(h,e,t){const n=h.name,s=n.length;for(iu.lastIndex=0;;){const l=iu.exec(n),u=iu.lastIndex;let f=l[1];const b=l[3];if("]"===l[2]&&(f|=0),void 0===b||"["===b&&u+2===s){md(t,void 0===b?new eu(f,h,e):new tu(f,h,e));break}{let S=t.map[f];void 0===S&&(S=new $c(f),md(t,S)),t=S}}}function no(h,e){this.seq=[],this.map={};const t=h.getProgramParameter(e,35718);for(let n=0;n<t;++n){const s=h.getActiveUniform(e,n);nu(s,h.getUniformLocation(e,s.name),this)}}function Xc(h,e,t){const n=h.createShader(e);return h.shaderSource(n,t),h.compileShader(n),n}no.prototype.setValue=function(h,e,t,n){const s=this.map[e];void 0!==s&&s.setValue(h,t,n)},no.prototype.setOptional=function(h,e,t){const n=e[t];void 0!==n&&this.setValue(h,t,n)},no.upload=function(h,e,t,n){for(let s=0,l=e.length;s!==l;++s){const u=e[s],f=t[u.id];!1!==f.needsUpdate&&u.setValue(h,f.value,n)}},no.seqWithValue=function(h,e){const t=[];for(let n=0,s=h.length;n!==s;++n){const l=h[n];l.id in e&&t.push(l)}return t};let Wm=0;function Bp(h,e,t){const n=h.getShaderParameter(e,35713),s=h.getShaderInfoLog(e).trim();return n&&""===s?"":t.toUpperCase()+"\n\n"+s+"\n\n"+function(l){const u=l.split("\n");for(let f=0;f<u.length;f++)u[f]=f+1+": "+u[f];return u.join("\n")}(h.getShaderSource(e))}function fd(h,e){const t=function(n){switch(n){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}(e);return"vec4 "+h+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Yc(h,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+h+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function dl(h){return""!==h}function ru(h,e){return h.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Lr(h,e){return h.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const gs=/^[ \t]*#include +<([\w\d./]+)>/gm;function pl(h){return h.replace(gs,ml)}function ml(h,e){const t=Li[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return pl(t)}const gd=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,su=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function fl(h){return h.replace(su,ln).replace(gd,Bs)}function Bs(h,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ln(0,e,t,n)}function ln(h,e,t,n){let s="";for(let l=parseInt(e);l<parseInt(t);l++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return s}function ec(h){let e="precision "+h.precision+" float;\nprecision "+h.precision+" int;";return"highp"===h.precision?e+="\n#define HIGH_PRECISION":"mediump"===h.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===h.precision&&(e+="\n#define LOW_PRECISION"),e}function tc(h,e,t,n){const s=h.getContext(),l=t.defines;let u=t.vertexShader,f=t.fragmentShader;const v=function(Ce){let Le="SHADOWMAP_TYPE_BASIC";return 1===Ce.shadowMapType?Le="SHADOWMAP_TYPE_PCF":2===Ce.shadowMapType?Le="SHADOWMAP_TYPE_PCF_SOFT":3===Ce.shadowMapType&&(Le="SHADOWMAP_TYPE_VSM"),Le}(t),b=function(Ce){let Le="ENVMAP_TYPE_CUBE";if(Ce.envMap)switch(Ce.envMapMode){case 301:case 302:Le="ENVMAP_TYPE_CUBE";break;case 306:case 307:Le="ENVMAP_TYPE_CUBE_UV"}return Le}(t),S=function(Ce){let Le="ENVMAP_MODE_REFLECTION";if(Ce.envMap)switch(Ce.envMapMode){case 302:case 307:Le="ENVMAP_MODE_REFRACTION"}return Le}(t),C=function(Ce){let Le="ENVMAP_BLENDING_NONE";if(Ce.envMap)switch(Ce.combine){case 0:Le="ENVMAP_BLENDING_MULTIPLY";break;case 1:Le="ENVMAP_BLENDING_MIX";break;case 2:Le="ENVMAP_BLENDING_ADD"}return Le}(t),I=function(Ce){const Le=Ce.envMapCubeUVHeight;if(null===Le)return null;const Oe=Math.log2(Le/32+1)+3,Ze=1/Le;return{texelWidth:1/(3*Math.max(Math.pow(2,Oe),112)),texelHeight:Ze,maxMip:Oe}}(t),D=t.isWebGL2?"":[(Ce=t).extensionDerivatives||Ce.envMapCubeUVHeight||Ce.bumpMap||Ce.tangentSpaceNormalMap||Ce.clearcoatNormalMap||Ce.flatShading||"physical"===Ce.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(Ce.extensionFragDepth||Ce.logarithmicDepthBuffer)&&Ce.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Ce.extensionDrawBuffers&&Ce.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Ce.extensionShaderTextureLOD||Ce.envMap||Ce.transmission)&&Ce.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(dl).join("\n"),O=function(Ce){const Le=[];for(const Oe in Ce){const Ze=Ce[Oe];!1!==Ze&&Le.push("#define "+Oe+" "+Ze)}return Le.join("\n")}(l),N=s.createProgram();var Ce;let j,U,Q=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(j=[O].filter(dl).join("\n"),j.length>0&&(j+="\n"),U=[D,O].filter(dl).join("\n"),U.length>0&&(U+="\n")):(j=[ec(t),"#define SHADER_NAME "+t.shaderName,O,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+S:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+v:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(dl).join("\n"),U=[D,ec(t),"#define SHADER_NAME "+t.shaderName,O,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+b:"",t.envMap?"#define "+S:"",t.envMap?"#define "+C:"",I?"#define CUBEUV_TEXEL_WIDTH "+I.texelWidth:"",I?"#define CUBEUV_TEXEL_HEIGHT "+I.texelHeight:"",I?"#define CUBEUV_MAX_MIP "+I.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+v:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?Li.tonemapping_pars_fragment:"",0!==t.toneMapping?Yc("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Li.encodings_pars_fragment,fd("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(dl).join("\n")),u=pl(u),u=ru(u,t),u=Lr(u,t),f=pl(f),f=ru(f,t),f=Lr(f,t),u=fl(u),f=fl(f),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(Q="#version 300 es\n",j=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+j,U=["#define varying in","300 es"===t.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+U);const Y=Q+U+f,Z=Xc(s,35633,Q+j+u),te=Xc(s,35632,Y);if(s.attachShader(N,Z),s.attachShader(N,te),void 0!==t.index0AttributeName?s.bindAttribLocation(N,0,t.index0AttributeName):!0===t.morphTargets&&s.bindAttribLocation(N,0,"position"),s.linkProgram(N),h.debug.checkShaderErrors){const Ce=s.getProgramInfoLog(N).trim(),Le=s.getShaderInfoLog(Z).trim(),Oe=s.getShaderInfoLog(te).trim();let Ze=!0,et=!0;if(!1===s.getProgramParameter(N,35714)){Ze=!1;const ot=Bp(s,Z,"vertex"),Ve=Bp(s,te,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(N,35715)+"\n\nProgram Info Log: "+Ce+"\n"+ot+"\n"+Ve)}else""!==Ce?console.warn("THREE.WebGLProgram: Program Info Log:",Ce):""!==Le&&""!==Oe||(et=!1);et&&(this.diagnostics={runnable:Ze,programLog:Ce,vertexShader:{log:Le,prefix:j},fragmentShader:{log:Oe,prefix:U}})}let oe,de;return s.deleteShader(Z),s.deleteShader(te),this.getUniforms=function(){return void 0===oe&&(oe=new no(s,N)),oe},this.getAttributes=function(){return void 0===de&&(de=function(Ce,Le){const Oe={},Ze=Ce.getProgramParameter(Le,35721);for(let et=0;et<Ze;et++){const ot=Ce.getActiveAttrib(Le,et),Ve=ot.name;let at=1;35674===ot.type&&(at=2),35675===ot.type&&(at=3),35676===ot.type&&(at=4),Oe[Ve]={type:ot.type,location:Ce.getAttribLocation(Le,Ve),locationSize:at}}return Oe}(s,N)),de},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(N),this.program=void 0},this.name=t.shaderName,this.id=Wm++,this.cacheKey=e,this.usedTimes=1,this.program=N,this.vertexShader=Z,this.fragmentShader=te,this}let g=0;class r{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.fragmentShader,s=this._getShaderStage(e.vertexShader),l=this._getShaderStage(n),u=this._getShaderCacheForMaterial(e);return!1===u.has(s)&&(u.add(s),s.usedTimes++),!1===u.has(l)&&(u.add(l),l.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const n=new d;t.set(e,n)}return t.get(e)}}class d{constructor(){this.id=g++,this.usedTimes=0}}function y(h,e,t,n,s,l,u){const f=new Lc,v=new r,b=[],S=s.isWebGL2,C=s.logarithmicDepthBuffer,I=s.floatVertexTextures,D=s.maxVertexUniforms,O=s.vertexTextures;let N=s.precision;const j={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(U,Q,Y,Z,te){const oe=Z.fog,de=te.geometry,Le=(U.isMeshStandardMaterial?t:e).get(U.envMap||(U.isMeshStandardMaterial?Z.environment:null)),Oe=!Le||306!==Le.mapping&&307!==Le.mapping?null:Le.image.height,Ze=j[U.type],et=te.isSkinnedMesh?function(Xt){const ni=Xt.skeleton.bones;if(I)return 1024;{const ve=Math.floor((D-20)/4),tt=Math.min(ve,ni.length);return tt<ni.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+ni.length+" bones. This GPU supports "+tt+"."),0):tt}}(te):0;null!==U.precision&&(N=s.getMaxPrecision(U.precision),N!==U.precision&&console.warn("THREE.WebGLProgram.getParameters:",U.precision,"not supported, using",N,"instead."));const ot=de.morphAttributes.position||de.morphAttributes.normal||de.morphAttributes.color,Ve=void 0!==ot?ot.length:0;let at,it,wt,pt,Ct=0;if(void 0!==de.morphAttributes.position&&(Ct=1),void 0!==de.morphAttributes.normal&&(Ct=2),void 0!==de.morphAttributes.color&&(Ct=3),Ze){const Xt=Dr[Ze];at=Xt.vertexShader,it=Xt.fragmentShader}else at=U.vertexShader,it=U.fragmentShader,v.update(U),wt=v.getVertexShaderID(U),pt=v.getFragmentShaderID(U);const dt=h.getRenderTarget(),Zt=U.clearcoat>0;return{isWebGL2:S,shaderID:Ze,shaderName:U.type,vertexShader:at,fragmentShader:it,defines:U.defines,customVertexShaderID:wt,customFragmentShaderID:pt,isRawShaderMaterial:!0===U.isRawShaderMaterial,glslVersion:U.glslVersion,precision:N,instancing:!0===te.isInstancedMesh,instancingColor:!0===te.isInstancedMesh&&null!==te.instanceColor,supportsVertexTextures:O,outputEncoding:null===dt?h.outputEncoding:!0===dt.isXRRenderTarget?dt.texture.encoding:3e3,map:!!U.map,matcap:!!U.matcap,envMap:!!Le,envMapMode:Le&&Le.mapping,envMapCubeUVHeight:Oe,lightMap:!!U.lightMap,aoMap:!!U.aoMap,emissiveMap:!!U.emissiveMap,bumpMap:!!U.bumpMap,normalMap:!!U.normalMap,objectSpaceNormalMap:1===U.normalMapType,tangentSpaceNormalMap:0===U.normalMapType,decodeVideoTexture:!!U.map&&!0===U.map.isVideoTexture&&3001===U.map.encoding,clearcoat:Zt,clearcoatMap:Zt&&!!U.clearcoatMap,clearcoatRoughnessMap:Zt&&!!U.clearcoatRoughnessMap,clearcoatNormalMap:Zt&&!!U.clearcoatNormalMap,displacementMap:!!U.displacementMap,roughnessMap:!!U.roughnessMap,metalnessMap:!!U.metalnessMap,specularMap:!!U.specularMap,specularIntensityMap:!!U.specularIntensityMap,specularColorMap:!!U.specularColorMap,opaque:!1===U.transparent&&1===U.blending,alphaMap:!!U.alphaMap,alphaTest:U.alphaTest>0,gradientMap:!!U.gradientMap,sheen:U.sheen>0,sheenColorMap:!!U.sheenColorMap,sheenRoughnessMap:!!U.sheenRoughnessMap,transmission:U.transmission>0,transmissionMap:!!U.transmissionMap,thicknessMap:!!U.thicknessMap,combine:U.combine,vertexTangents:!!U.normalMap&&!!de.attributes.tangent,vertexColors:U.vertexColors,vertexAlphas:!0===U.vertexColors&&!!de.attributes.color&&4===de.attributes.color.itemSize,vertexUvs:!!(U.map||U.bumpMap||U.normalMap||U.specularMap||U.alphaMap||U.emissiveMap||U.roughnessMap||U.metalnessMap||U.clearcoatMap||U.clearcoatRoughnessMap||U.clearcoatNormalMap||U.displacementMap||U.transmissionMap||U.thicknessMap||U.specularIntensityMap||U.specularColorMap||U.sheenColorMap||U.sheenRoughnessMap),uvsVertexOnly:!(U.map||U.bumpMap||U.normalMap||U.specularMap||U.alphaMap||U.emissiveMap||U.roughnessMap||U.metalnessMap||U.clearcoatNormalMap||U.transmission>0||U.transmissionMap||U.thicknessMap||U.specularIntensityMap||U.specularColorMap||U.sheen>0||U.sheenColorMap||U.sheenRoughnessMap||!U.displacementMap),fog:!!oe,useFog:U.fog,fogExp2:oe&&oe.isFogExp2,flatShading:!!U.flatShading,sizeAttenuation:U.sizeAttenuation,logarithmicDepthBuffer:C,skinning:!0===te.isSkinnedMesh&&et>0,maxBones:et,useVertexTexture:I,morphTargets:void 0!==de.morphAttributes.position,morphNormals:void 0!==de.morphAttributes.normal,morphColors:void 0!==de.morphAttributes.color,morphTargetsCount:Ve,morphTextureStride:Ct,numDirLights:Q.directional.length,numPointLights:Q.point.length,numSpotLights:Q.spot.length,numRectAreaLights:Q.rectArea.length,numHemiLights:Q.hemi.length,numDirLightShadows:Q.directionalShadowMap.length,numPointLightShadows:Q.pointShadowMap.length,numSpotLightShadows:Q.spotShadowMap.length,numClippingPlanes:u.numPlanes,numClipIntersection:u.numIntersection,dithering:U.dithering,shadowMapEnabled:h.shadowMap.enabled&&Y.length>0,shadowMapType:h.shadowMap.type,toneMapping:U.toneMapped?h.toneMapping:0,physicallyCorrectLights:h.physicallyCorrectLights,premultipliedAlpha:U.premultipliedAlpha,doubleSided:2===U.side,flipSided:1===U.side,depthPacking:void 0!==U.depthPacking&&U.depthPacking,index0AttributeName:U.index0AttributeName,extensionDerivatives:U.extensions&&U.extensions.derivatives,extensionFragDepth:U.extensions&&U.extensions.fragDepth,extensionDrawBuffers:U.extensions&&U.extensions.drawBuffers,extensionShaderTextureLOD:U.extensions&&U.extensions.shaderTextureLOD,rendererExtensionFragDepth:S||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:S||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:S||n.has("EXT_shader_texture_lod"),customProgramCacheKey:U.customProgramCacheKey()}},getProgramCacheKey:function(U){const Q=[];if(U.shaderID?Q.push(U.shaderID):(Q.push(U.customVertexShaderID),Q.push(U.customFragmentShaderID)),void 0!==U.defines)for(const Y in U.defines)Q.push(Y),Q.push(U.defines[Y]);return!1===U.isRawShaderMaterial&&((Y=Q).push((Z=U).precision),Y.push(Z.outputEncoding),Y.push(Z.envMapMode),Y.push(Z.envMapCubeUVHeight),Y.push(Z.combine),Y.push(Z.vertexUvs),Y.push(Z.fogExp2),Y.push(Z.sizeAttenuation),Y.push(Z.maxBones),Y.push(Z.morphTargetsCount),Y.push(Z.morphAttributeCount),Y.push(Z.numDirLights),Y.push(Z.numPointLights),Y.push(Z.numSpotLights),Y.push(Z.numHemiLights),Y.push(Z.numRectAreaLights),Y.push(Z.numDirLightShadows),Y.push(Z.numPointLightShadows),Y.push(Z.numSpotLightShadows),Y.push(Z.shadowMapType),Y.push(Z.toneMapping),Y.push(Z.numClippingPlanes),Y.push(Z.numClipIntersection),function(Y,Z){f.disableAll(),Z.isWebGL2&&f.enable(0),Z.supportsVertexTextures&&f.enable(1),Z.instancing&&f.enable(2),Z.instancingColor&&f.enable(3),Z.map&&f.enable(4),Z.matcap&&f.enable(5),Z.envMap&&f.enable(6),Z.lightMap&&f.enable(7),Z.aoMap&&f.enable(8),Z.emissiveMap&&f.enable(9),Z.bumpMap&&f.enable(10),Z.normalMap&&f.enable(11),Z.objectSpaceNormalMap&&f.enable(12),Z.tangentSpaceNormalMap&&f.enable(13),Z.clearcoat&&f.enable(14),Z.clearcoatMap&&f.enable(15),Z.clearcoatRoughnessMap&&f.enable(16),Z.clearcoatNormalMap&&f.enable(17),Z.displacementMap&&f.enable(18),Z.specularMap&&f.enable(19),Z.roughnessMap&&f.enable(20),Z.metalnessMap&&f.enable(21),Z.gradientMap&&f.enable(22),Z.alphaMap&&f.enable(23),Z.alphaTest&&f.enable(24),Z.vertexColors&&f.enable(25),Z.vertexAlphas&&f.enable(26),Z.vertexUvs&&f.enable(27),Z.vertexTangents&&f.enable(28),Z.uvsVertexOnly&&f.enable(29),Z.fog&&f.enable(30),Y.push(f.mask),f.disableAll(),Z.useFog&&f.enable(0),Z.flatShading&&f.enable(1),Z.logarithmicDepthBuffer&&f.enable(2),Z.skinning&&f.enable(3),Z.useVertexTexture&&f.enable(4),Z.morphTargets&&f.enable(5),Z.morphNormals&&f.enable(6),Z.morphColors&&f.enable(7),Z.premultipliedAlpha&&f.enable(8),Z.shadowMapEnabled&&f.enable(9),Z.physicallyCorrectLights&&f.enable(10),Z.doubleSided&&f.enable(11),Z.flipSided&&f.enable(12),Z.depthPacking&&f.enable(13),Z.dithering&&f.enable(14),Z.specularIntensityMap&&f.enable(15),Z.specularColorMap&&f.enable(16),Z.transmission&&f.enable(17),Z.transmissionMap&&f.enable(18),Z.thicknessMap&&f.enable(19),Z.sheen&&f.enable(20),Z.sheenColorMap&&f.enable(21),Z.sheenRoughnessMap&&f.enable(22),Z.decodeVideoTexture&&f.enable(23),Z.opaque&&f.enable(24),Y.push(f.mask)}(Q,U),Q.push(h.outputEncoding)),Q.push(U.customProgramCacheKey),Q.join();var Y,Z},getUniforms:function(U){const Q=j[U.type];let Y;return Y=Q?Wu.clone(Dr[Q].uniforms):U.uniforms,Y},acquireProgram:function(U,Q){let Y;for(let Z=0,te=b.length;Z<te;Z++){const oe=b[Z];if(oe.cacheKey===Q){Y=oe,++Y.usedTimes;break}}return void 0===Y&&(Y=new tc(h,Q,U,l),b.push(Y)),Y},releaseProgram:function(U){if(0==--U.usedTimes){const Q=b.indexOf(U);b[Q]=b[b.length-1],b.pop(),U.destroy()}},releaseShaderCache:function(U){v.remove(U)},programs:b,dispose:function(){v.dispose()}}}function M(){let h=new WeakMap;return{get:function(e){let t=h.get(e);return void 0===t&&(t={},h.set(e,t)),t},remove:function(e){h.delete(e)},update:function(e,t,n){h.get(e)[t]=n},dispose:function(){h=new WeakMap}}}function T(h,e){return h.groupOrder!==e.groupOrder?h.groupOrder-e.groupOrder:h.renderOrder!==e.renderOrder?h.renderOrder-e.renderOrder:h.material.id!==e.material.id?h.material.id-e.material.id:h.z!==e.z?h.z-e.z:h.id-e.id}function A(h,e){return h.groupOrder!==e.groupOrder?h.groupOrder-e.groupOrder:h.renderOrder!==e.renderOrder?h.renderOrder-e.renderOrder:h.z!==e.z?e.z-h.z:h.id-e.id}function L(){const h=[];let e=0;const t=[],n=[],s=[];function l(u,f,v,b,S,C){let I=h[e];return void 0===I?(I={id:u.id,object:u,geometry:f,material:v,groupOrder:b,renderOrder:u.renderOrder,z:S,group:C},h[e]=I):(I.id=u.id,I.object=u,I.geometry=f,I.material=v,I.groupOrder=b,I.renderOrder=u.renderOrder,I.z=S,I.group=C),e++,I}return{opaque:t,transmissive:n,transparent:s,init:function(){e=0,t.length=0,n.length=0,s.length=0},push:function(u,f,v,b,S,C){const I=l(u,f,v,b,S,C);v.transmission>0?n.push(I):!0===v.transparent?s.push(I):t.push(I)},unshift:function(u,f,v,b,S,C){const I=l(u,f,v,b,S,C);v.transmission>0?n.unshift(I):!0===v.transparent?s.unshift(I):t.unshift(I)},finish:function(){for(let u=e,f=h.length;u<f;u++){const v=h[u];if(null===v.id)break;v.id=null,v.object=null,v.geometry=null,v.material=null,v.group=null}},sort:function(u,f){t.length>1&&t.sort(u||T),n.length>1&&n.sort(f||A),s.length>1&&s.sort(f||A)}}}function F(){let h=new WeakMap;return{get:function(e,t){let n;return!1===h.has(e)?(n=new L,h.set(e,[n])):t>=h.get(e).length?(n=new L,h.get(e).push(n)):n=h.get(e)[t],n},dispose:function(){h=new WeakMap}}}function V(){const h={};return{get:function(e){if(void 0!==h[e.id])return h[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new me,color:new we};break;case"SpotLight":t={position:new me,direction:new me,color:new we,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new me,color:new we,distance:0,decay:0};break;case"HemisphereLight":t={direction:new me,skyColor:new we,groundColor:new we};break;case"RectAreaLight":t={color:new we,position:new me,halfWidth:new me,halfHeight:new me}}return h[e.id]=t,t}}}let G=0;function q(h,e){return(e.castShadow?1:0)-(h.castShadow?1:0)}function ee(h,e){const t=new V,n=function(){const v={};return{get:function(b){if(void 0!==v[b.id])return v[b.id];let S;switch(b.type){case"DirectionalLight":case"SpotLight":S={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mt};break;case"PointLight":S={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mt,shadowCameraNear:1,shadowCameraFar:1e3}}return v[b.id]=S,S}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let v=0;v<9;v++)s.probe.push(new me);const l=new me,u=new ii,f=new ii;return{setup:function(v,b){let S=0,C=0,I=0;for(let de=0;de<9;de++)s.probe[de].set(0,0,0);let D=0,O=0,N=0,j=0,U=0,Q=0,Y=0,Z=0;v.sort(q);const te=!0!==b?Math.PI:1;for(let de=0,Ce=v.length;de<Ce;de++){const Le=v[de],Oe=Le.color,Ze=Le.intensity,et=Le.distance,ot=Le.shadow&&Le.shadow.map?Le.shadow.map.texture:null;if(Le.isAmbientLight)S+=Oe.r*Ze*te,C+=Oe.g*Ze*te,I+=Oe.b*Ze*te;else if(Le.isLightProbe)for(let Ve=0;Ve<9;Ve++)s.probe[Ve].addScaledVector(Le.sh.coefficients[Ve],Ze);else if(Le.isDirectionalLight){const Ve=t.get(Le);if(Ve.color.copy(Le.color).multiplyScalar(Le.intensity*te),Le.castShadow){const at=Le.shadow,it=n.get(Le);it.shadowBias=at.bias,it.shadowNormalBias=at.normalBias,it.shadowRadius=at.radius,it.shadowMapSize=at.mapSize,s.directionalShadow[D]=it,s.directionalShadowMap[D]=ot,s.directionalShadowMatrix[D]=Le.shadow.matrix,Q++}s.directional[D]=Ve,D++}else if(Le.isSpotLight){const Ve=t.get(Le);if(Ve.position.setFromMatrixPosition(Le.matrixWorld),Ve.color.copy(Oe).multiplyScalar(Ze*te),Ve.distance=et,Ve.coneCos=Math.cos(Le.angle),Ve.penumbraCos=Math.cos(Le.angle*(1-Le.penumbra)),Ve.decay=Le.decay,Le.castShadow){const at=Le.shadow,it=n.get(Le);it.shadowBias=at.bias,it.shadowNormalBias=at.normalBias,it.shadowRadius=at.radius,it.shadowMapSize=at.mapSize,s.spotShadow[N]=it,s.spotShadowMap[N]=ot,s.spotShadowMatrix[N]=Le.shadow.matrix,Z++}s.spot[N]=Ve,N++}else if(Le.isRectAreaLight){const Ve=t.get(Le);Ve.color.copy(Oe).multiplyScalar(Ze),Ve.halfWidth.set(.5*Le.width,0,0),Ve.halfHeight.set(0,.5*Le.height,0),s.rectArea[j]=Ve,j++}else if(Le.isPointLight){const Ve=t.get(Le);if(Ve.color.copy(Le.color).multiplyScalar(Le.intensity*te),Ve.distance=Le.distance,Ve.decay=Le.decay,Le.castShadow){const at=Le.shadow,it=n.get(Le);it.shadowBias=at.bias,it.shadowNormalBias=at.normalBias,it.shadowRadius=at.radius,it.shadowMapSize=at.mapSize,it.shadowCameraNear=at.camera.near,it.shadowCameraFar=at.camera.far,s.pointShadow[O]=it,s.pointShadowMap[O]=ot,s.pointShadowMatrix[O]=Le.shadow.matrix,Y++}s.point[O]=Ve,O++}else if(Le.isHemisphereLight){const Ve=t.get(Le);Ve.skyColor.copy(Le.color).multiplyScalar(Ze*te),Ve.groundColor.copy(Le.groundColor).multiplyScalar(Ze*te),s.hemi[U]=Ve,U++}}j>0&&(e.isWebGL2||!0===h.has("OES_texture_float_linear")?(s.rectAreaLTC1=Ht.LTC_FLOAT_1,s.rectAreaLTC2=Ht.LTC_FLOAT_2):!0===h.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=Ht.LTC_HALF_1,s.rectAreaLTC2=Ht.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=S,s.ambient[1]=C,s.ambient[2]=I;const oe=s.hash;oe.directionalLength===D&&oe.pointLength===O&&oe.spotLength===N&&oe.rectAreaLength===j&&oe.hemiLength===U&&oe.numDirectionalShadows===Q&&oe.numPointShadows===Y&&oe.numSpotShadows===Z||(s.directional.length=D,s.spot.length=N,s.rectArea.length=j,s.point.length=O,s.hemi.length=U,s.directionalShadow.length=Q,s.directionalShadowMap.length=Q,s.pointShadow.length=Y,s.pointShadowMap.length=Y,s.spotShadow.length=Z,s.spotShadowMap.length=Z,s.directionalShadowMatrix.length=Q,s.pointShadowMatrix.length=Y,s.spotShadowMatrix.length=Z,oe.directionalLength=D,oe.pointLength=O,oe.spotLength=N,oe.rectAreaLength=j,oe.hemiLength=U,oe.numDirectionalShadows=Q,oe.numPointShadows=Y,oe.numSpotShadows=Z,s.version=G++)},setupView:function(v,b){let S=0,C=0,I=0,D=0,O=0;const N=b.matrixWorldInverse;for(let j=0,U=v.length;j<U;j++){const Q=v[j];if(Q.isDirectionalLight){const Y=s.directional[S];Y.direction.setFromMatrixPosition(Q.matrixWorld),l.setFromMatrixPosition(Q.target.matrixWorld),Y.direction.sub(l),Y.direction.transformDirection(N),S++}else if(Q.isSpotLight){const Y=s.spot[I];Y.position.setFromMatrixPosition(Q.matrixWorld),Y.position.applyMatrix4(N),Y.direction.setFromMatrixPosition(Q.matrixWorld),l.setFromMatrixPosition(Q.target.matrixWorld),Y.direction.sub(l),Y.direction.transformDirection(N),I++}else if(Q.isRectAreaLight){const Y=s.rectArea[D];Y.position.setFromMatrixPosition(Q.matrixWorld),Y.position.applyMatrix4(N),f.identity(),u.copy(Q.matrixWorld),u.premultiply(N),f.extractRotation(u),Y.halfWidth.set(.5*Q.width,0,0),Y.halfHeight.set(0,.5*Q.height,0),Y.halfWidth.applyMatrix4(f),Y.halfHeight.applyMatrix4(f),D++}else if(Q.isPointLight){const Y=s.point[C];Y.position.setFromMatrixPosition(Q.matrixWorld),Y.position.applyMatrix4(N),C++}else if(Q.isHemisphereLight){const Y=s.hemi[O];Y.direction.setFromMatrixPosition(Q.matrixWorld),Y.direction.transformDirection(N),Y.direction.normalize(),O++}}},state:s}}function re(h,e){const t=new ee(h,e),n=[],s=[];return{init:function(){n.length=0,s.length=0},state:{lightsArray:n,shadowsArray:s,lights:t},setupLights:function(l){t.setup(n,l)},setupLightsView:function(l){t.setupView(n,l)},pushLight:function(l){n.push(l)},pushShadow:function(l){s.push(l)}}}function ie(h,e){let t=new WeakMap;return{get:function(n,s=0){let l;return!1===t.has(n)?(l=new re(h,e),t.set(n,[l])):s>=t.get(n).length?(l=new re(h,e),t.get(n).push(l)):l=t.get(n)[s],l},dispose:function(){t=new WeakMap}}}class J extends Mn{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}J.prototype.isMeshDepthMaterial=!0;class ge extends Mn{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new me,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function ce(h,e,t){let n=new Ea;const s=new Mt,l=new Mt,u=new Rt,f=new J({depthPacking:3201}),v=new ge,b={},S=t.maxTextureSize,C={0:1,1:0,2:2},I=new xr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Mt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),D=I.clone();D.defines.HORIZONTAL_PASS=1;const O=new an;O.setAttribute("position",new un(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const N=new di(O,I),j=this;function U(Z,te){const oe=e.update(N);I.defines.VSM_SAMPLES!==Z.blurSamples&&(I.defines.VSM_SAMPLES=Z.blurSamples,D.defines.VSM_SAMPLES=Z.blurSamples,I.needsUpdate=!0,D.needsUpdate=!0),I.uniforms.shadow_pass.value=Z.map.texture,I.uniforms.resolution.value=Z.mapSize,I.uniforms.radius.value=Z.radius,h.setRenderTarget(Z.mapPass),h.clear(),h.renderBufferDirect(te,null,oe,I,N,null),D.uniforms.shadow_pass.value=Z.mapPass.texture,D.uniforms.resolution.value=Z.mapSize,D.uniforms.radius.value=Z.radius,h.setRenderTarget(Z.map),h.clear(),h.renderBufferDirect(te,null,oe,D,N,null)}function Q(Z,te,oe,de,Ce,Le){let Oe=null;const Ze=!0===oe.isPointLight?Z.customDistanceMaterial:Z.customDepthMaterial;if(Oe=void 0!==Ze?Ze:!0===oe.isPointLight?v:f,h.localClippingEnabled&&!0===te.clipShadows&&0!==te.clippingPlanes.length||te.displacementMap&&0!==te.displacementScale||te.alphaMap&&te.alphaTest>0){const et=Oe.uuid,ot=te.uuid;let Ve=b[et];void 0===Ve&&(Ve={},b[et]=Ve);let at=Ve[ot];void 0===at&&(at=Oe.clone(),Ve[ot]=at),Oe=at}return Oe.visible=te.visible,Oe.wireframe=te.wireframe,Oe.side=3===Le?null!==te.shadowSide?te.shadowSide:te.side:null!==te.shadowSide?te.shadowSide:C[te.side],Oe.alphaMap=te.alphaMap,Oe.alphaTest=te.alphaTest,Oe.clipShadows=te.clipShadows,Oe.clippingPlanes=te.clippingPlanes,Oe.clipIntersection=te.clipIntersection,Oe.displacementMap=te.displacementMap,Oe.displacementScale=te.displacementScale,Oe.displacementBias=te.displacementBias,Oe.wireframeLinewidth=te.wireframeLinewidth,Oe.linewidth=te.linewidth,!0===oe.isPointLight&&!0===Oe.isMeshDistanceMaterial&&(Oe.referencePosition.setFromMatrixPosition(oe.matrixWorld),Oe.nearDistance=de,Oe.farDistance=Ce),Oe}function Y(Z,te,oe,de,Ce){if(!1===Z.visible)return;if(Z.layers.test(te.layers)&&(Z.isMesh||Z.isLine||Z.isPoints)&&(Z.castShadow||Z.receiveShadow&&3===Ce)&&(!Z.frustumCulled||n.intersectsObject(Z))){Z.modelViewMatrix.multiplyMatrices(oe.matrixWorldInverse,Z.matrixWorld);const Oe=e.update(Z),Ze=Z.material;if(Array.isArray(Ze)){const et=Oe.groups;for(let ot=0,Ve=et.length;ot<Ve;ot++){const at=et[ot],it=Ze[at.materialIndex];if(it&&it.visible){const wt=Q(Z,it,de,oe.near,oe.far,Ce);h.renderBufferDirect(oe,null,Oe,wt,Z,at)}}}else if(Ze.visible){const et=Q(Z,Ze,de,oe.near,oe.far,Ce);h.renderBufferDirect(oe,null,Oe,et,Z,null)}}const Le=Z.children;for(let Oe=0,Ze=Le.length;Oe<Ze;Oe++)Y(Le[Oe],te,oe,de,Ce)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(Z,te,oe){if(!1===j.enabled||!1===j.autoUpdate&&!1===j.needsUpdate||0===Z.length)return;const de=h.getRenderTarget(),Ce=h.getActiveCubeFace(),Le=h.getActiveMipmapLevel(),Oe=h.state;Oe.setBlending(0),Oe.buffers.color.setClear(1,1,1,1),Oe.buffers.depth.setTest(!0),Oe.setScissorTest(!1);for(let Ze=0,et=Z.length;Ze<et;Ze++){const ot=Z[Ze],Ve=ot.shadow;if(void 0===Ve){console.warn("THREE.WebGLShadowMap:",ot,"has no shadow.");continue}if(!1===Ve.autoUpdate&&!1===Ve.needsUpdate)continue;s.copy(Ve.mapSize);const at=Ve.getFrameExtents();if(s.multiply(at),l.copy(Ve.mapSize),(s.x>S||s.y>S)&&(s.x>S&&(l.x=Math.floor(S/at.x),s.x=l.x*at.x,Ve.mapSize.x=l.x),s.y>S&&(l.y=Math.floor(S/at.y),s.y=l.y*at.y,Ve.mapSize.y=l.y)),null===Ve.map&&!Ve.isPointLightShadow&&3===this.type){const wt={minFilter:1006,magFilter:1006,format:1023};Ve.map=new Fe(s.x,s.y,wt),Ve.map.texture.name=ot.name+".shadowMap",Ve.mapPass=new Fe(s.x,s.y,wt),Ve.camera.updateProjectionMatrix()}null===Ve.map&&(Ve.map=new Fe(s.x,s.y,{minFilter:1003,magFilter:1003,format:1023}),Ve.map.texture.name=ot.name+".shadowMap",Ve.camera.updateProjectionMatrix()),h.setRenderTarget(Ve.map),h.clear();const it=Ve.getViewportCount();for(let wt=0;wt<it;wt++){const pt=Ve.getViewport(wt);u.set(l.x*pt.x,l.y*pt.y,l.x*pt.z,l.y*pt.w),Oe.viewport(u),Ve.updateMatrices(ot,wt),n=Ve.getFrustum(),Y(te,oe,Ve.camera,ot,this.type)}Ve.isPointLightShadow||3!==this.type||U(Ve,oe),Ve.needsUpdate=!1}j.needsUpdate=!1,h.setRenderTarget(de,Ce,Le)}}function pe(h,e,t){const n=t.isWebGL2,s=new function(){let he=!1;const ze=new Rt;let Ke=null;const Et=new Rt(0,0,0,0);return{setMask:function(nt){Ke===nt||he||(h.colorMask(nt,nt,nt,nt),Ke=nt)},setLocked:function(nt){he=nt},setClear:function(nt,Ft,jt,ri,Ri){!0===Ri&&(nt*=ri,Ft*=ri,jt*=ri),ze.set(nt,Ft,jt,ri),!1===Et.equals(ze)&&(h.clearColor(nt,Ft,jt,ri),Et.copy(ze))},reset:function(){he=!1,Ke=null,Et.set(-1,0,0,0)}}},l=new function(){let he=!1,ze=null,Ke=null,Et=null;return{setTest:function(nt){nt?Zt(2929):Xt(2929)},setMask:function(nt){ze===nt||he||(h.depthMask(nt),ze=nt)},setFunc:function(nt){if(Ke!==nt){if(nt)switch(nt){case 0:h.depthFunc(512);break;case 1:h.depthFunc(519);break;case 2:h.depthFunc(513);break;case 3:default:h.depthFunc(515);break;case 4:h.depthFunc(514);break;case 5:h.depthFunc(518);break;case 6:h.depthFunc(516);break;case 7:h.depthFunc(517)}else h.depthFunc(515);Ke=nt}},setLocked:function(nt){he=nt},setClear:function(nt){Et!==nt&&(h.clearDepth(nt),Et=nt)},reset:function(){he=!1,ze=null,Ke=null,Et=null}}},u=new function(){let he=!1,ze=null,Ke=null,Et=null,nt=null,Ft=null,jt=null,ri=null,Ri=null;return{setTest:function(bi){he||(bi?Zt(2960):Xt(2960))},setMask:function(bi){ze===bi||he||(h.stencilMask(bi),ze=bi)},setFunc:function(bi,Ti,_i){Ke===bi&&Et===Ti&&nt===_i||(h.stencilFunc(bi,Ti,_i),Ke=bi,Et=Ti,nt=_i)},setOp:function(bi,Ti,_i){Ft===bi&&jt===Ti&&ri===_i||(h.stencilOp(bi,Ti,_i),Ft=bi,jt=Ti,ri=_i)},setLocked:function(bi){he=bi},setClear:function(bi){Ri!==bi&&(h.clearStencil(bi),Ri=bi)},reset:function(){he=!1,ze=null,Ke=null,Et=null,nt=null,Ft=null,jt=null,ri=null,Ri=null}}};let f={},v={},b=new WeakMap,S=[],C=null,I=!1,D=null,O=null,N=null,j=null,U=null,Q=null,Y=null,Z=!1,te=null,oe=null,de=null,Ce=null,Le=null;const Oe=h.getParameter(35661);let Ze=!1,et=0;const ot=h.getParameter(7938);-1!==ot.indexOf("WebGL")?(et=parseFloat(/^WebGL (\d)/.exec(ot)[1]),Ze=et>=1):-1!==ot.indexOf("OpenGL ES")&&(et=parseFloat(/^OpenGL ES (\d)/.exec(ot)[1]),Ze=et>=2);let Ve=null,at={};const it=h.getParameter(3088),wt=h.getParameter(2978),pt=(new Rt).fromArray(it),Ct=(new Rt).fromArray(wt);function dt(he,ze,Ke){const Et=new Uint8Array(4),nt=h.createTexture();h.bindTexture(he,nt),h.texParameteri(he,10241,9728),h.texParameteri(he,10240,9728);for(let Ft=0;Ft<Ke;Ft++)h.texImage2D(ze+Ft,0,6408,1,1,0,6408,5121,Et);return nt}const ei={};function Zt(he){!0!==f[he]&&(h.enable(he),f[he]=!0)}function Xt(he){!1!==f[he]&&(h.disable(he),f[he]=!1)}ei[3553]=dt(3553,3553,1),ei[34067]=dt(34067,34069,6),s.setClear(0,0,0,1),l.setClear(1),u.setClear(0),Zt(2929),l.setFunc(3),tt(!1),st(1),Zt(2884),ve(0);const ni={100:32774,101:32778,102:32779};if(n)ni[103]=32775,ni[104]=32776;else{const he=e.get("EXT_blend_minmax");null!==he&&(ni[103]=he.MIN_EXT,ni[104]=he.MAX_EXT)}const Te={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function ve(he,ze,Ke,Et,nt,Ft,jt,ri){if(0!==he){if(!1===I&&(Zt(3042),I=!0),5===he)nt=nt||ze,Ft=Ft||Ke,jt=jt||Et,ze===O&&nt===U||(h.blendEquationSeparate(ni[ze],ni[nt]),O=ze,U=nt),Ke===N&&Et===j&&Ft===Q&&jt===Y||(h.blendFuncSeparate(Te[Ke],Te[Et],Te[Ft],Te[jt]),N=Ke,j=Et,Q=Ft,Y=jt),D=he,Z=null;else if(he!==D||ri!==Z){if(100===O&&100===U||(h.blendEquation(32774),O=100,U=100),ri)switch(he){case 1:h.blendFuncSeparate(1,771,1,771);break;case 2:h.blendFunc(1,1);break;case 3:h.blendFuncSeparate(0,769,0,1);break;case 4:h.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",he)}else switch(he){case 1:h.blendFuncSeparate(770,771,1,771);break;case 2:h.blendFunc(770,1);break;case 3:h.blendFuncSeparate(0,769,0,1);break;case 4:h.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",he)}N=null,j=null,Q=null,Y=null,D=he,Z=ri}}else!0===I&&(Xt(3042),I=!1)}function tt(he){te!==he&&(h.frontFace(he?2304:2305),te=he)}function st(he){0!==he?(Zt(2884),he!==oe&&h.cullFace(1===he?1029:2===he?1028:1032)):Xt(2884),oe=he}function Pe(he,ze,Ke){he?(Zt(32823),Ce===ze&&Le===Ke||(h.polygonOffset(ze,Ke),Ce=ze,Le=Ke)):Xt(32823)}function Ge(he){void 0===he&&(he=33984+Oe-1),Ve!==he&&(h.activeTexture(he),Ve=he)}return{buffers:{color:s,depth:l,stencil:u},enable:Zt,disable:Xt,bindFramebuffer:function(he,ze){return v[he]!==ze&&(h.bindFramebuffer(he,ze),v[he]=ze,n&&(36009===he&&(v[36160]=ze),36160===he&&(v[36009]=ze)),!0)},drawBuffers:function(he,ze){let Ke=S,Et=!1;if(he)if(Ke=b.get(ze),void 0===Ke&&(Ke=[],b.set(ze,Ke)),he.isWebGLMultipleRenderTargets){const nt=he.texture;if(Ke.length!==nt.length||36064!==Ke[0]){for(let Ft=0,jt=nt.length;Ft<jt;Ft++)Ke[Ft]=36064+Ft;Ke.length=nt.length,Et=!0}}else 36064!==Ke[0]&&(Ke[0]=36064,Et=!0);else 1029!==Ke[0]&&(Ke[0]=1029,Et=!0);Et&&(t.isWebGL2?h.drawBuffers(Ke):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ke))},useProgram:function(he){return C!==he&&(h.useProgram(he),C=he,!0)},setBlending:ve,setMaterial:function(he,ze){2===he.side?Xt(2884):Zt(2884);let Ke=1===he.side;ze&&(Ke=!Ke),tt(Ke),1===he.blending&&!1===he.transparent?ve(0):ve(he.blending,he.blendEquation,he.blendSrc,he.blendDst,he.blendEquationAlpha,he.blendSrcAlpha,he.blendDstAlpha,he.premultipliedAlpha),l.setFunc(he.depthFunc),l.setTest(he.depthTest),l.setMask(he.depthWrite),s.setMask(he.colorWrite);const Et=he.stencilWrite;u.setTest(Et),Et&&(u.setMask(he.stencilWriteMask),u.setFunc(he.stencilFunc,he.stencilRef,he.stencilFuncMask),u.setOp(he.stencilFail,he.stencilZFail,he.stencilZPass)),Pe(he.polygonOffset,he.polygonOffsetFactor,he.polygonOffsetUnits),!0===he.alphaToCoverage?Zt(32926):Xt(32926)},setFlipSided:tt,setCullFace:st,setLineWidth:function(he){he!==de&&(Ze&&h.lineWidth(he),de=he)},setPolygonOffset:Pe,setScissorTest:function(he){he?Zt(3089):Xt(3089)},activeTexture:Ge,bindTexture:function(he,ze){null===Ve&&Ge();let Ke=at[Ve];void 0===Ke&&(Ke={type:void 0,texture:void 0},at[Ve]=Ke),Ke.type===he&&Ke.texture===ze||(h.bindTexture(he,ze||ei[he]),Ke.type=he,Ke.texture=ze)},unbindTexture:function(){const he=at[Ve];void 0!==he&&void 0!==he.type&&(h.bindTexture(he.type,null),he.type=void 0,he.texture=void 0)},compressedTexImage2D:function(){try{h.compressedTexImage2D.apply(h,arguments)}catch(he){console.error("THREE.WebGLState:",he)}},texImage2D:function(){try{h.texImage2D.apply(h,arguments)}catch(he){console.error("THREE.WebGLState:",he)}},texImage3D:function(){try{h.texImage3D.apply(h,arguments)}catch(he){console.error("THREE.WebGLState:",he)}},texStorage2D:function(){try{h.texStorage2D.apply(h,arguments)}catch(he){console.error("THREE.WebGLState:",he)}},texStorage3D:function(){try{h.texStorage3D.apply(h,arguments)}catch(he){console.error("THREE.WebGLState:",he)}},texSubImage2D:function(){try{h.texSubImage2D.apply(h,arguments)}catch(he){console.error("THREE.WebGLState:",he)}},texSubImage3D:function(){try{h.texSubImage3D.apply(h,arguments)}catch(he){console.error("THREE.WebGLState:",he)}},compressedTexSubImage2D:function(){try{h.compressedTexSubImage2D.apply(h,arguments)}catch(he){console.error("THREE.WebGLState:",he)}},scissor:function(he){!1===pt.equals(he)&&(h.scissor(he.x,he.y,he.z,he.w),pt.copy(he))},viewport:function(he){!1===Ct.equals(he)&&(h.viewport(he.x,he.y,he.z,he.w),Ct.copy(he))},reset:function(){h.disable(3042),h.disable(2884),h.disable(2929),h.disable(32823),h.disable(3089),h.disable(2960),h.disable(32926),h.blendEquation(32774),h.blendFunc(1,0),h.blendFuncSeparate(1,0,1,0),h.colorMask(!0,!0,!0,!0),h.clearColor(0,0,0,0),h.depthMask(!0),h.depthFunc(513),h.clearDepth(1),h.stencilMask(4294967295),h.stencilFunc(519,0,4294967295),h.stencilOp(7680,7680,7680),h.clearStencil(0),h.cullFace(1029),h.frontFace(2305),h.polygonOffset(0,0),h.activeTexture(33984),h.bindFramebuffer(36160,null),!0===n&&(h.bindFramebuffer(36009,null),h.bindFramebuffer(36008,null)),h.useProgram(null),h.lineWidth(1),h.scissor(0,0,h.canvas.width,h.canvas.height),h.viewport(0,0,h.canvas.width,h.canvas.height),f={},Ve=null,at={},v={},b=new WeakMap,S=[],C=null,I=!1,D=null,O=null,N=null,j=null,U=null,Q=null,Y=null,Z=!1,te=null,oe=null,de=null,Ce=null,Le=null,pt.set(0,0,h.canvas.width,h.canvas.height),Ct.set(0,0,h.canvas.width,h.canvas.height),s.reset(),l.reset(),u.reset()}}}function _e(h,e,t,n,s,l,u){const f=s.isWebGL2,v=s.maxTextures,b=s.maxCubemapSize,S=s.maxTextureSize,C=s.maxSamples,I=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,D=new WeakMap;let O;const N=new WeakMap;let j=!1;try{j="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(Te){}function U(Te,ve){return j?new OffscreenCanvas(Te,ve):X("canvas")}function Q(Te,ve,tt,st){let Pe=1;if((Te.width>st||Te.height>st)&&(Pe=st/Math.max(Te.width,Te.height)),Pe<1||!0===ve){if("undefined"!=typeof HTMLImageElement&&Te instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&Te instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&Te instanceof ImageBitmap){const Ge=ve?Vo:Math.floor,he=Ge(Pe*Te.width),ze=Ge(Pe*Te.height);void 0===O&&(O=U(he,ze));const Ke=tt?U(he,ze):O;return Ke.width=he,Ke.height=ze,Ke.getContext("2d").drawImage(Te,0,0,he,ze),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Te.width+"x"+Te.height+") to ("+he+"x"+ze+")."),Ke}return"data"in Te&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Te.width+"x"+Te.height+")."),Te}return Te}function Y(Te){return No(Te.width)&&No(Te.height)}function Z(Te,ve){return Te.generateMipmaps&&ve&&1003!==Te.minFilter&&1006!==Te.minFilter}function te(Te){h.generateMipmap(Te)}function oe(Te,ve,tt,st,Pe=!1){if(!1===f)return ve;if(null!==Te){if(void 0!==h[Te])return h[Te];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Te+"'")}let Ge=ve;return 6403===ve&&(5126===tt&&(Ge=33326),5131===tt&&(Ge=33325),5121===tt&&(Ge=33321)),33319===ve&&(5126===tt&&(Ge=33328),5131===tt&&(Ge=33327),5121===tt&&(Ge=33323)),6408===ve&&(5126===tt&&(Ge=34836),5131===tt&&(Ge=34842),5121===tt&&(Ge=3001===st&&!1===Pe?35907:32856),32819===tt&&(Ge=32854),32820===tt&&(Ge=32855)),33325!==Ge&&33326!==Ge&&33327!==Ge&&33328!==Ge&&34842!==Ge&&34836!==Ge||e.get("EXT_color_buffer_float"),Ge}function de(Te,ve,tt){return!0===Z(Te,tt)||Te.isFramebufferTexture&&1003!==Te.minFilter&&1006!==Te.minFilter?Math.log2(Math.max(ve.width,ve.height))+1:void 0!==Te.mipmaps&&Te.mipmaps.length>0?Te.mipmaps.length:Te.isCompressedTexture&&Array.isArray(Te.image)?ve.mipmaps.length:1}function Ce(Te){return 1003===Te||1004===Te||1005===Te?9728:9729}function Le(Te){const ve=Te.target;ve.removeEventListener("dispose",Le),function(tt){const st=n.get(tt);if(void 0===st.__webglInit)return;const Pe=tt.source,Ge=N.get(Pe);if(Ge){const he=Ge[st.__cacheKey];he.usedTimes--,0===he.usedTimes&&Ze(tt),0===Object.keys(Ge).length&&N.delete(Pe)}n.remove(tt)}(ve),ve.isVideoTexture&&D.delete(ve)}function Oe(Te){const ve=Te.target;ve.removeEventListener("dispose",Oe),function(tt){const st=tt.texture,Pe=n.get(tt),Ge=n.get(st);if(void 0!==Ge.__webglTexture&&(h.deleteTexture(Ge.__webglTexture),u.memory.textures--),tt.depthTexture&&tt.depthTexture.dispose(),tt.isWebGLCubeRenderTarget)for(let he=0;he<6;he++)h.deleteFramebuffer(Pe.__webglFramebuffer[he]),Pe.__webglDepthbuffer&&h.deleteRenderbuffer(Pe.__webglDepthbuffer[he]);else h.deleteFramebuffer(Pe.__webglFramebuffer),Pe.__webglDepthbuffer&&h.deleteRenderbuffer(Pe.__webglDepthbuffer),Pe.__webglMultisampledFramebuffer&&h.deleteFramebuffer(Pe.__webglMultisampledFramebuffer),Pe.__webglColorRenderbuffer&&h.deleteRenderbuffer(Pe.__webglColorRenderbuffer),Pe.__webglDepthRenderbuffer&&h.deleteRenderbuffer(Pe.__webglDepthRenderbuffer);if(tt.isWebGLMultipleRenderTargets)for(let he=0,ze=st.length;he<ze;he++){const Ke=n.get(st[he]);Ke.__webglTexture&&(h.deleteTexture(Ke.__webglTexture),u.memory.textures--),n.remove(st[he])}n.remove(st),n.remove(tt)}(ve)}function Ze(Te){const ve=n.get(Te);h.deleteTexture(ve.__webglTexture),delete N.get(Te.source)[ve.__cacheKey],u.memory.textures--}let et=0;function ot(Te,ve){const tt=n.get(Te);if(Te.isVideoTexture&&function(st){const Pe=u.render.frame;D.get(st)!==Pe&&(D.set(st,Pe),st.update())}(Te),!1===Te.isRenderTargetTexture&&Te.version>0&&tt.__version!==Te.version){const st=Te.image;if(null===st)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==st.complete)return void pt(tt,Te,ve);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.activeTexture(33984+ve),t.bindTexture(3553,tt.__webglTexture)}const Ve={1e3:10497,1001:33071,1002:33648},at={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function it(Te,ve,tt){if(tt?(h.texParameteri(Te,10242,Ve[ve.wrapS]),h.texParameteri(Te,10243,Ve[ve.wrapT]),32879!==Te&&35866!==Te||h.texParameteri(Te,32882,Ve[ve.wrapR]),h.texParameteri(Te,10240,at[ve.magFilter]),h.texParameteri(Te,10241,at[ve.minFilter])):(h.texParameteri(Te,10242,33071),h.texParameteri(Te,10243,33071),32879!==Te&&35866!==Te||h.texParameteri(Te,32882,33071),1001===ve.wrapS&&1001===ve.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),h.texParameteri(Te,10240,Ce(ve.magFilter)),h.texParameteri(Te,10241,Ce(ve.minFilter)),1003!==ve.minFilter&&1006!==ve.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const st=e.get("EXT_texture_filter_anisotropic");if(1015===ve.type&&!1===e.has("OES_texture_float_linear")||!1===f&&1016===ve.type&&!1===e.has("OES_texture_half_float_linear"))return;(ve.anisotropy>1||n.get(ve).__currentAnisotropy)&&(h.texParameterf(Te,st.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ve.anisotropy,s.getMaxAnisotropy())),n.get(ve).__currentAnisotropy=ve.anisotropy)}}function wt(Te,ve){let tt=!1;void 0===Te.__webglInit&&(Te.__webglInit=!0,ve.addEventListener("dispose",Le));const st=ve.source;let Pe=N.get(st);void 0===Pe&&(Pe={},N.set(st,Pe));const Ge=function(he){const ze=[];return ze.push(he.wrapS),ze.push(he.wrapT),ze.push(he.magFilter),ze.push(he.minFilter),ze.push(he.anisotropy),ze.push(he.internalFormat),ze.push(he.format),ze.push(he.type),ze.push(he.generateMipmaps),ze.push(he.premultiplyAlpha),ze.push(he.flipY),ze.push(he.unpackAlignment),ze.push(he.encoding),ze.join()}(ve);if(Ge!==Te.__cacheKey){void 0===Pe[Ge]&&(Pe[Ge]={texture:h.createTexture(),usedTimes:0},u.memory.textures++,tt=!0),Pe[Ge].usedTimes++;const he=Pe[Te.__cacheKey];void 0!==he&&(Pe[Te.__cacheKey].usedTimes--,0===he.usedTimes&&Ze(ve)),Te.__cacheKey=Ge,Te.__webglTexture=Pe[Ge].texture}return tt}function pt(Te,ve,tt){let st=3553;ve.isDataArrayTexture&&(st=35866),ve.isData3DTexture&&(st=32879);const Pe=wt(Te,ve),Ge=ve.source;if(t.activeTexture(33984+tt),t.bindTexture(st,Te.__webglTexture),Ge.version!==Ge.__currentVersion||!0===Pe){h.pixelStorei(37440,ve.flipY),h.pixelStorei(37441,ve.premultiplyAlpha),h.pixelStorei(3317,ve.unpackAlignment),h.pixelStorei(37443,0);const he=(_i=ve,!f&&(1001!==_i.wrapS||1001!==_i.wrapT||1003!==_i.minFilter&&1006!==_i.minFilter)&&!1===Y(ve.image));let ze=Q(ve.image,he,!1,S);ze=ni(ve,ze);const Ke=Y(ze)||f,Et=l.convert(ve.format,ve.encoding);let nt,Ft=l.convert(ve.type),jt=oe(ve.internalFormat,Et,Ft,ve.encoding,ve.isVideoTexture);it(st,ve,Ke);const ri=ve.mipmaps,Ri=f&&!0!==ve.isVideoTexture,bi=void 0===Te.__version,Ti=de(ve,ze,Ke);if(ve.isDepthTexture)jt=6402,f?jt=1015===ve.type?36012:1014===ve.type?33190:1020===ve.type?35056:33189:1015===ve.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===ve.format&&6402===jt&&1012!==ve.type&&1014!==ve.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ve.type=1012,Ft=l.convert(ve.type)),1027===ve.format&&6402===jt&&(jt=34041,1020!==ve.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ve.type=1020,Ft=l.convert(ve.type))),Ri&&bi?t.texStorage2D(3553,1,jt,ze.width,ze.height):t.texImage2D(3553,0,jt,ze.width,ze.height,0,Et,Ft,null);else if(ve.isDataTexture)if(ri.length>0&&Ke){Ri&&bi&&t.texStorage2D(3553,Ti,jt,ri[0].width,ri[0].height);for(let _i=0,Bn=ri.length;_i<Bn;_i++)nt=ri[_i],Ri?t.texSubImage2D(3553,_i,0,0,nt.width,nt.height,Et,Ft,nt.data):t.texImage2D(3553,_i,jt,nt.width,nt.height,0,Et,Ft,nt.data);ve.generateMipmaps=!1}else Ri?(bi&&t.texStorage2D(3553,Ti,jt,ze.width,ze.height),t.texSubImage2D(3553,0,0,0,ze.width,ze.height,Et,Ft,ze.data)):t.texImage2D(3553,0,jt,ze.width,ze.height,0,Et,Ft,ze.data);else if(ve.isCompressedTexture){Ri&&bi&&t.texStorage2D(3553,Ti,jt,ri[0].width,ri[0].height);for(let _i=0,Bn=ri.length;_i<Bn;_i++)nt=ri[_i],1023!==ve.format?null!==Et?Ri?t.compressedTexSubImage2D(3553,_i,0,0,nt.width,nt.height,Et,nt.data):t.compressedTexImage2D(3553,_i,jt,nt.width,nt.height,0,nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ri?t.texSubImage2D(3553,_i,0,0,nt.width,nt.height,Et,Ft,nt.data):t.texImage2D(3553,_i,jt,nt.width,nt.height,0,Et,Ft,nt.data)}else if(ve.isDataArrayTexture)Ri?(bi&&t.texStorage3D(35866,Ti,jt,ze.width,ze.height,ze.depth),t.texSubImage3D(35866,0,0,0,0,ze.width,ze.height,ze.depth,Et,Ft,ze.data)):t.texImage3D(35866,0,jt,ze.width,ze.height,ze.depth,0,Et,Ft,ze.data);else if(ve.isData3DTexture)Ri?(bi&&t.texStorage3D(32879,Ti,jt,ze.width,ze.height,ze.depth),t.texSubImage3D(32879,0,0,0,0,ze.width,ze.height,ze.depth,Et,Ft,ze.data)):t.texImage3D(32879,0,jt,ze.width,ze.height,ze.depth,0,Et,Ft,ze.data);else if(ve.isFramebufferTexture)Ri&&bi?t.texStorage2D(3553,Ti,jt,ze.width,ze.height):t.texImage2D(3553,0,jt,ze.width,ze.height,0,Et,Ft,null);else if(ri.length>0&&Ke){Ri&&bi&&t.texStorage2D(3553,Ti,jt,ri[0].width,ri[0].height);for(let _i=0,Bn=ri.length;_i<Bn;_i++)nt=ri[_i],Ri?t.texSubImage2D(3553,_i,0,0,Et,Ft,nt):t.texImage2D(3553,_i,jt,Et,Ft,nt);ve.generateMipmaps=!1}else Ri?(bi&&t.texStorage2D(3553,Ti,jt,ze.width,ze.height),t.texSubImage2D(3553,0,0,0,Et,Ft,ze)):t.texImage2D(3553,0,jt,Et,Ft,ze);Z(ve,Ke)&&te(st),Ge.__currentVersion=Ge.version,ve.onUpdate&&ve.onUpdate(ve)}var _i;Te.__version=ve.version}function Ct(Te,ve,tt,st,Pe){const Ge=l.convert(tt.format,tt.encoding),he=l.convert(tt.type),ze=oe(tt.internalFormat,Ge,he,tt.encoding);n.get(ve).__hasExternalTextures||(32879===Pe||35866===Pe?t.texImage3D(Pe,0,ze,ve.width,ve.height,ve.depth,0,Ge,he,null):t.texImage2D(Pe,0,ze,ve.width,ve.height,0,Ge,he,null)),t.bindFramebuffer(36160,Te),Xt(ve)?I.framebufferTexture2DMultisampleEXT(36160,st,Pe,n.get(tt).__webglTexture,0,Zt(ve)):h.framebufferTexture2D(36160,st,Pe,n.get(tt).__webglTexture,0),t.bindFramebuffer(36160,null)}function dt(Te,ve,tt){if(h.bindRenderbuffer(36161,Te),ve.depthBuffer&&!ve.stencilBuffer){let st=33189;if(tt||Xt(ve)){const Pe=ve.depthTexture;Pe&&Pe.isDepthTexture&&(1015===Pe.type?st=36012:1014===Pe.type&&(st=33190));const Ge=Zt(ve);Xt(ve)?I.renderbufferStorageMultisampleEXT(36161,Ge,st,ve.width,ve.height):h.renderbufferStorageMultisample(36161,Ge,st,ve.width,ve.height)}else h.renderbufferStorage(36161,st,ve.width,ve.height);h.framebufferRenderbuffer(36160,36096,36161,Te)}else if(ve.depthBuffer&&ve.stencilBuffer){const st=Zt(ve);tt&&!1===Xt(ve)?h.renderbufferStorageMultisample(36161,st,35056,ve.width,ve.height):Xt(ve)?I.renderbufferStorageMultisampleEXT(36161,st,35056,ve.width,ve.height):h.renderbufferStorage(36161,34041,ve.width,ve.height),h.framebufferRenderbuffer(36160,33306,36161,Te)}else{const st=!0===ve.isWebGLMultipleRenderTargets?ve.texture[0]:ve.texture,Pe=l.convert(st.format,st.encoding),Ge=l.convert(st.type),he=oe(st.internalFormat,Pe,Ge,st.encoding),ze=Zt(ve);tt&&!1===Xt(ve)?h.renderbufferStorageMultisample(36161,ze,he,ve.width,ve.height):Xt(ve)?I.renderbufferStorageMultisampleEXT(36161,ze,he,ve.width,ve.height):h.renderbufferStorage(36161,he,ve.width,ve.height)}h.bindRenderbuffer(36161,null)}function ei(Te){const ve=n.get(Te),tt=!0===Te.isWebGLCubeRenderTarget;if(Te.depthTexture&&!ve.__autoAllocateDepthBuffer){if(tt)throw new Error("target.depthTexture not supported in Cube render targets");!function(st,Pe){if(Pe&&Pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,st),!Pe.depthTexture||!Pe.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(Pe.depthTexture).__webglTexture&&Pe.depthTexture.image.width===Pe.width&&Pe.depthTexture.image.height===Pe.height||(Pe.depthTexture.image.width=Pe.width,Pe.depthTexture.image.height=Pe.height,Pe.depthTexture.needsUpdate=!0),ot(Pe.depthTexture,0);const Ge=n.get(Pe.depthTexture).__webglTexture,he=Zt(Pe);if(1026===Pe.depthTexture.format)Xt(Pe)?I.framebufferTexture2DMultisampleEXT(36160,36096,3553,Ge,0,he):h.framebufferTexture2D(36160,36096,3553,Ge,0);else{if(1027!==Pe.depthTexture.format)throw new Error("Unknown depthTexture format");Xt(Pe)?I.framebufferTexture2DMultisampleEXT(36160,33306,3553,Ge,0,he):h.framebufferTexture2D(36160,33306,3553,Ge,0)}}(ve.__webglFramebuffer,Te)}else if(tt){ve.__webglDepthbuffer=[];for(let st=0;st<6;st++)t.bindFramebuffer(36160,ve.__webglFramebuffer[st]),ve.__webglDepthbuffer[st]=h.createRenderbuffer(),dt(ve.__webglDepthbuffer[st],Te,!1)}else t.bindFramebuffer(36160,ve.__webglFramebuffer),ve.__webglDepthbuffer=h.createRenderbuffer(),dt(ve.__webglDepthbuffer,Te,!1);t.bindFramebuffer(36160,null)}function Zt(Te){return Math.min(C,Te.samples)}function Xt(Te){const ve=n.get(Te);return f&&Te.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==ve.__useRenderToTexture}function ni(Te,ve){const tt=Te.encoding,st=Te.format,Pe=Te.type;return!0===Te.isCompressedTexture||!0===Te.isVideoTexture||1035===Te.format||3e3!==tt&&(3001===tt?!1===f?!0===e.has("EXT_sRGB")&&1023===st?(Te.format=1035,Te.minFilter=1006,Te.generateMipmaps=!1):ve=At.sRGBToLinear(ve):1023===st&&1009===Pe||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",tt)),ve}this.allocateTextureUnit=function(){const Te=et;return Te>=v&&console.warn("THREE.WebGLTextures: Trying to use "+Te+" texture units while this GPU supports only "+v),et+=1,Te},this.resetTextureUnits=function(){et=0},this.setTexture2D=ot,this.setTexture2DArray=function(Te,ve){const tt=n.get(Te);Te.version>0&&tt.__version!==Te.version?pt(tt,Te,ve):(t.activeTexture(33984+ve),t.bindTexture(35866,tt.__webglTexture))},this.setTexture3D=function(Te,ve){const tt=n.get(Te);Te.version>0&&tt.__version!==Te.version?pt(tt,Te,ve):(t.activeTexture(33984+ve),t.bindTexture(32879,tt.__webglTexture))},this.setTextureCube=function(Te,ve){const tt=n.get(Te);Te.version>0&&tt.__version!==Te.version?function(st,Pe,Ge){if(6!==Pe.image.length)return;const he=wt(st,Pe),ze=Pe.source;if(t.activeTexture(33984+Ge),t.bindTexture(34067,st.__webglTexture),ze.version!==ze.__currentVersion||!0===he){h.pixelStorei(37440,Pe.flipY),h.pixelStorei(37441,Pe.premultiplyAlpha),h.pixelStorei(3317,Pe.unpackAlignment),h.pixelStorei(37443,0);const Ke=Pe.isCompressedTexture||Pe.image[0].isCompressedTexture,Et=Pe.image[0]&&Pe.image[0].isDataTexture,nt=[];for(let Ci=0;Ci<6;Ci++)nt[Ci]=Ke||Et?Et?Pe.image[Ci].image:Pe.image[Ci]:Q(Pe.image[Ci],!1,!0,b),nt[Ci]=ni(Pe,nt[Ci]);const Ft=nt[0],jt=Y(Ft)||f,ri=l.convert(Pe.format,Pe.encoding),Ri=l.convert(Pe.type),bi=oe(Pe.internalFormat,ri,Ri,Pe.encoding),Ti=f&&!0!==Pe.isVideoTexture,_i=void 0===st.__version;let Bn,Ah=de(Pe,Ft,jt);if(it(34067,Pe,jt),Ke){Ti&&_i&&t.texStorage2D(34067,Ah,bi,Ft.width,Ft.height);for(let Ci=0;Ci<6;Ci++){Bn=nt[Ci].mipmaps;for(let Yn=0;Yn<Bn.length;Yn++){const rn=Bn[Yn];1023!==Pe.format?null!==ri?Ti?t.compressedTexSubImage2D(34069+Ci,Yn,0,0,rn.width,rn.height,ri,rn.data):t.compressedTexImage2D(34069+Ci,Yn,bi,rn.width,rn.height,0,rn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ti?t.texSubImage2D(34069+Ci,Yn,0,0,rn.width,rn.height,ri,Ri,rn.data):t.texImage2D(34069+Ci,Yn,bi,rn.width,rn.height,0,ri,Ri,rn.data)}}}else{Bn=Pe.mipmaps,Ti&&_i&&(Bn.length>0&&Ah++,t.texStorage2D(34067,Ah,bi,nt[0].width,nt[0].height));for(let Ci=0;Ci<6;Ci++)if(Et){Ti?t.texSubImage2D(34069+Ci,0,0,0,nt[Ci].width,nt[Ci].height,ri,Ri,nt[Ci].data):t.texImage2D(34069+Ci,0,bi,nt[Ci].width,nt[Ci].height,0,ri,Ri,nt[Ci].data);for(let Yn=0;Yn<Bn.length;Yn++){const rn=Bn[Yn].image[Ci].image;Ti?t.texSubImage2D(34069+Ci,Yn+1,0,0,rn.width,rn.height,ri,Ri,rn.data):t.texImage2D(34069+Ci,Yn+1,bi,rn.width,rn.height,0,ri,Ri,rn.data)}}else{Ti?t.texSubImage2D(34069+Ci,0,0,0,ri,Ri,nt[Ci]):t.texImage2D(34069+Ci,0,bi,ri,Ri,nt[Ci]);for(let Yn=0;Yn<Bn.length;Yn++){const rn=Bn[Yn];Ti?t.texSubImage2D(34069+Ci,Yn+1,0,0,ri,Ri,rn.image[Ci]):t.texImage2D(34069+Ci,Yn+1,bi,ri,Ri,rn.image[Ci])}}}Z(Pe,jt)&&te(34067),ze.__currentVersion=ze.version,Pe.onUpdate&&Pe.onUpdate(Pe)}st.__version=Pe.version}(tt,Te,ve):(t.activeTexture(33984+ve),t.bindTexture(34067,tt.__webglTexture))},this.rebindTextures=function(Te,ve,tt){const st=n.get(Te);void 0!==ve&&Ct(st.__webglFramebuffer,Te,Te.texture,36064,3553),void 0!==tt&&ei(Te)},this.setupRenderTarget=function(Te){const ve=Te.texture,tt=n.get(Te),st=n.get(ve);Te.addEventListener("dispose",Oe),!0!==Te.isWebGLMultipleRenderTargets&&(void 0===st.__webglTexture&&(st.__webglTexture=h.createTexture()),st.__version=ve.version,u.memory.textures++);const Pe=!0===Te.isWebGLCubeRenderTarget,Ge=!0===Te.isWebGLMultipleRenderTargets,he=Y(Te)||f;if(Pe){tt.__webglFramebuffer=[];for(let ze=0;ze<6;ze++)tt.__webglFramebuffer[ze]=h.createFramebuffer()}else if(tt.__webglFramebuffer=h.createFramebuffer(),Ge)if(s.drawBuffers){const ze=Te.texture;for(let Ke=0,Et=ze.length;Ke<Et;Ke++){const nt=n.get(ze[Ke]);void 0===nt.__webglTexture&&(nt.__webglTexture=h.createTexture(),u.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(f&&Te.samples>0&&!1===Xt(Te)){tt.__webglMultisampledFramebuffer=h.createFramebuffer(),tt.__webglColorRenderbuffer=h.createRenderbuffer(),h.bindRenderbuffer(36161,tt.__webglColorRenderbuffer);const ze=l.convert(ve.format,ve.encoding),Ke=l.convert(ve.type),Et=oe(ve.internalFormat,ze,Ke,ve.encoding),nt=Zt(Te);h.renderbufferStorageMultisample(36161,nt,Et,Te.width,Te.height),t.bindFramebuffer(36160,tt.__webglMultisampledFramebuffer),h.framebufferRenderbuffer(36160,36064,36161,tt.__webglColorRenderbuffer),h.bindRenderbuffer(36161,null),Te.depthBuffer&&(tt.__webglDepthRenderbuffer=h.createRenderbuffer(),dt(tt.__webglDepthRenderbuffer,Te,!0)),t.bindFramebuffer(36160,null)}if(Pe){t.bindTexture(34067,st.__webglTexture),it(34067,ve,he);for(let ze=0;ze<6;ze++)Ct(tt.__webglFramebuffer[ze],Te,ve,36064,34069+ze);Z(ve,he)&&te(34067),t.unbindTexture()}else if(Ge){const ze=Te.texture;for(let Ke=0,Et=ze.length;Ke<Et;Ke++){const nt=ze[Ke],Ft=n.get(nt);t.bindTexture(3553,Ft.__webglTexture),it(3553,nt,he),Ct(tt.__webglFramebuffer,Te,nt,36064+Ke,3553),Z(nt,he)&&te(3553)}t.unbindTexture()}else{let ze=3553;(Te.isWebGL3DRenderTarget||Te.isWebGLArrayRenderTarget)&&(f?ze=Te.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(ze,st.__webglTexture),it(ze,ve,he),Ct(tt.__webglFramebuffer,Te,ve,36064,ze),Z(ve,he)&&te(ze),t.unbindTexture()}Te.depthBuffer&&ei(Te)},this.updateRenderTargetMipmap=function(Te){const ve=Y(Te)||f,tt=!0===Te.isWebGLMultipleRenderTargets?Te.texture:[Te.texture];for(let st=0,Pe=tt.length;st<Pe;st++){const Ge=tt[st];if(Z(Ge,ve)){const he=Te.isWebGLCubeRenderTarget?34067:3553,ze=n.get(Ge).__webglTexture;t.bindTexture(he,ze),te(he),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function(Te){if(f&&Te.samples>0&&!1===Xt(Te)){const ve=Te.width,tt=Te.height;let st=16384;const Pe=[36064],Ge=Te.stencilBuffer?33306:36096;Te.depthBuffer&&Pe.push(Ge);const he=n.get(Te),ze=void 0!==he.__ignoreDepthValues&&he.__ignoreDepthValues;!1===ze&&(Te.depthBuffer&&(st|=256),Te.stencilBuffer&&(st|=1024)),t.bindFramebuffer(36008,he.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,he.__webglFramebuffer),!0===ze&&(h.invalidateFramebuffer(36008,[Ge]),h.invalidateFramebuffer(36009,[Ge])),h.blitFramebuffer(0,0,ve,tt,0,0,ve,tt,st,9728),h.invalidateFramebuffer(36008,Pe),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,he.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ei,this.setupFrameBufferTexture=Ct,this.useMultisampledRTT=Xt}function ye(h,e,t){const n=t.isWebGL2;return{convert:function(s,l=null){let u;if(1009===s)return 5121;if(1017===s)return 32819;if(1018===s)return 32820;if(1010===s)return 5120;if(1011===s)return 5122;if(1012===s)return 5123;if(1013===s)return 5124;if(1014===s)return 5125;if(1015===s)return 5126;if(1016===s)return n?5131:(u=e.get("OES_texture_half_float"),null!==u?u.HALF_FLOAT_OES:null);if(1021===s)return 6406;if(1023===s)return 6408;if(1024===s)return 6409;if(1025===s)return 6410;if(1026===s)return 6402;if(1027===s)return 34041;if(1028===s)return 6403;if(1022===s)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(1035===s)return u=e.get("EXT_sRGB"),null!==u?u.SRGB_ALPHA_EXT:null;if(1029===s)return 36244;if(1030===s)return 33319;if(1031===s)return 33320;if(1033===s)return 36249;if(33776===s||33777===s||33778===s||33779===s)if(3001===l){if(u=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===u)return null;if(33776===s)return u.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===s)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===s)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===s)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(u=e.get("WEBGL_compressed_texture_s3tc"),null===u)return null;if(33776===s)return u.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===s)return u.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===s)return u.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===s)return u.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===s||35841===s||35842===s||35843===s){if(u=e.get("WEBGL_compressed_texture_pvrtc"),null===u)return null;if(35840===s)return u.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===s)return u.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===s)return u.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===s)return u.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===s)return u=e.get("WEBGL_compressed_texture_etc1"),null!==u?u.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===s||37496===s){if(u=e.get("WEBGL_compressed_texture_etc"),null===u)return null;if(37492===s)return 3001===l?u.COMPRESSED_SRGB8_ETC2:u.COMPRESSED_RGB8_ETC2;if(37496===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:u.COMPRESSED_RGBA8_ETC2_EAC}if(37808===s||37809===s||37810===s||37811===s||37812===s||37813===s||37814===s||37815===s||37816===s||37817===s||37818===s||37819===s||37820===s||37821===s){if(u=e.get("WEBGL_compressed_texture_astc"),null===u)return null;if(37808===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:u.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:u.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:u.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:u.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:u.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:u.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:u.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:u.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:u.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:u.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:u.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:u.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:u.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===s)return 3001===l?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:u.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===s){if(u=e.get("EXT_texture_compression_bptc"),null===u)return null;if(36492===s)return 3001===l?u.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:u.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===s?n?34042:(u=e.get("WEBGL_depth_texture"),null!==u?u.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}ge.prototype.isMeshDistanceMaterial=!0;class ue extends bn{constructor(e=[]){super(),this.cameras=e}}ue.prototype.isArrayCamera=!0;class xe extends Ni{constructor(){super(),this.type="Group"}}xe.prototype.isGroup=!0;const Ne={type:"move"};class He{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new xe,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new xe,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new me,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new me),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new xe,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new me,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new me),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let s=null,l=null,u=null;const f=this._targetRay,v=this._grip,b=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==f&&(s=t.getPose(e.targetRaySpace,n),null!==s&&(f.matrix.fromArray(s.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),s.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(s.linearVelocity)):f.hasLinearVelocity=!1,s.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(s.angularVelocity)):f.hasAngularVelocity=!1,this.dispatchEvent(Ne))),b&&e.hand){u=!0;for(const N of e.hand.values()){const j=t.getJointPose(N,n);if(void 0===b.joints[N.jointName]){const Q=new xe;Q.matrixAutoUpdate=!1,Q.visible=!1,b.joints[N.jointName]=Q,b.add(Q)}const U=b.joints[N.jointName];null!==j&&(U.matrix.fromArray(j.transform.matrix),U.matrix.decompose(U.position,U.rotation,U.scale),U.jointRadius=j.radius),U.visible=null!==j}const I=b.joints["index-finger-tip"].position.distanceTo(b.joints["thumb-tip"].position),D=.02,O=.005;b.inputState.pinching&&I>D+O?(b.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!b.inputState.pinching&&I<=D-O&&(b.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==v&&e.gripSpace&&(l=t.getPose(e.gripSpace,n),null!==l&&(v.matrix.fromArray(l.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),l.linearVelocity?(v.hasLinearVelocity=!0,v.linearVelocity.copy(l.linearVelocity)):v.hasLinearVelocity=!1,l.angularVelocity?(v.hasAngularVelocity=!0,v.angularVelocity.copy(l.angularVelocity)):v.hasAngularVelocity=!1));return null!==f&&(f.visible=null!==s),null!==v&&(v.visible=null!==l),null!==b&&(b.visible=null!==u),this}}class Ye extends Dt{constructor(e,t,n,s,l,u,f,v,b,S){if(1026!==(S=void 0!==S?S:1026)&&1027!==S)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===S&&(n=1012),void 0===n&&1027===S&&(n=1020),super(null,s,l,u,f,v,S,n,b),this.image={width:e,height:t},this.magFilter=void 0!==f?f:1003,this.minFilter=void 0!==v?v:1003,this.flipY=!1,this.generateMipmaps=!1}}Ye.prototype.isDepthTexture=!0;class Xe extends qr{constructor(e,t){super();const n=this;let s=null,l=1,u=null,f="local-floor",v=null,b=null,S=null,C=null,I=null;const D=t.getContextAttributes();let O=null,N=null;const j=[],U=new Map,Q=new bn;Q.layers.enable(1),Q.viewport=new Rt;const Y=new bn;Y.layers.enable(2),Y.viewport=new Rt;const Z=[Q,Y],te=new ue;te.layers.enable(1),te.layers.enable(2);let oe=null,de=null;function Ce(it){const wt=U.get(it.inputSource);wt&&wt.dispatchEvent({type:it.type,data:it.inputSource})}function Le(){U.forEach(function(it,wt){it.disconnect(wt)}),U.clear(),oe=null,de=null,e.setRenderTarget(O),C=null,S=null,b=null,s=null,N=null,at.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function Oe(it){const wt=s.inputSources;for(let pt=0;pt<j.length;pt++)U.set(wt[pt],j[pt]);for(let pt=0;pt<it.removed.length;pt++){const Ct=it.removed[pt],dt=U.get(Ct);dt&&(dt.dispatchEvent({type:"disconnected",data:Ct}),U.delete(Ct))}for(let pt=0;pt<it.added.length;pt++){const Ct=it.added[pt],dt=U.get(Ct);dt&&dt.dispatchEvent({type:"connected",data:Ct})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(it){let wt=j[it];return void 0===wt&&(wt=new He,j[it]=wt),wt.getTargetRaySpace()},this.getControllerGrip=function(it){let wt=j[it];return void 0===wt&&(wt=new He,j[it]=wt),wt.getGripSpace()},this.getHand=function(it){let wt=j[it];return void 0===wt&&(wt=new He,j[it]=wt),wt.getHandSpace()},this.setFramebufferScaleFactor=function(it){l=it,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(it){f=it,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u},this.getBaseLayer=function(){return null!==S?S:C},this.getBinding=function(){return b},this.getFrame=function(){return I},this.getSession=function(){return s},this.setSession=function(){var it=(0,m.Z)(function*(wt){if(s=wt,null!==s){if(O=e.getRenderTarget(),s.addEventListener("select",Ce),s.addEventListener("selectstart",Ce),s.addEventListener("selectend",Ce),s.addEventListener("squeeze",Ce),s.addEventListener("squeezestart",Ce),s.addEventListener("squeezeend",Ce),s.addEventListener("end",Le),s.addEventListener("inputsourceschange",Oe),!0!==D.xrCompatible&&(yield t.makeXRCompatible()),void 0===s.renderState.layers||!1===e.capabilities.isWebGL2)C=new XRWebGLLayer(s,t,{antialias:void 0!==s.renderState.layers||D.antialias,alpha:D.alpha,depth:D.depth,stencil:D.stencil,framebufferScaleFactor:l}),s.updateRenderState({baseLayer:C}),N=new Fe(C.framebufferWidth,C.framebufferHeight,{format:1023,type:1009,encoding:e.outputEncoding});else{let pt=null,Ct=null,dt=null;D.depth&&(dt=D.stencil?35056:33190,pt=D.stencil?1027:1026,Ct=D.stencil?1020:1012);const ei={colorFormat:3001===e.outputEncoding?35907:32856,depthFormat:dt,scaleFactor:l};b=new XRWebGLBinding(s,t),S=b.createProjectionLayer(ei),s.updateRenderState({layers:[S]}),N=new Fe(S.textureWidth,S.textureHeight,{format:1023,type:1009,depthTexture:new Ye(S.textureWidth,S.textureHeight,Ct,void 0,void 0,void 0,void 0,void 0,void 0,pt),stencilBuffer:D.stencil,encoding:e.outputEncoding,samples:D.antialias?4:0}),e.properties.get(N).__ignoreDepthValues=S.ignoreDepthValues}N.isXRRenderTarget=!0,this.setFoveation(1),u=yield s.requestReferenceSpace(f),at.setContext(s),at.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}});return function(wt){return it.apply(this,arguments)}}();const Ze=new me,et=new me;function ot(it,wt){null===wt?it.matrixWorld.copy(it.matrix):it.matrixWorld.multiplyMatrices(wt.matrixWorld,it.matrix),it.matrixWorldInverse.copy(it.matrixWorld).invert()}this.updateCamera=function(it){if(null===s)return;te.near=Y.near=Q.near=it.near,te.far=Y.far=Q.far=it.far,oe===te.near&&de===te.far||(s.updateRenderState({depthNear:te.near,depthFar:te.far}),oe=te.near,de=te.far);const wt=it.parent,pt=te.cameras;ot(te,wt);for(let dt=0;dt<pt.length;dt++)ot(pt[dt],wt);te.matrixWorld.decompose(te.position,te.quaternion,te.scale),it.position.copy(te.position),it.quaternion.copy(te.quaternion),it.scale.copy(te.scale),it.matrix.copy(te.matrix),it.matrixWorld.copy(te.matrixWorld);const Ct=it.children;for(let dt=0,ei=Ct.length;dt<ei;dt++)Ct[dt].updateMatrixWorld(!0);2===pt.length?function(dt,ei,Zt){Ze.setFromMatrixPosition(ei.matrixWorld),et.setFromMatrixPosition(Zt.matrixWorld);const Xt=Ze.distanceTo(et),ni=ei.projectionMatrix.elements,Te=Zt.projectionMatrix.elements,ve=ni[14]/(ni[10]-1),tt=ni[14]/(ni[10]+1),st=(ni[9]+1)/ni[5],Pe=(ni[9]-1)/ni[5],Ge=(ni[8]-1)/ni[0],he=(Te[8]+1)/Te[0],ze=ve*Ge,Ke=ve*he,Et=Xt/(-Ge+he),nt=Et*-Ge;ei.matrixWorld.decompose(dt.position,dt.quaternion,dt.scale),dt.translateX(nt),dt.translateZ(Et),dt.matrixWorld.compose(dt.position,dt.quaternion,dt.scale),dt.matrixWorldInverse.copy(dt.matrixWorld).invert();const Ft=ve+Et,jt=tt+Et;dt.projectionMatrix.makePerspective(ze-nt,Ke+(Xt-nt),st*tt/jt*Ft,Pe*tt/jt*Ft,Ft,jt)}(te,Q,Y):te.projectionMatrix.copy(Q.projectionMatrix)},this.getCamera=function(){return te},this.getFoveation=function(){return null!==S?S.fixedFoveation:null!==C?C.fixedFoveation:void 0},this.setFoveation=function(it){null!==S&&(S.fixedFoveation=it),null!==C&&void 0!==C.fixedFoveation&&(C.fixedFoveation=it)};let Ve=null;const at=new xp;at.setAnimationLoop(function(it,wt){if(v=wt.getViewerPose(u),I=wt,null!==v){const Ct=v.views;null!==C&&(e.setRenderTargetFramebuffer(N,C.framebuffer),e.setRenderTarget(N));let dt=!1;Ct.length!==te.cameras.length&&(te.cameras.length=0,dt=!0);for(let ei=0;ei<Ct.length;ei++){const Zt=Ct[ei];let Xt=null;if(null!==C)Xt=C.getViewport(Zt);else{const Te=b.getViewSubImage(S,Zt);Xt=Te.viewport,0===ei&&(e.setRenderTargetTextures(N,Te.colorTexture,S.ignoreDepthValues?void 0:Te.depthStencilTexture),e.setRenderTarget(N))}const ni=Z[ei];ni.matrix.fromArray(Zt.transform.matrix),ni.projectionMatrix.fromArray(Zt.projectionMatrix),ni.viewport.set(Xt.x,Xt.y,Xt.width,Xt.height),0===ei&&te.matrix.copy(ni.matrix),!0===dt&&te.cameras.push(ni)}}const pt=s.inputSources;for(let Ct=0;Ct<j.length;Ct++)j[Ct].update(pt[Ct],wt,u);Ve&&Ve(it,wt),I=null}),this.setAnimationLoop=function(it){Ve=it},this.dispose=function(){}}}function St(h){function e(n,s){n.opacity.value=s.opacity,s.color&&n.diffuse.value.copy(s.color),s.emissive&&n.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),s.map&&(n.map.value=s.map),s.alphaMap&&(n.alphaMap.value=s.alphaMap),s.specularMap&&(n.specularMap.value=s.specularMap),s.alphaTest>0&&(n.alphaTest.value=s.alphaTest);const l=h.get(s).envMap;let u,f;l&&(n.envMap.value=l,n.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1,n.reflectivity.value=s.reflectivity,n.ior.value=s.ior,n.refractionRatio.value=s.refractionRatio),s.lightMap&&(n.lightMap.value=s.lightMap,n.lightMapIntensity.value=s.lightMapIntensity),s.aoMap&&(n.aoMap.value=s.aoMap,n.aoMapIntensity.value=s.aoMapIntensity),s.map?u=s.map:s.specularMap?u=s.specularMap:s.displacementMap?u=s.displacementMap:s.normalMap?u=s.normalMap:s.bumpMap?u=s.bumpMap:s.roughnessMap?u=s.roughnessMap:s.metalnessMap?u=s.metalnessMap:s.alphaMap?u=s.alphaMap:s.emissiveMap?u=s.emissiveMap:s.clearcoatMap?u=s.clearcoatMap:s.clearcoatNormalMap?u=s.clearcoatNormalMap:s.clearcoatRoughnessMap?u=s.clearcoatRoughnessMap:s.specularIntensityMap?u=s.specularIntensityMap:s.specularColorMap?u=s.specularColorMap:s.transmissionMap?u=s.transmissionMap:s.thicknessMap?u=s.thicknessMap:s.sheenColorMap?u=s.sheenColorMap:s.sheenRoughnessMap&&(u=s.sheenRoughnessMap),void 0!==u&&(u.isWebGLRenderTarget&&(u=u.texture),!0===u.matrixAutoUpdate&&u.updateMatrix(),n.uvTransform.value.copy(u.matrix)),s.aoMap?f=s.aoMap:s.lightMap&&(f=s.lightMap),void 0!==f&&(f.isWebGLRenderTarget&&(f=f.texture),!0===f.matrixAutoUpdate&&f.updateMatrix(),n.uv2Transform.value.copy(f.matrix))}function t(n,s){n.roughness.value=s.roughness,n.metalness.value=s.metalness,s.roughnessMap&&(n.roughnessMap.value=s.roughnessMap),s.metalnessMap&&(n.metalnessMap.value=s.metalnessMap),s.emissiveMap&&(n.emissiveMap.value=s.emissiveMap),s.bumpMap&&(n.bumpMap.value=s.bumpMap,n.bumpScale.value=s.bumpScale,1===s.side&&(n.bumpScale.value*=-1)),s.normalMap&&(n.normalMap.value=s.normalMap,n.normalScale.value.copy(s.normalScale),1===s.side&&n.normalScale.value.negate()),s.displacementMap&&(n.displacementMap.value=s.displacementMap,n.displacementScale.value=s.displacementScale,n.displacementBias.value=s.displacementBias),h.get(s).envMap&&(n.envMapIntensity.value=s.envMapIntensity)}return{refreshFogUniforms:function(n,s){n.fogColor.value.copy(s.color),s.isFog?(n.fogNear.value=s.near,n.fogFar.value=s.far):s.isFogExp2&&(n.fogDensity.value=s.density)},refreshMaterialUniforms:function(n,s,l,u,f){var b;s.isMeshBasicMaterial?e(n,s):s.isMeshLambertMaterial?(e(n,s),(b=s).emissiveMap&&(n.emissiveMap.value=b.emissiveMap)):s.isMeshToonMaterial?(e(n,s),function(v,b){b.gradientMap&&(v.gradientMap.value=b.gradientMap),b.emissiveMap&&(v.emissiveMap.value=b.emissiveMap),b.bumpMap&&(v.bumpMap.value=b.bumpMap,v.bumpScale.value=b.bumpScale,1===b.side&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,v.normalScale.value.copy(b.normalScale),1===b.side&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(n,s)):s.isMeshPhongMaterial?(e(n,s),function(v,b){v.specular.value.copy(b.specular),v.shininess.value=Math.max(b.shininess,1e-4),b.emissiveMap&&(v.emissiveMap.value=b.emissiveMap),b.bumpMap&&(v.bumpMap.value=b.bumpMap,v.bumpScale.value=b.bumpScale,1===b.side&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,v.normalScale.value.copy(b.normalScale),1===b.side&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(n,s)):s.isMeshStandardMaterial?(e(n,s),s.isMeshPhysicalMaterial?function(v,b,S){t(v,b),v.ior.value=b.ior,b.sheen>0&&(v.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),v.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(v.sheenColorMap.value=b.sheenColorMap),b.sheenRoughnessMap&&(v.sheenRoughnessMap.value=b.sheenRoughnessMap)),b.clearcoat>0&&(v.clearcoat.value=b.clearcoat,v.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(v.clearcoatMap.value=b.clearcoatMap),b.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap),b.clearcoatNormalMap&&(v.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),v.clearcoatNormalMap.value=b.clearcoatNormalMap,1===b.side&&v.clearcoatNormalScale.value.negate())),b.transmission>0&&(v.transmission.value=b.transmission,v.transmissionSamplerMap.value=S.texture,v.transmissionSamplerSize.value.set(S.width,S.height),b.transmissionMap&&(v.transmissionMap.value=b.transmissionMap),v.thickness.value=b.thickness,b.thicknessMap&&(v.thicknessMap.value=b.thicknessMap),v.attenuationDistance.value=b.attenuationDistance,v.attenuationColor.value.copy(b.attenuationColor)),v.specularIntensity.value=b.specularIntensity,v.specularColor.value.copy(b.specularColor),b.specularIntensityMap&&(v.specularIntensityMap.value=b.specularIntensityMap),b.specularColorMap&&(v.specularColorMap.value=b.specularColorMap)}(n,s,f):t(n,s)):s.isMeshMatcapMaterial?(e(n,s),function(v,b){b.matcap&&(v.matcap.value=b.matcap),b.bumpMap&&(v.bumpMap.value=b.bumpMap,v.bumpScale.value=b.bumpScale,1===b.side&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,v.normalScale.value.copy(b.normalScale),1===b.side&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(n,s)):s.isMeshDepthMaterial?(e(n,s),function(v,b){b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(n,s)):s.isMeshDistanceMaterial?(e(n,s),function(v,b){b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias),v.referencePosition.value.copy(b.referencePosition),v.nearDistance.value=b.nearDistance,v.farDistance.value=b.farDistance}(n,s)):s.isMeshNormalMaterial?(e(n,s),function(v,b){b.bumpMap&&(v.bumpMap.value=b.bumpMap,v.bumpScale.value=b.bumpScale,1===b.side&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,v.normalScale.value.copy(b.normalScale),1===b.side&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias)}(n,s)):s.isLineBasicMaterial?(function(v,b){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity}(n,s),s.isLineDashedMaterial&&function(v,b){v.dashSize.value=b.dashSize,v.totalSize.value=b.dashSize+b.gapSize,v.scale.value=b.scale}(n,s)):s.isPointsMaterial?function(v,b,S,C){let I;v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,v.size.value=b.size*S,v.scale.value=.5*C,b.map&&(v.map.value=b.map),b.alphaMap&&(v.alphaMap.value=b.alphaMap),b.alphaTest>0&&(v.alphaTest.value=b.alphaTest),b.map?I=b.map:b.alphaMap&&(I=b.alphaMap),void 0!==I&&(!0===I.matrixAutoUpdate&&I.updateMatrix(),v.uvTransform.value.copy(I.matrix))}(n,s,l,u):s.isSpriteMaterial?function(v,b){let S;v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,v.rotation.value=b.rotation,b.map&&(v.map.value=b.map),b.alphaMap&&(v.alphaMap.value=b.alphaMap),b.alphaTest>0&&(v.alphaTest.value=b.alphaTest),b.map?S=b.map:b.alphaMap&&(S=b.alphaMap),void 0!==S&&(!0===S.matrixAutoUpdate&&S.updateMatrix(),v.uvTransform.value.copy(S.matrix))}(n,s):s.isShadowMaterial?(n.color.value.copy(s.color),n.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function Ie(h={}){const e=void 0!==h.canvas?h.canvas:function(){const Ee=X("canvas");return Ee.style.display="block",Ee}(),t=void 0!==h.context?h.context:null,n=void 0===h.depth||h.depth,s=void 0===h.stencil||h.stencil,l=void 0!==h.antialias&&h.antialias,u=void 0===h.premultipliedAlpha||h.premultipliedAlpha,f=void 0!==h.preserveDrawingBuffer&&h.preserveDrawingBuffer,v=void 0!==h.powerPreference?h.powerPreference:"default",b=void 0!==h.failIfMajorPerformanceCaveat&&h.failIfMajorPerformanceCaveat;let S;S=void 0!==h.context?t.getContextAttributes().alpha:void 0!==h.alpha&&h.alpha;let C=null,I=null;const D=[],O=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const N=this;let j=!1,U=0,Q=0,Y=null,Z=-1,te=null;const oe=new Rt,de=new Rt;let Ce=null,Le=e.width,Oe=e.height,Ze=1,et=null,ot=null;const Ve=new Rt(0,0,Le,Oe),at=new Rt(0,0,Le,Oe);let it=!1;const wt=new Ea;let pt=!1,Ct=!1,dt=null;const ei=new ii,Zt=new Mt,Xt=new me,ni={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Te(){return null===Y?Ze:1}let ve,tt,st,Pe,Ge,he,ze,Ke,Et,nt,Ft,jt,ri,Ri,bi,Ti,_i,Bn,Ah,Ci,Yn,rn,mp,qt=t;function Lx(Ee,lt){for(let _t=0;_t<Ee.length;_t++){const Lt=e.getContext(Ee[_t],lt);if(null!==Lt)return Lt}return null}try{const Ee={alpha:!0,depth:n,stencil:s,antialias:l,premultipliedAlpha:u,preserveDrawingBuffer:f,powerPreference:v,failIfMajorPerformanceCaveat:b};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r138"),e.addEventListener("webglcontextlost",kx,!1),e.addEventListener("webglcontextrestored",zx,!1),null===qt){const lt=["webgl2","webgl","experimental-webgl"];if(!0===N.isWebGL1Renderer&&lt.shift(),qt=Lx(lt,Ee),null===qt)throw Lx(lt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===qt.getShaderPrecisionFormat&&(qt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ee){throw console.error("THREE.WebGLRenderer: "+Ee.message),Ee}function Rx(){ve=new $h(qt),tt=new bp(qt,ve,h),ve.init(tt),rn=new ye(qt,ve,tt),st=new pe(qt,ve,tt),Pe=new Ku(qt),Ge=new M,he=new _e(qt,ve,st,Ge,tt,rn,Pe),ze=new Wh(N),Ke=new Ju(N),Et=new Gm(qt,tt),mp=new qu(qt,ve,Et,tt),nt=new Nc(qt,Et,Pe,mp),Ft=new td(qt,nt,Et,Pe),Ah=new ed(qt,tt,he),Ti=new jh(Ge),jt=new y(N,ze,Ke,ve,tt,mp,Ti),ri=new St(Ge),Ri=new F,bi=new ie(ve,tt),Bn=new Uc(N,ze,st,Ft,S,u),_i=new ce(N,Ft,tt),Ci=new $u(qt,ve,Pe,tt),Yn=new Vc(qt,ve,Pe,tt),Pe.programs=jt.programs,N.capabilities=tt,N.extensions=ve,N.properties=Ge,N.renderLists=Ri,N.shadowMap=_i,N.state=st,N.info=Pe}Rx();const da=new Xe(N,qt);function kx(Ee){Ee.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),j=!0}function zx(){console.log("THREE.WebGLRenderer: Context Restored."),j=!1;const Ee=Pe.autoReset,lt=_i.enabled,_t=_i.autoUpdate,Pt=_i.needsUpdate,Lt=_i.type;Rx(),Pe.autoReset=Ee,_i.enabled=lt,_i.autoUpdate=_t,_i.needsUpdate=Pt,_i.type=Lt}function Ox(Ee){const lt=Ee.target;var _t;lt.removeEventListener("dispose",Ox),function(Pt){const Lt=Ge.get(Pt).programs;void 0!==Lt&&(Lt.forEach(function(wi){jt.releaseProgram(wi)}),Pt.isShaderMaterial&&jt.releaseShaderCache(Pt))}(_t=lt),Ge.remove(_t)}this.xr=da,this.getContext=function(){return qt},this.getContextAttributes=function(){return qt.getContextAttributes()},this.forceContextLoss=function(){const Ee=ve.get("WEBGL_lose_context");Ee&&Ee.loseContext()},this.forceContextRestore=function(){const Ee=ve.get("WEBGL_lose_context");Ee&&Ee.restoreContext()},this.getPixelRatio=function(){return Ze},this.setPixelRatio=function(Ee){void 0!==Ee&&(Ze=Ee,this.setSize(Le,Oe,!1))},this.getSize=function(Ee){return Ee.set(Le,Oe)},this.setSize=function(Ee,lt,_t){da.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Le=Ee,Oe=lt,e.width=Math.floor(Ee*Ze),e.height=Math.floor(lt*Ze),!1!==_t&&(e.style.width=Ee+"px",e.style.height=lt+"px"),this.setViewport(0,0,Ee,lt))},this.getDrawingBufferSize=function(Ee){return Ee.set(Le*Ze,Oe*Ze).floor()},this.setDrawingBufferSize=function(Ee,lt,_t){Le=Ee,Oe=lt,Ze=_t,e.width=Math.floor(Ee*_t),e.height=Math.floor(lt*_t),this.setViewport(0,0,Ee,lt)},this.getCurrentViewport=function(Ee){return Ee.copy(oe)},this.getViewport=function(Ee){return Ee.copy(Ve)},this.setViewport=function(Ee,lt,_t,Pt){Ee.isVector4?Ve.set(Ee.x,Ee.y,Ee.z,Ee.w):Ve.set(Ee,lt,_t,Pt),st.viewport(oe.copy(Ve).multiplyScalar(Ze).floor())},this.getScissor=function(Ee){return Ee.copy(at)},this.setScissor=function(Ee,lt,_t,Pt){Ee.isVector4?at.set(Ee.x,Ee.y,Ee.z,Ee.w):at.set(Ee,lt,_t,Pt),st.scissor(de.copy(at).multiplyScalar(Ze).floor())},this.getScissorTest=function(){return it},this.setScissorTest=function(Ee){st.setScissorTest(it=Ee)},this.setOpaqueSort=function(Ee){et=Ee},this.setTransparentSort=function(Ee){ot=Ee},this.getClearColor=function(Ee){return Ee.copy(Bn.getClearColor())},this.setClearColor=function(){Bn.setClearColor.apply(Bn,arguments)},this.getClearAlpha=function(){return Bn.getClearAlpha()},this.setClearAlpha=function(){Bn.setClearAlpha.apply(Bn,arguments)},this.clear=function(Ee=!0,lt=!0,_t=!0){let Pt=0;Ee&&(Pt|=16384),lt&&(Pt|=256),_t&&(Pt|=1024),qt.clear(Pt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",kx,!1),e.removeEventListener("webglcontextrestored",zx,!1),Ri.dispose(),bi.dispose(),Ge.dispose(),ze.dispose(),Ke.dispose(),Ft.dispose(),mp.dispose(),jt.dispose(),da.dispose(),da.removeEventListener("sessionstart",Bx),da.removeEventListener("sessionend",Fx),dt&&(dt.dispose(),dt=null),fp.stop()},this.renderBufferDirect=function(Ee,lt,_t,Pt,Lt,wi){null===lt&&(lt=ni);const Gi=Lt.isMesh&&Lt.matrixWorld.determinant()<0,ki=function(Ss,Lg,kl,Ui,os){!0!==Lg.isScene&&(Lg=ni),he.resetTextureUnits();const Z0=Lg.fog,sw=null===Y?N.outputEncoding:!0===Y.isXRRenderTarget?Y.texture.encoding:3e3,ow=(Ui.isMeshStandardMaterial?Ke:ze).get(Ui.envMap||(Ui.isMeshStandardMaterial?Lg.environment:null)),aw=!0===Ui.vertexColors&&!!kl.attributes.color&&4===kl.attributes.color.itemSize,lw=!!Ui.normalMap&&!!kl.attributes.tangent,cw=!!kl.morphAttributes.position,hw=!!kl.morphAttributes.normal,uw=!!kl.morphAttributes.color,dw=Ui.toneMapped?N.toneMapping:0,Gx=kl.morphAttributes.position||kl.morphAttributes.normal||kl.morphAttributes.color,pw=void 0!==Gx?Gx.length:0,An=Ge.get(Ui),mw=I.state.lights;!0!==pt||!0!==Ct&&Ss===te||Ti.setState(Ui,Ss,Ss===te&&Ui.id===Z);let Ph=!1;Ui.version===An.__version?An.needsLights&&An.lightsStateVersion!==mw.state.version||An.outputEncoding!==sw||os.isInstancedMesh&&!1===An.instancing?Ph=!0:os.isInstancedMesh||!0!==An.instancing?os.isSkinnedMesh&&!1===An.skinning?Ph=!0:os.isSkinnedMesh||!0!==An.skinning?An.envMap!==ow||Ui.fog&&An.fog!==Z0?Ph=!0:void 0===An.numClippingPlanes||An.numClippingPlanes===Ti.numPlanes&&An.numIntersection===Ti.numIntersection?(An.vertexAlphas!==aw||An.vertexTangents!==lw||An.morphTargets!==cw||An.morphNormals!==hw||An.morphColors!==uw||An.toneMapping!==dw||!0===tt.isWebGL2&&An.morphTargetsCount!==pw)&&(Ph=!0):Ph=!0:Ph=!0:Ph=!0:(Ph=!0,An.__version=Ui.version);let Rg=An.currentProgram;!0===Ph&&(Rg=j0(Ui,Lg,os));let Hx=!1,kg=!1,q0=!1;const qs=Rg.getUniforms(),zg=An.uniforms;if(st.useProgram(Rg.program)&&(Hx=!0,kg=!0,q0=!0),Ui.id!==Z&&(Z=Ui.id,kg=!0),Hx||te!==Ss){if(qs.setValue(qt,"projectionMatrix",Ss.projectionMatrix),tt.logarithmicDepthBuffer&&qs.setValue(qt,"logDepthBufFC",2/(Math.log(Ss.far+1)/Math.LN2)),te!==Ss&&(te=Ss,kg=!0,q0=!0),Ui.isShaderMaterial||Ui.isMeshPhongMaterial||Ui.isMeshToonMaterial||Ui.isMeshStandardMaterial||Ui.envMap){const Ol=qs.map.cameraPosition;void 0!==Ol&&Ol.setValue(qt,Xt.setFromMatrixPosition(Ss.matrixWorld))}(Ui.isMeshPhongMaterial||Ui.isMeshToonMaterial||Ui.isMeshLambertMaterial||Ui.isMeshBasicMaterial||Ui.isMeshStandardMaterial||Ui.isShaderMaterial)&&qs.setValue(qt,"isOrthographic",!0===Ss.isOrthographicCamera),(Ui.isMeshPhongMaterial||Ui.isMeshToonMaterial||Ui.isMeshLambertMaterial||Ui.isMeshBasicMaterial||Ui.isMeshStandardMaterial||Ui.isShaderMaterial||Ui.isShadowMaterial||os.isSkinnedMesh)&&qs.setValue(qt,"viewMatrix",Ss.matrixWorldInverse)}if(os.isSkinnedMesh){qs.setOptional(qt,os,"bindMatrix"),qs.setOptional(qt,os,"bindMatrixInverse");const Ol=os.skeleton;Ol&&(tt.floatVertexTextures?(null===Ol.boneTexture&&Ol.computeBoneTexture(),qs.setValue(qt,"boneTexture",Ol.boneTexture,he),qs.setValue(qt,"boneTextureSize",Ol.boneTextureSize)):qs.setOptional(qt,Ol,"boneMatrices"))}const $0=kl.morphAttributes;var wc,zl;return(void 0!==$0.position||void 0!==$0.normal||void 0!==$0.color&&!0===tt.isWebGL2)&&Ah.update(os,kl,Ui,Rg),(kg||An.receiveShadow!==os.receiveShadow)&&(An.receiveShadow=os.receiveShadow,qs.setValue(qt,"receiveShadow",os.receiveShadow)),kg&&(qs.setValue(qt,"toneMappingExposure",N.toneMappingExposure),An.needsLights&&((wc=zg).ambientLightColor.needsUpdate=zl=q0,wc.lightProbe.needsUpdate=zl,wc.directionalLights.needsUpdate=zl,wc.directionalLightShadows.needsUpdate=zl,wc.pointLights.needsUpdate=zl,wc.pointLightShadows.needsUpdate=zl,wc.spotLights.needsUpdate=zl,wc.spotLightShadows.needsUpdate=zl,wc.rectAreaLights.needsUpdate=zl,wc.hemisphereLights.needsUpdate=zl),Z0&&Ui.fog&&ri.refreshFogUniforms(zg,Z0),ri.refreshMaterialUniforms(zg,Ui,Ze,Oe,dt),no.upload(qt,An.uniformsList,zg,he)),Ui.isShaderMaterial&&!0===Ui.uniformsNeedUpdate&&(no.upload(qt,An.uniformsList,zg,he),Ui.uniformsNeedUpdate=!1),Ui.isSpriteMaterial&&qs.setValue(qt,"center",os.center),qs.setValue(qt,"modelViewMatrix",os.modelViewMatrix),qs.setValue(qt,"normalMatrix",os.normalMatrix),qs.setValue(qt,"modelMatrix",os.matrixWorld),Rg}(Ee,lt,_t,Pt,Lt);st.setMaterial(Pt,Gi);let sn=_t.index;const hr=_t.attributes.position;if(null===sn){if(void 0===hr||0===hr.count)return}else if(0===sn.count)return;let gn,Yi=1;!0===Pt.wireframe&&(sn=nt.getWireframeAttribute(_t),Yi=2),mp.setup(Lt,Pt,ki,_t,sn);let ss=Ci;null!==sn&&(gn=Et.get(sn),ss=Yn,ss.setIndex(gn));const Dg=null!==sn?sn.count:hr.count,Wa=_t.drawRange.start*Yi,W0=_t.drawRange.count*Yi,Vu=null!==wi?wi.start*Yi:0,iw=null!==wi?wi.count*Yi:1/0,ny=Math.max(Wa,Vu),nw=Math.min(Dg,Wa+W0,Vu+iw)-1,ry=Math.max(0,nw-ny+1);if(0!==ry){if(Lt.isMesh)!0===Pt.wireframe?(st.setLineWidth(Pt.wireframeLinewidth*Te()),ss.setMode(1)):ss.setMode(4);else if(Lt.isLine){let Ss=Pt.linewidth;void 0===Ss&&(Ss=1),st.setLineWidth(Ss*Te()),ss.setMode(Lt.isLineSegments?1:Lt.isLineLoop?2:3)}else Lt.isPoints?ss.setMode(0):Lt.isSprite&&ss.setMode(4);if(Lt.isInstancedMesh)ss.renderInstances(ny,ry,Lt.count);else if(_t.isInstancedBufferGeometry){const Ss=Math.min(_t.instanceCount,_t._maxInstanceCount);ss.renderInstances(ny,ry,Ss)}else ss.render(ny,ry)}},this.compile=function(Ee,lt){I=bi.get(Ee),I.init(),O.push(I),Ee.traverseVisible(function(_t){_t.isLight&&_t.layers.test(lt.layers)&&(I.pushLight(_t),_t.castShadow&&I.pushShadow(_t))}),I.setupLights(N.physicallyCorrectLights),Ee.traverse(function(_t){const Pt=_t.material;if(Pt)if(Array.isArray(Pt))for(let Lt=0;Lt<Pt.length;Lt++)j0(Pt[Lt],Ee,_t);else j0(Pt,Ee,_t)}),O.pop(),I=null};let H0=null;function Bx(){fp.stop()}function Fx(){fp.start()}const fp=new xp;function Ux(Ee,lt,_t,Pt){if(!1===Ee.visible)return;if(Ee.layers.test(lt.layers))if(Ee.isGroup)_t=Ee.renderOrder;else if(Ee.isLOD)!0===Ee.autoUpdate&&Ee.update(lt);else if(Ee.isLight)I.pushLight(Ee),Ee.castShadow&&I.pushShadow(Ee);else if(Ee.isSprite){if(!Ee.frustumCulled||wt.intersectsSprite(Ee)){Pt&&Xt.setFromMatrixPosition(Ee.matrixWorld).applyMatrix4(ei);const wi=Ft.update(Ee),Gi=Ee.material;Gi.visible&&C.push(Ee,wi,Gi,_t,Xt.z,null)}}else if((Ee.isMesh||Ee.isLine||Ee.isPoints)&&(Ee.isSkinnedMesh&&Ee.skeleton.frame!==Pe.render.frame&&(Ee.skeleton.update(),Ee.skeleton.frame=Pe.render.frame),!Ee.frustumCulled||wt.intersectsObject(Ee))){Pt&&Xt.setFromMatrixPosition(Ee.matrixWorld).applyMatrix4(ei);const wi=Ft.update(Ee),Gi=Ee.material;if(Array.isArray(Gi)){const ki=wi.groups;for(let sn=0,hr=ki.length;sn<hr;sn++){const gn=ki[sn],Yi=Gi[gn.materialIndex];Yi&&Yi.visible&&C.push(Ee,wi,Yi,_t,Xt.z,gn)}}else Gi.visible&&C.push(Ee,wi,Gi,_t,Xt.z,null)}const Lt=Ee.children;for(let wi=0,Gi=Lt.length;wi<Gi;wi++)Ux(Lt[wi],lt,_t,Pt)}function Nx(Ee,lt,_t,Pt){const Lt=Ee.opaque,wi=Ee.transmissive,Gi=Ee.transparent;I.setupLightsView(_t),wi.length>0&&function(ki,sn,hr){const gn=tt.isWebGL2;null===dt&&(dt=new Fe(1,1,{generateMipmaps:!0,type:null!==rn.convert(1016)?1016:1009,minFilter:1008,samples:gn&&!0===l?4:0})),N.getDrawingBufferSize(Zt),gn?dt.setSize(Zt.x,Zt.y):dt.setSize(Vo(Zt.x),Vo(Zt.y));const Yi=N.getRenderTarget();N.setRenderTarget(dt),N.clear();const ss=N.toneMapping;N.toneMapping=0,iy(ki,sn,hr),N.toneMapping=ss,he.updateMultisampleRenderTarget(dt),he.updateRenderTargetMipmap(dt),N.setRenderTarget(Yi)}(Lt,lt,_t),Pt&&st.viewport(oe.copy(Pt)),Lt.length>0&&iy(Lt,lt,_t),wi.length>0&&iy(wi,lt,_t),Gi.length>0&&iy(Gi,lt,_t),st.buffers.depth.setTest(!0),st.buffers.depth.setMask(!0),st.buffers.color.setMask(!0),st.setPolygonOffset(!1)}function iy(Ee,lt,_t){const Pt=!0===lt.isScene?lt.overrideMaterial:null;for(let Lt=0,wi=Ee.length;Lt<wi;Lt++){const Gi=Ee[Lt],ki=Gi.object,sn=Gi.geometry,hr=null===Pt?Gi.material:Pt,gn=Gi.group;ki.layers.test(_t.layers)&&tw(ki,lt,_t,sn,hr,gn)}}function tw(Ee,lt,_t,Pt,Lt,wi){Ee.onBeforeRender(N,lt,_t,Pt,Lt,wi),Ee.modelViewMatrix.multiplyMatrices(_t.matrixWorldInverse,Ee.matrixWorld),Ee.normalMatrix.getNormalMatrix(Ee.modelViewMatrix),Lt.onBeforeRender(N,lt,_t,Pt,Ee,wi),!0===Lt.transparent&&2===Lt.side?(Lt.side=1,Lt.needsUpdate=!0,N.renderBufferDirect(_t,lt,Pt,Lt,Ee,wi),Lt.side=0,Lt.needsUpdate=!0,N.renderBufferDirect(_t,lt,Pt,Lt,Ee,wi),Lt.side=2):N.renderBufferDirect(_t,lt,Pt,Lt,Ee,wi),Ee.onAfterRender(N,lt,_t,Pt,Lt,wi)}function j0(Ee,lt,_t){!0!==lt.isScene&&(lt=ni);const Pt=Ge.get(Ee),Lt=I.state.lights,Gi=Lt.state.version,ki=jt.getParameters(Ee,Lt.state,I.state.shadowsArray,lt,_t),sn=jt.getProgramCacheKey(ki);let hr=Pt.programs;Pt.environment=Ee.isMeshStandardMaterial?lt.environment:null,Pt.fog=lt.fog,Pt.envMap=(Ee.isMeshStandardMaterial?Ke:ze).get(Ee.envMap||Pt.environment),void 0===hr&&(Ee.addEventListener("dispose",Ox),hr=new Map,Pt.programs=hr);let gn=hr.get(sn);if(void 0!==gn){if(Pt.currentProgram===gn&&Pt.lightsStateVersion===Gi)return Vx(Ee,ki),gn}else ki.uniforms=jt.getUniforms(Ee),Ee.onBuild(_t,ki,N),Ee.onBeforeCompile(ki,N),gn=jt.acquireProgram(ki,sn),hr.set(sn,gn),Pt.uniforms=ki.uniforms;const Yi=Pt.uniforms;var Wa;(Ee.isShaderMaterial||Ee.isRawShaderMaterial)&&!0!==Ee.clipping||(Yi.clippingPlanes=Ti.uniform),Vx(Ee,ki),Pt.needsLights=(Wa=Ee).isMeshLambertMaterial||Wa.isMeshToonMaterial||Wa.isMeshPhongMaterial||Wa.isMeshStandardMaterial||Wa.isShadowMaterial||Wa.isShaderMaterial&&!0===Wa.lights,Pt.lightsStateVersion=Gi,Pt.needsLights&&(Yi.ambientLightColor.value=Lt.state.ambient,Yi.lightProbe.value=Lt.state.probe,Yi.directionalLights.value=Lt.state.directional,Yi.directionalLightShadows.value=Lt.state.directionalShadow,Yi.spotLights.value=Lt.state.spot,Yi.spotLightShadows.value=Lt.state.spotShadow,Yi.rectAreaLights.value=Lt.state.rectArea,Yi.ltc_1.value=Lt.state.rectAreaLTC1,Yi.ltc_2.value=Lt.state.rectAreaLTC2,Yi.pointLights.value=Lt.state.point,Yi.pointLightShadows.value=Lt.state.pointShadow,Yi.hemisphereLights.value=Lt.state.hemi,Yi.directionalShadowMap.value=Lt.state.directionalShadowMap,Yi.directionalShadowMatrix.value=Lt.state.directionalShadowMatrix,Yi.spotShadowMap.value=Lt.state.spotShadowMap,Yi.spotShadowMatrix.value=Lt.state.spotShadowMatrix,Yi.pointShadowMap.value=Lt.state.pointShadowMap,Yi.pointShadowMatrix.value=Lt.state.pointShadowMatrix);const ss=gn.getUniforms(),Dg=no.seqWithValue(ss.seq,Yi);return Pt.currentProgram=gn,Pt.uniformsList=Dg,gn}function Vx(Ee,lt){const _t=Ge.get(Ee);_t.outputEncoding=lt.outputEncoding,_t.instancing=lt.instancing,_t.skinning=lt.skinning,_t.morphTargets=lt.morphTargets,_t.morphNormals=lt.morphNormals,_t.morphColors=lt.morphColors,_t.morphTargetsCount=lt.morphTargetsCount,_t.numClippingPlanes=lt.numClippingPlanes,_t.numIntersection=lt.numClipIntersection,_t.vertexAlphas=lt.vertexAlphas,_t.vertexTangents=lt.vertexTangents,_t.toneMapping=lt.toneMapping}fp.setAnimationLoop(function(Ee){H0&&H0(Ee)}),"undefined"!=typeof window&&fp.setContext(window),this.setAnimationLoop=function(Ee){H0=Ee,da.setAnimationLoop(Ee),null===Ee?fp.stop():fp.start()},da.addEventListener("sessionstart",Bx),da.addEventListener("sessionend",Fx),this.render=function(Ee,lt){if(void 0===lt||!0===lt.isCamera){if(!0!==j){if(!0===Ee.autoUpdate&&Ee.updateMatrixWorld(),null===lt.parent&&lt.updateMatrixWorld(),!0===da.enabled&&!0===da.isPresenting&&(!0===da.cameraAutoUpdate&&da.updateCamera(lt),lt=da.getCamera()),!0===Ee.isScene&&Ee.onBeforeRender(N,Ee,lt,Y),I=bi.get(Ee,O.length),I.init(),O.push(I),ei.multiplyMatrices(lt.projectionMatrix,lt.matrixWorldInverse),wt.setFromProjectionMatrix(ei),Ct=this.localClippingEnabled,pt=Ti.init(this.clippingPlanes,Ct,lt),C=Ri.get(Ee,D.length),C.init(),D.push(C),Ux(Ee,lt,0,N.sortObjects),C.finish(),!0===N.sortObjects&&C.sort(et,ot),!0===pt&&Ti.beginShadows(),_i.render(I.state.shadowsArray,Ee,lt),!0===pt&&Ti.endShadows(),!0===this.info.autoReset&&this.info.reset(),Bn.render(C,Ee),I.setupLights(N.physicallyCorrectLights),lt.isArrayCamera){const Pt=lt.cameras;for(let Lt=0,wi=Pt.length;Lt<wi;Lt++){const Gi=Pt[Lt];Nx(C,Ee,Gi,Gi.viewport)}}else Nx(C,Ee,lt);null!==Y&&(he.updateMultisampleRenderTarget(Y),he.updateRenderTargetMipmap(Y)),!0===Ee.isScene&&Ee.onAfterRender(N,Ee,lt),mp.resetDefaultState(),Z=-1,te=null,O.pop(),I=O.length>0?O[O.length-1]:null,D.pop(),C=D.length>0?D[D.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return U},this.getActiveMipmapLevel=function(){return Q},this.getRenderTarget=function(){return Y},this.setRenderTargetTextures=function(Ee,lt,_t){Ge.get(Ee.texture).__webglTexture=lt,Ge.get(Ee.depthTexture).__webglTexture=_t;const Pt=Ge.get(Ee);Pt.__hasExternalTextures=!0,Pt.__hasExternalTextures&&(Pt.__autoAllocateDepthBuffer=void 0===_t,Pt.__autoAllocateDepthBuffer||!0===ve.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Pt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Ee,lt){const _t=Ge.get(Ee);_t.__webglFramebuffer=lt,_t.__useDefaultFramebuffer=void 0===lt},this.setRenderTarget=function(Ee,lt=0,_t=0){Y=Ee,U=lt,Q=_t;let Pt=!0;if(Ee){const ki=Ge.get(Ee);void 0!==ki.__useDefaultFramebuffer?(st.bindFramebuffer(36160,null),Pt=!1):void 0===ki.__webglFramebuffer?he.setupRenderTarget(Ee):ki.__hasExternalTextures&&he.rebindTextures(Ee,Ge.get(Ee.texture).__webglTexture,Ge.get(Ee.depthTexture).__webglTexture)}let Lt=null,wi=!1,Gi=!1;if(Ee){const ki=Ee.texture;(ki.isData3DTexture||ki.isDataArrayTexture)&&(Gi=!0);const sn=Ge.get(Ee).__webglFramebuffer;Ee.isWebGLCubeRenderTarget?(Lt=sn[lt],wi=!0):Lt=tt.isWebGL2&&Ee.samples>0&&!1===he.useMultisampledRTT(Ee)?Ge.get(Ee).__webglMultisampledFramebuffer:sn,oe.copy(Ee.viewport),de.copy(Ee.scissor),Ce=Ee.scissorTest}else oe.copy(Ve).multiplyScalar(Ze).floor(),de.copy(at).multiplyScalar(Ze).floor(),Ce=it;if(st.bindFramebuffer(36160,Lt)&&tt.drawBuffers&&Pt&&st.drawBuffers(Ee,Lt),st.viewport(oe),st.scissor(de),st.setScissorTest(Ce),wi){const ki=Ge.get(Ee.texture);qt.framebufferTexture2D(36160,36064,34069+lt,ki.__webglTexture,_t)}else if(Gi){const ki=Ge.get(Ee.texture);qt.framebufferTextureLayer(36160,36064,ki.__webglTexture,_t||0,lt||0)}Z=-1},this.readRenderTargetPixels=function(Ee,lt,_t,Pt,Lt,wi,Gi){if(!Ee||!Ee.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ki=Ge.get(Ee).__webglFramebuffer;if(Ee.isWebGLCubeRenderTarget&&void 0!==Gi&&(ki=ki[Gi]),ki){st.bindFramebuffer(36160,ki);try{const sn=Ee.texture,hr=sn.format,gn=sn.type;if(1023!==hr&&rn.convert(hr)!==qt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Yi=1016===gn&&(ve.has("EXT_color_buffer_half_float")||tt.isWebGL2&&ve.has("EXT_color_buffer_float"));if(!(1009===gn||rn.convert(gn)===qt.getParameter(35738)||1015===gn&&(tt.isWebGL2||ve.has("OES_texture_float")||ve.has("WEBGL_color_buffer_float"))||Yi))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===qt.checkFramebufferStatus(36160)?lt>=0&&lt<=Ee.width-Pt&&_t>=0&&_t<=Ee.height-Lt&&qt.readPixels(lt,_t,Pt,Lt,rn.convert(hr),rn.convert(gn),wi):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const sn=null!==Y?Ge.get(Y).__webglFramebuffer:null;st.bindFramebuffer(36160,sn)}}},this.copyFramebufferToTexture=function(Ee,lt,_t=0){if(!0!==lt.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const Pt=Math.pow(2,-_t),Lt=Math.floor(lt.image.width*Pt),wi=Math.floor(lt.image.height*Pt);he.setTexture2D(lt,0),qt.copyTexSubImage2D(3553,_t,0,0,Ee.x,Ee.y,Lt,wi),st.unbindTexture()},this.copyTextureToTexture=function(Ee,lt,_t,Pt=0){const Lt=lt.image.width,wi=lt.image.height,Gi=rn.convert(_t.format),ki=rn.convert(_t.type);he.setTexture2D(_t,0),qt.pixelStorei(37440,_t.flipY),qt.pixelStorei(37441,_t.premultiplyAlpha),qt.pixelStorei(3317,_t.unpackAlignment),lt.isDataTexture?qt.texSubImage2D(3553,Pt,Ee.x,Ee.y,Lt,wi,Gi,ki,lt.image.data):lt.isCompressedTexture?qt.compressedTexSubImage2D(3553,Pt,Ee.x,Ee.y,lt.mipmaps[0].width,lt.mipmaps[0].height,Gi,lt.mipmaps[0].data):qt.texSubImage2D(3553,Pt,Ee.x,Ee.y,Gi,ki,lt.image),0===Pt&&_t.generateMipmaps&&qt.generateMipmap(3553),st.unbindTexture()},this.copyTextureToTexture3D=function(Ee,lt,_t,Pt,Lt=0){if(N.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const wi=Ee.max.x-Ee.min.x+1,Gi=Ee.max.y-Ee.min.y+1,ki=Ee.max.z-Ee.min.z+1,sn=rn.convert(Pt.format),hr=rn.convert(Pt.type);let gn;if(Pt.isData3DTexture)he.setTexture3D(Pt,0),gn=32879;else{if(!Pt.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");he.setTexture2DArray(Pt,0),gn=35866}qt.pixelStorei(37440,Pt.flipY),qt.pixelStorei(37441,Pt.premultiplyAlpha),qt.pixelStorei(3317,Pt.unpackAlignment);const Yi=qt.getParameter(3314),ss=qt.getParameter(32878),Dg=qt.getParameter(3316),Wa=qt.getParameter(3315),W0=qt.getParameter(32877),Vu=_t.isCompressedTexture?_t.mipmaps[0]:_t.image;qt.pixelStorei(3314,Vu.width),qt.pixelStorei(32878,Vu.height),qt.pixelStorei(3316,Ee.min.x),qt.pixelStorei(3315,Ee.min.y),qt.pixelStorei(32877,Ee.min.z),_t.isDataTexture||_t.isData3DTexture?qt.texSubImage3D(gn,Lt,lt.x,lt.y,lt.z,wi,Gi,ki,sn,hr,Vu.data):_t.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),qt.compressedTexSubImage3D(gn,Lt,lt.x,lt.y,lt.z,wi,Gi,ki,sn,Vu.data)):qt.texSubImage3D(gn,Lt,lt.x,lt.y,lt.z,wi,Gi,ki,sn,hr,Vu),qt.pixelStorei(3314,Yi),qt.pixelStorei(32878,ss),qt.pixelStorei(3316,Dg),qt.pixelStorei(3315,Wa),qt.pixelStorei(32877,W0),0===Lt&&Pt.generateMipmaps&&qt.generateMipmap(gn),st.unbindTexture()},this.initTexture=function(Ee){he.setTexture2D(Ee,0),st.unbindTexture()},this.resetState=function(){U=0,Q=0,Y=null,st.reset(),mp.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ie.prototype.isWebGLRenderer=!0,class extends Ie{}.prototype.isWebGL1Renderer=!0;class mt extends Ni{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}mt.prototype.isScene=!0;class ft{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=or()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let s=0,l=this.stride;s<l;s++)this.array[e+s]=t.array[n+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=or()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=or()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ft.prototype.isInterleavedBuffer=!0;const Tt=new me;class je{constructor(e,t,n,s=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Tt.x=this.getX(t),Tt.y=this.getY(t),Tt.z=this.getZ(t),Tt.applyMatrix4(e),this.setXYZ(t,Tt.x,Tt.y,Tt.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Tt.x=this.getX(t),Tt.y=this.getY(t),Tt.z=this.getZ(t),Tt.applyNormalMatrix(e),this.setXYZ(t,Tt.x,Tt.y,Tt.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Tt.x=this.getX(t),Tt.y=this.getY(t),Tt.z=this.getZ(t),Tt.transformDirection(e),this.setXYZ(t,Tt.x,Tt.y,Tt.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,s){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,t,n,s,l){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=l,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)t.push(this.data.array[s+l])}return new un(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new je(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)t.push(this.data.array[s+l])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}je.prototype.isInterleavedBufferAttribute=!0;class $t extends Mn{constructor(e){super(),this.type="SpriteMaterial",this.color=new we(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Wt;$t.prototype.isSpriteMaterial=!0;const zt=new me,Ot=new me,Kt=new me,li=new Mt,Vt=new Mt,oi=new ii,Mi=new me,pn=new me,nr=new me,pr=new Mt,Rr=new Mt,Fs=new Mt;function Us(h,e,t,n,s,l){li.subVectors(h,t).addScalar(.5).multiply(n),void 0!==s?(Vt.x=l*li.x-s*li.y,Vt.y=s*li.x+l*li.y):Vt.copy(li),h.copy(e),h.x+=Vt.x,h.y+=Vt.y,h.applyMatrix4(oi)}(class extends Ni{constructor(h){if(super(),this.type="Sprite",void 0===Wt){Wt=new an;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new ft(e,5);Wt.setIndex([0,1,2,0,2,3]),Wt.setAttribute("position",new je(t,3,0,!1)),Wt.setAttribute("uv",new je(t,2,3,!1))}this.geometry=Wt,this.material=void 0!==h?h:new $t,this.center=new Mt(.5,.5)}raycast(h,e){null===h.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ot.setFromMatrixScale(this.matrixWorld),oi.copy(h.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(h.camera.matrixWorldInverse,this.matrixWorld),Kt.setFromMatrixPosition(this.modelViewMatrix),h.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ot.multiplyScalar(-Kt.z);const t=this.material.rotation;let n,s;0!==t&&(s=Math.cos(t),n=Math.sin(t));const l=this.center;Us(Mi.set(-.5,-.5,0),Kt,l,Ot,n,s),Us(pn.set(.5,-.5,0),Kt,l,Ot,n,s),Us(nr.set(.5,.5,0),Kt,l,Ot,n,s),pr.set(0,0),Rr.set(1,0),Fs.set(1,1);let u=h.ray.intersectTriangle(Mi,pn,nr,!1,zt);if(null===u&&(Us(pn.set(-.5,.5,0),Kt,l,Ot,n,s),Rr.set(0,1),u=h.ray.intersectTriangle(Mi,nr,pn,!1,zt),null===u))return;const f=h.ray.origin.distanceTo(zt);f<h.near||f>h.far||e.push({distance:f,point:zt.clone(),uv:Ln.getUV(zt,Mi,pn,nr,pr,Rr,Fs,new Mt),face:null,object:this})}copy(h){return super.copy(h),void 0!==h.center&&this.center.copy(h.center),this.material=h.material,this}}).prototype.isSprite=!0;const ea=new me,Mo=new Rt,wn=new Rt,Rn=new me,Oi=new ii;class kn extends di{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ii,this.bindMatrixInverse=new ii}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Rt,t=this.geometry.attributes.skinWeight;for(let n=0,s=t.count;n<s;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const l=1/e.manhattanLength();l!==1/0?e.multiplyScalar(l):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,s=this.geometry;Mo.fromBufferAttribute(s.attributes.skinIndex,e),wn.fromBufferAttribute(s.attributes.skinWeight,e),ea.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let l=0;l<4;l++){const u=wn.getComponent(l);if(0!==u){const f=Mo.getComponent(l);Oi.multiplyMatrices(n.bones[f].matrixWorld,n.boneInverses[f]),t.addScaledVector(Rn.copy(ea).applyMatrix4(Oi),u)}}return t.applyMatrix4(this.bindMatrixInverse)}}kn.prototype.isSkinnedMesh=!0;class kr extends Ni{constructor(){super(),this.type="Bone"}}kr.prototype.isBone=!0;class _n extends Dt{constructor(e=null,t=1,n=1,s,l,u,f,v,b=1003,S=1003,C,I){super(null,u,f,v,b,S,s,l,C,I),this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}_n.prototype.isDataTexture=!0;const _s=new ii,Jc=new ii;class zr{constructor(e=[],t=[]){this.uuid=or(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new ii)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new ii;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let l=0,u=e.length;l<u;l++)_s.multiplyMatrices(e[l]?e[l].matrixWorld:Jc,t[l]),_s.toArray(n,16*l);null!==s&&(s.needsUpdate=!0)}clone(){return new zr(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=ba(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new _n(t,e,e,1023,1015);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const l=e.bones[n];let u=t[l];void 0===u&&(console.warn("THREE.Skeleton: No bone found with UUID:",l),u=new kr),this.bones.push(u),this.boneInverses.push((new ii).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let s=0,l=t.length;s<l;s++)e.bones.push(t[s].uuid),e.boneInverses.push(n[s].toArray());return e}}class ta extends un{constructor(e,t,n,s=1){"number"==typeof n&&(s=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}ta.prototype.isInstancedBufferAttribute=!0;const _d=new ii,ou=new ii,ia=[],Kc=new di;(class extends di{constructor(h,e,t){super(h,e),this.instanceMatrix=new ta(new Float32Array(16*t),16),this.instanceColor=null,this.count=t,this.frustumCulled=!1}copy(h){return super.copy(h),this.instanceMatrix.copy(h.instanceMatrix),null!==h.instanceColor&&(this.instanceColor=h.instanceColor.clone()),this.count=h.count,this}getColorAt(h,e){e.fromArray(this.instanceColor.array,3*h)}getMatrixAt(h,e){e.fromArray(this.instanceMatrix.array,16*h)}raycast(h,e){const t=this.matrixWorld,n=this.count;if(Kc.geometry=this.geometry,Kc.material=this.material,void 0!==Kc.material)for(let s=0;s<n;s++){this.getMatrixAt(s,_d),ou.multiplyMatrices(t,_d),Kc.matrixWorld=ou,Kc.raycast(h,ia);for(let l=0,u=ia.length;l<u;l++){const f=ia[l];f.instanceId=s,f.object=this,e.push(f)}ia.length=0}}setColorAt(h,e){null===this.instanceColor&&(this.instanceColor=new ta(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*h)}setMatrixAt(h,e){e.toArray(this.instanceMatrix.array,16*h)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class es extends Mn{constructor(e){super(),this.type="LineBasicMaterial",this.color=new we(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}es.prototype.isLineBasicMaterial=!0;const au=new me,yd=new me,Zm=new ii,vd=new Dn,Qc=new Ks;class So extends Ni{constructor(e=new an,t=new es){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let s=1,l=t.count;s<l;s++)au.fromBufferAttribute(t,s-1),yd.fromBufferAttribute(t,s),n[s]=n[s-1],n[s]+=au.distanceTo(yd);e.setAttribute("lineDistance",new vn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,l=e.params.Line.threshold,u=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Qc.copy(n.boundingSphere),Qc.applyMatrix4(s),Qc.radius+=l,!1===e.ray.intersectsSphere(Qc))return;Zm.copy(s).invert(),vd.copy(e.ray).applyMatrix4(Zm);const f=l/((this.scale.x+this.scale.y+this.scale.z)/3),v=f*f,b=new me,S=new me,C=new me,I=new me,D=this.isLineSegments?2:1;if(n.isBufferGeometry){const O=n.index,N=n.attributes.position;if(null!==O)for(let j=Math.max(0,u.start),U=Math.min(O.count,u.start+u.count)-1;j<U;j+=D){const Q=O.getX(j),Y=O.getX(j+1);if(b.fromBufferAttribute(N,Q),S.fromBufferAttribute(N,Y),vd.distanceSqToSegment(b,S,I,C)>v)continue;I.applyMatrix4(this.matrixWorld);const Z=e.ray.origin.distanceTo(I);Z<e.near||Z>e.far||t.push({distance:Z,point:C.clone().applyMatrix4(this.matrixWorld),index:j,face:null,faceIndex:null,object:this})}else for(let j=Math.max(0,u.start),U=Math.min(N.count,u.start+u.count)-1;j<U;j+=D){if(b.fromBufferAttribute(N,j),S.fromBufferAttribute(N,j+1),vd.distanceSqToSegment(b,S,I,C)>v)continue;I.applyMatrix4(this.matrixWorld);const Q=e.ray.origin.distanceTo(I);Q<e.near||Q>e.far||t.push({distance:Q,point:C.clone().applyMatrix4(this.matrixWorld),index:j,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,u=s.length;l<u;l++){const f=s[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=l}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}So.prototype.isLine=!0;const xd=new me,qm=new me;class bd extends So{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let s=0,l=t.count;s<l;s+=2)xd.fromBufferAttribute(t,s),qm.fromBufferAttribute(t,s+1),n[s]=0===s?0:n[s-1],n[s+1]=n[s]+xd.distanceTo(qm);e.setAttribute("lineDistance",new vn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}bd.prototype.isLineSegments=!0;class Og extends So{constructor(e,t){super(e,t),this.type="LineLoop"}}Og.prototype.isLineLoop=!0;class Fp extends Mn{constructor(e){super(),this.type="PointsMaterial",this.color=new we(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Fp.prototype.isPointsMaterial=!0;const Bg=new ii,wd=new Dn,ic=new Ks,gl=new me;class Aa extends Ni{constructor(e=new an,t=new Fp){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,l=e.params.Points.threshold,u=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ic.copy(n.boundingSphere),ic.applyMatrix4(s),ic.radius+=l,!1===e.ray.intersectsSphere(ic))return;Bg.copy(s).invert(),wd.copy(e.ray).applyMatrix4(Bg);const f=l/((this.scale.x+this.scale.y+this.scale.z)/3),v=f*f;if(n.isBufferGeometry){const b=n.index,S=n.attributes.position;if(null!==b)for(let C=Math.max(0,u.start),I=Math.min(b.count,u.start+u.count);C<I;C++){const D=b.getX(C);gl.fromBufferAttribute(S,D),To(gl,D,v,s,e,t,this)}else for(let C=Math.max(0,u.start),I=Math.min(S.count,u.start+u.count);C<I;C++)gl.fromBufferAttribute(S,C),To(gl,C,v,s,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,u=s.length;l<u;l++){const f=s[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=l}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function To(h,e,t,n,s,l,u){const f=wd.distanceSqToPoint(h);if(f<t){const v=new me;wd.closestPointToPoint(h,v),v.applyMatrix4(n);const b=s.ray.origin.distanceTo(v);if(b<s.near||b>s.far)return;l.push({distance:b,distanceToRay:Math.sqrt(f),point:v,index:e,face:null,object:u})}}Aa.prototype.isPoints=!0,class extends Dt{constructor(h,e,t,n,s,l,u,f,v){super(h,e,t,n,s,l,u,f,v),this.minFilter=void 0!==l?l:1006,this.magFilter=void 0!==s?s:1006,this.generateMipmaps=!1;const b=this;"requestVideoFrameCallback"in h&&h.requestVideoFrameCallback(function S(){b.needsUpdate=!0,h.requestVideoFrameCallback(S)})}clone(){return new this.constructor(this.image).copy(this)}update(){const h=this.image;!("requestVideoFrameCallback"in h)&&h.readyState>=h.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class extends Dt{constructor(h,e,t){super({width:h,height:e}),this.format=t,this.magFilter=1003,this.minFilter=1003,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0;class Pa extends Dt{constructor(e,t,n,s,l,u,f,v,b,S,C,I){super(null,u,f,v,b,S,s,l,C,I),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}Pa.prototype.isCompressedTexture=!0,class extends Dt{constructor(h,e,t,n,s,l,u,f,v){super(h,e,t,n,s,l,u,f,v),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0,new me,new me,new me,new Ln;class mr{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,s=this.getPoint(0),l=0;t.push(0);for(let u=1;u<=e;u++)n=this.getPoint(u/e),l+=n.distanceTo(s),t.push(l),s=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let s=0;const l=n.length;let u;u=t||e*n[l-1];let f,v=0,b=l-1;for(;v<=b;)if(s=Math.floor(v+(b-v)/2),f=n[s]-u,f<0)v=s+1;else{if(!(f>0)){b=s;break}b=s-1}if(s=b,n[s]===u)return s/(l-1);const S=n[s];return(s+(u-S)/(n[s+1]-S))/(l-1)}getTangent(e,t){let s=e-1e-4,l=e+1e-4;s<0&&(s=0),l>1&&(l=1);const u=this.getPoint(s),f=this.getPoint(l),v=t||(u.isVector2?new Mt:new me);return v.copy(f).sub(u).normalize(),v}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new me,s=[],l=[],u=[],f=new me,v=new ii;for(let D=0;D<=e;D++)s[D]=this.getTangentAt(D/e,new me);l[0]=new me,u[0]=new me;let b=Number.MAX_VALUE;const S=Math.abs(s[0].x),C=Math.abs(s[0].y),I=Math.abs(s[0].z);S<=b&&(b=S,n.set(1,0,0)),C<=b&&(b=C,n.set(0,1,0)),I<=b&&n.set(0,0,1),f.crossVectors(s[0],n).normalize(),l[0].crossVectors(s[0],f),u[0].crossVectors(s[0],l[0]);for(let D=1;D<=e;D++){if(l[D]=l[D-1].clone(),u[D]=u[D-1].clone(),f.crossVectors(s[D-1],s[D]),f.length()>Number.EPSILON){f.normalize();const O=Math.acos(ar(s[D-1].dot(s[D]),-1,1));l[D].applyMatrix4(v.makeRotationAxis(f,O))}u[D].crossVectors(s[D],l[D])}if(!0===t){let D=Math.acos(ar(l[0].dot(l[e]),-1,1));D/=e,s[0].dot(f.crossVectors(l[0],l[e]))>0&&(D=-D);for(let O=1;O<=e;O++)l[O].applyMatrix4(v.makeRotationAxis(s[O],D*O)),u[O].crossVectors(s[O],l[O])}return{tangents:s,normals:l,binormals:u}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ia extends mr{constructor(e=0,t=0,n=1,s=1,l=0,u=2*Math.PI,f=!1,v=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=s,this.aStartAngle=l,this.aEndAngle=u,this.aClockwise=f,this.aRotation=v}getPoint(e,t){const n=t||new Mt,s=2*Math.PI;let l=this.aEndAngle-this.aStartAngle;const u=Math.abs(l)<Number.EPSILON;for(;l<0;)l+=s;for(;l>s;)l-=s;l<Number.EPSILON&&(l=u?0:s),!0!==this.aClockwise||u||(l===s?l=-s:l-=s);const f=this.aStartAngle+e*l;let v=this.aX+this.xRadius*Math.cos(f),b=this.aY+this.yRadius*Math.sin(f);if(0!==this.aRotation){const S=Math.cos(this.aRotation),C=Math.sin(this.aRotation),I=v-this.aX,D=b-this.aY;v=I*S-D*C+this.aX,b=I*C+D*S+this.aY}return n.set(v,b)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Ia.prototype.isEllipseCurve=!0;class Fg extends Ia{constructor(e,t,n,s,l,u){super(e,t,n,n,s,l,u),this.type="ArcCurve"}}function $m(){let h=0,e=0,t=0,n=0;function s(l,u,f,v){h=l,e=f,t=-3*l+3*u-2*f-v,n=2*l-2*u+f+v}return{initCatmullRom:function(l,u,f,v,b){s(u,f,b*(f-l),b*(v-u))},initNonuniformCatmullRom:function(l,u,f,v,b,S,C){let I=(u-l)/b-(f-l)/(b+S)+(f-u)/S,D=(f-u)/S-(v-u)/(S+C)+(v-f)/C;I*=S,D*=S,s(u,f,I,D)},calc:function(l){const u=l*l;return h+e*l+t*u+n*(u*l)}}}Fg.prototype.isArcCurve=!0;const Up=new me,Xm=new $m,Np=new $m,lu=new $m;class Eo extends mr{constructor(e=[],t=!1,n="centripetal",s=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=s}getPoint(e,t=new me){const n=t,s=this.points,l=s.length,u=(l-(this.closed?0:1))*e;let f,v,b=Math.floor(u),S=u-b;this.closed?b+=b>0?0:(Math.floor(Math.abs(b)/l)+1)*l:0===S&&b===l-1&&(b=l-2,S=1),this.closed||b>0?f=s[(b-1)%l]:(Up.subVectors(s[0],s[1]).add(s[0]),f=Up);const C=s[b%l],I=s[(b+1)%l];if(this.closed||b+2<l?v=s[(b+2)%l]:(Up.subVectors(s[l-1],s[l-2]).add(s[l-1]),v=Up),"centripetal"===this.curveType||"chordal"===this.curveType){const D="chordal"===this.curveType?.5:.25;let O=Math.pow(f.distanceToSquared(C),D),N=Math.pow(C.distanceToSquared(I),D),j=Math.pow(I.distanceToSquared(v),D);N<1e-4&&(N=1),O<1e-4&&(O=N),j<1e-4&&(j=N),Xm.initNonuniformCatmullRom(f.x,C.x,I.x,v.x,O,N,j),Np.initNonuniformCatmullRom(f.y,C.y,I.y,v.y,O,N,j),lu.initNonuniformCatmullRom(f.z,C.z,I.z,v.z,O,N,j)}else"catmullrom"===this.curveType&&(Xm.initCatmullRom(f.x,C.x,I.x,v.x,this.tension),Np.initCatmullRom(f.y,C.y,I.y,v.y,this.tension),lu.initCatmullRom(f.z,C.z,I.z,v.z,this.tension));return n.set(Xm.calc(S),Np.calc(S),lu.calc(S)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push((new me).fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Ug(h,e,t,n,s){const l=.5*(n-e),u=.5*(s-t),f=h*h;return(2*t-2*n+l+u)*(h*f)+(-3*t+3*n-2*l-u)*f+l*h+t}function Md(h,e,t,n){return function(s,l){const u=1-s;return u*u*l}(h,e)+2*(1-(s=h))*s*t+function(s,l){return s*s*l}(h,n);var s}function yn(h,e,t,n,s){return function(l,u){const f=1-l;return f*f*f*u}(h,e)+function(l,u){const f=1-l;return 3*f*f*l*u}(h,t)+3*(1-(l=h))*l*l*n+function(l,u){return l*l*l*u}(h,s);var l}Eo.prototype.isCatmullRomCurve3=!0;class hi extends mr{constructor(e=new Mt,t=new Mt,n=new Mt,s=new Mt){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new Mt){const n=t,s=this.v0,l=this.v1,u=this.v2,f=this.v3;return n.set(yn(e,s.x,l.x,u.x,f.x),yn(e,s.y,l.y,u.y,f.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}hi.prototype.isCubicBezierCurve=!0;class _l extends mr{constructor(e=new me,t=new me,n=new me,s=new me){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new me){const n=t,s=this.v0,l=this.v1,u=this.v2,f=this.v3;return n.set(yn(e,s.x,l.x,u.x,f.x),yn(e,s.y,l.y,u.y,f.y),yn(e,s.z,l.z,u.z,f.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}_l.prototype.isCubicBezierCurve3=!0;class cu extends mr{constructor(e=new Mt,t=new Mt){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Mt){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Mt;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}cu.prototype.isLineCurve=!0;class Wi extends mr{constructor(e=new Mt,t=new Mt,n=new Mt){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Mt){const n=t,s=this.v0,l=this.v1,u=this.v2;return n.set(Md(e,s.x,l.x,u.x),Md(e,s.y,l.y,u.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Wi.prototype.isQuadraticBezierCurve=!0;class Ym extends mr{constructor(e=new me,t=new me,n=new me){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new me){const n=t,s=this.v0,l=this.v1,u=this.v2;return n.set(Md(e,s.x,l.x,u.x),Md(e,s.y,l.y,u.y),Md(e,s.z,l.z,u.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Ym.prototype.isQuadraticBezierCurve3=!0;class Sd extends mr{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Mt){const n=t,s=this.points,l=(s.length-1)*e,u=Math.floor(l),f=l-u,v=s[0===u?u:u-1],b=s[u],S=s[u>s.length-2?s.length-1:u+1],C=s[u>s.length-3?s.length-1:u+2];return n.set(Ug(f,v.x,b.x,S.x,C.x),Ug(f,v.y,b.y,S.y,C.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++)this.points.push(e.points[t].clone());return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push((new Mt).fromArray(s))}return this}}Sd.prototype.isSplineCurve=!0;var hu=Object.freeze({__proto__:null,ArcCurve:Fg,CatmullRomCurve3:Eo,CubicBezierCurve:hi,CubicBezierCurve3:_l,EllipseCurve:Ia,LineCurve:cu,LineCurve3:class extends mr{constructor(h=new me,e=new me){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=h,this.v2=e}getPoint(h,e=new me){const t=e;return 1===h?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(h).add(this.v1)),t}getPointAt(h,e){return this.getPoint(h,e)}copy(h){return super.copy(h),this.v1.copy(h.v1),this.v2.copy(h.v2),this}toJSON(){const h=super.toJSON();return h.v1=this.v1.toArray(),h.v2=this.v2.toArray(),h}fromJSON(h){return super.fromJSON(h),this.v1.fromArray(h.v1),this.v2.fromArray(h.v2),this}},QuadraticBezierCurve:Wi,QuadraticBezierCurve3:Ym,SplineCurve:Sd});class uu extends mr{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new cu(t,e))}getPoint(e,t){const n=e*this.getLength(),s=this.getCurveLengths();let l=0;for(;l<s.length;){if(s[l]>=n){const u=s[l]-n,f=this.curves[l],v=f.getLength();return f.getPointAt(0===v?0:1-u/v,t)}l++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,s=this.curves.length;n<s;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let s=0,l=this.curves;s<l.length;s++){const u=l[s],v=u.getPoints(u.isEllipseCurve?2*e:u.isLineCurve||u.isLineCurve3?1:u.isSplineCurve?e*u.points.length:e);for(let b=0;b<v.length;b++){const S=v[b];n&&n.equals(S)||(t.push(S),n=S)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push((new hu[s.type]).fromJSON(s))}return this}}class nc extends uu{constructor(e){super(),this.type="Path",this.currentPoint=new Mt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new cu(this.currentPoint.clone(),new Mt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,s){const l=new Wi(this.currentPoint.clone(),new Mt(e,t),new Mt(n,s));return this.curves.push(l),this.currentPoint.set(n,s),this}bezierCurveTo(e,t,n,s,l,u){const f=new hi(this.currentPoint.clone(),new Mt(e,t),new Mt(n,s),new Mt(l,u));return this.curves.push(f),this.currentPoint.set(l,u),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Sd(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,s,l,u){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,n,s,l,u),this}absarc(e,t,n,s,l,u){return this.absellipse(e,t,n,n,s,l,u),this}ellipse(e,t,n,s,l,u,f,v){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,n,s,l,u,f,v),this}absellipse(e,t,n,s,l,u,f,v){const b=new Ia(e,t,n,s,l,u,f,v);if(this.curves.length>0){const C=b.getPoint(0);C.equals(this.currentPoint)||this.lineTo(C.x,C.y)}this.curves.push(b);const S=b.getPoint(1);return this.currentPoint.copy(S),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class ts extends nc{constructor(e){super(e),this.uuid=or(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,s=this.holes.length;n<s;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push((new nc).fromJSON(s))}return this}}function Jm(h,e,t,n,s){let l,u;if(s===function(f,v,b,S){let C=0;for(let I=v,D=b-S;I<b;I+=S)C+=(f[D]-f[I])*(f[I+1]+f[D+1]),D=I;return C}(h,e,t,n)>0)for(l=e;l<t;l+=n)u=tf(l,h[l],h[l+1],u);else for(l=t-n;l>=e;l-=n)u=tf(l,h[l],h[l+1],u);return u&&Td(u,u.next)&&(Da(u),u=u.next),u}function Or(h,e){if(!h)return h;e||(e=h);let t,n=h;do{if(t=!1,n.steiner||!Td(n,n.next)&&0!==Hn(n.prev,n,n.next))n=n.next;else{if(Da(n),n=e=n.prev,n===n.next)break;t=!0}}while(t||n!==e);return e}function rc(h,e,t,n,s,l,u){if(!h)return;!u&&l&&function(S,C,I,D){let O=S;do{null===O.z&&(O.z=du(O.x,O.y,C,I,D)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next}while(O!==S);O.prevZ.nextZ=null,O.prevZ=null,function(N){let j,U,Q,Y,Z,te,oe,de,Ce=1;do{for(U=N,N=null,Z=null,te=0;U;){for(te++,Q=U,oe=0,j=0;j<Ce&&(oe++,Q=Q.nextZ,Q);j++);for(de=Ce;oe>0||de>0&&Q;)0!==oe&&(0===de||!Q||U.z<=Q.z)?(Y=U,U=U.nextZ,oe--):(Y=Q,Q=Q.nextZ,de--),Z?Z.nextZ=Y:N=Y,Y.prevZ=Z,Z=Y;U=Q}Z.nextZ=null,Ce*=2}while(te>1)}(O)}(h,n,s,l);let f,v,b=h;for(;h.prev!==h.next;)if(f=h.prev,v=h.next,l?sy(h,n,s,l):Km(h))e.push(f.i/t),e.push(h.i/t),e.push(v.i/t),Da(h),h=v.next,b=v.next;else if((h=v)===b){u?1===u?rc(h=Qm(Or(h),e,t),e,t,n,s,l,2):2===u&&Ng(h,e,t,n,s,l):rc(Or(h),e,t,n,s,l,1);break}}function Km(h){const e=h.prev,t=h,n=h.next;if(Hn(e,t,n)>=0)return!1;let s=h.next.next;for(;s!==h.prev;){if(sc(e.x,e.y,t.x,t.y,n.x,n.y,s.x,s.y)&&Hn(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function sy(h,e,t,n){const s=h.prev,l=h,u=h.next;if(Hn(s,l,u)>=0)return!1;const b=s.x>l.x?s.x>u.x?s.x:u.x:l.x>u.x?l.x:u.x,S=s.y>l.y?s.y>u.y?s.y:u.y:l.y>u.y?l.y:u.y,C=du(s.x<l.x?s.x<u.x?s.x:u.x:l.x<u.x?l.x:u.x,s.y<l.y?s.y<u.y?s.y:u.y:l.y<u.y?l.y:u.y,e,t,n),I=du(b,S,e,t,n);let D=h.prevZ,O=h.nextZ;for(;D&&D.z>=C&&O&&O.z<=I;){if(D!==h.prev&&D!==h.next&&sc(s.x,s.y,l.x,l.y,u.x,u.y,D.x,D.y)&&Hn(D.prev,D,D.next)>=0||(D=D.prevZ,O!==h.prev&&O!==h.next&&sc(s.x,s.y,l.x,l.y,u.x,u.y,O.x,O.y)&&Hn(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;D&&D.z>=C;){if(D!==h.prev&&D!==h.next&&sc(s.x,s.y,l.x,l.y,u.x,u.y,D.x,D.y)&&Hn(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;O&&O.z<=I;){if(O!==h.prev&&O!==h.next&&sc(s.x,s.y,l.x,l.y,u.x,u.y,O.x,O.y)&&Hn(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function Qm(h,e,t){let n=h;do{const s=n.prev,l=n.next.next;!Td(s,l)&&Gg(s,n,n.next,l)&&th(s,l)&&th(l,s)&&(e.push(s.i/t),e.push(n.i/t),e.push(l.i/t),Da(n),Da(n.next),n=h=l),n=n.next}while(n!==h);return Or(n)}function Ng(h,e,t,n,s,l){let u=h;do{let f=u.next.next;for(;f!==u.prev;){if(u.i!==f.i&&Vg(u,f)){let v=ef(u,f);return u=Or(u,u.next),v=Or(v,v.next),rc(u,e,t,n,s,l),void rc(v,e,t,n,s,l)}f=f.next}u=u.next}while(u!==h)}function oy(h,e){return h.x-e.x}function yl(h,e){if(e=function(t,n){let s=n;const l=t.x,u=t.y;let f,v=-1/0;do{if(u<=s.y&&u>=s.next.y&&s.next.y!==s.y){const O=s.x+(u-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(O<=l&&O>v){if(v=O,O===l){if(u===s.y)return s;if(u===s.next.y)return s.next}f=s.x<s.next.x?s:s.next}}s=s.next}while(s!==n);if(!f)return null;if(l===v)return f;const b=f,S=f.x,C=f.y;let I,D=1/0;s=f;do{l>=s.x&&s.x>=S&&l!==s.x&&sc(u<C?l:v,u,S,C,u<C?v:l,u,s.x,s.y)&&(I=Math.abs(u-s.y)/(l-s.x),th(s,t)&&(I<D||I===D&&(s.x>f.x||s.x===f.x&&eh(f,s)))&&(f=s,D=I)),s=s.next}while(s!==b);return f}(h,e)){const t=ef(e,h);Or(e,e.next),Or(t,t.next)}}function eh(h,e){return Hn(h.prev,h,e.prev)<0&&Hn(e.next,h,h.next)<0}function du(h,e,t,n,s){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=32767*(h-t)*s)|h<<8))|h<<4))|h<<2))|h<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Vp(h){let e=h,t=h;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==h);return t}function sc(h,e,t,n,s,l,u,f){return(s-u)*(e-f)-(h-u)*(l-f)>=0&&(h-u)*(n-f)-(t-u)*(e-f)>=0&&(t-u)*(l-f)-(s-u)*(n-f)>=0}function Vg(h,e){return h.next.i!==e.i&&h.prev.i!==e.i&&!function(t,n){let s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==n.i&&s.next.i!==n.i&&Gg(s,s.next,t,n))return!0;s=s.next}while(s!==t);return!1}(h,e)&&(th(h,e)&&th(e,h)&&function(t,n){let s=t,l=!1;const u=(t.x+n.x)/2,f=(t.y+n.y)/2;do{s.y>f!=s.next.y>f&&s.next.y!==s.y&&u<(s.next.x-s.x)*(f-s.y)/(s.next.y-s.y)+s.x&&(l=!l),s=s.next}while(s!==t);return l}(h,e)&&(Hn(h.prev,h,e.prev)||Hn(h,e.prev,e))||Td(h,e)&&Hn(h.prev,h,h.next)>0&&Hn(e.prev,e,e.next)>0)}function Hn(h,e,t){return(e.y-h.y)*(t.x-e.x)-(e.x-h.x)*(t.y-e.y)}function Td(h,e){return h.x===e.x&&h.y===e.y}function Gg(h,e,t,n){const s=Gp(Hn(h,e,t)),l=Gp(Hn(h,e,n)),u=Gp(Hn(t,n,h)),f=Gp(Hn(t,n,e));return s!==l&&u!==f||!(0!==s||!pu(h,t,e))||!(0!==l||!pu(h,n,e))||!(0!==u||!pu(t,h,n))||!(0!==f||!pu(t,e,n))}function pu(h,e,t){return e.x<=Math.max(h.x,t.x)&&e.x>=Math.min(h.x,t.x)&&e.y<=Math.max(h.y,t.y)&&e.y>=Math.min(h.y,t.y)}function Gp(h){return h>0?1:h<0?-1:0}function th(h,e){return Hn(h.prev,h,h.next)<0?Hn(h,e,h.next)>=0&&Hn(h,h.prev,e)>=0:Hn(h,e,h.prev)<0||Hn(h,h.next,e)<0}function ef(h,e){const t=new Hp(h.i,h.x,h.y),n=new Hp(e.i,e.x,e.y),s=h.next,l=e.prev;return h.next=e,e.prev=h,t.next=s,s.prev=t,n.next=t,t.prev=n,l.next=n,n.prev=l,n}function tf(h,e,t,n){const s=new Hp(h,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Da(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function Hp(h,e,t){this.i=h,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class oc{static area(e){const t=e.length;let n=0;for(let s=t-1,l=0;l<t;s=l++)n+=e[s].x*e[l].y-e[l].x*e[s].y;return.5*n}static isClockWise(e){return oc.area(e)<0}static triangulateShape(e,t){const n=[],s=[],l=[];ih(e),Ed(n,e);let u=e.length;t.forEach(ih);for(let v=0;v<t.length;v++)s.push(u),u+=t[v].length,Ed(n,t[v]);const f=function(h,e,t=2){const n=e&&e.length,s=n?e[0]*t:h.length;let l=Jm(h,0,s,t,!0);const u=[];if(!l||l.next===l.prev)return u;let f,v,b,S,C,I,D;if(n&&(l=function(O,N,j,U){const Q=[];let Y,Z,te,oe,de;for(Y=0,Z=N.length;Y<Z;Y++)te=N[Y]*U,oe=Y<Z-1?N[Y+1]*U:O.length,de=Jm(O,te,oe,U,!1),de===de.next&&(de.steiner=!0),Q.push(Vp(de));for(Q.sort(oy),Y=0;Y<Q.length;Y++)yl(Q[Y],j),j=Or(j,j.next);return j}(h,e,l,t)),h.length>80*t){f=b=h[0],v=S=h[1];for(let O=t;O<s;O+=t)C=h[O],I=h[O+1],C<f&&(f=C),I<v&&(v=I),C>b&&(b=C),I>S&&(S=I);D=Math.max(b-f,S-v),D=0!==D?1/D:0}return rc(l,u,t,f,v,D),u}(n,s);for(let v=0;v<f.length;v+=3)l.push(f.slice(v,v+3));return l}}function ih(h){const e=h.length;e>2&&h[e-1].equals(h[0])&&h.pop()}function Ed(h,e){for(let t=0;t<e.length;t++)h.push(e[t].x),h.push(e[t].y)}class nh extends an{constructor(e=new ts([new Mt(.5,.5),new Mt(-.5,.5),new Mt(-.5,-.5),new Mt(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,s=[],l=[];for(let f=0,v=e.length;f<v;f++)u(e[f]);function u(f){const v=[],b=void 0!==t.curveSegments?t.curveSegments:12,S=void 0!==t.steps?t.steps:1;let C=void 0!==t.depth?t.depth:1,I=void 0===t.bevelEnabled||t.bevelEnabled,D=void 0!==t.bevelThickness?t.bevelThickness:.2,O=void 0!==t.bevelSize?t.bevelSize:D-.1,N=void 0!==t.bevelOffset?t.bevelOffset:0,j=void 0!==t.bevelSegments?t.bevelSegments:3;const U=t.extrudePath,Q=void 0!==t.UVGenerator?t.UVGenerator:Hg;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),C=t.amount);let Y,Z,te,oe,de,Ce=!1;U&&(Y=U.getSpacedPoints(S),Ce=!0,I=!1,Z=U.computeFrenetFrames(S,!1),te=new me,oe=new me,de=new me),I||(j=0,D=0,O=0,N=0);const Le=f.extractPoints(b);let Oe=Le.shape;const Ze=Le.holes;if(!oc.isClockWise(Oe)){Oe=Oe.reverse();for(let Pe=0,Ge=Ze.length;Pe<Ge;Pe++){const he=Ze[Pe];oc.isClockWise(he)&&(Ze[Pe]=he.reverse())}}const et=oc.triangulateShape(Oe,Ze),ot=Oe;for(let Pe=0,Ge=Ze.length;Pe<Ge;Pe++)Oe=Oe.concat(Ze[Pe]);function Ve(Pe,Ge,he){return Ge||console.error("THREE.ExtrudeGeometry: vec does not exist"),Ge.clone().multiplyScalar(he).add(Pe)}const at=Oe.length,it=et.length;function wt(Pe,Ge,he){let ze,Ke,Et;const nt=Pe.x-Ge.x,Ft=Pe.y-Ge.y,jt=he.x-Pe.x,ri=he.y-Pe.y,Ri=nt*nt+Ft*Ft;if(Math.abs(nt*ri-Ft*jt)>Number.EPSILON){const Ti=Math.sqrt(Ri),_i=Math.sqrt(jt*jt+ri*ri),Bn=Ge.x-Ft/Ti,Ah=Ge.y+nt/Ti,Ci=((he.x-ri/_i-Bn)*ri-(he.y+jt/_i-Ah)*jt)/(nt*ri-Ft*jt);ze=Bn+nt*Ci-Pe.x,Ke=Ah+Ft*Ci-Pe.y;const Yn=ze*ze+Ke*Ke;if(Yn<=2)return new Mt(ze,Ke);Et=Math.sqrt(Yn/2)}else{let Ti=!1;nt>Number.EPSILON?jt>Number.EPSILON&&(Ti=!0):nt<-Number.EPSILON?jt<-Number.EPSILON&&(Ti=!0):Math.sign(Ft)===Math.sign(ri)&&(Ti=!0),Ti?(ze=-Ft,Ke=nt,Et=Math.sqrt(Ri)):(ze=nt,Ke=Ft,Et=Math.sqrt(Ri/2))}return new Mt(ze/Et,Ke/Et)}const pt=[];for(let Pe=0,Ge=ot.length,he=Ge-1,ze=Pe+1;Pe<Ge;Pe++,he++,ze++)he===Ge&&(he=0),ze===Ge&&(ze=0),pt[Pe]=wt(ot[Pe],ot[he],ot[ze]);const Ct=[];let dt,ei=pt.concat();for(let Pe=0,Ge=Ze.length;Pe<Ge;Pe++){const he=Ze[Pe];dt=[];for(let ze=0,Ke=he.length,Et=Ke-1,nt=ze+1;ze<Ke;ze++,Et++,nt++)Et===Ke&&(Et=0),nt===Ke&&(nt=0),dt[ze]=wt(he[ze],he[Et],he[nt]);Ct.push(dt),ei=ei.concat(dt)}for(let Pe=0;Pe<j;Pe++){const Ge=Pe/j,he=D*Math.cos(Ge*Math.PI/2),ze=O*Math.sin(Ge*Math.PI/2)+N;for(let Ke=0,Et=ot.length;Ke<Et;Ke++){const nt=Ve(ot[Ke],pt[Ke],ze);ni(nt.x,nt.y,-he)}for(let Ke=0,Et=Ze.length;Ke<Et;Ke++){const nt=Ze[Ke];dt=Ct[Ke];for(let Ft=0,jt=nt.length;Ft<jt;Ft++){const ri=Ve(nt[Ft],dt[Ft],ze);ni(ri.x,ri.y,-he)}}}const Zt=O+N;for(let Pe=0;Pe<at;Pe++){const Ge=I?Ve(Oe[Pe],ei[Pe],Zt):Oe[Pe];Ce?(oe.copy(Z.normals[0]).multiplyScalar(Ge.x),te.copy(Z.binormals[0]).multiplyScalar(Ge.y),de.copy(Y[0]).add(oe).add(te),ni(de.x,de.y,de.z)):ni(Ge.x,Ge.y,0)}for(let Pe=1;Pe<=S;Pe++)for(let Ge=0;Ge<at;Ge++){const he=I?Ve(Oe[Ge],ei[Ge],Zt):Oe[Ge];Ce?(oe.copy(Z.normals[Pe]).multiplyScalar(he.x),te.copy(Z.binormals[Pe]).multiplyScalar(he.y),de.copy(Y[Pe]).add(oe).add(te),ni(de.x,de.y,de.z)):ni(he.x,he.y,C/S*Pe)}for(let Pe=j-1;Pe>=0;Pe--){const Ge=Pe/j,he=D*Math.cos(Ge*Math.PI/2),ze=O*Math.sin(Ge*Math.PI/2)+N;for(let Ke=0,Et=ot.length;Ke<Et;Ke++){const nt=Ve(ot[Ke],pt[Ke],ze);ni(nt.x,nt.y,C+he)}for(let Ke=0,Et=Ze.length;Ke<Et;Ke++){const nt=Ze[Ke];dt=Ct[Ke];for(let Ft=0,jt=nt.length;Ft<jt;Ft++){const ri=Ve(nt[Ft],dt[Ft],ze);Ce?ni(ri.x,ri.y+Y[S-1].y,Y[S-1].x+he):ni(ri.x,ri.y,C+he)}}}function Xt(Pe,Ge){let he=Pe.length;for(;--he>=0;){const ze=he;let Ke=he-1;Ke<0&&(Ke=Pe.length-1);for(let Et=0,nt=S+2*j;Et<nt;Et++){const Ft=at*Et,jt=at*(Et+1);ve(Ge+ze+Ft,Ge+Ke+Ft,Ge+Ke+jt,Ge+ze+jt)}}}function ni(Pe,Ge,he){v.push(Pe),v.push(Ge),v.push(he)}function Te(Pe,Ge,he){tt(Pe),tt(Ge),tt(he);const ze=s.length/3,Ke=Q.generateTopUV(n,s,ze-3,ze-2,ze-1);st(Ke[0]),st(Ke[1]),st(Ke[2])}function ve(Pe,Ge,he,ze){tt(Pe),tt(Ge),tt(ze),tt(Ge),tt(he),tt(ze);const Ke=s.length/3,Et=Q.generateSideWallUV(n,s,Ke-6,Ke-3,Ke-2,Ke-1);st(Et[0]),st(Et[1]),st(Et[3]),st(Et[1]),st(Et[2]),st(Et[3])}function tt(Pe){s.push(v[3*Pe+0]),s.push(v[3*Pe+1]),s.push(v[3*Pe+2])}function st(Pe){l.push(Pe.x),l.push(Pe.y)}(function(){const Pe=s.length/3;if(I){let Ge=0,he=at*Ge;for(let ze=0;ze<it;ze++){const Ke=et[ze];Te(Ke[2]+he,Ke[1]+he,Ke[0]+he)}Ge=S+2*j,he=at*Ge;for(let ze=0;ze<it;ze++){const Ke=et[ze];Te(Ke[0]+he,Ke[1]+he,Ke[2]+he)}}else{for(let Ge=0;Ge<it;Ge++){const he=et[Ge];Te(he[2],he[1],he[0])}for(let Ge=0;Ge<it;Ge++){const he=et[Ge];Te(he[0]+at*S,he[1]+at*S,he[2]+at*S)}}n.addGroup(Pe,s.length/3-Pe,0)})(),function(){const Pe=s.length/3;let Ge=0;Xt(ot,Ge),Ge+=ot.length;for(let he=0,ze=Ze.length;he<ze;he++){const Ke=Ze[he];Xt(Ke,Ge),Ge+=Ke.length}n.addGroup(Pe,s.length/3-Pe,1)}()}this.setAttribute("position",new vn(s,3)),this.setAttribute("uv",new vn(l,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(t,n,s){if(s.shapes=[],Array.isArray(t))for(let l=0,u=t.length;l<u;l++)s.shapes.push(t[l].uuid);else s.shapes.push(t.uuid);return void 0!==n.extrudePath&&(s.options.extrudePath=n.extrudePath.toJSON()),s}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let l=0,u=e.shapes.length;l<u;l++)n.push(t[e.shapes[l]]);const s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new hu[s.type]).fromJSON(s)),new nh(n,e.options)}}const Hg={generateTopUV:function(h,e,t,n,s){const f=e[3*n],v=e[3*n+1],b=e[3*s],S=e[3*s+1];return[new Mt(e[3*t],e[3*t+1]),new Mt(f,v),new Mt(b,S)]},generateSideWallUV:function(h,e,t,n,s,l){const u=e[3*t],f=e[3*t+1],v=e[3*t+2],b=e[3*n],S=e[3*n+1],C=e[3*n+2],I=e[3*s],D=e[3*s+1],O=e[3*s+2],N=e[3*l],j=e[3*l+1],U=e[3*l+2];return Math.abs(f-S)<Math.abs(u-b)?[new Mt(u,1-v),new Mt(b,1-C),new Mt(I,1-O),new Mt(N,1-U)]:[new Mt(f,1-v),new Mt(S,1-C),new Mt(D,1-O),new Mt(j,1-U)]}};class nf extends an{constructor(e=new ts([new Mt(0,.5),new Mt(-.5,-.5),new Mt(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],s=[],l=[],u=[];let f=0,v=0;if(!1===Array.isArray(e))b(e);else for(let S=0;S<e.length;S++)b(e[S]),this.addGroup(f,v,S),f+=v,v=0;function b(S){const C=s.length/3,I=S.extractPoints(t);let D=I.shape;const O=I.holes;!1===oc.isClockWise(D)&&(D=D.reverse());for(let j=0,U=O.length;j<U;j++){const Q=O[j];!0===oc.isClockWise(Q)&&(O[j]=Q.reverse())}const N=oc.triangulateShape(D,O);for(let j=0,U=O.length;j<U;j++)D=D.concat(O[j]);for(let j=0,U=D.length;j<U;j++){const Q=D[j];s.push(Q.x,Q.y,0),l.push(0,0,1),u.push(Q.x,Q.y)}for(let j=0,U=N.length;j<U;j++){const Q=N[j];n.push(Q[0]+C,Q[1]+C,Q[2]+C),v+=3}}this.setIndex(n),this.setAttribute("position",new vn(s,3)),this.setAttribute("normal",new vn(l,3)),this.setAttribute("uv",new vn(u,2))}toJSON(){const e=super.toJSON();return function(t,n){if(n.shapes=[],Array.isArray(t))for(let s=0,l=t.length;s<l;s++)n.shapes.push(t[s].uuid);else n.shapes.push(t.uuid);return n}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let s=0,l=e.shapes.length;s<l;s++)n.push(t[e.shapes[s]]);return new nf(n,e.curveSegments)}}class jg extends Mn{constructor(e){super(),this.type="ShadowMaterial",this.color=new we(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}jg.prototype.isShadowMaterial=!0;class jp extends xr{constructor(e){super(e),this.type="RawShaderMaterial"}}jp.prototype.isRawShaderMaterial=!0;class jn extends Mn{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new we(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new we(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}jn.prototype.isMeshStandardMaterial=!0;class vl extends jn{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Mt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ar(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new we(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new we(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new we(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}vl.prototype.isMeshPhysicalMaterial=!0;class na extends Mn{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new we(16777215),this.specular=new we(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new we(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}na.prototype.isMeshPhongMaterial=!0;class Wp extends Mn{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new we(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new we(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Wp.prototype.isMeshToonMaterial=!0;class ac extends Mn{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}ac.prototype.isMeshNormalMaterial=!0;class xl extends Mn{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new we(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new we(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}xl.prototype.isMeshLambertMaterial=!0;class Zp extends Mn{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new we(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}Zp.prototype.isMeshMatcapMaterial=!0;class qp extends es{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}qp.prototype.isLineDashedMaterial=!0;const ay={ShadowMaterial:jg,SpriteMaterial:$t,RawShaderMaterial:jp,ShaderMaterial:xr,PointsMaterial:Fp,MeshPhysicalMaterial:vl,MeshStandardMaterial:jn,MeshPhongMaterial:na,MeshToonMaterial:Wp,MeshNormalMaterial:ac,MeshLambertMaterial:xl,MeshDepthMaterial:J,MeshDistanceMaterial:ge,MeshBasicMaterial:Pr,MeshMatcapMaterial:Zp,LineDashedMaterial:qp,LineBasicMaterial:es,Material:Mn};Mn.fromType=function(h){return new ay[h]};const Sn={arraySlice:function(h,e,t){return Sn.isTypedArray(h)?new h.constructor(h.subarray(e,void 0!==t?t:h.length)):h.slice(e,t)},convertArray:function(h,e,t){return!h||!t&&h.constructor===e?h:"number"==typeof e.BYTES_PER_ELEMENT?new e(h):Array.prototype.slice.call(h)},isTypedArray:function(h){return ArrayBuffer.isView(h)&&!(h instanceof DataView)},getKeyframeOrder:function(h){const e=h.length,t=new Array(e);for(let n=0;n!==e;++n)t[n]=n;return t.sort(function(n,s){return h[n]-h[s]}),t},sortedArray:function(h,e,t){const n=h.length,s=new h.constructor(n);for(let l=0,u=0;u!==n;++l){const f=t[l]*e;for(let v=0;v!==e;++v)s[u++]=h[f+v]}return s},flattenJSON:function(h,e,t,n){let s=1,l=h[0];for(;void 0!==l&&void 0===l[n];)l=h[s++];if(void 0===l)return;let u=l[n];if(void 0!==u)if(Array.isArray(u))do{u=l[n],void 0!==u&&(e.push(l.time),t.push.apply(t,u)),l=h[s++]}while(void 0!==l);else if(void 0!==u.toArray)do{u=l[n],void 0!==u&&(e.push(l.time),u.toArray(t,t.length)),l=h[s++]}while(void 0!==l);else do{u=l[n],void 0!==u&&(e.push(l.time),t.push(u)),l=h[s++]}while(void 0!==l)},subclip:function(h,e,t,n,s=30){const l=h.clone();l.name=e;const u=[];for(let v=0;v<l.tracks.length;++v){const b=l.tracks[v],S=b.getValueSize(),C=[],I=[];for(let D=0;D<b.times.length;++D){const O=b.times[D]*s;if(!(O<t||O>=n)){C.push(b.times[D]);for(let N=0;N<S;++N)I.push(b.values[D*S+N])}}0!==C.length&&(b.times=Sn.convertArray(C,b.times.constructor),b.values=Sn.convertArray(I,b.values.constructor),u.push(b))}l.tracks=u;let f=1/0;for(let v=0;v<l.tracks.length;++v)f>l.tracks[v].times[0]&&(f=l.tracks[v].times[0]);for(let v=0;v<l.tracks.length;++v)l.tracks[v].shift(-1*f);return l.resetDuration(),l},makeClipAdditive:function(h,e=0,t=h,n=30){n<=0&&(n=30);const s=t.tracks.length,l=e/n;for(let u=0;u<s;++u){const f=t.tracks[u],v=f.ValueTypeName;if("bool"===v||"string"===v)continue;const b=h.tracks.find(function(U){return U.name===f.name&&U.ValueTypeName===v});if(void 0===b)continue;let S=0;const C=f.getValueSize();f.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(S=C/3);let I=0;const D=b.getValueSize();b.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(I=D/3);const O=f.times.length-1;let N;if(l<=f.times[0])N=Sn.arraySlice(f.values,S,C-S);else if(l>=f.times[O]){const U=O*C+S;N=Sn.arraySlice(f.values,U,U+C-S)}else{const U=f.createInterpolant(),Q=S,Y=C-S;U.evaluate(l),N=Sn.arraySlice(U.resultBuffer,Q,Y)}"quaternion"===v&&(new ui).fromArray(N).normalize().conjugate().toArray(N);const j=b.times.length;for(let U=0;U<j;++U){const Q=U*D+I;if("quaternion"===v)ui.multiplyQuaternionsFlat(b.values,Q,N,0,b.values,Q);else{const Y=D-2*I;for(let Z=0;Z<Y;++Z)b.values[Q+Z]-=N[Z]}}}return h.blendMode=2501,h}};class La{constructor(e,t,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==s?s:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,s=t[n],l=t[n-1];e:{t:{let u;i:{n:if(!(e<s)){for(let f=n+2;;){if(void 0===s){if(e<l)break n;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,l)}if(n===f)break;if(l=s,s=t[++n],e<s)break t}u=t.length;break i}if(e>=l)break e;{const f=t[1];e<f&&(n=2,l=f);for(let v=n-2;;){if(void 0===l)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(n===v)break;if(s=l,l=t[--n-1],e>=l)break t}u=n,n=0}}for(;n<u;){const f=n+u>>>1;e<t[f]?u=f:n=f+1}if(s=t[n],l=t[n-1],void 0===l)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(void 0===s)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,l,e)}this._cachedIndex=n,this.intervalChanged_(n,l,s)}return this.interpolate_(n,l,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,l=e*s;for(let u=0;u!==s;++u)t[u]=n[l+u];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}La.prototype.beforeStart_=La.prototype.copySampleValue_,La.prototype.afterEnd_=La.prototype.copySampleValue_;class Wg extends La{constructor(e,t,n,s){super(e,t,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const s=this.parameterPositions;let l=e-2,u=e+1,f=s[l],v=s[u];if(void 0===f)switch(this.getSettings_().endingStart){case 2401:l=e,f=2*t-n;break;case 2402:l=s.length-2,f=t+s[l]-s[l+1];break;default:l=e,f=n}if(void 0===v)switch(this.getSettings_().endingEnd){case 2401:u=e,v=2*n-t;break;case 2402:u=1,v=n+s[1]-s[0];break;default:u=e-1,v=t}const b=.5*(n-t),S=this.valueSize;this._weightPrev=b/(t-f),this._weightNext=b/(v-n),this._offsetPrev=l*S,this._offsetNext=u*S}interpolate_(e,t,n,s){const l=this.resultBuffer,u=this.sampleValues,f=this.valueSize,v=e*f,b=v-f,S=this._offsetPrev,C=this._offsetNext,I=this._weightPrev,D=this._weightNext,O=(n-t)/(s-t),N=O*O,j=N*O,U=-I*j+2*I*N-I*O,Q=(1+I)*j+(-1.5-2*I)*N+(-.5+I)*O+1,Y=(-1-D)*j+(1.5+D)*N+.5*O,Z=D*j-D*N;for(let te=0;te!==f;++te)l[te]=U*u[S+te]+Q*u[b+te]+Y*u[v+te]+Z*u[C+te];return l}}class mu extends La{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const l=this.resultBuffer,u=this.sampleValues,f=this.valueSize,v=e*f,b=v-f,S=(n-t)/(s-t),C=1-S;for(let I=0;I!==f;++I)l[I]=u[b+I]*C+u[v+I]*S;return l}}class Zg extends La{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class ra{constructor(e,t,n,s){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Sn.convertArray(t,this.TimeBufferType),this.values=Sn.convertArray(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Sn.convertArray(e.times,Array),values:Sn.convertArray(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Zg(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new mu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Wg(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]*=e}return this}trim(e,t){const n=this.times,s=n.length;let l=0,u=s-1;for(;l!==s&&n[l]<e;)++l;for(;-1!==u&&n[u]>t;)--u;if(++u,0!==l||u!==s){l>=u&&(u=Math.max(u,1),l=u-1);const f=this.getValueSize();this.times=Sn.arraySlice(n,l,u),this.values=Sn.arraySlice(this.values,l*f,u*f)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,l=n.length;0===l&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let u=null;for(let f=0;f!==l;f++){const v=n[f];if("number"==typeof v&&isNaN(v)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,f,v),e=!1;break}if(null!==u&&u>v){console.error("THREE.KeyframeTrack: Out of order keys.",this,f,v,u),e=!1;break}u=v}if(void 0!==s&&Sn.isTypedArray(s))for(let f=0,v=s.length;f!==v;++f){const b=s[f];if(isNaN(b)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,f,b),e=!1;break}}return e}optimize(){const e=Sn.arraySlice(this.times),t=Sn.arraySlice(this.values),n=this.getValueSize(),s=2302===this.getInterpolation(),l=e.length-1;let u=1;for(let f=1;f<l;++f){let v=!1;const b=e[f];if(b!==e[f+1]&&(1!==f||b!==e[0]))if(s)v=!0;else{const S=f*n,C=S-n,I=S+n;for(let D=0;D!==n;++D){const O=t[S+D];if(O!==t[C+D]||O!==t[I+D]){v=!0;break}}}if(v){if(f!==u){e[u]=e[f];const S=f*n,C=u*n;for(let I=0;I!==n;++I)t[C+I]=t[S+I]}++u}}if(l>0){e[u]=e[l];for(let f=l*n,v=u*n,b=0;b!==n;++b)t[v+b]=t[f+b];++u}return u!==e.length?(this.times=Sn.arraySlice(e,0,u),this.values=Sn.arraySlice(t,0,u*n)):(this.times=e,this.values=t),this}clone(){const e=Sn.arraySlice(this.times,0),t=Sn.arraySlice(this.values,0),n=new this.constructor(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}ra.prototype.TimeBufferType=Float32Array,ra.prototype.ValueBufferType=Float32Array,ra.prototype.DefaultInterpolation=2301;class rh extends ra{}rh.prototype.ValueTypeName="bool",rh.prototype.ValueBufferType=Array,rh.prototype.DefaultInterpolation=2300,rh.prototype.InterpolantFactoryMethodLinear=void 0,rh.prototype.InterpolantFactoryMethodSmooth=void 0;class $p extends ra{}$p.prototype.ValueTypeName="color";class sh extends ra{}sh.prototype.ValueTypeName="number";class Cd extends La{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const l=this.resultBuffer,u=this.sampleValues,f=this.valueSize,v=(n-t)/(s-t);let b=e*f;for(let S=b+f;b!==S;b+=4)ui.slerpFlat(l,0,u,b-f,u,b,v);return l}}class bl extends ra{InterpolantFactoryMethodLinear(e){return new Cd(this.times,this.values,this.getValueSize(),e)}}bl.prototype.ValueTypeName="quaternion",bl.prototype.DefaultInterpolation=2301,bl.prototype.InterpolantFactoryMethodSmooth=void 0;class Ra extends ra{}Ra.prototype.ValueTypeName="string",Ra.prototype.ValueBufferType=Array,Ra.prototype.DefaultInterpolation=2300,Ra.prototype.InterpolantFactoryMethodLinear=void 0,Ra.prototype.InterpolantFactoryMethodSmooth=void 0;class wl extends ra{}wl.prototype.ValueTypeName="vector";class Xp{constructor(e,t=-1,n,s=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=s,this.uuid=or(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,s=1/(e.fps||1);for(let u=0,f=n.length;u!==f;++u)t.push(oh(n[u]).scale(s));const l=new this(e.name,e.duration,t,e.blendMode);return l.uuid=e.uuid,l}static toJSON(e){const t=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let l=0,u=n.length;l!==u;++l)t.push(ra.toJSON(n[l]));return s}static CreateFromMorphTargetSequence(e,t,n,s){const l=t.length,u=[];for(let f=0;f<l;f++){let v=[],b=[];v.push((f+l-1)%l,f,(f+1)%l),b.push(0,1,0);const S=Sn.getKeyframeOrder(v);v=Sn.sortedArray(v,1,S),b=Sn.sortedArray(b,1,S),s||0!==v[0]||(v.push(l),b.push(b[0])),u.push(new sh(".morphTargetInfluences["+t[f].name+"]",v,b).scale(1/n))}return new this(e,-1,u)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===t)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const s={},l=/^([\w-]*?)([\d]+)$/;for(let f=0,v=e.length;f<v;f++){const b=e[f],S=b.name.match(l);if(S&&S.length>1){const C=S[1];let I=s[C];I||(s[C]=I=[]),I.push(b)}}const u=[];for(const f in s)u.push(this.CreateFromMorphTargetSequence(f,s[f],t,n));return u}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(S,C,I,D,O){if(0!==I.length){const N=[],j=[];Sn.flattenJSON(I,N,j,D),0!==N.length&&O.push(new S(C,N,j))}},s=[],l=e.name||"default",u=e.fps||30,f=e.blendMode;let v=e.length||-1;const b=e.hierarchy||[];for(let S=0;S<b.length;S++){const C=b[S].keys;if(C&&0!==C.length)if(C[0].morphTargets){const I={};let D;for(D=0;D<C.length;D++)if(C[D].morphTargets)for(let O=0;O<C[D].morphTargets.length;O++)I[C[D].morphTargets[O]]=-1;for(const O in I){const N=[],j=[];for(let U=0;U!==C[D].morphTargets.length;++U){const Q=C[D];N.push(Q.time),j.push(Q.morphTarget===O?1:0)}s.push(new sh(".morphTargetInfluence["+O+"]",N,j))}v=I.length*u}else{const I=".bones["+t[S].name+"]";n(wl,I+".position",C,"pos",s),n(bl,I+".quaternion",C,"rot",s),n(wl,I+".scale",C,"scl",s)}}return 0===s.length?null:new this(l,v,s,f)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const s=this.tracks[t];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function oh(h){if(void 0===h.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return sh;case"vector":case"vector2":case"vector3":case"vector4":return wl;case"color":return $p;case"quaternion":return bl;case"bool":case"boolean":return rh;case"string":return Ra}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(h.type);if(void 0===h.times){const t=[],n=[];Sn.flattenJSON(h.keys,t,n,"value"),h.times=t,h.values=n}return void 0!==e.parse?e.parse(h):new e(h.name,h.times,h.values,h.interpolation)}const ah={enabled:!1,files:{},add:function(h,e){!1!==this.enabled&&(this.files[h]=e)},get:function(h){if(!1!==this.enabled)return this.files[h]},remove:function(h){delete this.files[h]},clear:function(){this.files={}}},Ad=new class{constructor(h,e,t){const n=this;let s,l=!1,u=0,f=0;const v=[];this.onStart=void 0,this.onLoad=h,this.onProgress=e,this.onError=t,this.itemStart=function(b){f++,!1===l&&void 0!==n.onStart&&n.onStart(b,u,f),l=!0},this.itemEnd=function(b){u++,void 0!==n.onProgress&&n.onProgress(b,u,f),u===f&&(l=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(b){void 0!==n.onError&&n.onError(b)},this.resolveURL=function(b){return s?s(b):b},this.setURLModifier=function(b){return s=b,this},this.addHandler=function(b,S){return v.push(b,S),this},this.removeHandler=function(b){const S=v.indexOf(b);return-1!==S&&v.splice(S,2),this},this.getHandler=function(b){for(let S=0,C=v.length;S<C;S+=2){const I=v[S],D=v[S+1];if(I.global&&(I.lastIndex=0),I.test(b))return D}return null}}};class Br{constructor(e){this.manager=void 0!==e?e:Ad,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(s,l){n.load(e,s,t,l)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Ml={};class Sl extends Br{constructor(e){super(e)}load(e,t,n,s){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const l=ah.get(e);if(void 0!==l)return this.manager.itemStart(e),setTimeout(()=>{t&&t(l),this.manager.itemEnd(e)},0),l;if(void 0!==Ml[e])return void Ml[e].push({onLoad:t,onProgress:n,onError:s});Ml[e]=[],Ml[e].push({onLoad:t,onProgress:n,onError:s});const u=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),f=this.mimeType,v=this.responseType;fetch(u).then(b=>{if(200===b.status||0===b.status){if(0===b.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===b.body||void 0===b.body.getReader)return b;const S=Ml[e],C=b.body.getReader(),I=b.headers.get("Content-Length"),D=I?parseInt(I):0,O=0!==D;let N=0;const j=new ReadableStream({start(U){!function Q(){C.read().then(({done:Y,value:Z})=>{if(Y)U.close();else{N+=Z.byteLength;const te=new ProgressEvent("progress",{lengthComputable:O,loaded:N,total:D});for(let oe=0,de=S.length;oe<de;oe++){const Ce=S[oe];Ce.onProgress&&Ce.onProgress(te)}U.enqueue(Z),Q()}})}()}});return new Response(j)}throw Error(`fetch for "${b.url}" responded with ${b.status}: ${b.statusText}`)}).then(b=>{switch(v){case"arraybuffer":return b.arrayBuffer();case"blob":return b.blob();case"document":return b.text().then(S=>(new DOMParser).parseFromString(S,f));case"json":return b.json();default:if(void 0===f)return b.text();{const S=/charset="?([^;"\s]*)"?/i.exec(f),C=S&&S[1]?S[1].toLowerCase():void 0,I=new TextDecoder(C);return b.arrayBuffer().then(D=>I.decode(D))}}}).then(b=>{ah.add(e,b);const S=Ml[e];delete Ml[e];for(let C=0,I=S.length;C<I;C++){const D=S[C];D.onLoad&&D.onLoad(b)}}).catch(b=>{const S=Ml[e];if(void 0===S)throw this.manager.itemError(e),b;delete Ml[e];for(let C=0,I=S.length;C<I;C++){const D=S[C];D.onError&&D.onError(b)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class lc extends Br{constructor(e){super(e)}load(e,t,n,s){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,u=ah.get(e);if(void 0!==u)return l.manager.itemStart(e),setTimeout(function(){t&&t(u),l.manager.itemEnd(e)},0),u;const f=X("img");function v(){S(),ah.add(e,this),t&&t(this),l.manager.itemEnd(e)}function b(C){S(),s&&s(C),l.manager.itemError(e),l.manager.itemEnd(e)}function S(){f.removeEventListener("load",v,!1),f.removeEventListener("error",b,!1)}return f.addEventListener("load",v,!1),f.addEventListener("error",b,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),l.manager.itemStart(e),f.src=e,f}}class qg extends Br{constructor(e){super(e)}load(e,t,n,s){const l=new yo,u=new lc(this.manager);u.setCrossOrigin(this.crossOrigin),u.setPath(this.path);let f=0;function v(b){u.load(e[b],function(S){l.images[b]=S,f++,6===f&&(l.needsUpdate=!0,t&&t(l))},void 0,s)}for(let b=0;b<e.length;++b)v(b);return l}}class $g extends Br{constructor(e){super(e)}load(e,t,n,s){const l=this,u=new _n,f=new Sl(this.manager);return f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setPath(this.path),f.setWithCredentials(l.withCredentials),f.load(e,function(v){const b=l.parse(v);b&&(void 0!==b.image?u.image=b.image:void 0!==b.data&&(u.image.width=b.width,u.image.height=b.height,u.image.data=b.data),u.wrapS=void 0!==b.wrapS?b.wrapS:1001,u.wrapT=void 0!==b.wrapT?b.wrapT:1001,u.magFilter=void 0!==b.magFilter?b.magFilter:1006,u.minFilter=void 0!==b.minFilter?b.minFilter:1006,u.anisotropy=void 0!==b.anisotropy?b.anisotropy:1,void 0!==b.encoding&&(u.encoding=b.encoding),void 0!==b.flipY&&(u.flipY=b.flipY),void 0!==b.format&&(u.format=b.format),void 0!==b.type&&(u.type=b.type),void 0!==b.mipmaps&&(u.mipmaps=b.mipmaps,u.minFilter=1008),1===b.mipmapCount&&(u.minFilter=1006),void 0!==b.generateMipmaps&&(u.generateMipmaps=b.generateMipmaps),u.needsUpdate=!0,t&&t(u,b))},n,s),u}}class Pd extends Br{constructor(e){super(e)}load(e,t,n,s){const l=new Dt,u=new lc(this.manager);return u.setCrossOrigin(this.crossOrigin),u.setPath(this.path),u.load(e,function(f){l.image=f,l.needsUpdate=!0,void 0!==t&&t(l)},n,s),l}}class Co extends Ni{constructor(e,t=1){super(),this.type="Light",this.color=new we(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Co.prototype.isLight=!0,class extends Co{constructor(h,e,t){super(h,t),this.type="HemisphereLight",this.position.copy(Ni.DefaultUp),this.updateMatrix(),this.groundColor=new we(e)}copy(h){return Co.prototype.copy.call(this,h),this.groundColor.copy(h.groundColor),this}}.prototype.isHemisphereLight=!0;const Ns=new ii,rf=new me,Xg=new me;class Yp{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Mt(512,512),this.map=null,this.mapPass=null,this.matrix=new ii,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ea,this._frameExtents=new Mt(1,1),this._viewportCount=1,this._viewports=[new Rt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;rf.setFromMatrixPosition(e.matrixWorld),t.position.copy(rf),Xg.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Xg),t.updateMatrixWorld(),Ns.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ns),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Yg extends Yp{constructor(){super(new bn(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*xa*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,l=e.distance||t.far;n===t.fov&&s===t.aspect&&l===t.far||(t.fov=n,t.aspect=s,t.far=l,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Yg.prototype.isSpotLightShadow=!0;class Jg extends Co{constructor(e,t,n=0,s=Math.PI/3,l=0,u=1){super(e,t),this.type="SpotLight",this.position.copy(Ni.DefaultUp),this.updateMatrix(),this.target=new Ni,this.distance=n,this.angle=s,this.penumbra=l,this.decay=u,this.shadow=new Yg}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Jg.prototype.isSpotLight=!0;const sf=new ii,fu=new me,Jp=new me;class Kp extends Yp{constructor(){super(new bn(90,1,.5,500)),this._frameExtents=new Mt(4,2),this._viewportCount=6,this._viewports=[new Rt(2,1,1,1),new Rt(0,1,1,1),new Rt(3,1,1,1),new Rt(1,1,1,1),new Rt(3,0,1,1),new Rt(1,0,1,1)],this._cubeDirections=[new me(1,0,0),new me(-1,0,0),new me(0,0,1),new me(0,0,-1),new me(0,1,0),new me(0,-1,0)],this._cubeUps=[new me(0,1,0),new me(0,1,0),new me(0,1,0),new me(0,1,0),new me(0,0,1),new me(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,s=this.matrix,l=e.distance||n.far;l!==n.far&&(n.far=l,n.updateProjectionMatrix()),fu.setFromMatrixPosition(e.matrixWorld),n.position.copy(fu),Jp.copy(n.position),Jp.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Jp),n.updateMatrixWorld(),s.makeTranslation(-fu.x,-fu.y,-fu.z),sf.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sf)}}Kp.prototype.isPointLightShadow=!0;class Ao extends Co{constructor(e,t,n=0,s=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new Kp}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Ao.prototype.isPointLight=!0;class ys extends Yp{constructor(){super(new It(-5,5,5,-5,.5,500))}}ys.prototype.isDirectionalLightShadow=!0;class of extends Co{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Ni.DefaultUp),this.updateMatrix(),this.target=new Ni,this.shadow=new ys}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}of.prototype.isDirectionalLight=!0,class extends Co{constructor(h,e){super(h,e),this.type="AmbientLight"}}.prototype.isAmbientLight=!0,class extends Co{constructor(h,e,t=10,n=10){super(h,e),this.type="RectAreaLight",this.width=t,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(h){this.intensity=h/(this.width*this.height*Math.PI)}copy(h){return super.copy(h),this.width=h.width,this.height=h.height,this}toJSON(h){const e=super.toJSON(h);return e.object.width=this.width,e.object.height=this.height,e}}.prototype.isRectAreaLight=!0;class Qp{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new me)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,s=e.y,l=e.z,u=this.coefficients;return t.copy(u[0]).multiplyScalar(.282095),t.addScaledVector(u[1],.488603*s),t.addScaledVector(u[2],.488603*l),t.addScaledVector(u[3],.488603*n),t.addScaledVector(u[4],n*s*1.092548),t.addScaledVector(u[5],s*l*1.092548),t.addScaledVector(u[6],.315392*(3*l*l-1)),t.addScaledVector(u[7],n*l*1.092548),t.addScaledVector(u[8],.546274*(n*n-s*s)),t}getIrradianceAt(e,t){const n=e.x,s=e.y,l=e.z,u=this.coefficients;return t.copy(u[0]).multiplyScalar(.886227),t.addScaledVector(u[1],1.023328*s),t.addScaledVector(u[2],1.023328*l),t.addScaledVector(u[3],1.023328*n),t.addScaledVector(u[4],.858086*n*s),t.addScaledVector(u[5],.858086*s*l),t.addScaledVector(u[6],.743125*l*l-.247708),t.addScaledVector(u[7],.858086*n*l),t.addScaledVector(u[8],.429043*(n*n-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,t+3*s);return this}toArray(e=[],t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,t+3*s);return e}static getBasisAt(e,t){const n=e.x,s=e.y,l=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*l,t[3]=.488603*n,t[4]=1.092548*n*s,t[5]=1.092548*s*l,t[6]=.315392*(3*l*l-1),t[7]=1.092548*n*l,t[8]=.546274*(n*n-s*s)}}Qp.prototype.isSphericalHarmonics3=!0;class em extends Co{constructor(e=new Qp,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}em.prototype.isLightProbe=!0;class cc{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,s=e.length;n<s;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}(class extends an{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(h){return super.copy(h),this.instanceCount=h.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const h=super.toJSON(this);return h.instanceCount=this.instanceCount,h.isInstancedBufferGeometry=!0,h}}).prototype.isInstancedBufferGeometry=!0;class Kg extends Br{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,s){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,u=ah.get(e);if(void 0!==u)return l.manager.itemStart(e),setTimeout(function(){t&&t(u),l.manager.itemEnd(e)},0),u;const f={};f.credentials="anonymous"===this.crossOrigin?"same-origin":"include",f.headers=this.requestHeader,fetch(e,f).then(function(v){return v.blob()}).then(function(v){return createImageBitmap(v,Object.assign(l.options,{colorSpaceConversion:"none"}))}).then(function(v){ah.add(e,v),t&&t(v),l.manager.itemEnd(e)}).catch(function(v){s&&s(v),l.manager.itemError(e),l.manager.itemEnd(e)}),l.manager.itemStart(e)}}let gu;Kg.prototype.isImageBitmapLoader=!0;class tm extends Br{constructor(e){super(e)}load(e,t,n,s){const l=this,u=new Sl(this.manager);u.setResponseType("arraybuffer"),u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(f){try{const v=f.slice(0);(void 0===gu&&(gu=new(window.AudioContext||window.webkitAudioContext)),gu).decodeAudioData(v,function(b){t(b)})}catch(v){s?s(v):console.error(v),l.manager.itemError(e)}},n,s)}}(class extends em{constructor(h,e,t=1){super(void 0,t);const n=(new we).set(h),s=(new we).set(e),l=new me(n.r,n.g,n.b),u=new me(s.r,s.g,s.b),f=Math.sqrt(Math.PI),v=f*Math.sqrt(.75);this.sh.coefficients[0].copy(l).add(u).multiplyScalar(f),this.sh.coefficients[1].copy(l).sub(u).multiplyScalar(v)}}).prototype.isHemisphereLightProbe=!0,class extends em{constructor(h,e=1){super(void 0,e);const t=(new we).set(h);this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class Qg{constructor(e,t,n){let s,l,u;switch(this.binding=e,this.valueSize=n,t){case"quaternion":s=this._slerp,l=this._slerpAdditive,u=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":s=this._select,l=this._select,u=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:s=this._lerp,l=this._lerpAdditive,u=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=l,this._setIdentity=u,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,s=this.valueSize,l=e*s+s;let u=this.cumulativeWeight;if(0===u){for(let f=0;f!==s;++f)n[l+f]=n[f];u=t}else u+=t,this._mixBufferRegion(n,l,0,t/u,s);this.cumulativeWeight=u}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,s=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,s=e*t+t,l=this.cumulativeWeight,u=this.cumulativeWeightAdditive,f=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,l<1&&this._mixBufferRegion(n,s,t*this._origIndex,1-l,t),u>0&&this._mixBufferRegionAdditive(n,s,this._addIndex*t,1,t);for(let v=t,b=t+t;v!==b;++v)if(n[v]!==n[v+t]){f.setValue(n,s);break}}saveOriginalState(){const t=this.buffer,n=this.valueSize,s=n*this._origIndex;this.binding.getValue(t,s);for(let l=n,u=s;l!==u;++l)t[l]=t[s+l%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,s,l){if(s>=.5)for(let u=0;u!==l;++u)e[t+u]=e[n+u]}_slerp(e,t,n,s){ui.slerpFlat(e,t,e,t,e,n,s)}_slerpAdditive(e,t,n,s,l){const u=this._workIndex*l;ui.multiplyQuaternionsFlat(e,u,e,t,e,n),ui.slerpFlat(e,t,e,t,e,u,s)}_lerp(e,t,n,s,l){const u=1-s;for(let f=0;f!==l;++f){const v=t+f;e[v]=e[v]*u+e[n+f]*s}}_lerpAdditive(e,t,n,s,l){for(let u=0;u!==l;++u){const f=t+u;e[f]=e[f]+e[n+u]*s}}}const hc=new RegExp("[\\[\\]\\.:\\/]","g"),Id="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",cy=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),hy=/(WCOD+)?/.source.replace("WCOD",Id),uy=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),dy=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),py=new RegExp("^"+cy+hy+uy+dy+"$"),my=["material","materials","bones"];class $i{constructor(e,t,n){this.path=t,this.parsedPath=n||$i.parseTrackName(t),this.node=$i.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new $i.Composite(e,t,n):new $i(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(hc,"")}static parseTrackName(e){const t=py.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const l=n.nodeName.substring(s+1);-1!==my.indexOf(l)&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=l)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(l){for(let u=0;u<l.length;u++){const f=l[u];if(f.name===t||f.uuid===t)return f;const v=n(f.children);if(v)return v}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let s=0,l=n.length;s!==l;++s)e[t++]=n[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let s=0,l=n.length;s!==l;++s)n[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,l=n.length;s!==l;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,l=n.length;s!==l;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,s=t.propertyName;let l=t.propertyIndex;if(e||(e=$i.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let b=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let S=0;S<e.length;S++)if(e[S].name===b){b=S;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==b){if(void 0===e[b])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[b]}}const u=e[s];if(void 0===u)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+s+" but it wasn't found.",e);let f=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?f=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(f=this.Versioning.MatrixWorldNeedsUpdate);let v=this.BindingType.Direct;if(void 0!==l){if("morphTargetInfluences"===s){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[l]&&(l=e.morphTargetDictionary[l])}v=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=l}else void 0!==u.fromArray&&void 0!==u.toArray?(v=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(v=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=s;this.getValue=this.GetterByBindingType[v],this.setValue=this.SetterByBindingTypeAndVersioning[v][f]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}$i.Composite=class{constructor(h,e,t){const n=t||$i.parseTrackName(e);this._targetGroup=h,this._bindings=h.subscribe_(e,n)}getValue(h,e){this.bind();const n=this._bindings[this._targetGroup.nCachedObjects_];void 0!==n&&n.getValue(h,e)}setValue(h,e){const t=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=t.length;n!==s;++n)t[n].setValue(h,e)}bind(){const h=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=h.length;e!==t;++e)h[e].bind()}unbind(){const h=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=h.length;e!==t;++e)h[e].unbind()}},$i.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},$i.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},$i.prototype.GetterByBindingType=[$i.prototype._getValue_direct,$i.prototype._getValue_array,$i.prototype._getValue_arrayElement,$i.prototype._getValue_toArray],$i.prototype.SetterByBindingTypeAndVersioning=[[$i.prototype._setValue_direct,$i.prototype._setValue_direct_setNeedsUpdate,$i.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[$i.prototype._setValue_array,$i.prototype._setValue_array_setNeedsUpdate,$i.prototype._setValue_array_setMatrixWorldNeedsUpdate],[$i.prototype._setValue_arrayElement,$i.prototype._setValue_arrayElement_setNeedsUpdate,$i.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[$i.prototype._setValue_fromArray,$i.prototype._setValue_fromArray_setNeedsUpdate,$i.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class af{constructor(e,t,n=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=s;const l=t.tracks,u=l.length,f=new Array(u),v={endingStart:2400,endingEnd:2400};for(let b=0;b!==u;++b){const S=l[b].createInterpolant(null);f[b]=S,S.settings=v}this._interpolantSettings=v,this._interpolants=f,this._propertyBindings=new Array(u),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const s=this._clip.duration,l=e._clip.duration,f=s/l;e.warp(1,l/s,t),this.warp(f,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const s=this._mixer,l=s.time,u=this.timeScale;let f=this._timeScaleInterpolant;null===f&&(f=s._lendControlInterpolant(),this._timeScaleInterpolant=f);const v=f.parameterPositions,b=f.sampleValues;return v[0]=l,v[1]=l+n,b[0]=e/u,b[1]=t/u,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,s){if(!this.enabled)return void this._updateWeight(e);const l=this._startTime;if(null!==l){const v=(e-l)*n;if(v<0||0===n)return;this._startTime=null,t=n*v}t*=this._updateTimeScale(e);const u=this._updateTime(t),f=this._updateWeight(e);if(f>0){const v=this._interpolants,b=this._propertyBindings;if(2501===this.blendMode)for(let S=0,C=v.length;S!==C;++S)v[S].evaluate(u),b[S].accumulateAdditive(f);else for(let S=0,C=v.length;S!==C;++S)v[S].evaluate(u),b[S].accumulate(s,f)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopFading(),0===s&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let s=this.time+e,l=this._loopCount;const u=2202===n;if(0===e)return-1===l?s:u&&1==(1&l)?t-s:s;if(2200===n){-1===l&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else{if(!(s<0)){this.time=s;break e}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===l&&(e>=0?(l=0,this._setEndings(!0,0===this.repetitions,u)):this._setEndings(0===this.repetitions,!0,u)),s>=t||s<0){const f=Math.floor(s/t);s-=t*f,l+=Math.abs(f);const v=this.repetitions-l;if(v<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===v){const b=e<0;this._setEndings(b,!b,u)}else this._setEndings(!1,!1,u);this._loopCount=l,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f})}}else this.time=s;if(u&&1==(1&l))return t-s}return s}_setEndings(e,t,n){const s=this._interpolantSettings;n?(s.endingStart=2401,s.endingEnd=2401):(s.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,s.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,t,n){const s=this._mixer,l=s.time;let u=this._weightInterpolant;null===u&&(u=s._lendControlInterpolant(),this._weightInterpolant=u);const f=u.parameterPositions,v=u.sampleValues;return f[0]=l,v[0]=t,f[1]=l+e,v[1]=n,this}}class e_ extends qr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,s=e._clip.tracks,l=s.length,u=e._propertyBindings,f=e._interpolants,v=n.uuid,b=this._bindingsByRootAndName;let S=b[v];void 0===S&&(S={},b[v]=S);for(let C=0;C!==l;++C){const I=s[C],D=I.name;let O=S[D];if(void 0!==O)++O.referenceCount,u[C]=O;else{if(O=u[C],void 0!==O){null===O._cacheIndex&&(++O.referenceCount,this._addInactiveBinding(O,v,D));continue}O=new Qg($i.create(n,D,t&&t._propertyBindings[C].binding.parsedPath),I.ValueTypeName,I.getValueSize()),++O.referenceCount,this._addInactiveBinding(O,v,D),u[C]=O}f[C].resultBuffer=O.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const n=(e._localRoot||this._root).uuid,s=e._clip.uuid,l=this._actionsByClip[s];this._bindAction(e,l&&l.knownActions[0]),this._addInactiveAction(e,s,n)}const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const l=t[n];0==l.useCount++&&(this._lendBinding(l),l.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const l=t[n];0==--l.useCount&&(l.restoreOriginalState(),this._takeBackBinding(l))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const s=this._actions,l=this._actionsByClip;let u=l[t];if(void 0===u)u={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,l[t]=u;else{const f=u.knownActions;e._byClipCacheIndex=f.length,f.push(e)}e._cacheIndex=s.length,s.push(e),u.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],s=e._cacheIndex;n._cacheIndex=s,t[s]=n,t.pop(),e._cacheIndex=null;const l=e._clip.uuid,u=this._actionsByClip,f=u[l],v=f.knownActions,b=v[v.length-1],S=e._byClipCacheIndex;b._byClipCacheIndex=S,v[S]=b,v.pop(),e._byClipCacheIndex=null,delete f.actionByRoot[(e._localRoot||this._root).uuid],0===v.length&&delete u[l],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const l=t[n];0==--l.referenceCount&&this._removeInactiveBinding(l)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,s=this._nActiveActions++,l=t[s];e._cacheIndex=s,t[s]=e,l._cacheIndex=n,t[n]=l}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,s=--this._nActiveActions,l=t[s];e._cacheIndex=s,t[s]=e,l._cacheIndex=n,t[n]=l}_addInactiveBinding(e,t,n){const s=this._bindingsByRootAndName,l=this._bindings;let u=s[t];void 0===u&&(u={},s[t]=u),u[n]=e,e._cacheIndex=l.length,l.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,s=n.rootNode.uuid,l=n.path,u=this._bindingsByRootAndName,f=u[s],v=t[t.length-1],b=e._cacheIndex;v._cacheIndex=b,t[b]=v,t.pop(),delete f[l],0===Object.keys(f).length&&delete u[s]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,s=this._nActiveBindings++,l=t[s];e._cacheIndex=s,t[s]=e,l._cacheIndex=n,t[n]=l}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,s=--this._nActiveBindings,l=t[s];e._cacheIndex=s,t[s]=e,l._cacheIndex=n,t[n]=l}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new mu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,s=--this._nActiveControlInterpolants,l=t[s];e.__cacheIndex=s,t[s]=e,l.__cacheIndex=n,t[n]=l}clipAction(e,t,n){const s=t||this._root,l=s.uuid;let u="string"==typeof e?Xp.findByName(s,e):e;const f=null!==u?u.uuid:e,v=this._actionsByClip[f];let b=null;if(void 0===n&&(n=null!==u?u.blendMode:2500),void 0!==v){const C=v.actionByRoot[l];if(void 0!==C&&C.blendMode===n)return C;b=v.knownActions[0],null===u&&(u=b._clip)}if(null===u)return null;const S=new af(this,u,t,n);return this._bindAction(S,b),this._addInactiveAction(S,f,l),S}existingAction(e,t){const n=t||this._root,s=n.uuid,l="string"==typeof e?Xp.findByName(n,e):e,f=this._actionsByClip[l?l.uuid:e];return void 0!==f&&f.actionByRoot[s]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){const t=this._actions,n=this._nActiveActions,s=this.time+=e*=this.timeScale,l=Math.sign(e),u=this._accuIndex^=1;for(let b=0;b!==n;++b)t[b]._update(s,e,l,u);const f=this._bindings,v=this._nActiveBindings;for(let b=0;b!==v;++b)f[b].apply(u);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,s=this._actionsByClip,l=s[n];if(void 0!==l){const u=l.knownActions;for(let f=0,v=u.length;f!==v;++f){const b=u[f];this._deactivateAction(b);const S=b._cacheIndex,C=t[t.length-1];b._cacheIndex=null,b._byClipCacheIndex=null,C._cacheIndex=S,t[S]=C,t.pop(),this._removeInactiveBindingsForAction(b)}delete s[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const l in n){const u=n[l].actionByRoot[t];void 0!==u&&(this._deactivateAction(u),this._removeInactiveAction(u))}const s=this._bindingsByRootAndName[t];if(void 0!==s)for(const l in s){const u=s[l];u.restoreOriginalState(),this._removeInactiveBinding(u)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}function lh(h,e){return h.distance-e.distance}function lf(h,e,t,n){if(h.layers.test(e.layers)&&h.raycast(e,t),!0===n){const s=h.children;for(let l=0,u=s.length;l<u;l++)lf(s[l],e,t,!0)}}e_.prototype._controlInterpolantsResultBuffer=new Float32Array(1),class extends ft{constructor(h,e,t=1){super(h,e),this.meshPerAttribute=t}copy(h){return super.copy(h),this.meshPerAttribute=h.meshPerAttribute,this}clone(h){const e=super.clone(h);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(h){const e=super.toJSON(h);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}.prototype.isInstancedInterleavedBuffer=!0;class Tn{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ar(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const sa=new me,Dd=new ii,_u=new ii;function Ld(h){const e=[];!0===h.isBone&&e.push(h);for(let t=0;t<h.children.length;t++)e.push.apply(e,Ld(h.children[t]));return e}const yu=new Float32Array(1),t_=new Int32Array(yu.buffer);class Rd{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),yu[0]=e;const t=t_[0];let n=t>>16&32768,s=t>>12&2047;const l=t>>23&255;return l<103?n:l>142?(n|=31744,n|=(255==l?0:1)&&8388607&t,n):l<113?(s|=2048,n|=(s>>114-l)+(s>>113-l&1),n):(n|=l-112<<10|s>>1,n+=1&s,n)}}mr.create=function(h,e){return console.log("THREE.Curve.create() has been deprecated"),h.prototype=Object.create(mr.prototype),h.prototype.constructor=h,h.prototype.getPoint=e,h},nc.prototype.fromPoints=function(h){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(h)},class extends bd{constructor(h=10,e=10,t=4473924,n=8947848){t=new we(t),n=new we(n);const s=e/2,l=h/e,u=h/2,f=[],v=[];for(let S=0,C=0,I=-u;S<=e;S++,I+=l){f.push(-u,0,I,u,0,I),f.push(I,0,-u,I,0,u);const D=S===s?t:n;D.toArray(v,C),C+=3,D.toArray(v,C),C+=3,D.toArray(v,C),C+=3,D.toArray(v,C),C+=3}const b=new an;b.setAttribute("position",new vn(f,3)),b.setAttribute("color",new vn(v,3)),super(b,new es({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends bd{constructor(h){const e=Ld(h),t=new an,n=[],s=[],l=new we(0,0,1),u=new we(0,1,0);for(let f=0;f<e.length;f++){const v=e[f];v.parent&&v.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(l.r,l.g,l.b),s.push(u.r,u.g,u.b))}t.setAttribute("position",new vn(n,3)),t.setAttribute("color",new vn(s,3)),super(t,new es({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=h,this.bones=e,this.matrix=h.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(h){const e=this.bones,t=this.geometry,n=t.getAttribute("position");_u.copy(this.root.matrixWorld).invert();for(let s=0,l=0;s<e.length;s++){const u=e[s];u.parent&&u.parent.isBone&&(Dd.multiplyMatrices(_u,u.matrixWorld),sa.setFromMatrixPosition(Dd),n.setXYZ(l,sa.x,sa.y,sa.z),Dd.multiplyMatrices(_u,u.parent.matrixWorld),sa.setFromMatrixPosition(Dd),n.setXYZ(l+1,sa.x,sa.y,sa.z),l+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(h)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Br.prototype.extractUrlBase=function(h){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),cc.extractUrlBase(h)},Br.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},yt.prototype.center=function(h){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(h)},yt.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},yt.prototype.isIntersectionBox=function(h){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(h)},yt.prototype.isIntersectionSphere=function(h){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(h)},yt.prototype.size=function(h){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(h)},vr.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},Ks.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ea.prototype.setFromMatrix=function(h){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(h)},se.prototype.flattenToArrayOffset=function(h,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(h,e)},se.prototype.multiplyVector3=function(h){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),h.applyMatrix3(this)},se.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},se.prototype.applyToBufferAttribute=function(h){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),h.applyMatrix3(this)},se.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},se.prototype.getInverse=function(h){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(h).invert()},ii.prototype.extractPosition=function(h){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(h)},ii.prototype.flattenToArrayOffset=function(h,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(h,e)},ii.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new me).setFromMatrixColumn(this,3)},ii.prototype.setRotationFromQuaternion=function(h){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(h)},ii.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},ii.prototype.multiplyVector3=function(h){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),h.applyMatrix4(this)},ii.prototype.multiplyVector4=function(h){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),h.applyMatrix4(this)},ii.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ii.prototype.rotateAxis=function(h){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),h.transformDirection(this)},ii.prototype.crossVector=function(h){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),h.applyMatrix4(this)},ii.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ii.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ii.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ii.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ii.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ii.prototype.applyToBufferAttribute=function(h){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),h.applyMatrix4(this)},ii.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ii.prototype.makeFrustum=function(h,e,t,n,s,l){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(h,e,n,t,s,l)},ii.prototype.getInverse=function(h){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(h).invert()},Ir.prototype.isIntersectionLine=function(h){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(h)},ui.prototype.multiplyVector3=function(h){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),h.applyQuaternion(this)},ui.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Dn.prototype.isIntersectionBox=function(h){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(h)},Dn.prototype.isIntersectionPlane=function(h){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(h)},Dn.prototype.isIntersectionSphere=function(h){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(h)},Ln.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Ln.prototype.barycoordFromPoint=function(h,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(h,e)},Ln.prototype.midpoint=function(h){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(h)},Ln.prototypenormal=function(h){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(h)},Ln.prototype.plane=function(h){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(h)},Ln.barycoordFromPoint=function(h,e,t,n,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ln.getBarycoord(h,e,t,n,s)},Ln.normal=function(h,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ln.getNormal(h,e,t,n)},ts.prototype.extractAllPoints=function(h){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(h)},ts.prototype.extrude=function(h){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new nh(this,h)},ts.prototype.makeGeometry=function(h){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new nf(this,h)},Mt.prototype.fromAttribute=function(h,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(h,e,t)},Mt.prototype.distanceToManhattan=function(h){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(h)},Mt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},me.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},me.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},me.prototype.getPositionFromMatrix=function(h){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(h)},me.prototype.getScaleFromMatrix=function(h){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(h)},me.prototype.getColumnFromMatrix=function(h,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,h)},me.prototype.applyProjection=function(h){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(h)},me.prototype.fromAttribute=function(h,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(h,e,t)},me.prototype.distanceToManhattan=function(h){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(h)},me.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Rt.prototype.fromAttribute=function(h,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(h,e,t)},Rt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ni.prototype.getChildByName=function(h){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(h)},Ni.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Ni.prototype.translate=function(h,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,h)},Ni.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Ni.prototype.applyMatrix=function(h){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(h)},Object.defineProperties(Ni.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(h){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=h}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),di.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(di.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),kn.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},bn.prototype.setLens=function(h,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(h)},Object.defineProperties(Co.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(h){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=h}},shadowCameraLeft:{set:function(h){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=h}},shadowCameraRight:{set:function(h){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=h}},shadowCameraTop:{set:function(h){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=h}},shadowCameraBottom:{set:function(h){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=h}},shadowCameraNear:{set:function(h){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=h}},shadowCameraFar:{set:function(h){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=h}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(h){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=h}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(h){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=h}},shadowMapHeight:{set:function(h){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=h}}}),Object.defineProperties(un.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),un.prototype.setDynamic=function(h){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===h?35048:35044),this},un.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},un.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},an.prototype.addIndex=function(h){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(h)},an.prototype.addAttribute=function(h,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===h?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(h,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(h,new un(arguments[1],arguments[2])))},an.prototype.addDrawCall=function(h,e,t){void 0!==t&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(h,e)},an.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},an.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},an.prototype.removeAttribute=function(h){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(h)},an.prototype.applyMatrix=function(h){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(h)},Object.defineProperties(an.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ft.prototype.setDynamic=function(h){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===h?35048:35044),this},ft.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},nh.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},nh.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},nh.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},mt.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(Mn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new we}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(h){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===h}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(h){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=h}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(xr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(h){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=h}}}),Ie.prototype.clearTarget=function(h,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(h),this.clear(e,t,n)},Ie.prototype.animate=function(h){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(h)},Ie.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Ie.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Ie.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Ie.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Ie.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Ie.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Ie.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Ie.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Ie.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Ie.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Ie.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Ie.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Ie.prototype.enableScissorTest=function(h){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(h)},Ie.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Ie.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Ie.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Ie.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Ie.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Ie.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Ie.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Ie.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Ie.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Ie.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Ie.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(h){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=h}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(h){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=h}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(h){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===h?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(ce.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Fe.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(h){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=h}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(h){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=h}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(h){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=h}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(h){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=h}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(h){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=h}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(h){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=h}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(h){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=h}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(h){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=h}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(h){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=h}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(h){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=h}}}),class extends Ni{constructor(h){super(),this.type="Audio",this.listener=h,this.context=h.context,this.gain=this.context.createGain(),this.gain.connect(h.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(h){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=h,this.connect(),this}setMediaElementSource(h){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(h),this.connect(),this}setMediaStreamSource(h){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(h),this.connect(),this}setBuffer(h){return this.buffer=h,this.sourceType="buffer",this.autoplay&&this.play(),this}play(h=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+h;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let h=1,e=this.filters.length;h<e;h++)this.filters[h-1].connect(this.filters[h]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let h=1,e=this.filters.length;h<e;h++)this.filters[h-1].disconnect(this.filters[h]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(h){return h||(h=[]),!0===this._connected?(this.disconnect(),this.filters=h.slice(),this.connect()):this.filters=h.slice(),this}setDetune(h){if(this.detune=h,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(h){return this.setFilters(h?[h]:[])}setPlaybackRate(h){if(!1!==this.hasPlaybackControl)return this.playbackRate=h,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(h){if(!1!==this.hasPlaybackControl)return this.loop=h,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(h){return this.loopStart=h,this}setLoopEnd(h){return this.loopEnd=h,this}getVolume(){return this.gain.gain.value}setVolume(h){return this.gain.gain.setTargetAtTime(h,this.context.currentTime,.01),this}}.prototype.load=function(h){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new tm).load(h,function(t){e.setBuffer(t)}),this},al.prototype.updateCubeMap=function(h,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(h,e)},al.prototype.clear=function(h,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(h,e,t,n)},At.crossOrigin=void 0,At.loadTexture=function(h,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const s=new Pd;s.setCrossOrigin(this.crossOrigin);const l=s.load(h,t,void 0,n);return e&&(l.mapping=e),l},At.loadTextureCube=function(h,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const s=new qg;s.setCrossOrigin(this.crossOrigin);const l=s.load(h,t,void 0,n);return e&&(l.mapping=e),l},At.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},At.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"138"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="138");const vu=null!=navigator.xr&&null!=self.XRSession&&null!=navigator.xr.isSessionSupported,im=vu&&self.XRSession.prototype.requestHitTestSource,kd=null!=self.ResizeObserver,cf=null!=self.IntersectionObserver,hf=im;(()=>{const h=navigator.userAgent||navigator.vendor||self.opera;/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(h)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(h.substr(0,4))})(),/\bCrOS\b/.test(navigator.userAgent);const zd=/android/i.test(navigator.userAgent),fy=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,nm=(()=>{const h=document.createElement("a");return Boolean(h.relList&&h.relList.supports&&h.relList.supports("ar"))})();/Safari\//.test(navigator.userAgent);const gy=/firefox/i.test(navigator.userAgent),uf=/OculusBrowser/.test(navigator.userAgent);fy&&/CriOS\//.test(navigator.userAgent);const df=zd&&!gy&&!uf,rm=uo`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

/* NOTE: This ruleset is our integration surface area with the
 * :focus-visible polyfill.
 *
 * @see https://github.com/WICG/focus-visible/pull/196 */
:host([data-js-focus-visible]:focus:not(.focus-visible)),
:host([data-js-focus-visible]) :focus:not(.focus-visible) {
  outline: none;
}

.container {
  position: relative;
}

.userInput {
  width: 100%;
  height: 100%;
  display: block;
  position: relative;
  overflow: hidden;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

canvas.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  left: 0;
  top: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
  pointer-events: none;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  opacity: 0;
  transition: opacity 0.3s 0.3s;
  background-color: inherit;
}

.slot.poster.show {
  opacity: 1;
  transition: none;
}

.slot.poster.quick {
  transition: none;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: var(--poster-color, #fff);
  background-image: var(--poster-image, none);
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .mask {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--progress-mask, #fff);
  transition: opacity 0.3s;
  opacity: 0.2;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  align-items: center;
  justify-content: center;

  opacity: 0;
  will-change: opacity;
  overflow: hidden;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.slot.interaction-prompt > .animated-container {
  will-change: transform, opacity;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.pan-target {
  display: block;
  position: absolute;
  width: 0;
  height: 0;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  background-color: transparent;
  opacity: 0;
  transition: opacity 0.3s;
}

#default-pan-target {
  width: 6px;
  height: 6px;
  border-radius: 6px;
  border: 1px solid white;
  box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 16px;
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>
      
  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Loading 3D model"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          aria-label="View in your space">
        ${uo`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`}
      </a>
    </slot>
  </div>

  <div class="slot pan-target">
    <slot name="pan-target">
      <div id="default-pan-target">      
      </div>
    </slot>
  </div>

  <div class="slot interaction-prompt">
    <div class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${uo`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`}
      </slot>
    </div>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="mask" part="default-progress-mask"></div>
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>
    
    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${uo`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`}
        </a>
      </slot>
    </div>
  </div>
</div>
<div class="screen-reader-only" role="region" aria-label="Live announcements">
  <span id="status" role="status"></span>
</div>`,pf=new WeakMap;function _y(){let h,e;function t(n,s,l,u,f,v){const b=v.num_components(),S=l.num_points()*b,C=S*f.BYTES_PER_ELEMENT,I=function(N,j){switch(j){case Float32Array:return N.DT_FLOAT32;case Int8Array:return N.DT_INT8;case Int16Array:return N.DT_INT16;case Int32Array:return N.DT_INT32;case Uint8Array:return N.DT_UINT8;case Uint16Array:return N.DT_UINT16;case Uint32Array:return N.DT_UINT32}}(n,f),D=n._malloc(C);s.GetAttributeDataArrayForAllPoints(l,v,I,C,D);const O=new f(n.HEAPF32.buffer,D,S).slice();return n._free(D),{name:u,array:O,itemSize:b}}onmessage=function(n){const s=n.data;switch(s.type){case"init":h=s.decoderConfig,e=new Promise(function(f){h.onModuleLoaded=function(v){f({draco:v})},DracoDecoderModule(h)});break;case"decode":const l=s.buffer,u=s.taskConfig;e.then(f=>{const v=f.draco,b=new v.Decoder,S=new v.DecoderBuffer;S.Init(new Int8Array(l),l.byteLength);try{const C=function(D,O,N,j){const U=j.attributeIDs,Q=j.attributeTypes;let Y,Z;const te=O.GetEncodedGeometryType(N);if(te===D.TRIANGULAR_MESH)Y=new D.Mesh,Z=O.DecodeBufferToMesh(N,Y);else{if(te!==D.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");Y=new D.PointCloud,Z=O.DecodeBufferToPointCloud(N,Y)}if(!Z.ok()||0===Y.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+Z.error_msg());const oe={index:null,attributes:[]};for(const de in U){const Ce=self[Q[de]];let Le,Oe;if(j.useUniqueIDs)Oe=U[de],Le=O.GetAttributeByUniqueId(Y,Oe);else{if(Oe=O.GetAttributeId(Y,D[U[de]]),-1===Oe)continue;Le=O.GetAttribute(Y,Oe)}oe.attributes.push(t(D,O,Y,de,Ce,Le))}return te===D.TRIANGULAR_MESH&&(oe.index=function(de,Ce,Le){const Oe=3*Le.num_faces(),Ze=4*Oe,et=de._malloc(Ze);Ce.GetTrianglesUInt32Array(Le,Ze,et);const ot=new Uint32Array(de.HEAPF32.buffer,et,Oe).slice();return de._free(et),{array:ot,itemSize:1}}(D,O,Y)),D.destroy(Y),oe}(v,b,S,u),I=C.attributes.map(D=>D.array.buffer);C.index&&I.push(C.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:C},I)}catch(C){console.error(C),self.postMessage({type:"error",id:s.id,error:C.message})}finally{v.destroy(S),v.destroy(b)}})}}}class yy extends Br{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new xu(t)}),this.register(function(t){return new Sy(t)}),this.register(function(t){return new ch(t)}),this.register(function(t){return new by(t)}),this.register(function(t){return new wy(t)}),this.register(function(t){return new n_(t)}),this.register(function(t){return new r_(t)}),this.register(function(t){return new My(t)}),this.register(function(t){return new xy(t)}),this.register(function(t){return new sm(t)})}load(e,t,n,s){const l=this;let u;u=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:cc.extractUrlBase(e),this.manager.itemStart(e);const f=function(b){s?s(b):console.error(b),l.manager.itemError(e),l.manager.itemEnd(e)},v=new Sl(this.manager);v.setPath(this.path),v.setResponseType("arraybuffer"),v.setRequestHeader(this.requestHeader),v.setWithCredentials(this.withCredentials),v.load(e,function(b){try{l.parse(b,u,function(S){t(S),l.manager.itemEnd(e)},f)}catch(S){f(S)}},n,f)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let l;const u={},f={};if("string"==typeof e)l=e;else if(cc.decodeText(new Uint8Array(e,0,4))===s_){try{u[Zi.KHR_BINARY_GLTF]=new Bd(e)}catch(S){return void(s&&s(S))}l=u[Zi.KHR_BINARY_GLTF].content}else l=cc.decodeText(new Uint8Array(e));const v=JSON.parse(l);if(void 0===v.asset||v.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const b=new Gd(v,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});b.fileLoader.setRequestHeader(this.requestHeader);for(let S=0;S<this.pluginCallbacks.length;S++){const C=this.pluginCallbacks[S](b);f[C.name]=C,u[C.name]=!0}if(v.extensionsUsed)for(let S=0;S<v.extensionsUsed.length;++S){const C=v.extensionsUsed[S],I=v.extensionsRequired||[];switch(C){case Zi.KHR_MATERIALS_UNLIT:u[C]=new i_;break;case Zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:u[C]=new Ey;break;case Zi.KHR_DRACO_MESH_COMPRESSION:u[C]=new o_(v,this.dracoLoader);break;case Zi.KHR_TEXTURE_TRANSFORM:u[C]=new Fd;break;case Zi.KHR_MESH_QUANTIZATION:u[C]=new Ud;break;default:I.indexOf(C)>=0&&void 0===f[C]&&console.warn('THREE.GLTFLoader: Unknown extension "'+C+'".')}}b.setExtensions(u),b.setPlugins(f),b.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,l){n.parse(e,t,s,l)})}}function vy(){let h={};return{get:function(e){return h[e]},add:function(e,t){h[e]=t},remove:function(e){delete h[e]},removeAll:function(){h={}}}}const Zi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class xy{constructor(e){this.parser=e,this.name=Zi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const l=t[n];l.extensions&&l.extensions[this.name]&&void 0!==l.extensions[this.name].light&&e._addNodeRef(this.cache,l.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const l=t.json,u=((l.extensions&&l.extensions[this.name]||{}).lights||[])[e];let f;const v=new we(16777215);void 0!==u.color&&v.fromArray(u.color);const b=void 0!==u.range?u.range:0;switch(u.type){case"directional":f=new of(v),f.target.position.set(0,0,-1),f.add(f.target);break;case"point":f=new Ao(v),f.distance=b;break;case"spot":f=new Jg(v),f.distance=b,u.spot=u.spot||{},u.spot.innerConeAngle=void 0!==u.spot.innerConeAngle?u.spot.innerConeAngle:0,u.spot.outerConeAngle=void 0!==u.spot.outerConeAngle?u.spot.outerConeAngle:Math.PI/4,f.angle=u.spot.outerConeAngle,f.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,f.target.position.set(0,0,-1),f.add(f.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return f.position.set(0,0,0),f.decay=2,void 0!==u.intensity&&(f.intensity=u.intensity),f.name=t.createUniqueName(u.name||"light_"+e),s=Promise.resolve(f),t.cache.add(n,s),s}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],l=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===l?null:this._loadLight(l).then(function(u){return n._getNodeRef(t.cache,l,u)})}}class i_{constructor(){this.name=Zi.KHR_MATERIALS_UNLIT}getMaterialType(){return Pr}extendParams(e,t,n){const s=[];e.color=new we(1,1,1),e.opacity=1;const l=t.pbrMetallicRoughness;if(l){if(Array.isArray(l.baseColorFactor)){const u=l.baseColorFactor;e.color.fromArray(u),e.opacity=u[3]}void 0!==l.baseColorTexture&&s.push(n.assignTexture(e,"map",l.baseColorTexture))}return Promise.all(s)}}class xu{constructor(e){this.parser=e,this.name=Zi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?vl:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];if(void 0!==u.clearcoatFactor&&(t.clearcoat=u.clearcoatFactor),void 0!==u.clearcoatTexture&&l.push(n.assignTexture(t,"clearcoatMap",u.clearcoatTexture)),void 0!==u.clearcoatRoughnessFactor&&(t.clearcoatRoughness=u.clearcoatRoughnessFactor),void 0!==u.clearcoatRoughnessTexture&&l.push(n.assignTexture(t,"clearcoatRoughnessMap",u.clearcoatRoughnessTexture)),void 0!==u.clearcoatNormalTexture&&(l.push(n.assignTexture(t,"clearcoatNormalMap",u.clearcoatNormalTexture)),void 0!==u.clearcoatNormalTexture.scale)){const f=u.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Mt(f,f)}return Promise.all(l)}}class by{constructor(e){this.parser=e,this.name=Zi.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?vl:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[];t.sheenColor=new we(0,0,0),t.sheenRoughness=0,t.sheen=1;const u=s.extensions[this.name];return void 0!==u.sheenColorFactor&&t.sheenColor.fromArray(u.sheenColorFactor),void 0!==u.sheenRoughnessFactor&&(t.sheenRoughness=u.sheenRoughnessFactor),void 0!==u.sheenColorTexture&&l.push(n.assignTexture(t,"sheenColorMap",u.sheenColorTexture)),void 0!==u.sheenRoughnessTexture&&l.push(n.assignTexture(t,"sheenRoughnessMap",u.sheenRoughnessTexture)),Promise.all(l)}}class wy{constructor(e){this.parser=e,this.name=Zi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?vl:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];return void 0!==u.transmissionFactor&&(t.transmission=u.transmissionFactor),void 0!==u.transmissionTexture&&l.push(n.assignTexture(t,"transmissionMap",u.transmissionTexture)),Promise.all(l)}}class n_{constructor(e){this.parser=e,this.name=Zi.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?vl:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];t.thickness=void 0!==u.thicknessFactor?u.thicknessFactor:0,void 0!==u.thicknessTexture&&l.push(n.assignTexture(t,"thicknessMap",u.thicknessTexture)),t.attenuationDistance=u.attenuationDistance||0;const f=u.attenuationColor||[1,1,1];return t.attenuationColor=new we(f[0],f[1],f[2]),Promise.all(l)}}class r_{constructor(e){this.parser=e,this.name=Zi.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?vl:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class My{constructor(e){this.parser=e,this.name=Zi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?vl:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];t.specularIntensity=void 0!==u.specularFactor?u.specularFactor:1,void 0!==u.specularTexture&&l.push(n.assignTexture(t,"specularIntensityMap",u.specularTexture));const f=u.specularColorFactor||[1,1,1];return t.specularColor=new we(f[0],f[1],f[2]),void 0!==u.specularColorTexture&&l.push(n.assignTexture(t,"specularColorMap",u.specularColorTexture).then(function(v){v.encoding=3001})),Promise.all(l)}}class Sy{constructor(e){this.parser=e,this.name=Zi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const l=s.extensions[this.name],u=t.options.ktx2Loader;if(!u){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,l.source,u)}}class ch{constructor(e){this.parser=e,this.name=Zi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,l=s.textures[e];if(!l.extensions||!l.extensions[t])return null;const f=s.images[l.extensions[t].source];let v=n.textureLoader;if(f.uri){const b=n.options.manager.getHandler(f.uri);null!==b&&(v=b)}return this.detectSupport().then(function(b){if(b)return n.loadTextureImage(e,f,v);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class sm{constructor(e){this.name=Zi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],l=this.parser.getDependency("buffer",s.buffer),u=this.parser.options.meshoptDecoder;if(!u||!u.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([l,u.ready]).then(function(f){const v=s.byteOffset||0,b=s.byteLength||0,S=s.count,C=s.byteStride,I=new ArrayBuffer(S*C),D=new Uint8Array(f[0],v,b);return u.decodeGltfBuffer(new Uint8Array(I),S,C,D,s.mode,s.filter),I})}return null}}const s_="glTF";class Bd{constructor(e){this.name=Zi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:cc.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==s_)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,s=new DataView(e,12);let l=0;for(;l<n;){const u=s.getUint32(l,!0);l+=4;const f=s.getUint32(l,!0);if(l+=4,1313821514===f){const v=new Uint8Array(e,12+l,u);this.content=cc.decodeText(v)}else if(5130562===f){const v=12+l;this.body=e.slice(v,v+u)}l+=u}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class o_{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Zi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,l=e.extensions[this.name].bufferView,u=e.extensions[this.name].attributes,f={},v={},b={};for(const S in u){const C=yf[S]||S.toLowerCase();f[C]=u[S]}for(const S in e.attributes){const C=yf[S]||S.toLowerCase();if(void 0!==u[S]){const I=n.accessors[e.attributes[S]];b[C]=Vd[I.componentType],v[C]=!0===I.normalized}}return t.getDependency("bufferView",l).then(function(S){return new Promise(function(C){s.decodeDracoFile(S,function(I){for(const D in I.attributes){const O=I.attributes[D],N=v[D];void 0!==N&&(O.normalized=N)}C(I)},f,b)})})}}class Fd{constructor(){this.name=Zi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class mf extends jn{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),l=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),f={specular:{value:(new we).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=f,this.onBeforeCompile=function(v){for(const b in f)v.uniforms[b]=f[b];v.fragmentShader=v.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",l).replace("#include <lights_physical_fragment>",u)},Object.defineProperties(this,{specular:{get:function(){return f.specular.value},set:function(v){f.specular.value=v}},specularMap:{get:function(){return f.specularMap.value},set:function(v){f.specularMap.value=v,v?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return f.glossiness.value},set:function(v){f.glossiness.value=v}},glossinessMap:{get:function(){return f.glossinessMap.value},set:function(v){f.glossinessMap.value=v,v?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Ey{constructor(){this.name=Zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return mf}extendParams(e,t,n){const s=t.extensions[this.name];e.color=new we(1,1,1),e.opacity=1;const l=[];if(Array.isArray(s.diffuseFactor)){const u=s.diffuseFactor;e.color.fromArray(u),e.opacity=u[3]}if(void 0!==s.diffuseTexture&&l.push(n.assignTexture(e,"map",s.diffuseTexture)),e.emissive=new we(0,0,0),e.glossiness=void 0!==s.glossinessFactor?s.glossinessFactor:1,e.specular=new we(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),void 0!==s.specularGlossinessTexture){const u=s.specularGlossinessTexture;l.push(n.assignTexture(e,"glossinessMap",u)),l.push(n.assignTexture(e,"specularMap",u))}return Promise.all(l)}createMaterial(e){const t=new mf(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=0,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class Ud{constructor(){this.name=Zi.KHR_MESH_QUANTIZATION}}class uc extends La{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,l=e*s*3+s;for(let u=0;u!==s;u++)t[u]=n[l+u];return t}}uc.prototype.beforeStart_=uc.prototype.copySampleValue_,uc.prototype.afterEnd_=uc.prototype.copySampleValue_,uc.prototype.interpolate_=function(h,e,t,n){const s=this.resultBuffer,l=this.sampleValues,u=this.valueSize,f=2*u,v=3*u,b=n-e,S=(t-e)/b,C=S*S,I=C*S,D=h*v,O=D-v,N=-2*I+3*C,j=I-C,U=1-N,Q=j-C+S;for(let Y=0;Y!==u;Y++)s[Y]=U*l[O+Y+u]+Q*(l[O+Y+f]*b)+N*l[D+Y+u]+j*(l[D+Y]*b);return s};const a_=new ui;class Cy extends uc{interpolate_(e,t,n,s){const l=super.interpolate_(e,t,n,s);return a_.fromArray(l).normalize().toArray(l),l}}const Vd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ff={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},gf={33071:1001,33648:1002,10497:1e3},_f={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yf={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},bu={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ry={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300};function Vs(h,e,t){for(const n in t.extensions)void 0===h[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Tl(h,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(h.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function om(h,e){if(h.updateMorphTargets(),void 0!==e.weights)for(let t=0,n=e.weights.length;t<n;t++)h.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(h.morphTargetInfluences.length===t.length){h.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)h.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function wu(h){const e=h.extensions&&h.extensions[Zi.KHR_DRACO_MESH_COMPRESSION];let t;return t=e?"draco:"+e.bufferView+":"+e.indices+":"+h_(e.attributes):h.indices+":"+h_(h.attributes)+":"+h.mode,t}function h_(h){let e="";const t=Object.keys(h).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+h[t[n]]+";";return e}function vf(h){switch(h){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Gd{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new vy,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={},this.textureLoader="undefined"!=typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?new Kg(this.options.manager):new Pd(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Sl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,l=this.extensions;this.cache.removeAll(),this._invokeAll(function(u){return u._markDefs&&u._markDefs()}),Promise.all(this._invokeAll(function(u){return u.beforeRoot&&u.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(u){const f={scene:u[0][s.scene||0],scenes:u[0],animations:u[1],cameras:u[2],asset:s.asset,parser:n,userData:{}};Vs(l,f,s),Tl(f,s),Promise.all(n._invokeAll(function(v){return v.afterRoot&&v.afterRoot(f)})).then(function(){e(f)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,l=t.length;s<l;s++){const u=t[s].joints;for(let f=0,v=u.length;f<v;f++)e[u[f]].isBone=!0}for(let s=0,l=e.length;s<l;s++){const u=e[s];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(n[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),l=(u,f)=>{const v=this.associations.get(u);null!=v&&this.associations.set(f,v);for(const[b,S]of u.children.entries())l(S,f.children[b])};return l(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const l=e(t[s]);l&&n.push(l)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this.loadNode(t);break;case"mesh":s=this._invokeOne(function(l){return l.loadMesh&&l.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(l){return l.loadBufferView&&l.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(l){return l.loadMaterial&&l.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(l){return l.loadTexture&&l.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this.loadAnimation(t);break;case"camera":s=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(l,u){return n.getDependency(e,u)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Zi.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(l,u){n.load(cc.resolveURL(t.uri,s.path),l,void 0,function(){u(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const l=t.byteOffset||0;return n.slice(l,l+(t.byteLength||0))})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse)return Promise.resolve(null);const l=[];return l.push(void 0!==s.bufferView?this.getDependency("bufferView",s.bufferView):null),void 0!==s.sparse&&(l.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),l.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(l).then(function(u){const f=u[0],v=_f[s.type],b=Vd[s.componentType],S=b.BYTES_PER_ELEMENT,I=s.byteOffset||0,D=void 0!==s.bufferView?n.bufferViews[s.bufferView].byteStride:void 0,O=!0===s.normalized;let N,j;if(D&&D!==S*v){const U=Math.floor(I/D),Q="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+U+":"+s.count;let Y=t.cache.get(Q);Y||(N=new b(f,U*D,s.count*D/S),Y=new ft(N,D/S),t.cache.add(Q,Y)),j=new je(Y,v,I%D/S,O)}else N=null===f?new b(s.count*v):new b(f,I,s.count*v),j=new un(N,v,O);if(void 0!==s.sparse){const Z=s.sparse.values.byteOffset||0,te=new(0,Vd[s.sparse.indices.componentType])(u[1],s.sparse.indices.byteOffset||0,s.sparse.count*_f.SCALAR),oe=new b(u[2],Z,s.sparse.count*v);null!==f&&(j=new un(j.array.slice(),j.itemSize,j.normalized));for(let de=0,Ce=te.length;de<Ce;de++){const Le=te[de];if(j.setX(Le,oe[de*v]),v>=2&&j.setY(Le,oe[de*v+1]),v>=3&&j.setZ(Le,oe[de*v+2]),v>=4&&j.setW(Le,oe[de*v+3]),v>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return j})}loadTexture(e){const t=this.json,s=t.textures[e].source,l=t.images[s];let u=this.textureLoader;if(l.uri){const f=this.options.manager.getHandler(l.uri);null!==f&&(u=f)}return this.loadTextureImage(e,s,u)}loadTextureImage(e,t,n){const s=this,l=this.json,u=l.textures[e],f=l.images[t],v=(f.uri||f.bufferView)+":"+u.sampler;if(this.textureCache[v])return this.textureCache[v];const b=this.loadImageSource(t,n).then(function(S){S.flipY=!1,u.name&&(S.name=u.name);const C=(l.samplers||{})[u.sampler]||{};return S.magFilter=ff[C.magFilter]||1006,S.minFilter=ff[C.minFilter]||1008,S.wrapS=gf[C.wrapS]||1e3,S.wrapT=gf[C.wrapT]||1e3,s.associations.set(S,{textures:e}),S}).catch(function(){return null});return this.textureCache[v]=b,b}loadImageSource(e,t){const s=this.json,l=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(function(C){return C.clone()}).catch(function(C){throw C});const u=s.images[e],f=self.URL||self.webkitURL;let v=u.uri||"",b=!1;if(void 0!==u.bufferView)v=this.getDependency("bufferView",u.bufferView).then(function(C){b=!0;const I=new Blob([C],{type:u.mimeType});return v=f.createObjectURL(I),v});else if(void 0===u.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const S=Promise.resolve(v).then(function(C){return new Promise(function(I,D){let O=I;!0===t.isImageBitmapLoader&&(O=function(N){const j=new Dt(N);j.needsUpdate=!0,I(j)}),t.load(cc.resolveURL(C,l.path),O,void 0,D)})}).then(function(C){var I;return!0===b&&f.revokeObjectURL(v),C.userData.mimeType=u.mimeType||((I=u.uri).search(/\.jpe?g($|\?)/i)>0||0===I.search(/^data\:image\/jpeg/)?"image/jpeg":I.search(/\.webp($|\?)/i)>0||0===I.search(/^data\:image\/webp/)?"image/webp":"image/png"),C}).catch(function(C){throw console.error("THREE.GLTFLoader: Couldn't load texture",v),C});return this.sourceCache[e]=S,S}assignTexture(e,t,n){const s=this;return this.getDependency("texture",n.index).then(function(l){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),s.extensions[Zi.KHR_TEXTURE_TRANSFORM]){const u=void 0!==n.extensions?n.extensions[Zi.KHR_TEXTURE_TRANSFORM]:void 0;if(u){const f=s.associations.get(l);l=s.extensions[Zi.KHR_TEXTURE_TRANSFORM].extendTexture(l,u),s.associations.set(l,f)}}return e[t]=l,l})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=void 0===t.attributes.tangent,l=void 0!==t.attributes.color,u=void 0===t.attributes.normal;if(e.isPoints){const f="PointsMaterial:"+n.uuid;let v=this.cache.get(f);v||(v=new Fp,Mn.prototype.copy.call(v,n),v.color.copy(n.color),v.map=n.map,v.sizeAttenuation=!1,this.cache.add(f,v)),n=v}else if(e.isLine){const f="LineBasicMaterial:"+n.uuid;let v=this.cache.get(f);v||(v=new es,Mn.prototype.copy.call(v,n),v.color.copy(n.color),this.cache.add(f,v)),n=v}if(s||l||u){let f="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(f+="specular-glossiness:"),s&&(f+="derivative-tangents:"),l&&(f+="vertex-colors:"),u&&(f+="flat-shading:");let v=this.cache.get(f);v||(v=n.clone(),l&&(v.vertexColors=!0),u&&(v.flatShading=!0),s&&(v.normalScale&&(v.normalScale.y*=-1),v.clearcoatNormalScale&&(v.clearcoatNormalScale.y*=-1)),this.cache.add(f,v),this.associations.set(v,this.associations.get(n))),n=v}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return jn}loadMaterial(e){const t=this,s=this.extensions,l=this.json.materials[e];let u;const f={},v=l.extensions||{},b=[];if(v[Zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const C=s[Zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];u=C.getMaterialType(),b.push(C.extendParams(f,l,t))}else if(v[Zi.KHR_MATERIALS_UNLIT]){const C=s[Zi.KHR_MATERIALS_UNLIT];u=C.getMaterialType(),b.push(C.extendParams(f,l,t))}else{const C=l.pbrMetallicRoughness||{};if(f.color=new we(1,1,1),f.opacity=1,Array.isArray(C.baseColorFactor)){const I=C.baseColorFactor;f.color.fromArray(I),f.opacity=I[3]}void 0!==C.baseColorTexture&&b.push(t.assignTexture(f,"map",C.baseColorTexture)),f.metalness=void 0!==C.metallicFactor?C.metallicFactor:1,f.roughness=void 0!==C.roughnessFactor?C.roughnessFactor:1,void 0!==C.metallicRoughnessTexture&&(b.push(t.assignTexture(f,"metalnessMap",C.metallicRoughnessTexture)),b.push(t.assignTexture(f,"roughnessMap",C.metallicRoughnessTexture))),u=this._invokeOne(function(I){return I.getMaterialType&&I.getMaterialType(e)}),b.push(Promise.all(this._invokeAll(function(I){return I.extendMaterialParams&&I.extendMaterialParams(e,f)})))}!0===l.doubleSided&&(f.side=2);const S=l.alphaMode||"OPAQUE";if("BLEND"===S?(f.transparent=!0,f.depthWrite=!1):(f.transparent=!1,"MASK"===S&&(f.alphaTest=void 0!==l.alphaCutoff?l.alphaCutoff:.5)),void 0!==l.normalTexture&&u!==Pr&&(b.push(t.assignTexture(f,"normalMap",l.normalTexture)),f.normalScale=new Mt(1,1),void 0!==l.normalTexture.scale)){const C=l.normalTexture.scale;f.normalScale.set(C,C)}return void 0!==l.occlusionTexture&&u!==Pr&&(b.push(t.assignTexture(f,"aoMap",l.occlusionTexture)),void 0!==l.occlusionTexture.strength&&(f.aoMapIntensity=l.occlusionTexture.strength)),void 0!==l.emissiveFactor&&u!==Pr&&(f.emissive=(new we).fromArray(l.emissiveFactor)),void 0!==l.emissiveTexture&&u!==Pr&&b.push(t.assignTexture(f,"emissiveMap",l.emissiveTexture)),Promise.all(b).then(function(){let C;return C=u===mf?s[Zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(f):new u(f),l.name&&(C.name=l.name),C.map&&(C.map.encoding=3001),C.emissiveMap&&(C.emissiveMap.encoding=3001),C.sheenColorMap&&(C.sheenColorMap.encoding=3001),C.specularColorMap&&(C.specularColorMap.encoding=3001),C.specularMap&&(C.specularMap.encoding=3001),Tl(C,l),t.associations.set(C,{materials:e}),l.extensions&&Vs(s,C,l),C})}createUniqueName(e){const t=$i.sanitizeNodeName(e||"");let n=t;for(let s=1;this.nodeNamesUsed[n];++s)n=t+"_"+s;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function l(f){return n[Zi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(f,t).then(function(v){return d_(v,f,t)})}const u=[];for(let f=0,v=e.length;f<v;f++){const b=e[f],S=wu(b),C=s[S];if(C)u.push(C.promise);else{let I;I=b.extensions&&b.extensions[Zi.KHR_DRACO_MESH_COMPRESSION]?l(b):d_(new an,b,t),s[S]={primitive:b,promise:I},u.push(I)}}return Promise.all(u)}loadMesh(e){const t=this,s=this.extensions,l=this.json.meshes[e],u=l.primitives,f=[];for(let v=0,b=u.length;v<b;v++){const S=void 0===u[v].material?(void 0===(h=this.cache).DefaultMaterial&&(h.DefaultMaterial=new jn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),h.DefaultMaterial):this.getDependency("material",u[v].material);f.push(S)}var h;return f.push(t.loadGeometries(u)),Promise.all(f).then(function(v){const b=v.slice(0,v.length-1),S=v[v.length-1],C=[];for(let D=0,O=S.length;D<O;D++){const N=S[D],j=u[D];let U;const Q=b[D];if(4===j.mode||5===j.mode||6===j.mode||void 0===j.mode)U=!0===l.isSkinnedMesh?new kn(N,Q):new di(N,Q),!0!==U.isSkinnedMesh||U.geometry.attributes.skinWeight.normalized||U.normalizeSkinWeights(),5===j.mode?U.geometry=xf(U.geometry,1):6===j.mode&&(U.geometry=xf(U.geometry,2));else if(1===j.mode)U=new bd(N,Q);else if(3===j.mode)U=new So(N,Q);else if(2===j.mode)U=new Og(N,Q);else{if(0!==j.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+j.mode);U=new Aa(N,Q)}Object.keys(U.geometry.morphAttributes).length>0&&om(U,l),U.name=t.createUniqueName(l.name||"mesh_"+e),Tl(U,l),j.extensions&&Vs(s,U,j),t.assignFinalMaterial(U),C.push(U)}for(let D=0,O=C.length;D<O;D++)t.associations.set(C[D],{meshes:e,primitives:D});if(1===C.length)return C[0];const I=new xe;t.associations.set(I,{meshes:e});for(let D=0,O=C.length;D<O;D++)I.add(C[D]);return I})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(s)return"perspective"===n.type?t=new bn(Ul.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===n.type&&(t=new It(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Tl(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(s){return n.inverseBindMatrices=s,n})}loadAnimation(e){const t=this.json.animations[e],n=[],s=[],l=[],u=[],f=[];for(let v=0,b=t.channels.length;v<b;v++){const S=t.channels[v],C=t.samplers[S.sampler],I=S.target,O=void 0!==t.parameters?t.parameters[C.input]:C.input,N=void 0!==t.parameters?t.parameters[C.output]:C.output;n.push(this.getDependency("node",void 0!==I.node?I.node:I.id)),s.push(this.getDependency("accessor",O)),l.push(this.getDependency("accessor",N)),u.push(C),f.push(I)}return Promise.all([Promise.all(n),Promise.all(s),Promise.all(l),Promise.all(u),Promise.all(f)]).then(function(v){const b=v[0],S=v[1],C=v[2],I=v[3],D=v[4],O=[];for(let j=0,U=b.length;j<U;j++){const Q=b[j],Y=S[j],Z=C[j],te=I[j],oe=D[j];if(void 0===Q)continue;let de;switch(Q.updateMatrix(),Q.matrixAutoUpdate=!0,bu[oe.path]){case bu.weights:de=sh;break;case bu.rotation:de=bl;break;default:de=wl}const Ce=Q.name?Q.name:Q.uuid,Le=void 0!==te.interpolation?Ry[te.interpolation]:2301,Oe=[];bu[oe.path]===bu.weights?Q.traverse(function(et){et.morphTargetInfluences&&Oe.push(et.name?et.name:et.uuid)}):Oe.push(Ce);let Ze=Z.array;if(Z.normalized){const et=vf(Ze.constructor),ot=new Float32Array(Ze.length);for(let Ve=0,at=Ze.length;Ve<at;Ve++)ot[Ve]=Ze[Ve]*et;Ze=ot}for(let et=0,ot=Oe.length;et<ot;et++){const Ve=new de(Oe[et]+"."+bu[oe.path],Y.array,Ze,Le);"CUBICSPLINE"===te.interpolation&&(Ve.createInterpolant=function(at){return new(this instanceof bl?Cy:uc)(this.times,this.values,this.getValueSize()/3,at)},Ve.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),O.push(Ve)}}return new Xp(t.name?t.name:"animation_"+e,void 0,O)})}createNodeMesh(e){const n=this,s=this.json.nodes[e];return void 0===s.mesh?null:n.getDependency("mesh",s.mesh).then(function(l){const u=n._getNodeRef(n.meshCache,s.mesh,l);return void 0!==s.weights&&u.traverse(function(f){if(f.isMesh)for(let v=0,b=s.weights.length;v<b;v++)f.morphTargetInfluences[v]=s.weights[v]}),u})}loadNode(e){const n=this.extensions,s=this,l=this.json.nodes[e],u=l.name?s.createUniqueName(l.name):"";return function(){const f=[],v=s._invokeOne(function(b){return b.createNodeMesh&&b.createNodeMesh(e)});return v&&f.push(v),void 0!==l.camera&&f.push(s.getDependency("camera",l.camera).then(function(b){return s._getNodeRef(s.cameraCache,l.camera,b)})),s._invokeAll(function(b){return b.createNodeAttachment&&b.createNodeAttachment(e)}).forEach(function(b){f.push(b)}),Promise.all(f)}().then(function(f){let v;if(v=!0===l.isBone?new kr:f.length>1?new xe:1===f.length?f[0]:new Ni,v!==f[0])for(let b=0,S=f.length;b<S;b++)v.add(f[b]);if(l.name&&(v.userData.name=l.name,v.name=u),Tl(v,l),l.extensions&&Vs(n,v,l),void 0!==l.matrix){const b=new ii;b.fromArray(l.matrix),v.applyMatrix4(b)}else void 0!==l.translation&&v.position.fromArray(l.translation),void 0!==l.rotation&&v.quaternion.fromArray(l.rotation),void 0!==l.scale&&v.scale.fromArray(l.scale);return s.associations.has(v)||s.associations.set(v,{}),s.associations.get(v).nodes=e,v})}loadScene(e){const t=this.json,n=this.extensions,s=this.json.scenes[e],l=this,u=new xe;s.name&&(u.name=l.createUniqueName(s.name)),Tl(u,s),s.extensions&&Vs(n,u,s);const f=s.nodes||[],v=[];for(let b=0,S=f.length;b<S;b++)v.push(u_(f[b],u,t,l));return Promise.all(v).then(function(){return l.associations=(b=>{const S=new Map;for(const[C,I]of l.associations)(C instanceof Mn||C instanceof Dt)&&S.set(C,I);return b.traverse(C=>{const I=l.associations.get(C);null!=I&&S.set(C,I)}),S})(u),u})}}function u_(h,e,t,n){const s=t.nodes[h];return n.getDependency("node",h).then(function(l){if(void 0===s.skin)return l;let u;return n.getDependency("skin",s.skin).then(function(f){u=f;const v=[];for(let b=0,S=u.joints.length;b<S;b++)v.push(n.getDependency("node",u.joints[b]));return Promise.all(v)}).then(function(f){return l.traverse(function(v){if(!v.isMesh)return;const b=[],S=[];for(let C=0,I=f.length;C<I;C++){const D=f[C];if(D){b.push(D);const O=new ii;void 0!==u.inverseBindMatrices&&O.fromArray(u.inverseBindMatrices.array,16*C),S.push(O)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',u.joints[C])}v.bind(new zr(b,S),v.matrixWorld)}),l})}).then(function(l){e.add(l);const u=[];if(s.children){const f=s.children;for(let v=0,b=f.length;v<b;v++)u.push(u_(f[v],l,t,n))}return Promise.all(u)})}function d_(h,e,t){const n=e.attributes,s=[];function l(u,f){return t.getDependency("accessor",u).then(function(v){h.setAttribute(f,v)})}for(const u in n){const f=yf[u]||u.toLowerCase();f in h.attributes||s.push(l(n[u],f))}if(void 0!==e.indices&&!h.index){const u=t.getDependency("accessor",e.indices).then(function(f){h.setIndex(f)});s.push(u)}return Tl(h,e),function(u,f,v){const b=f.attributes,S=new yt;if(void 0===b.POSITION)return;{const D=v.json.accessors[b.POSITION],O=D.min,N=D.max;if(void 0===O||void 0===N)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(S.set(new me(O[0],O[1],O[2]),new me(N[0],N[1],N[2])),D.normalized){const j=vf(Vd[D.componentType]);S.min.multiplyScalar(j),S.max.multiplyScalar(j)}}const C=f.targets;if(void 0!==C){const D=new me,O=new me;for(let N=0,j=C.length;N<j;N++){const U=C[N];if(void 0!==U.POSITION){const Q=v.json.accessors[U.POSITION],Y=Q.min,Z=Q.max;if(void 0!==Y&&void 0!==Z){if(O.setX(Math.max(Math.abs(Y[0]),Math.abs(Z[0]))),O.setY(Math.max(Math.abs(Y[1]),Math.abs(Z[1]))),O.setZ(Math.max(Math.abs(Y[2]),Math.abs(Z[2]))),Q.normalized){const te=vf(Vd[Q.componentType]);O.multiplyScalar(te)}D.max(O)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}S.expandByVector(D)}u.boundingBox=S;const I=new Ks;S.getCenter(I.center),I.radius=S.min.distanceTo(S.max)/2,u.boundingSphere=I}(h,e,t),Promise.all(s).then(function(){return void 0!==e.targets?function(u,f,v){let b=!1,S=!1,C=!1;for(let N=0,j=f.length;N<j;N++){const U=f[N];if(void 0!==U.POSITION&&(b=!0),void 0!==U.NORMAL&&(S=!0),void 0!==U.COLOR_0&&(C=!0),b&&S&&C)break}if(!b&&!S&&!C)return Promise.resolve(u);const I=[],D=[],O=[];for(let N=0,j=f.length;N<j;N++){const U=f[N];if(b){const Q=void 0!==U.POSITION?v.getDependency("accessor",U.POSITION):u.attributes.position;I.push(Q)}if(S){const Q=void 0!==U.NORMAL?v.getDependency("accessor",U.NORMAL):u.attributes.normal;D.push(Q)}if(C){const Q=void 0!==U.COLOR_0?v.getDependency("accessor",U.COLOR_0):u.attributes.color;O.push(Q)}}return Promise.all([Promise.all(I),Promise.all(D),Promise.all(O)]).then(function(N){const U=N[1],Q=N[2];return b&&(u.morphAttributes.position=N[0]),S&&(u.morphAttributes.normal=U),C&&(u.morphAttributes.color=Q),u.morphTargetsRelative=!0,u})}(h,e.targets,t):h})}function xf(h,e){let t=h.getIndex();if(null===t){const u=[],f=h.getAttribute("position");if(void 0===f)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),h;for(let v=0;v<f.count;v++)u.push(v);h.setIndex(u),t=h.getIndex()}const n=t.count-2,s=[];if(2===e)for(let u=1;u<=n;u++)s.push(t.getX(0)),s.push(t.getX(u)),s.push(t.getX(u+1));else for(let u=0;u<n;u++)u%2==0?(s.push(t.getX(u)),s.push(t.getX(u+1)),s.push(t.getX(u+2))):(s.push(t.getX(u+2)),s.push(t.getX(u+1)),s.push(t.getX(u)));s.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const l=h.clone();return l.setIndex(s),l}class p_{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:s,msg:l,transfer:u}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(l,u)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const s=this._getIdleWorker();-1!==s?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=n,this.workers[s].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const hh=new WeakMap;let Ji=0;class Po extends Br{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new p_,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new Sl(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new Sl(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const s=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([l,u])=>{const f=Po.BasisWorker.toString(),v=["/* constants */","let _EngineFormat = "+JSON.stringify(Po.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Po.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Po.BasisFormat),"/* basis_transcoder.js */",l,"/* worker */",f.substring(f.indexOf("{")+1,f.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([v])),this.transcoderBinary=u,this.workerPool.setWorkerCreator(()=>{const b=new Worker(this.workerSourceURL),S=this.transcoderBinary.slice(0);return b.postMessage({type:"init",config:this.workerConfig,transcoderBinary:S},[S]),b})}),Ji>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Ji++}return this.transcoderPending}load(e,t,n,s){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const l=new Sl(this.manager);l.setResponseType("arraybuffer"),l.setWithCredentials(this.withCredentials);const u=new Pa;return l.load(e,f=>{if(hh.has(f))return hh.get(f).promise.then(t).catch(s);this._createTexture([f]).then(function(v){u.copy(v),u.needsUpdate=!0,t&&t(u)}).catch(s)},n,s),u}_createTextureFrom(e){const{mipmaps:t,width:n,height:s,format:l,type:u,error:f,dfdTransferFn:v,dfdFlags:b}=e;if("error"===u)return Promise.reject(f);const S=new Pa(t,n,s,l,1009);return S.minFilter=1===t.length?1006:1008,S.magFilter=1006,S.generateMipmaps=!1,S.needsUpdate=!0,S.encoding=2===v?3001:3e3,S.premultiplyAlpha=!!(1&b),S}_createTexture(e,t={}){const n=t,s=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:n},e)).then(l=>this._createTextureFrom(l.data));return hh.set(e[0],{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Ji--,this}}var bf,wf;Po.BasisFormat={ETC1S:0,UASTC_4x4:1},Po.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Po.EngineFormat={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},Po.BasisWorker=function(){let h,e,t;const n=_EngineFormat,s=_TranscoderFormat,l=_BasisFormat;self.addEventListener("message",function(S){const C=S.data;switch(C.type){case"init":h=C.config,I=C.transcoderBinary,e=new Promise(D=>{t={wasmBinary:I,onRuntimeInitialized:D},BASIS(t)}).then(()=>{t.initializeBasis(),void 0===t.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{width:D,height:O,hasAlpha:N,mipmaps:j,format:U,dfdTransferFn:Q,dfdFlags:Y}=function(te){const oe=new t.KTX2File(new Uint8Array(te));function de(){oe.close(),oe.delete()}if(!oe.isValid())throw de(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const Ce=oe.isUASTC()?l.UASTC_4x4:l.ETC1S,Le=oe.getWidth(),Oe=oe.getHeight(),Ze=oe.getLevels(),et=oe.getHasAlpha(),ot=oe.getDFDTransferFunc(),Ve=oe.getDFDFlags(),{transcoderFormat:at,engineFormat:it}=function(pt,Ct,dt,ei){let Zt,Xt;const ni=pt===l.ETC1S?f:v;for(let Te=0;Te<ni.length;Te++){const ve=ni[Te];if(h[ve.if]&&ve.basisFormat.includes(pt)&&!(ei&&ve.transcoderFormat.length<2)&&(!ve.needsPowerOfTwo||b(Ct)&&b(dt)))return Zt=ve.transcoderFormat[ei?1:0],Xt=ve.engineFormat[ei?1:0],{transcoderFormat:Zt,engineFormat:Xt}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),Zt=s.RGBA32,Xt=n.RGBAFormat,{transcoderFormat:Zt,engineFormat:Xt}}(Ce,Le,Oe,et);if(!Le||!Oe||!Ze)throw de(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!oe.startTranscoding())throw de(),new Error("THREE.KTX2Loader: .startTranscoding failed");const wt=[];for(let pt=0;pt<Ze;pt++){const Ct=oe.getImageLevelInfo(pt,0,0),dt=Ct.origWidth,ei=Ct.origHeight,Zt=new Uint8Array(oe.getImageTranscodedSizeInBytes(pt,0,0,at));if(!oe.transcodeImage(Zt,pt,0,0,at,0,-1,-1))throw de(),new Error("THREE.KTX2Loader: .transcodeImage failed.");wt.push({data:Zt,width:dt,height:ei})}return de(),{width:Le,height:Oe,hasAlpha:et,mipmaps:wt,format:it,dfdTransferFn:ot,dfdFlags:Ve}}(C.buffers[0]),Z=[];for(let te=0;te<j.length;++te)Z.push(j[te].data.buffer);self.postMessage({type:"transcode",id:C.id,width:D,height:O,hasAlpha:N,mipmaps:j,format:U,dfdTransferFn:Q,dfdFlags:Y},Z)}catch(D){console.error(D),self.postMessage({type:"error",id:C.id,error:D.message})}})}var I});const u=[{if:"astcSupported",basisFormat:[l.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],f=u.sort(function(S,C){return S.priorityETC1S-C.priorityETC1S}),v=u.sort(function(S,C){return S.priorityUASTC-C.priorityUASTC});function b(S){return S<=2||0==(S&S-1)&&0!==S}};const fr=Symbol("retainerCount"),Gs=Symbol("recentlyUsed"),Hd=Symbol("evict"),jd=Symbol("evictionThreshold"),Mf=Symbol("cache");class Oy{constructor(e,t=5){this[bf]=new Map,this[wf]=[],this[Mf]=e,this[jd]=t}set evictionThreshold(e){this[jd]=e,this[Hd]()}get evictionThreshold(){return this[jd]}get cache(){return this[Mf]}retainerCount(e){return this[fr].get(e)||0}reset(){this[fr].clear(),this[Gs]=[]}retain(e){this[fr].has(e)||this[fr].set(e,0),this[fr].set(e,this[fr].get(e)+1);const t=this[Gs].indexOf(e);-1!==t&&this[Gs].splice(t,1),this[Gs].unshift(e),this[Hd]()}release(e){this[fr].has(e)&&this[fr].set(e,Math.max(this[fr].get(e)-1,0)),this[Hd]()}[(bf=fr,wf=Gs,Hd)](){if(!(this[Gs].length<this[jd]))for(let e=this[Gs].length-1;e>=this[jd];--e){const t=this[Gs][e];0===this[fr].get(t)&&(this[Mf].delete(t),this[Gs].splice(e,1))}}}const By=h=>{const e=new Map;for(const t of h.mappings)for(const n of t.variants)e.set(n,{material:null,gltfMaterialIndex:t.material});return e};class Fy{constructor(e){this.parser=e,this.name="KHR_materials_variants"}afterRoot(e){const t=this.parser,n=t.json;if(void 0===n.extensions||void 0===n.extensions[this.name])return null;const s=(l=>{const u=[],f=new Set;for(const v of l){let b=v,S=0;for(;f.has(b);)b=v+"."+ ++S;f.add(b),u.push(b)}return u})((n.extensions[this.name].variants||[]).map(l=>l.name));for(const l of e.scenes)l.traverse(u=>{const f=u;if(!f.isMesh)return;const v=t.associations.get(f);if(null==v||null==v.meshes||null==v.primitives)return;const b=n.meshes[v.meshes].primitives[v.primitives].extensions;b&&b[this.name]&&(f.userData.variantMaterials=By(b[this.name]))});return e.userData.variants=s,Promise.resolve()}}var m_,f_;const El=new Map,Sf=new Map;let Wd;const uh=new class extends Br{constructor(h){super(h),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(h){return this.decoderPath=h,this}setDecoderConfig(h){return this.decoderConfig=h,this}setWorkerLimit(h){return this.workerLimit=h,this}load(h,e,t,n){const s=new Sl(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(h,l=>{this.decodeGeometry(l,{attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1}).then(e).catch(n)},t,n)}decodeDracoFile(h,e,t,n){this.decodeGeometry(h,{attributeIDs:t||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!t}).then(e)}decodeGeometry(h,e){for(const f in e.attributeTypes){const v=e.attributeTypes[f];void 0!==v.BYTES_PER_ELEMENT&&(e.attributeTypes[f]=v.name)}const t=JSON.stringify(e);if(pf.has(h)){const f=pf.get(h);if(f.key===t)return f.promise;if(0===h.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,u=this._getWorker(s,h.byteLength).then(f=>(n=f,new Promise((v,b)=>{n._callbacks[s]={resolve:v,reject:b},n.postMessage({type:"decode",id:s,taskConfig:e,buffer:h},[h])}))).then(f=>this._createGeometry(f.geometry));return u.catch(()=>!0).then(()=>{n&&s&&this._releaseTask(n,s)}),pf.set(h,{key:t,promise:u}),u}_createGeometry(h){const e=new an;h.index&&e.setIndex(new un(h.index.array,1));for(let t=0;t<h.attributes.length;t++){const n=h.attributes[t];e.setAttribute(n.name,new un(n.array,n.itemSize))}return e}_loadLibrary(h,e){const t=new Sl(this.manager);return t.setPath(this.decoderPath),t.setResponseType(e),t.setWithCredentials(this.withCredentials),new Promise((n,s)=>{t.load(h,n,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const h="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return h?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(t=>{const n=t[0];h||(this.decoderConfig.wasmBinary=t[1]);const s=_y.toString(),l=["/* draco decoder */",n,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([l]))}),this.decoderPending}_getWorker(h,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(s){const l=s.data;switch(l.type){case"decode":n._callbacks[l.id].resolve(l);break;case"error":n._callbacks[l.id].reject(l);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+l.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,s){return n._taskLoad>s._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskCosts[h]=e,t._taskLoad+=e,t})}_releaseTask(h,e){h._taskLoad-=h._taskCosts[e],delete h._callbacks[e],delete h._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(h=>h._taskLoad))}dispose(){for(let h=0;h<this.workerPool.length;++h)this.workerPool[h].terminate();return this.workerPool.length=0,this}};let Tf;const Ef=new Po;let Cf,Af;const Cl=Symbol("loader"),ka=Symbol("evictionPolicy"),Pf=Symbol("GLTFInstance");class mn extends qr{constructor(e){super(),this[f_]=(new yy).register(t=>new Fy(t)),this[Pf]=e,this[Cl].setDRACOLoader(uh),this[Cl].setKTX2Loader(Ef)}static setDRACODecoderLocation(e){Wd=e,uh.setDecoderPath(e)}static getDRACODecoderLocation(){return Wd}static setKTX2TranscoderLocation(e){Tf=e,Ef.setTranscoderPath(e)}static getKTX2TranscoderLocation(){return Tf}static setMeshoptDecoderLocation(e){var t;Cf!==e&&(Cf=e,Af=(t=e,new Promise((n,s)=>{const l=document.createElement("script");document.body.appendChild(l),l.onload=n,l.onerror=s,l.async=!0,l.src=t})).then(()=>MeshoptDecoder.ready).then(()=>MeshoptDecoder))}static getMeshoptDecoderLocation(){return Cf}static initializeKTX2Loader(e){Ef.detectSupport(e)}static get cache(){return El}static clearCache(){El.forEach((e,t)=>{this.delete(t)}),this[ka].reset()}static has(e){return El.has(e)}static delete(e){var t=this;return(0,m.Z)(function*(){if(!t.has(e))return;const n=El.get(e);Sf.delete(e),El.delete(e),(yield n).dispose()})()}static hasFinishedLoading(e){return!!Sf.get(e)}get[(m_=ka,f_=Cl,ka)](){return this.constructor[ka]}preload(e,t,n=(()=>{})){var s=this;return(0,m.Z)(function*(){if(s[Cl].setWithCredentials(mn.withCredentials),s.dispatchEvent({type:"preload",element:t,src:e}),!El.has(e)){null!=Af&&s[Cl].setMeshoptDecoder(yield Af);const l=((v,b,S=(()=>{}))=>{const C=I=>{const D=I.loaded/I.total;S(Math.max(0,Math.min(1,isFinite(D)?D:1)))};return new Promise((I,D)=>{b.load(v,I,C,D)})})(e,s[Cl],v=>{n(.8*v)}),u=s[Pf],f=l.then(v=>u.prepare(v)).then(v=>(n(.9),new u(v))).catch(v=>(console.error(v),new u));El.set(e,f)}yield El.get(e),Sf.set(e,!0),n&&n(1)})()}load(e,t,n=(()=>{})){var s=this;return(0,m.Z)(function*(){yield s.preload(e,t,n);const l=yield El.get(e),u=yield l.clone();return s[ka].retain(e),u.dispose=(()=>{const f=u.dispose;let v=!1;return()=>{v||(v=!0,f.apply(u),s[ka].release(e))}})(),u})()}}mn[m_]=new Oy(mn);class Mu extends Ni{constructor(e=document.createElement("div")){super(),this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}Mu.prototype.isCSS2DObject=!0;const ro=new me,am=new ii,Zd=new ii,g_=new me,If=new me;class __{constructor(e={}){const t=this;let n,s,l,u;const f={objects:new WeakMap},v=void 0!==e.element?e.element:document.createElement("div");function b(C,I,D){if(C.isCSS2DObject){ro.setFromMatrixPosition(C.matrixWorld),ro.applyMatrix4(Zd);const O=!0===C.visible&&ro.z>=-1&&ro.z<=1&&!0===C.layers.test(D.layers);if(C.element.style.display=!0===O?"":"none",!0===O){C.onBeforeRender(t,I,D);const j=C.element;j.style.transform=/apple/i.test(navigator.vendor)?"translate(-50%,-50%) translate("+Math.round(ro.x*l+l)+"px,"+Math.round(-ro.y*u+u)+"px)":"translate(-50%,-50%) translate("+(ro.x*l+l)+"px,"+(-ro.y*u+u)+"px)",j.parentNode!==v&&v.appendChild(j),C.onAfterRender(t,I,D)}const N={distanceToCameraSquared:S(D,C)};f.objects.set(C,N)}for(let O=0,N=C.children.length;O<N;O++)b(C.children[O],I,D)}function S(C,I){return g_.setFromMatrixPosition(C.matrixWorld),If.setFromMatrixPosition(I.matrixWorld),g_.distanceToSquared(If)}v.style.overflow="hidden",this.domElement=v,this.getSize=function(){return{width:n,height:s}},this.render=function(C,I){!0===C.autoUpdate&&C.updateMatrixWorld(),null===I.parent&&I.updateMatrixWorld(),am.copy(I.matrixWorldInverse),Zd.multiplyMatrices(I.projectionMatrix,am),b(C,C,I),function(D){const O=function(j){const U=[];return j.traverse(function(Q){Q.isCSS2DObject&&U.push(Q)}),U}(D).sort(function(j,U){return j.renderOrder!==U.renderOrder?U.renderOrder-j.renderOrder:f.objects.get(j).distanceToCameraSquared-f.objects.get(U).distanceToCameraSquared}),N=O.length;for(let j=0,U=O.length;j<U;j++)O[j].element.style.zIndex=N-j}(C)},this.setSize=function(C,I){n=C,s=I,l=n/2,u=s/2,v.style.width=C+"px",v.style.height=I+"px"}}}const y_=h=>h&&"null"!==h?v_(h):null,Df=()=>{if(hf)return;const h=[];throw vu||h.push("WebXR Device API"),im||h.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${h.join(", ")}`)},v_=h=>new URL(h,window.location.toString()).toString(),lm=(h,e)=>{let t=null;return(...n)=>{null!=t&&self.clearTimeout(t),t=self.setTimeout(()=>{t=null,h(...n)},e)}},Al=(h,e,t)=>Math.max(e,Math.min(t,h)),cm=(()=>{const h=(()=>{var e;if(null===(e=document.documentElement.getAttribute("itemtype"))||void 0===e?void 0:e.includes("schema.org/SearchResultsPage"))return!0;const t=null!=document.head?Array.from(document.head.querySelectorAll("meta")):[];for(const n of t)if("viewport"===n.name)return!0;return!1})();return h||console.warn('No <meta name="viewport"> detected; <model-viewer> will cap pixel density at 1.'),()=>h?window.devicePixelRatio:1})(),x_=(()=>{const h=new RegExp("[?&]model-viewer-debug-mode(&|$)");return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(h)})(),Lf=(h=0)=>new Promise(e=>setTimeout(e,h));class rr{constructor(e=50){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,t,n,s){const l=2e-4*this.naturalFrequency;if(null==e||0===s||e===t&&0===this.velocity)return t;if(n<0)return e;const u=e-t,f=this.velocity+this.naturalFrequency*u,v=u+n*f,b=Math.exp(-this.naturalFrequency*n),S=(f-this.naturalFrequency*v)*b,C=-this.naturalFrequency*(S+f*b);return Math.abs(S)<l*Math.abs(s)&&C*u>=0?(this.velocity=0,t):(this.velocity=S,t+v*b)}}const Fr=(h,e)=>({type:"number",number:h,unit:e}),dc=(()=>{const h={};return e=>{const t=e;if(t in h)return h[t];const n=[];let s=0;for(;e;){if(++s>1e3){e="";break}const l=Rf(e),u=l.nodes[0];if(null==u||0===u.terms.length)break;n.push(u),e=l.remainingInput}return h[t]=n}})(),Rf=(()=>{const h=/^(\-\-|[a-z\u0240-\uffff])/i,e=/^([\*\+\/]|[\-]\s)/i,t=/^[\),]/;return n=>{const s=[];for(;n.length&&(n=n.trim(),!t.test(n));)if("("===n[0]){const{nodes:l,remainingInput:u}=kf(n);n=u,s.push({type:"function",name:{type:"ident",value:"calc"},arguments:l})}else if(h.test(n)){const l=b_(n),u=l.nodes[0];if("("===(n=l.remainingInput)[0]){const{nodes:f,remainingInput:v}=kf(n);s.push({type:"function",name:u,arguments:f}),n=v}else s.push(u)}else if(e.test(n))s.push({type:"operator",value:n[0]}),n=n.slice(1);else{const{nodes:l,remainingInput:u}="#"===n[0]?Ny(n):Uy(n);if(0===l.length)break;s.push(l[0]),n=u}return{nodes:[{type:"expression",terms:s}],remainingInput:n}}})(),b_=(()=>{const h=/[^a-z0-9_\-\u0240-\uffff]/i;return e=>{const t=e.match(h);return{nodes:[{type:"ident",value:null==t?e:e.substr(0,t.index)}],remainingInput:null==t?"":e.substr(t.index)}}})(),Uy=(()=>{const h=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,e=/^[a-z%]+/i,t=/^(m|mm|cm|rad|deg|[%])$/;return n=>{const s=n.match(h),l=null==s?"0":s[0],u=(n=null==l?n:n.slice(l.length)).match(e);let f=null!=u&&""!==u[0]?u[0]:null;const v=null==u?n:n.slice(f.length);return null==f||t.test(f)||(f=null),{nodes:[{type:"number",number:parseFloat(l)||0,unit:f}],remainingInput:v}}})(),Ny=(()=>{const h=/^[a-f0-9]*/i;return e=>{const t=(e=e.slice(1).trim()).match(h);return{nodes:null==t?[]:[{type:"hex",value:t[0]}],remainingInput:null==t?e:e.slice(t[0].length)}}})(),kf=h=>{const e=[];for(h=h.slice(1).trim();h.length;){const t=Rf(h);if(e.push(t.nodes[0]),","===(h=t.remainingInput.trim())[0])h=h.slice(1).trim();else if(")"===h[0]){h=h.slice(1);break}}return{nodes:e,remainingInput:h}},zf=Symbol("visitedTypes");class qd{constructor(e){this[zf]=e}walk(e,t){const n=e.slice();for(;n.length;){const s=n.shift();switch(this[zf].indexOf(s.type)>-1&&t(s),s.type){case"expression":n.unshift(...s.terms);break;case"function":n.unshift(s.name,...s.arguments)}}}}const Pl=Object.freeze({type:"number",number:0,unit:null}),$d=(h,e=0)=>{let{number:t,unit:n}=h;if(isFinite(t)){if("rad"===h.unit||null==h.unit)return h}else t=e,n="rad";return{type:"number",number:("deg"===n&&null!=t?t:0)*Math.PI/180,unit:"rad"}},hm=(h,e=0)=>{let t,{number:n,unit:s}=h;if(isFinite(n)){if("m"===h.unit)return h}else n=e,s="m";switch(s){default:t=1;break;case"cm":t=.01;break;case"mm":t=.001}return{type:"number",number:t*n,unit:"m"}},vs=(()=>{const h=t=>t,e={rad:h,deg:$d,m:h,mm:hm,cm:hm};return(t,n=Pl)=>{isFinite(t.number)||(t.number=n.number,t.unit=n.unit);const{unit:s}=t;if(null==s)return t;const l=e[s];return null==l?n:l(t)}})();class Of extends Mu{constructor(e){super(document.createElement("div")),this.normal=new me(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=e.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(e.position),this.updateNormal(e.normal)}get facingCamera(){return!this.element.classList.contains("hide")}show(){this.facingCamera&&this.initialized||this.updateVisibility(!0)}hide(){!this.facingCamera&&this.initialized||this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,0===this.referenceCount}updatePosition(e){if(null==e)return;const t=dc(e)[0].terms;for(let n=0;n<3;++n)this.position.setComponent(n,vs(t[n]).number);this.updateMatrixWorld()}updateNormal(e){if(null==e)return;const t=dc(e)[0].terms;for(let n=0;n<3;++n)this.normal.setComponent(n,vs(t[n]).number)}orient(e){this.pivot.style.transform=`rotate(${e}rad)`}updateVisibility(e){e?this.element.classList.remove("hide"):this.element.classList.add("hide"),this.slot.assignedNodes().forEach(t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const n=t,s=n.dataset.visibilityAttribute;if(null!=s){const l=`data-${s}`;e?n.setAttribute(l,""):n.removeAttribute(l)}n.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))}),this.initialized=!0}}const dh=(h,e,t)=>{let n=t;const s=new me;return h.traverseVisible(l=>{let u,f;l.updateWorldMatrix(!1,!1);const v=l.geometry;if(void 0!==v)if(v.isGeometry){const b=v.vertices;for(u=0,f=b.length;u<f;u++)s.copy(b[u]),l.isSkinnedMesh?l.boneTransform(u,s):s.applyMatrix4(l.matrixWorld),n=e(n,s)}else if(v.isBufferGeometry){const{position:b}=v.attributes;if(void 0!==b){const S=(C=>{if(!C.normalized)return 1;const I=C.array;return I instanceof Int8Array?.007874015748031496:I instanceof Uint8Array?.00392156862745098:I instanceof Int16Array?3051850947599719e-20:I instanceof Uint16Array?15259021896696422e-21:1})(b);for(u=0,f=b.count;u<f;u++)s.fromBufferAttribute(b,u),s.multiplyScalar(S),l.isSkinnedMesh?l.boneTransform(u,s):s.applyMatrix4(l.matrixWorld),n=e(n,s)}}}),n},w_={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},um={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},dm=[];for(let h=0;h<256;h++)dm[h]=(h<16?"0":"")+h.toString(16);function M_(h,e,t){return(1-t)*h+t*e}class Vy extends Ni{constructor(e,t,n){super(),this.camera=new It,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new J,this.horizontalBlurMaterial=new xr(w_),this.verticalBlurMaterial=new xr(um),this.intensity=0,this.softness=1,this.boundingBox=new yt,this.size=new me,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:s}=this;s.rotation.x=Math.PI/2,s.left=-.5,s.right=.5,s.bottom=-.5,s.top=.5,this.add(s);const l=new Xo,u=new Pr({opacity:1,transparent:!0,side:1});this.floor=new di(l,u),this.floor.userData.shadow=!0,s.add(this.floor),this.blurPlane=new di(l),this.blurPlane.visible=!1,s.add(this.blurPlane),e.target.add(this),this.depthMaterial.onBeforeCompile=function(f){f.fragmentShader=f.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(e,t,n)}setScene(e,t,n){const{boundingBox:s,size:l,rotation:u,position:f}=this;if(this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),this.maxDimension=Math.max(l.x,l.y,l.z)*(this.isAnimated?2:1),this.boundingBox.getCenter(f),"back"===n){const{min:v,max:b}=s;[v.y,v.z]=[v.z,v.y],[b.y,b.z]=[b.z,b.y],[l.y,l.z]=[l.z,l.y],u.x=Math.PI/2,u.y=Math.PI}else u.x=0,u.y=0;if(this.isAnimated){const v=s.min.y,b=s.max.y;l.y=this.maxDimension,s.expandByVector(l.subScalar(this.maxDimension).multiplyScalar(-.5)),s.min.y=v,s.max.y=b,l.set(this.maxDimension,b-v,this.maxDimension)}"bottom"===n?f.y=s.min.y:f.z=s.min.y,this.setSoftness(t)}setSoftness(e){this.softness=e;const{size:t,camera:n}=this,s=this.isAnimated?2:1,l=s*Math.pow(2,9-3*e);this.setMapSize(l);const u=t.y/2,f=t.y*s;n.near=0,n.far=M_(f,u,e),this.depthMaterial.opacity=1/e,n.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(e){const{size:t}=this;this.isAnimated&&(e*=2);const n=Math.floor(t.x>t.z?e:e*t.x/t.z),s=Math.floor(t.x>t.z?e*t.z/t.x:e),l=10+n,u=10+s;if(null==this.renderTarget||this.renderTarget.width===l&&this.renderTarget.height===u||(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),null==this.renderTarget){const f={format:1023};this.renderTarget=new Fe(l,u,f),this.renderTargetBlur=new Fe(l,u,f),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(t.x*(1+10/n),t.z*(1+10/s),1),this.needsUpdate=!0}setIntensity(e){this.intensity=e,e>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=e*M_(.3,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(e){this.floor.position.z=.001*this.maxDimension-e}render(e,t){t.overrideMaterial=this.depthMaterial;const n=e.getClearAlpha();e.setClearAlpha(0),this.floor.visible=!1;const s=e.xr.enabled;e.xr.enabled=!1;const l=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.render(t,this.camera),t.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(e),e.xr.enabled=s,e.setRenderTarget(l),e.setClearAlpha(n)}blurShadow(e){const{camera:t,horizontalBlurMaterial:n,verticalBlurMaterial:s,renderTarget:l,renderTargetBlur:u,blurPlane:f}=this;f.visible=!0,f.material=n,n.uniforms.h.value=1/this.renderTarget.width,n.uniforms.tDiffuse.value=this.renderTarget.texture,e.setRenderTarget(u),e.render(f,t),f.material=s,s.uniforms.v.value=1/this.renderTarget.height,s.uniforms.tDiffuse.value=this.renderTargetBlur.texture,e.setRenderTarget(l),e.render(f,t),f.visible=!1}}const Bf=new me,S_=new me,T_=new me,Su=new class{constructor(h,e,t=0,n=1/0){this.ray=new Dn(h,e),this.near=t,this.far=n,this.camera=null,this.layers=new Lc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(h,e){this.ray.set(h,e)}setFromCamera(h,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(h.x,h.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(h.x,h.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(h,e=!0,t=[]){return lf(h,this,t,e),t.sort(lh),t}intersectObjects(h,e=!0,t=[]){for(let n=0,s=h.length;n<s;n++)lf(h[n],this,t,e);return t.sort(lh),t}},pm=new me,Xd=new Mt;class E_ extends mt{constructor({canvas:e,element:t,width:n,height:s}){super(),this.context=null,this.annotationRenderer=new __,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.renderCount=0,this.externalRenderer=null,this.camera=new bn(45,1,.1,100),this.xrCamera=null,this.url=null,this.target=new Ni,this.modelContainer=new Ni,this.animationNames=[],this.boundingBox=new yt,this.boundingSphere=new Ks,this.size=new me,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=Array(),this.exposure=1,this.canScale=!0,this.tightBounds=!1,this.isDirty=!1,this.goalTarget=new me,this.targetDamperX=new rr,this.targetDamperY=new rr,this.targetDamperZ=new rr,this._currentGLTF=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.name="ModelScene",this.element=t,this.canvas=e,this.camera=new bn(45,1,.1,100),this.camera.name="MainCamera",this.add(this.target),this.setSize(n,s),this.target.name="Target",this.modelContainer.name="ModelContainer",this.target.add(this.modelContainer),this.mixer=new e_(this.modelContainer);const{domElement:l}=this.annotationRenderer,{style:u}=l;u.display="none",u.pointerEvents="none",u.position="absolute",u.top="0",this.element.shadowRoot.querySelector(".default").appendChild(l),this.schemaElement.setAttribute("type","application/ld+json")}createContext(){this.context=this.canvas.getContext("2d")}getCamera(){return null!=this.xrCamera?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}setObject(e){var t=this;return(0,m.Z)(function*(){t.reset(),t.modelContainer.add(e),yield t.setupScene()})()}setSource(e,t=(()=>{})){var n=this;return(0,m.Z)(function*(){if(!e||e===n.url)return void t(1);if(n.reset(),n.url=e,null!=n.externalRenderer){const v=yield n.externalRenderer.load(t);return n.boundingSphere.radius=v.framedRadius,n.idealAspect=v.fieldOfViewAspect,void n.dispatchEvent({type:"model-load",url:n.url})}let s;null!=n.cancelPendingSourceChange&&(n.cancelPendingSourceChange(),n.cancelPendingSourceChange=null);try{s=yield new Promise(function(){var v=(0,m.Z)(function*(b,S){n.cancelPendingSourceChange=()=>S();try{b(yield n.element[Vi].loader.load(e,n.element,t))}catch(C){S(C)}});return function(b,S){return v.apply(this,arguments)}}())}catch(v){if(null==v)return;throw v}n.reset(),n.url=e,n._currentGLTF=s,null!=s&&n.modelContainer.add(s.scene);const{animations:l}=s,u=new Map,f=[];for(const v of l)u.set(v.name,v),f.push(v.name);n.animations=l,n.animationsByName=u,n.animationNames=f,yield n.setupScene()})()}setupScene(){var e=this;return(0,m.Z)(function*(){e.updateBoundingBox(),yield e.updateFraming(),e.updateShadow(),e.setShadowIntensity(e.shadowIntensity),e.dispatchEvent({type:"model-load",url:e.url})})()}reset(){this.url=null,this.queueRender(),null!=this.shadow&&this.shadow.setIntensity(0);const e=this._currentGLTF;if(null!=e){for(const t of this.modelContainer.children)this.modelContainer.remove(t);e.dispose(),this._currentGLTF=null}null!=this.currentAnimationAction&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}get currentGLTF(){return this._currentGLTF}setSize(e,t){if(this.width!==e||this.height!==t){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,null!=this.externalRenderer){const n=cm();this.externalRenderer.resize(e*n,t*n)}this.queueRender()}}findBakedShadows(e){const t=new yt;e.traverse(n=>{const s=n;if(!s.isMesh)return;const l=s.material;if(!l.isMeshBasicMaterial||!l.transparent)return;t.setFromObject(s);const u=t.getSize(pm),f=Math.min(u.x,u.y,u.z);Math.max(u.x,u.y,u.z)<100*f||(this.bakedShadows.push(s),s.userData.shadow=!0)})}updateBoundingBox(){if(this.target.remove(this.modelContainer),this.findBakedShadows(this.modelContainer),!0===this.tightBounds){const e=(t,n)=>t.expandByPoint(n);this.setBakedShadowVisibility(!1),this.boundingBox=dh(this.modelContainer,e,new yt),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows=[],this.boundingBox=dh(this.modelContainer,e,new yt)),this.setBakedShadowVisibility()}else this.boundingBox.setFromObject(this.modelContainer);this.boundingBox.getSize(this.size),this.target.add(this.modelContainer)}updateFraming(){var e=this;return(0,m.Z)(function*(){e.target.remove(e.modelContainer),e.setBakedShadowVisibility(!1);const{center:t}=e.boundingSphere;!0===e.tightBounds?(yield e.element.requestUpdate("cameraTarget"),t.copy(e.getTarget())):e.boundingBox.getCenter(t),e.boundingSphere.radius=Math.sqrt(dh(e.modelContainer,(n,s)=>Math.max(n,t.distanceToSquared(s)),0)),e.idealAspect=dh(e.modelContainer,(n,s)=>{s.sub(t);const l=Math.sqrt(s.x*s.x+s.z*s.z);return Math.max(n,l/(e.idealCameraDistance()-Math.abs(s.y)))},0)/Math.tan(e.framedFoVDeg/2*Math.PI/180),e.setBakedShadowVisibility(),e.target.add(e.modelContainer)})()}setBakedShadowVisibility(e=this.shadowIntensity<=0){for(const t of this.bakedShadows)t.visible=e}idealCameraDistance(){const e=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(e)}adjustedFoV(e){const t=Math.tan(e/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(t)*180/Math.PI}getNDC(e,t){if(null!=this.xrCamera)Xd.set(e/window.screen.width,t/window.screen.height);else{const n=this.element.getBoundingClientRect();Xd.set((e-n.x)/this.width,(t-n.y)/this.height)}return Xd.multiplyScalar(2).subScalar(1),Xd.y*=-1,Xd}getSize(){return{width:this.width,height:this.height}}setTarget(e,t,n){this.goalTarget.set(-e,-t,-n)}setTargetDamperDecayTime(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}getTarget(){return pm.copy(this.goalTarget).multiplyScalar(-1)}jumpToGoal(){this.updateTarget(1e4)}updateTarget(e){const t=this.goalTarget,n=this.target.position;if(!t.equals(n)){const s=this.boundingSphere.radius/10;let{x:l,y:u,z:f}=n;l=this.targetDamperX.update(l,t.x,e,s),u=this.targetDamperY.update(u,t.y,e,s),f=this.targetDamperZ.update(f,t.z,e,s),this.target.position.set(l,u,f),this.target.updateMatrixWorld(),this.queueRender()}}pointTowards(e,t){const{x:n,z:s}=this.position;this.yaw=Math.atan2(e-n,t-s)}set yaw(e){this.rotation.y=e,this.queueRender()}get yaw(){return this.rotation.y}set animationTime(e){this.mixer.setTime(e),this.queueShadowRender()}get animationTime(){if(null!=this.currentAnimationAction){const e=Math.max(this.currentAnimationAction._loopCount,0);return 2202===this.currentAnimationAction.loop&&1==(1&e)?this.duration-this.currentAnimationAction.time:this.currentAnimationAction.time}return 0}set animationTimeScale(e){this.mixer.timeScale=e}get animationTimeScale(){return this.mixer.timeScale}get duration(){return null!=this.currentAnimationAction&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return null!=this.currentAnimationAction}playAnimation(e=null,t=0,n=2201,s=1/0){if(null==this._currentGLTF)return;const{animations:l}=this;if(null==l||0===l.length)return void console.warn("Cannot play animation (model does not have any animations)");let u=null;if(null!=e&&(u=this.animationsByName.get(e),null==u)){const f=parseInt(e);!isNaN(f)&&f>=0&&f<l.length&&(u=l[f])}null==u&&(u=l[0]);try{const{currentAnimationAction:f}=this,v=this.mixer.clipAction(u,this);this.currentAnimationAction=v,this.element.paused?this.mixer.stopAllAction():(v.paused=!1,null!=f&&v!==f?v.crossFadeFrom(f,t,!1):this.animationTimeScale>0&&(this.animationTime=0)),v.setLoop(n,s),v.enabled=!0,v.clampWhenFinished=!0,v.play()}catch(f){console.error(f)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(e){this.mixer.update(e),this.queueShadowRender()}subscribeMixerEvent(e,t){this.mixer.addEventListener(e,t)}updateShadow(){const e=this.shadow;null!=e&&(e.setScene(this,this.shadowSoftness,"wall"===this.element.arPlacement?"back":"bottom"),e.needsUpdate=!0)}renderShadow(e){const t=this.shadow;null!=t&&1==t.needsUpdate&&(t.render(e,this),t.needsUpdate=!1)}queueShadowRender(){null!=this.shadow&&(this.shadow.needsUpdate=!0)}setShadowIntensity(e){this.shadowIntensity=e,null==this._currentGLTF||(this.setBakedShadowVisibility(),e<=0&&null==this.shadow)||(null==this.shadow&&(this.shadow=new Vy(this,this.shadowSoftness,"wall"===this.element.arPlacement?"back":"bottom")),this.shadow.setIntensity(e))}setShadowSoftness(e){this.shadowSoftness=e;const t=this.shadow;null!=t&&t.setSoftness(e)}setShadowOffset(e){const t=this.shadow;null!=t&&t.setOffset(e)}get raycaster(){return Su}positionAndNormalFromPoint(e,t=this){this.raycaster.setFromCamera(e,this.getCamera());const n=this.raycaster.intersectObject(t,!0).find(s=>!s.object.userData.shadow);return null==n||null==n.face?null:null==n.uv?{position:n.point,normal:n.face.normal,uv:null}:(n.face.normal.applyNormalMatrix((new se).getNormalMatrix(n.object.matrixWorld)),{position:n.point,normal:n.face.normal,uv:n.uv})}addHotspot(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element)}removeHotspot(e){this.target.remove(e)}forHotspots(e){const{children:t}=this.target;for(let n=0,s=t.length;n<s;n++){const l=t[n];l instanceof Of&&e(l)}}updateHotspots(e){this.forHotspots(t=>{Bf.copy(e),S_.setFromMatrixPosition(t.matrixWorld),Bf.sub(S_),T_.copy(t.normal).transformDirection(this.target.matrixWorld),Bf.dot(T_)<0?t.hide():t.show()})}orientHotspots(e){this.forHotspots(t=>{t.orient(e)})}setHotspotsVisibility(e){this.forHotspots(t=>{t.visible=e})}updateSchema(e){var t;const{schemaElement:n,element:s}=this,{alt:l,poster:u,iosSrc:f}=s;if(null!=e){const v=[{"@type":"MediaObject",contentUrl:e,encodingFormat:"gltf"===(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())?"model/gltf+json":"model/gltf-binary"}];f&&v.push({"@type":"MediaObject",contentUrl:f,encodingFormat:"model/vnd.usdz+zip"}),n.textContent=JSON.stringify({"@context":"http://schema.org/","@type":"3DModel",image:null!=u?u:void 0,name:null!=l?l:void 0,encoding:v}),document.head.appendChild(n)}else null!=n.parentElement&&n.parentElement.removeChild(n)}}var Yd=function(h,e,t,n){for(var s,l=arguments.length,u=l<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n,f=h.length-1;f>=0;f--)(s=h[f])&&(u=(l<3?s(u):l>3?s(e,t,u):s(e,t))||u);return l>3&&u&&Object.defineProperty(e,t,u),u};const ph=Symbol("currentEnvironmentMap"),mm=Symbol("applyEnvironmentMap"),oa=Symbol("updateEnvironment"),Tu=Symbol("cancelEnvironmentUpdate"),fm=Symbol("onPreload");class gm{constructor(e,t,n,s,l){this.xrLight=e,this.renderer=t,this.lightProbe=n,this.xrWebGLBinding=null,this.estimationStartCallback=l,this.frameCallback=this.onXRFrame.bind(this);const u=t.xr.getSession();if(s&&"XRWebGLBinding"in window){const f=new $o(16);e.environment=f.texture;const v=t.getContext();switch(u.preferredReflectionFormat){case"srgba8":v.getExtension("EXT_sRGB");break;case"rgba16f":v.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(u,v),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}u.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const n=t.getLightEstimate(this.lightProbe);if(n){this.xrLight.lightProbe.sh.fromArray(n.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const s=Math.max(1,Math.max(n.primaryLightIntensity.x,Math.max(n.primaryLightIntensity.y,n.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(n.primaryLightIntensity.x/s,n.primaryLightIntensity.y/s,n.primaryLightIntensity.z/s),this.xrLight.directionalLight.intensity=s,this.xrLight.directionalLight.position.copy(n.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class Ff extends xe{constructor(e,t=!0){super(),this.lightProbe=new em,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new of,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let n=null,s=!1;e.xr.addEventListener("sessionstart",()=>{const l=e.xr.getSession();"requestLightProbe"in l&&l.requestLightProbe({reflectionFormat:l.preferredReflectionFormat}).then(u=>{n=new gm(this,e,u,t,()=>{s=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{n&&(n.dispose(),n=null),s&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{n&&(n.dispose(),n=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}const Gy=Math.PI/24,C_=new Mt,_m=(h,e,t)=>{let n=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let s=0;s<=12;++s)h.push(e+.17*Math.cos(n),t+.17*Math.sin(n),0,e+.2*Math.cos(n),t+.2*Math.sin(n),0),n+=Gy};class Jd extends di{constructor(e,t){const n=new an,s=[],l=[],{size:u,boundingBox:f}=e,v=u.x/2,b=("back"===t?u.y:u.z)/2;_m(l,v,b),_m(l,-v,b),_m(l,-v,-b),_m(l,v,-b);const S=l.length/3;for(let D=0;D<S-2;D+=2)s.push(D,D+1,D+3,D,D+3,D+2);const C=S-2;s.push(C,C+1,1,C,1,0),n.setAttribute("position",new vn(l,3)),n.setIndex(s),super(n),this.side=t;const I=this.material;switch(I.side=0,I.transparent=!0,I.opacity=0,this.goalOpacity=0,this.opacityDamper=new rr,this.hitPlane=new di(new Xo(2*(v+.2),2*(b+.2))),this.hitPlane.visible=!1,this.add(this.hitPlane),f.getCenter(this.position),t){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=f.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=f.min.z,this.position.z=this.shadowHeight}e.target.add(this),this.offsetHeight=0}getHit(e,t,n){C_.set(t,-n),this.hitPlane.visible=!0;const s=e.positionAndNormalFromPoint(C_,this.hitPlane);return this.hitPlane.visible=!1,null==s?null:s.position}getExpandedHit(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);const s=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),s}set offsetHeight(e){e-=.001,"back"===this.side?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return"back"===this.side?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.goalOpacity=e?.75:0}updateOpacity(e){const t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:n}=this.hitPlane;t.dispose(),n.dispose(),this.geometry.dispose(),this.material.dispose(),null===(e=this.parent)||void 0===e||e.remove(this)}}const Eu="not-presenting",A_="session-started",Il="tracking",Cu=new me,P_=new ii,ym=new me,jy=new bn(45,1,.1,100);class Wy extends qr{constructor(e){super(),this.renderer=e,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.oldBackground=null,this.oldEnvironment=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new me,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new me,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new me,this.goalYaw=0,this.goalScale=1,this.xDamper=new rr,this.yDamper=new rr,this.zDamper=new rr,this.yawDamper=new rr,this.scaleDamper=new rr,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onUpdateScene=()=>{null!=this.placementBox&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new Jd(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=t=>{const n=this.transientHitTestSource;if(null==n)return;const s=this.frame.getHitTestResultsForTransientInput(n),l=this.presentedScene,u=this.placementBox;if(1===s.length){this.inputSource=t.inputSource;const{axes:f}=this.inputSource.gamepad,v=u.getHit(this.presentedScene,f[0],f[1]);u.show=!0,null!=v?(this.isTranslating=!0,this.lastDragPosition.copy(v)):!1===this.placeOnWall&&(this.isRotating=!0,this.lastAngle=1.5*f[0])}else if(2===s.length){u.show=!0,this.isTwoFingering=!0;const{separation:f}=this.fingerPolar(s);this.firstRatio=f/l.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=e.threeRenderer,this.threeRenderer.xr.enabled=!0}resolveARSession(){var e=this;return(0,m.Z)(function*(){Df();const t=yield navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:{root:e.overlay}});return e.threeRenderer.xr.setReferenceSpaceType("local"),yield e.threeRenderer.xr.setSession(t),e.threeRenderer.xr.cameraAutoUpdate=!1,t})()}get presentedScene(){return this._presentedScene}supportsPresentation(){return(0,m.Z)(function*(){try{return Df(),yield navigator.xr.isSessionSupported("immersive-ar")}catch(e){return console.warn("Request to present in WebXR denied:"),console.warn(e),console.warn("Falling back to next ar-mode"),!1}})()}present(e,t=!1){var n=this;return(0,m.Z)(function*(){n.isPresenting&&console.warn("Cannot present while a model is already presenting");let s=new Promise((S,C)=>{requestAnimationFrame(()=>S())});e.setHotspotsVisibility(!1),e.queueRender(),yield s,n._presentedScene=e,n.overlay=e.element.shadowRoot.querySelector("div.default"),!0===t&&(n.xrLight=new Ff(n.threeRenderer),n.xrLight.addEventListener("estimationstart",()=>{if(!n.isPresenting||null==n.xrLight)return;const S=n.presentedScene;S.add(n.xrLight),n.oldEnvironment=S.environment,S.environment=n.xrLight.environment}));const l=yield n.resolveARSession();l.addEventListener("end",()=>{n.postSessionCleanup()},{once:!0});const u=e.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");u.classList.add("enabled"),u.addEventListener("click",n.onExitWebXRButtonContainerClick),n.exitWebXRButtonContainer=u;const f=yield l.requestReferenceSpace("viewer");n.tracking=!0,n.frames=0,n.initialized=!1,n.turntableRotation=e.yaw,n.goalYaw=e.yaw,n.goalScale=1,n.oldBackground=e.background,e.background=null,n.oldShadowIntensity=e.shadowIntensity,e.setShadowIntensity(.01),n.oldTarget.copy(e.getTarget()),e.addEventListener("model-load",n.onUpdateScene);const v=20*Math.PI/180,b=!0===n.placeOnWall?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(v),z:-Math.cos(v)});l.requestHitTestSource({space:f,offsetRay:b}).then(S=>{n.initialHitSource=S}),n.currentSession=l,n.placementBox=new Jd(e,n.placeOnWall?"back":"bottom"),n.placementComplete=!1,n.lastTick=performance.now(),n.dispatchEvent({type:"status",status:A_})})()}stopPresenting(){var e=this;return(0,m.Z)(function*(){if(!e.isPresenting)return;const t=new Promise(n=>{e.resolveCleanup=n});try{yield e.currentSession.end(),yield t}catch(n){console.warn("Error while trying to end WebXR AR session"),console.warn(n),e.postSessionCleanup()}})()}get isPresenting(){return null!=this.presentedScene}get target(){return this.oldTarget}updateTarget(){const e=this.presentedScene;if(null!=e){const t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}postSessionCleanup(){const e=this.currentSession;null!=e&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const t=this.presentedScene;if(null!=t){const{element:u}=t;null!=this.xrLight&&(t.remove(this.xrLight),null!=this.oldEnvironment&&(t.environment=this.oldEnvironment,this.oldEnvironment=null),this.xrLight.dispose(),this.xrLight=null),t.position.set(0,0,0),t.scale.set(1,1,1),t.setShadowOffset(0);const f=this.turntableRotation;null!=f&&(t.yaw=f);const v=this.oldShadowIntensity;null!=v&&t.setShadowIntensity(v);const b=this.oldBackground;null!=b&&(t.background=b);const S=this.oldTarget;t.setTarget(S.x,S.y,S.z),t.xrCamera=null,t.removeEventListener("model-load",this.onUpdateScene),t.orientHotspots(0),u.requestUpdate("cameraTarget"),u.requestUpdate("maxCameraOrbit"),u[fh](u.getBoundingClientRect())}this.renderer.height=0;const n=this.exitWebXRButtonContainer;null!=n&&(n.classList.remove("enabled"),n.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const s=this.transientHitTestSource;null!=s&&(s.cancel(),this.transientHitTestSource=null);const l=this.initialHitSource;null!=l&&(l.cancel(),this.initialHitSource=null),null!=this.placementBox&&(this.placementBox.dispose(),this.placementBox=null),this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.oldBackground=null,this._presentedScene=null,this.frame=null,this.inputSource=null,this.overlay=null,null!=this.resolveCleanup&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:Eu})}updateView(e){const t=this.presentedScene,n=this.threeRenderer.xr;n.updateCamera(jy),t.xrCamera=n.getCamera();const{elements:s}=t.getCamera().matrixWorld;t.orientHotspots(Math.atan2(s[1],s[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale&&e.requestViewportScale(Math.max(e.recommendedViewportScale,.25));const l=this.currentSession.renderState.baseLayer.getViewport(e);this.threeRenderer.setViewport(l.x,l.y,l.width,l.height)}placeInitially(){const e=this.presentedScene,{position:t,element:n}=e,s=e.getCamera(),{width:l,height:u}=this.overlay.getBoundingClientRect();e.setSize(l,u),s.projectionMatrixInverse.copy(s.projectionMatrix).invert();const{theta:f,radius:v}=n.getCameraOrbit(),b=s.getWorldDirection(Cu);e.yaw=Math.atan2(-b.x,-b.z)-f,this.goalYaw=e.yaw,t.copy(s.position).add(b.multiplyScalar(v)),this.updateTarget();const S=e.getTarget();t.add(S).sub(this.oldTarget),this.goalPosition.copy(t),e.setHotspotsVisibility(!0);const{session:C}=this.frame;C.addEventListener("selectstart",this.onSelectStart),C.addEventListener("selectend",this.onSelectEnd),C.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then(I=>{this.transientHitTestSource=I})}getTouchLocation(){const{axes:e}=this.inputSource.gamepad;let t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return null!=t&&(Cu.copy(t).sub(this.presentedScene.getCamera().position),Cu.length()>10)?null:t}getHitPoint(e){const t=this.threeRenderer.xr.getReferenceSpace(),n=e.getPose(t);if(null==n)return null;const s=P_.fromArray(n.transform.matrix);return!0===this.placeOnWall&&(this.goalYaw=Math.atan2(s.elements[4],s.elements[6])),s.elements[5]>.75!==this.placeOnWall?ym.setFromMatrixPosition(s):null}moveToFloor(e){const t=this.initialHitSource;if(null==t)return;const n=e.getHitTestResults(t);if(0==n.length)return;const l=this.getHitPoint(n[0]);null!=l&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(l):this.goalPosition.y=l.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:"object-placed"}))}fingerPolar(e){const t=e[0].inputSource.gamepad.axes,n=e[1].inputSource.gamepad.axes,s=n[0]-t[0],l=n[1]-t[1],u=Math.atan2(l,s);let f=this.lastAngle-u;return f>Math.PI?f-=2*Math.PI:f<-Math.PI&&(f+=2*Math.PI),this.lastAngle=u,{separation:Math.sqrt(s*s+l*l),deltaYaw:f}}processInput(e){const t=this.transientHitTestSource;if(null==t||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const n=e.getHitTestResultsForTransientInput(t),s=this.presentedScene,l=s.scale.x;if(this.isTwoFingering)if(n.length<2)this.isTwoFingering=!1;else{const{separation:u,deltaYaw:f}=this.fingerPolar(n);if(!1===this.placeOnWall&&(this.goalYaw+=f),s.canScale){const v=u/this.firstRatio;this.goalScale=v<1.3&&v>.7692307692307692?1:v}}else if(2!==n.length)if(this.isRotating){const u=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=u-this.lastAngle,this.lastAngle=u}else this.isTranslating&&n.forEach(u=>{if(u.inputSource!==this.inputSource)return;let f=null;if(u.results.length>0&&(f=this.getHitPoint(u.results[0])),null==f&&(f=this.getTouchLocation()),null!=f){if(this.goalPosition.sub(this.lastDragPosition),!1===this.placeOnWall){const v=f.y-this.lastDragPosition.y;if(v<0){this.placementBox.offsetHeight=v/l,this.presentedScene.setShadowOffset(v);const b=Cu.copy(s.getCamera().position),S=-v/(b.y-f.y);b.multiplyScalar(S),f.multiplyScalar(1-S).add(b)}}this.goalPosition.add(f),this.lastDragPosition.copy(f)}});else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:u}=this.fingerPolar(n);this.firstRatio=u/l}}moveScene(e){const t=this.presentedScene,{position:n,yaw:s}=t,l=t.boundingSphere.radius,u=this.goalPosition,f=t.scale.x,v=this.placementBox;if(!u.equals(n)||this.goalScale!==f){let{x:b,y:S,z:C}=n;b=this.xDamper.update(b,u.x,e,l),S=this.yDamper.update(S,u.y,e,l),C=this.zDamper.update(C,u.z,e,l),n.set(b,S,C);const I=this.scaleDamper.update(f,this.goalScale,e,1);if(t.scale.set(I,I,I),!this.isTranslating){const D=u.y-S;this.placementComplete&&!1===this.placeOnWall?(v.offsetHeight=D/I,t.setShadowOffset(D)):0===D&&(this.placementComplete=!0,v.show=!1,t.setShadowIntensity(.8))}}v.updateOpacity(e),t.updateTarget(e),t.yaw=this.yawDamper.update(s,this.goalYaw,e,Math.PI)}onWebXRFrame(e,t){this.frame=t,++this.frames;const n=this.threeRenderer.xr.getReferenceSpace(),s=t.getViewerPose(n);null==s&&!0===this.tracking&&this.frames>30&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:"not-tracking"}));const l=this.presentedScene;if(null==s||null==l||!l.element[vc]())return void this.threeRenderer.clear();!1===this.tracking&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:Il}));let u=!0;for(const f of s.views){if(this.updateView(f),u){this.moveToFloor(t),this.processInput(t);const v=e-this.lastTick;this.moveScene(v),this.renderer.preRender(l,e,v),this.lastTick=e,l.renderShadow(this.threeRenderer)}this.threeRenderer.render(l,l.getCamera()),u=!1}}}class Zy{constructor(e){e.threeRenderer.debug={checkShaderErrors:!0},Promise.resolve().then(()=>{self.dispatchEvent(new CustomEvent("model-viewer-renderer-debug",{detail:{renderer:e,THREE:{ShaderMaterial:xr,Texture:Dt,Mesh:di,Scene:mt,PlaneBufferGeometry:Xo,OrthographicCamera:It,WebGLRenderTarget:Fe}}}))})}addScene(e){self.dispatchEvent(new CustomEvent("model-viewer-scene-added-debug",{detail:{scene:e}}))}removeScene(e){self.dispatchEvent(new CustomEvent("model-viewer-scene-removed-debug",{detail:{scene:e}}))}}function qy(h){const e=new Map,t=new Map,n=h.clone();return vm(h,n,function(s,l){e.set(l,s),t.set(s,l)}),n.traverse(function(s){if(!s.isSkinnedMesh)return;const l=s,u=e.get(s),f=u.skeleton.bones;l.skeleton=u.skeleton.clone(),l.bindMatrix.copy(u.bindMatrix),l.skeleton.bones=f.map(function(v){return t.get(v)}),l.bind(l.skeleton,l.bindMatrix)}),n}function vm(h,e,t){t(h,e);for(let n=0;n<h.children.length;n++)vm(h.children[n],e.children[n],t)}const I_=Symbol("prepared"),pc=Symbol("prepare"),Io=Symbol("preparedGLTF"),xm=Symbol("clone");class $y{constructor(e){this[Io]=e}static prepare(e){if(null==e.scene)throw new Error("Model does not have a scene");if(e[I_])return e;const t=this[pc](e);return t[I_]=!0,t}static[pc](e){const{scene:t}=e,n=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:n})}get parser(){return this[Io].parser}get animations(){return this[Io].animations}get scene(){return this[Io].scene}get scenes(){return this[Io].scenes}get cameras(){return this[Io].cameras}get asset(){return this[Io].asset}get userData(){return this[Io].userData}clone(){return new this.constructor(this[xm]())}dispose(){this.scenes.forEach(e=>{e.traverse(t=>{if(!t.isMesh)return;const n=t;(Array.isArray(n.material)?n.material:[n.material]).forEach(s=>{for(const l in s){const u=s[l];u instanceof Dt&&u.dispose()}s.dispose()}),n.geometry.dispose()})})}[xm](){const e=this[Io],t=qy(this.scene);D_(t,this.scene);const n=[t],s=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:n,userData:s})}}const D_=(h,e)=>{L_(h,e,(t,n)=>{void 0!==n.userData.variantMaterials&&(t.userData.variantMaterials=new Map(n.userData.variantMaterials)),void 0!==n.userData.variantData&&(t.userData.variantData=n.userData.variantData),void 0!==n.userData.originalMaterial&&(t.userData.originalMaterial=n.userData.originalMaterial)})},L_=(h,e,t)=>{t(h,e);for(let n=0;n<h.children.length;n++)L_(h.children[n],e.children[n],t)},R_=Symbol("threeGLTF"),k_=Symbol("gltf"),Vf=Symbol("gltfElementMap"),Gf=Symbol("threeObjectMap"),Au=Symbol("parallelTraverseThreeScene"),mh=Symbol("correlateOriginalThreeGLTF"),xs=Symbol("correlateCloneThreeGLTF");class Mr{constructor(e,t,n,s){this[R_]=e,this[k_]=t,this[Vf]=s,this[Gf]=n}static from(e,t){return null!=t?this[xs](e,t):this[mh](e)}static[mh](e){const t=e.parser.json,n=e.parser.associations,s=new Map,l={name:"Default"},u={type:"materials",index:-1};for(const f of n.keys())f instanceof Mn&&null==n.get(f)&&(u.index<0&&(null==t.materials&&(t.materials=[]),u.index=t.materials.length,t.materials.push(l)),f.name=l.name,n.set(f,{materials:u.index}));for(const[f,v]of n){if(v){const b=f;b.userData=b.userData||{},b.userData.associations=v}for(const b in v)if(null!=b&&"primitives"!==b){const C=(t[b]||[])[v[b]];if(null==C)continue;let I=s.get(C);null==I&&(I=new Set,s.set(C,I)),I.add(f)}}return new Mr(e,t,n,s)}static[xs](e,t){const n=t.threeGLTF,l=JSON.parse(JSON.stringify(t.gltf)),u=new Map,f=new Map;for(let v=0;v<n.scenes.length;v++)this[Au](n.scenes[v],e.scenes[v],(b,S)=>{const C=t.threeObjectMap.get(b);if(null!=C)for(const I in C)if(null!=I&&"primitives"!==I){const D=I,O=C[D],N=l[D][O],j=u.get(S)||{};j[D]=O,u.set(S,j);const U=f.get(N)||new Set;U.add(S),f.set(N,U)}});return new Mr(e,l,u,f)}static[Au](e,t,n){const s=(l,u)=>{if(n(l,u),l.isObject3D){if(l.isMesh)if(Array.isArray(l.material))for(let f=0;f<l.material.length;++f)s(l.material[f],u.material[f]);else s(l.material,u.material);for(let f=0;f<l.children.length;++f)s(l.children[f],u.children[f])}};s(e,t)}get threeGLTF(){return this[R_]}get gltf(){return this[k_]}get gltfElementMap(){return this[Vf]}get threeObjectMap(){return this[Gf]}}const bm=Symbol("correlatedSceneGraph");class Xy extends $y{static[pc](e){const t=super[pc](e);null==t[bm]&&(t[bm]=Mr.from(t));const{scene:n}=t,s=new Ks(void 0,1/0);return n.traverse(l=>{l.renderOrder=1e3,l.frustumCulled=!1,l.name||(l.name=l.uuid);const u=l;if(u.isMesh){u.castShadow=!0,u.isSkinnedMesh&&(u.geometry.boundingSphere=s,u.geometry.boundingBox=null);const f=u.material;!0===f.isMeshBasicMaterial&&(f.toneMapped=!1),f.shadowSide=0}}),t}get correlatedSceneGraph(){return this[Io][bm]}[xm](){const e=super[xm](),t=new Map;return e.scene.traverse(n=>{if(n.isMesh){const s=n,l=s.material;if(null!=l){if(t.has(l.uuid))return void(s.material=t.get(l.uuid));s.material=l.clone(),t.set(l.uuid,s.material)}}}),e[bm]=Mr.from(e,this.correlatedSceneGraph),e}}class Hf extends mt{constructor(){super(),this.position.y=-3.5;const e=new _o;e.deleteAttribute("uv");const t=new jn({metalness:0,side:1}),n=new jn({metalness:0}),s=new Ao(16777215,500,28,2);s.position.set(.418,16.199,.3),this.add(s);const l=new di(e,t);l.position.set(-.757,13.219,.717),l.scale.set(31.713,28.305,28.591),this.add(l);const u=new di(e,n);u.position.set(-10.906,2.009,1.846),u.rotation.set(0,-.195,0),u.scale.set(2.328,7.905,4.651),this.add(u);const f=new di(e,n);f.position.set(-5.607,-.754,-.758),f.rotation.set(0,.994,0),f.scale.set(1.97,1.534,3.955),this.add(f);const v=new di(e,n);v.position.set(6.167,.857,7.803),v.rotation.set(0,.561,0),v.scale.set(3.927,6.285,3.687),this.add(v);const b=new di(e,n);b.position.set(-2.017,.018,6.124),b.rotation.set(0,.333,0),b.scale.set(2.002,4.566,2.064),this.add(b);const S=new di(e,n);S.position.set(2.291,-.756,-2.621),S.rotation.set(0,-.286,0),S.scale.set(1.546,1.552,1.496),this.add(S);const C=new di(e,n);C.position.set(-2.193,-.369,-5.547),C.rotation.set(0,.516,0),C.scale.set(3.875,3.487,2.986),this.add(C);const I=new di(e,this.createAreaLightMaterial(50));I.position.set(-16.116,14.37,8.208),I.scale.set(.1,2.428,2.739),this.add(I);const D=new di(e,this.createAreaLightMaterial(50));D.position.set(-16.109,18.021,-8.207),D.scale.set(.1,2.425,2.751),this.add(D);const O=new di(e,this.createAreaLightMaterial(17));O.position.set(14.904,12.198,-1.832),O.scale.set(.15,4.265,6.331),this.add(O);const N=new di(e,this.createAreaLightMaterial(43));N.position.set(-.462,8.89,14.52),N.scale.set(4.38,5.441,.088),this.add(N);const j=new di(e,this.createAreaLightMaterial(20));j.position.set(3.235,11.486,-12.541),j.scale.set(2.5,2,.1),this.add(j);const U=new di(e,this.createAreaLightMaterial(100));U.position.set(0,20,0),U.scale.set(1,.1,1),this.add(U)}createAreaLightMaterial(e){const t=new Pr;return t.color.setScalar(e),t}}class Kd extends mt{constructor(){super(),this.position.y=-3.5;const e=new _o;e.deleteAttribute("uv");const t=new jn({metalness:0,side:1}),n=new jn({metalness:0}),s=new Ao(16777215,400,28,2);s.position.set(.5,14,.5),this.add(s);const l=new di(e,t);l.position.set(0,13.2,0),l.scale.set(31.5,28.5,31.5),this.add(l);const u=new di(e,n);u.position.set(-10.906,-1,1.846),u.rotation.set(0,-.195,0),u.scale.set(2.328,7.905,4.651),this.add(u);const f=new di(e,n);f.position.set(-5.607,-.754,-.758),f.rotation.set(0,.994,0),f.scale.set(1.97,1.534,3.955),this.add(f);const v=new di(e,n);v.position.set(6.167,-.16,7.803),v.rotation.set(0,.561,0),v.scale.set(3.927,6.285,3.687),this.add(v);const b=new di(e,n);b.position.set(-2.017,.018,6.124),b.rotation.set(0,.333,0),b.scale.set(2.002,4.566,2.064),this.add(b);const S=new di(e,n);S.position.set(2.291,-.756,-2.621),S.rotation.set(0,-.286,0),S.scale.set(1.546,1.552,1.496),this.add(S);const C=new di(e,n);C.position.set(-2.193,-.369,-5.547),C.rotation.set(0,.516,0),C.scale.set(3.875,3.487,2.986),this.add(C);const I=new di(e,this.createAreaLightMaterial(80));I.position.set(-14,10,8),I.scale.set(.1,2.5,2.5),this.add(I);const D=new di(e,this.createAreaLightMaterial(80));D.position.set(-14,14,-4),D.scale.set(.1,2.5,2.5),this.add(D);const O=new di(e,this.createAreaLightMaterial(23));O.position.set(14,12,0),O.scale.set(.1,5,5),this.add(O);const N=new di(e,this.createAreaLightMaterial(16));N.position.set(0,9,14),N.scale.set(5,5,.1),this.add(N);const j=new di(e,this.createAreaLightMaterial(80));j.position.set(7,8,-14),j.scale.set(2.5,2.5,.1),this.add(j);const U=new di(e,this.createAreaLightMaterial(80));U.position.set(-7,16,-14),U.scale.set(2.5,2.5,.1),this.add(U);const Q=new di(e,this.createAreaLightMaterial(1));Q.position.set(0,20,0),Q.scale.set(.1,.1,.1),this.add(Q)}createAreaLightMaterial(e){const t=new Pr;return t.color.setScalar(e),t}}const Yy=/\.hdr(\.js)?$/,jf=new Pd,Wf=new class extends $g{constructor(h){super(h),this.type=1016}parse(h){const e=function(f,v){switch(f){case 1:console.error("THREE.RGBELoader Read Error: "+(v||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(v||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(v||""));break;default:console.error("THREE.RGBELoader: Error: "+(v||""))}return-1},t=function(f,v,b){v=v||1024;let S=f.pos,C=-1,I=0,D="",O=String.fromCharCode.apply(null,new Uint16Array(f.subarray(S,S+128)));for(;0>(C=O.indexOf("\n"))&&I<v&&S<f.byteLength;)D+=O,I+=O.length,S+=128,O+=String.fromCharCode.apply(null,new Uint16Array(f.subarray(S,S+128)));return-1<C&&(!1!==b&&(f.pos+=I+C+1),D+O.slice(0,C))},n=function(f,v,b,S){const I=Math.pow(2,f[v+3]-128)/255;b[S+0]=f[v+0]*I,b[S+1]=f[v+1]*I,b[S+2]=f[v+2]*I,b[S+3]=1},s=function(f,v,b,S){const I=Math.pow(2,f[v+3]-128)/255;b[S+0]=Rd.toHalfFloat(Math.min(f[v+0]*I,65504)),b[S+1]=Rd.toHalfFloat(Math.min(f[v+1]*I,65504)),b[S+2]=Rd.toHalfFloat(Math.min(f[v+2]*I,65504)),b[S+3]=Rd.toHalfFloat(1)},l=new Uint8Array(h);l.pos=0;const u=function(f){const v=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,b=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,S=/^\s*FORMAT=(\S+)\s*$/,C=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,I={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let D,O;if(f.pos>=f.byteLength||!(D=t(f)))return e(1,"no header found");if(!(O=D.match(/^#\?(\S+)/)))return e(3,"bad initial token");for(I.valid|=1,I.programtype=O[1],I.string+=D+"\n";D=t(f),!1!==D;)if(I.string+=D+"\n","#"!==D.charAt(0)){if((O=D.match(v))&&(I.gamma=parseFloat(O[1])),(O=D.match(b))&&(I.exposure=parseFloat(O[1])),(O=D.match(S))&&(I.valid|=2,I.format=O[1]),(O=D.match(C))&&(I.valid|=4,I.height=parseInt(O[1],10),I.width=parseInt(O[2],10)),2&I.valid&&4&I.valid)break}else I.comments+=D+"\n";return 2&I.valid?4&I.valid?I:e(3,"missing image size specifier"):e(3,"missing format specifier")}(l);if(-1!==u){const f=u.width,v=u.height,b=function(S,C,I){const D=C;if(D<8||D>32767||2!==S[0]||2!==S[1]||128&S[2])return new Uint8Array(S);if(D!==(S[2]<<8|S[3]))return e(3,"wrong scanline width");const O=new Uint8Array(4*C*I);if(!O.length)return e(4,"unable to allocate buffer space");let N=0,j=0;const U=4*D,Q=new Uint8Array(4),Y=new Uint8Array(U);let Z=I;for(;Z>0&&j<S.byteLength;){if(j+4>S.byteLength)return e(1);if(Q[0]=S[j++],Q[1]=S[j++],Q[2]=S[j++],Q[3]=S[j++],2!=Q[0]||2!=Q[1]||(Q[2]<<8|Q[3])!=D)return e(3,"bad rgbe scanline format");let te,oe=0;for(;oe<U&&j<S.byteLength;){te=S[j++];const Ce=te>128;if(Ce&&(te-=128),0===te||oe+te>U)return e(3,"bad scanline data");if(Ce){const Le=S[j++];for(let Oe=0;Oe<te;Oe++)Y[oe++]=Le}else Y.set(S.subarray(j,j+te),oe),oe+=te,j+=te}const de=D;for(let Ce=0;Ce<de;Ce++){let Le=0;O[N]=Y[Ce+Le],Le+=D,O[N+1]=Y[Ce+Le],Le+=D,O[N+2]=Y[Ce+Le],Le+=D,O[N+3]=Y[Ce+Le],N+=4}Z--}return O}(l.subarray(l.pos),f,v);if(-1!==b){let S,C,I,D;switch(this.type){case 1015:D=b.length/4;const O=new Float32Array(4*D);for(let j=0;j<D;j++)n(b,4*j,O,4*j);S=O,I=1015;break;case 1016:D=b.length/4;const N=new Uint16Array(4*D);for(let j=0;j<D;j++)s(b,4*j,N,4*j);S=N,I=1016;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:f,height:v,data:S,header:u.string,gamma:u.gamma,exposure:u.exposure,format:C,type:I}}}return null}setDataType(h){return this.type=h,this}load(h,e,t,n){return super.load(h,function(s,l){switch(s.type){case 1015:case 1016:s.encoding=3e3,s.minFilter=1006,s.magFilter=1006,s.generateMipmaps=!1,s.flipY=!0}e&&e(s,l)},t,n)}};Wf.setDataType(1016);class za extends qr{constructor(e){super(),this.threeRenderer=e,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}load(e,t=(()=>{})){return(0,m.Z)(function*(){try{const n=Yy.test(e),s=n?Wf:jf,l=yield new Promise((u,f)=>s.load(e,u,v=>{t(v.loaded/v.total*.9)},f));return t(1),l.name=e,l.mapping=303,n||(l.encoding=3001),l}finally{t&&t(1)}})()}generateEnvironmentMapAndSkybox(e=null,t=null,n={}){var s=this;return(0,m.Z)(function*(){const{progressTracker:l}=n,u="neutral"===t;!0===u&&(t=null),t=y_(t);let f,v=Promise.resolve(null);e&&(v=s.loadEquirectFromUrl(e,l)),f=t?s.loadEquirectFromUrl(t,l):e?s.loadEquirectFromUrl(e,l):!0===u?s.loadGeneratedEnvironmentMapAlt():s.loadGeneratedEnvironmentMap();let[b,S]=yield Promise.all([f,v]);if(null==b)throw new Error("Failed to load environment map.");return{environmentMap:b,skybox:S}})()}loadEquirectFromUrl(e,t){var n=this;return(0,m.Z)(function*(){if(!n.skyboxCache.has(e)){const s=t?t.beginActivity():()=>{},l=n.load(e,s);n.skyboxCache.set(e,l)}return n.skyboxCache.get(e)})()}GenerateEnvironmentMap(e,t){var n=this;return(0,m.Z)(function*(){yield Lf();const s=n.threeRenderer,l=new $o(256,{generateMipmaps:!1,type:1016,format:1023,encoding:3e3,depthBuffer:!0}),u=new al(.1,100,l),f=u.renderTarget.texture;f.name=t;const v=s.outputEncoding,b=s.toneMapping;return s.toneMapping=0,s.outputEncoding=3e3,u.update(s,e),n.blurCubemap(l,.04),s.toneMapping=b,s.outputEncoding=v,f})()}loadGeneratedEnvironmentMap(){var e=this;return(0,m.Z)(function*(){return null==e.generatedEnvironmentMap&&(e.generatedEnvironmentMap=e.GenerateEnvironmentMap(new Hf,"default")),e.generatedEnvironmentMap})()}loadGeneratedEnvironmentMapAlt(){var e=this;return(0,m.Z)(function*(){return null==e.generatedEnvironmentMapAlt&&(e.generatedEnvironmentMapAlt=e.GenerateEnvironmentMap(new Kd,"neutral")),e.generatedEnvironmentMapAlt})()}blurCubemap(e,t){if(null==this.blurMaterial){this.blurMaterial=this.getBlurShader(20);const s=new _o,l=new di(s,this.blurMaterial);this.blurScene=new mt,this.blurScene.add(l)}const n=e.clone();this.halfblur(e,n,t,"latitudinal"),this.halfblur(n,e,t,"longitudinal")}halfblur(e,t,n,s){const l=e.width,u=isFinite(n)?Math.PI/(2*l):2*Math.PI/39,f=n/u,v=isFinite(n)?1+Math.floor(3*f):20;v>20&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${v} samples when the maximum is set to 20`);const b=[];let S=0;for(let I=0;I<20;++I){const D=I/f,O=Math.exp(-D*D/2);b.push(O),0==I?S+=O:I<v&&(S+=2*O)}for(let I=0;I<b.length;I++)b[I]=b[I]/S;const C=this.blurMaterial.uniforms;C.envMap.value=e.texture,C.samples.value=v,C.weights.value=b,C.latitudinal.value="latitudinal"===s,C.dTheta.value=u,new al(.1,100,t).update(this.threeRenderer,this.blurScene)}getBlurShader(e){const t=new Float32Array(e),n=new me(0,1,0);return new xr({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:n}},vertexShader:"\n      \n      varying vec3 vOutputDirection;\n  \n      void main() {\n  \n        vOutputDirection = vec3( position );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  \n      }\n    ",fragmentShader:"\n        varying vec3 vOutputDirection;\n  \n        uniform samplerCube envMap;\n        uniform int samples;\n        uniform float weights[ n ];\n        uniform bool latitudinal;\n        uniform float dTheta;\n        uniform vec3 poleAxis;\n  \n        vec3 getSample( float theta, vec3 axis ) {\n  \n          float cosTheta = cos( theta );\n          // Rodrigues' axis-angle rotation\n          vec3 sampleDirection = vOutputDirection * cosTheta\n            + cross( axis, vOutputDirection ) * sin( theta )\n            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n  \n          return vec3( textureCube( envMap, sampleDirection ) );\n  \n        }\n  \n        void main() {\n  \n          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n  \n          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n  \n            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n  \n          }\n  \n          axis = normalize( axis );\n  \n          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n  \n          for ( int i = 1; i < n; i++ ) {\n  \n            if ( i >= samples ) {\n  \n              break;\n  \n            }\n  \n            float theta = dTheta * float( i );\n            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n  \n          }\n        }\n      ",blending:0,depthTest:!1,depthWrite:!1,side:1})}dispose(){var e=this;return(0,m.Z)(function*(){for(const[,t]of e.skyboxCache)(yield t).dispose();null!=e.generatedEnvironmentMap&&((yield e.generatedEnvironmentMap).dispose(),e.generatedEnvironmentMap=null),null!=e.generatedEnvironmentMapAlt&&((yield e.generatedEnvironmentMapAlt).dispose(),e.generatedEnvironmentMapAlt=null),null!=e.blurMaterial&&e.blurMaterial.dispose()})()}}const Qd=[1,.79,.62,.5,.4,.31,.25];class aa extends qr{constructor(e){super(),this.loader=new mn(Xy),this.width=0,this.height=0,this.dpr=1,this.debugger=null,this.scenes=new Set,this.multipleScenesVisible=!1,this.scaleStep=0,this.lastStep=3,this.avgFrameDuration=22,this.onWebGLContextLost=t=>{this.dispatchEvent({type:"contextlost",sourceEvent:t})},this.onWebGLContextRestored=()=>{var t;null===(t=this.textureUtils)||void 0===t||t.dispose(),this.textureUtils=new za(this.threeRenderer);for(const n of this.scenes)n.element[oa]()},this.dpr=cm(),this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas";try{this.threeRenderer=new Ie({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.outputEncoding=3001,this.threeRenderer.physicallyCorrectLights=!0,this.threeRenderer.setPixelRatio(1),this.debugger=e.debug?new Zy(this):null,this.threeRenderer.debug={checkShaderErrors:!!this.debugger},this.threeRenderer.toneMapping=4}catch(t){console.warn(t)}this.arRenderer=new Wy(this),this.textureUtils=this.canRender?new za(this.threeRenderer):null,mn.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize(),this.lastTick=performance.now(),this.avgFrameDuration=0}static get singleton(){return this._singleton}static resetSingleton(){const e=this._singleton.dispose();for(const t of e)t.disconnectedCallback();this._singleton=new aa({powerPreference:(self.ModelViewerElement||{}).powerPreference||"high-performance",debug:x_()});for(const t of e)t.connectedCallback()}get canRender(){return null!=this.threeRenderer}get scaleFactor(){return Qd[this.scaleStep]}set minScale(e){let t=1;for(;t<Qd.length&&!(Qd[t]<e);)++t;this.lastStep=t-1}updateRendererSize(){const e=cm();if(e!==this.dpr)for(const f of this.scenes){const{element:v}=f;v[fc](v.getBoundingClientRect())}let t=0,n=0;for(const f of this.scenes)t=Math.max(t,f.width),n=Math.max(n,f.height);if(t===this.width&&n===this.height&&e===this.dpr)return;this.width=t,this.height=n,this.dpr=e,this.canRender&&this.threeRenderer.setSize(t*e,n*e,!1);const s=this.scaleFactor,l=t/s,u=n/s;this.canvas3D.style.width=`${l}px`,this.canvas3D.style.height=`${u}px`;for(const f of this.scenes){const{canvas:v}=f;v.width=Math.round(t*e),v.height=Math.round(n*e),v.style.width=`${l}px`,v.style.height=`${u}px`,f.queueRender()}}updateRendererScale(){const e=this.scaleStep;if(this.avgFrameDuration>26?++this.scaleStep:this.avgFrameDuration<18&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),e==this.scaleStep)return;const t=this.scaleFactor;this.avgFrameDuration=22;const n=this.width/t,s=this.height/t;this.canvas3D.style.width=`${n}px`,this.canvas3D.style.height=`${s}px`;for(const l of this.scenes){const{style:u}=l.canvas;u.width=`${n}px`,u.height=`${s}px`,l.queueRender(),this.dispatchRenderScale(l)}}dispatchRenderScale(e){const t=this.scaleFactor,n=this.dpr*t,s=t<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";e.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:n,minimumDpr:this.dpr*Qd[this.lastStep],pixelWidth:Math.ceil(e.width*n),pixelHeight:Math.ceil(e.height*n),reason:s}}))}registerScene(e){this.scenes.add(e);const{canvas:t}=e,n=this.scaleFactor;t.width=Math.round(this.width*this.dpr),t.height=Math.round(this.height*this.dpr),t.style.width=this.width/n+"px",t.style.height=this.height/n+"px",this.multipleScenesVisible&&t.classList.add("show"),e.queueRender(),this.dispatchRenderScale(e),this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop((s,l)=>this.render(s,l)),null!=this.debugger&&this.debugger.addScene(e)}unregisterScene(e){this.scenes.delete(e),this.canRender&&0===this.scenes.size&&this.threeRenderer.setAnimationLoop(null),null!=this.debugger&&this.debugger.removeScene(e)}displayCanvas(e){return this.multipleScenesVisible?e.element[Dl]:this.canvas3D}selectCanvas(){let e=0,t=null;for(const l of this.scenes){const{element:u}=l;u.modelIsVisible&&null==l.externalRenderer&&(++e,t=l.canvas)}if(null==t)return;const n=e>1,{canvas3D:s}=this;if(n!==this.multipleScenesVisible||!n&&s.parentElement!==t.parentElement){this.multipleScenesVisible=n,n&&s.classList.remove("show");for(const l of this.scenes){if(null!=l.externalRenderer)continue;const u=l.element[Dl];n?(u.classList.add("show"),l.queueRender()):l.canvas===t&&(l.canvas.parentElement.appendChild(s),s.classList.add("show"),u.classList.remove("show"),l.queueRender())}}}orderedScenes(){const e=[];for(const t of[!1,!0])for(const n of this.scenes)n.element.modelIsVisible===t&&e.push(n);return e}get isPresenting(){return this.arRenderer.isPresenting}preRender(e,t,n){const{element:s,exposure:l}=e;s[gr](t,n);const u="number"==typeof l&&!self.isNaN(l);this.threeRenderer.toneMappingExposure=u?l:1}render(e,t){if(null!=t)return void this.arRenderer.onWebXRFrame(e,t);const n=e-this.lastTick;if(this.lastTick=e,!this.canRender||this.isPresenting)return;this.avgFrameDuration+=Al(.2*(n-this.avgFrameDuration),-2,2),this.selectCanvas(),this.updateRendererSize(),this.updateRendererScale();const{dpr:s,scaleFactor:l}=this;for(const u of this.orderedScenes()){const{element:f}=u;if(!f.modelIsVisible&&u.renderCount>0||(this.preRender(u,e,n),!u.shouldRender()))continue;if(null!=u.externalRenderer){const S=u.getCamera();S.updateMatrix();const{matrix:C,projectionMatrix:I}=S,D=C.elements.slice(),O=u.getTarget();D[12]+=O.x,D[13]+=O.y,D[14]+=O.z,u.externalRenderer.render({viewMatrix:D,projectionMatrix:I.elements});continue}if(!f.modelIsVisible&&!this.multipleScenesVisible)for(const S of this.scenes)S.element.modelIsVisible&&S.queueRender();const v=Math.min(Math.ceil(u.width*l*s),this.canvas3D.width),b=Math.min(Math.ceil(u.height*l*s),this.canvas3D.height);if(u.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.floor(this.height*s)-b,v,b),this.threeRenderer.render(u,u.camera),this.multipleScenesVisible){null==u.context&&u.createContext();const S=u.context;S.clearRect(0,0,v,b),S.drawImage(this.canvas3D,0,0,v,b,0,0,v,b)}u.hasRendered(),f.loaded&&++u.renderCount}}dispose(){null!=this.textureUtils&&this.textureUtils.dispose(),null!=this.threeRenderer&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const e=[];for(const t of this.scenes)e.push(t.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),e}}aa._singleton=new aa({powerPreference:(self.ModelViewerElement||{}).powerPreference||"high-performance",debug:x_()});class z_ extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(){const e={progress:0,completed:!1};return this.ongoingActivities.add(e),1===this.ongoingActivityCount&&this.announceTotalProgress(e,0),t=>{let n;return n=Math.max(Al(t,0,1),e.progress),n!==e.progress&&this.announceTotalProgress(e,n),e.progress}}announceTotalProgress(e,t){let n=0,s=0;1==t&&(e.completed=!0);for(const f of this.ongoingActivities){const{progress:v}=f;n+=1-v,!0===f.completed&&s++}const l=e.progress;e.progress=t,this.totalProgress+=(t-l)*(1-this.totalProgress)/n,this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:s===this.ongoingActivityCount?1:this.totalProgress}})),s===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}var Zf,qf,$f,O_,B_,Xf,ep,Yf,Ur,Pu,mc,Jf,Kf=function(h,e,t,n){for(var s,l=arguments.length,u=l<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n,f=h.length-1;f>=0;f--)(s=h[f])&&(u=(l<3?s(u):l>3?s(e,t,u):s(e,t))||u);return l>3&&u&&Object.defineProperty(e,t,u),u};const so=document.createElement("canvas"),Hs=Symbol("fallbackResizeHandler"),la=Symbol("defaultAriaLabel"),ca=Symbol("resizeObserver"),js=Symbol("clearModelTimeout"),Oa=Symbol("onContextLost"),Ba=Symbol("loaded"),Qf=Symbol("status"),wm=Symbol("onFocus"),Mm=Symbol("onBlur"),fc=Symbol("updateSize"),Sm=Symbol("intersectionObserver"),gc=Symbol("isElementInViewport"),tp=Symbol("announceModelVisibility"),Iu=Symbol("ariaLabel"),Tm=Symbol("altDefaulted"),Du=Symbol("statusElement"),Em=Symbol("updateStatus"),Lu=Symbol("loadedTime"),Nr=Symbol("updateSource"),eg=Symbol("markLoaded"),_c=Symbol("container"),yc=Symbol("input"),Dl=Symbol("canvas"),Nt=Symbol("scene"),Vr=Symbol("needsRender"),gr=Symbol("tick"),Do=Symbol("onModelLoad"),fh=Symbol("onResize"),Vi=Symbol("renderer"),Lo=Symbol("progressTracker"),tg=Symbol("getLoaded"),ip=Symbol("getModelIsVisible"),Fa=Symbol("shouldAttemptPreload"),vc=Symbol("sceneIsReady"),gh=Symbol("hasTransitioned"),Cm=h=>({x:h.x,y:h.y,z:h.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),F_=h=>({u:h.x,v:h.y,toString(){return`${this.u} ${this.v}`}});class Am extends As{constructor(){var e;super(),e=this,this.alt=null,this.src=null,this.withCredentials=!1,this[Zf]=!1,this[qf]=!1,this[$f]=0,this[O_]=null,this[B_]=lm(()=>{const l=this.getBoundingClientRect();this[fc](l)},50),this[Xf]=lm(l=>{const u=this.modelIsVisible;u!==l&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:u}}))},0),this[ep]=null,this[Yf]=null,this[Ur]=new z_,this[Pu]=()=>{this[Du].textContent=this[Qf]},this[mc]=()=>{this[Du].textContent=""},this[Jf]=l=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:l.sourceEvent}}))},this.attachShadow({mode:"open"});const t=this.shadowRoot;let n,s;if(Pc(rm,t),this[_c]=t.querySelector(".container"),this[yc]=t.querySelector(".userInput"),this[Dl]=t.querySelector("canvas"),this[Du]=t.querySelector("#status"),this[la]=this[yc].getAttribute("aria-label"),this.isConnected){const l=this.getBoundingClientRect();n=l.width,s=l.height}else n=300,s=150;this[Nt]=new E_({canvas:this[Dl],element:this,width:n,height:s}),this[Nt].addEventListener("model-load",function(){var l=(0,m.Z)(function*(u){e[eg](),e[Do](),yield Lf(),e.dispatchEvent(new CustomEvent("load",{detail:{url:u.url}}))});return function(u){return l.apply(this,arguments)}}()),Promise.resolve().then(()=>{this[fc](this.getBoundingClientRect())}),kd&&(this[ca]=new ResizeObserver(l=>{if(!this[Vi].isPresenting)for(let u of l)u.target===this&&this[fc](u.contentRect)})),cf?this[Sm]=new IntersectionObserver(l=>{for(let u of l)if(u.target===this){const f=this.modelIsVisible;this[gc]=u.isIntersecting,this[tp](f),this[gc]&&!this[vc]()&&this[Nr]()}},{root:null,rootMargin:"0px",threshold:0}):this[gc]=!0}static get is(){return"model-viewer"}static set modelCacheSize(e){mn[ka].evictionThreshold=e}static get modelCacheSize(){return mn[ka].evictionThreshold}static set minimumRenderScale(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),aa.singleton.minScale=e}static get minimumRenderScale(){return aa.singleton.minScale}get loaded(){return this[tg]()}get[(Zf=gc,qf=Ba,$f=Lu,O_=js,B_=Hs,Xf=tp,ep=ca,Yf=Sm,Ur=Lo,Vi)](){return aa.singleton}get modelIsVisible(){return this[ip]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),kd?this[ca].observe(this):self.addEventListener("resize",this[Hs]),cf&&this[Sm].observe(this),this.addEventListener("focus",this[wm]),this.addEventListener("blur",this[Mm]);const e=this[Vi];e.addEventListener("contextlost",this[Oa]),e.registerScene(this[Nt]),null!=this[js]&&(self.clearTimeout(this[js]),this[js]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),kd?this[ca].unobserve(this):self.removeEventListener("resize",this[Hs]),cf&&this[Sm].unobserve(this),this.removeEventListener("focus",this[wm]),this.removeEventListener("blur",this[Mm]);const e=this[Vi];e.removeEventListener("contextlost",this[Oa]),e.unregisterScene(this[Nt]),this[js]=self.setTimeout(()=>{this[Nt].reset()},1e3)}updated(e){super.updated(e),e.has("src")&&(null==this.src?(this[Ba]=!1,this[Lu]=0,this[Nt].reset()):this.src!==this[Nt].url&&(this[Ba]=!1,this[Lu]=0,this[Nr]())),e.has("alt")&&this[yc].setAttribute("aria-label",this[Iu]),e.has("withCredentials")&&(mn.withCredentials=this.withCredentials)}toDataURL(e,t){return this[Vi].displayCanvas(this[Nt]).toDataURL(e,t)}toBlob(e){var t=this;return(0,m.Z)(function*(){const n=e?e.mimeType:void 0,s=e?e.qualityArgument:void 0,l=e?e.idealAspect:void 0,{width:u,height:f,idealAspect:v,aspect:b}=t[Nt],{dpr:S,scaleFactor:C}=t[Vi];let I=u*C*S,D=f*C*S,O=0,N=0;if(!0===l)if(v>b){const j=D;D=Math.round(I/v),N=(j-D)/2}else{const j=I;I=Math.round(D*v),O=(j-I)/2}so.width=I,so.height=D;try{return new Promise(function(){var j=(0,m.Z)(function*(U,Q){return so.getContext("2d").drawImage(t[Vi].displayCanvas(t[Nt]),O,N,I,D,0,0,I,D),!so.msToBlob||n&&"image/png"!==n?so.toBlob?void so.toBlob(Y=>{if(!Y)return Q(new Error("Unable to retrieve canvas blob"));U(Y)},n,s):U(yield(Y=(0,m.Z)(function*(Z){return new Promise((te,oe)=>{const de=Z.match(/data:(.*);/);if(!de)return oe(new Error(`${Z} is not a valid data Url`));const Ce=de[1],Le=Z.replace(/data:image\/\w+;base64,/,""),Oe=atob(Le),Ze=[];for(let et=0;et<Oe.length;et+=512){const ot=Oe.slice(et,et+512),Ve=new Array(ot.length);for(let it=0;it<ot.length;it++)Ve[it]=ot.charCodeAt(it);const at=new Uint8Array(Ve);Ze.push(at)}te(new Blob(Ze,{type:Ce}))})}),function(Z){return Y.apply(this,arguments)})(so.toDataURL(n,s))):U(so.msToBlob());var Y});return function(U,Q){return j.apply(this,arguments)}}())}finally{t[fc]({width:u,height:f})}})()}registerRenderer(e){this[Nt].externalRenderer=e}unregisterRenderer(){this[Nt].externalRenderer=null}get[Iu](){return this[Tm]}get[Tm](){return null==this.alt||"null"===this.alt?this[la]:this.alt}[tg](){return this[Ba]}[ip](){return this.loaded&&this[gc]}[gh](){return this.modelIsVisible}[Fa](){return!!this.src&&this[gc]}[vc](){return this[Ba]}[fc]({width:e,height:t}){this[_c].style.width=`${e}px`,this[_c].style.height=`${t}px`,this[fh]({width:parseFloat(e),height:parseFloat(t)})}[gr](e,t){}[eg](){this[Ba]||(this[Ba]=!0,this[Lu]=performance.now())}[Vr](){this[Nt].queueRender()}[Do](){}[Em](e){this[Qf]=e;const t=this.getRootNode();null!=t&&t.activeElement===this&&this[Du].textContent!=e&&(this[Du].textContent=e)}[(Pu=wm,mc=Mm,fh)](e){this[Nt].setSize(e.width,e.height)}[(Jf=Oa,Nr)](){var e=this;return(0,m.Z)(function*(){if(e.loaded||!e[Fa]())return;const t=e[Lo].beginActivity(),n=e.src;try{yield e[Nt].setSource(n,l=>t(.95*l)),e.dispatchEvent(new CustomEvent("preload",{detail:{url:n}}))}catch(s){e.dispatchEvent(new CustomEvent("error",{detail:s}))}finally{requestAnimationFrame(()=>{requestAnimationFrame(()=>{t(1)})})}})()}}Kf([si({type:String})],Am.prototype,"alt",void 0),Kf([si({type:String})],Am.prototype,"src",void 0),Kf([si({type:Boolean,attribute:"with-credentials"})],Am.prototype,"withCredentials",void 0);var np=function(h,e,t,n){for(var s,l=arguments.length,u=l<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n,f=h.length-1;f>=0;f--)(s=h[f])&&(u=(l<3?s(u):l>3?s(e,t,u):s(e,t))||u);return l>3&&u&&Object.defineProperty(e,t,u),u};const Pm=Symbol("changeAnimation"),Ua=Symbol("paused"),Jy={repetitions:1/0,pingpong:!1},oo=Symbol("hotspotMap"),ig=Symbol("mutationCallback"),rp=Symbol("observer"),_h=Symbol("addHotspot"),Ru=Symbol("removeHotspot"),yh=new ii,ku=new se;var sp=function(h){return URL.createObjectURL(new Blob([h],{type:"text/javascript"}))};try{URL.revokeObjectURL(sp(""))}catch(h){sp=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var bs=Uint8Array,ws=Uint16Array,ha=Uint32Array,zu=new bs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ng=new bs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),rg=new bs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),U_=function(h,e){for(var t=new ws(31),n=0;n<31;++n)t[n]=e+=1<<h[n-1];var s=new ha(t[30]);for(n=1;n<30;++n)for(var l=t[n];l<t[n+1];++l)s[l]=l-t[n]<<5|n;return[t,s]},sg=U_(zu,2),Im=sg[1];sg[0][28]=258,Im[258]=28;for(var o=U_(ng,0)[1],i=new ws(32768),a=0;a<32768;++a){var c=(43690&a)>>>1|(21845&a)<<1;c=(61680&(c=(52428&c)>>>2|(13107&c)<<2))>>>4|(3855&c)<<4,i[a]=((65280&c)>>>8|(255&c)<<8)>>>1}var p=function(h,e,t){for(var n=h.length,s=0,l=new ws(e);s<n;++s)++l[h[s]-1];var u,f=new ws(e);for(s=0;s<e;++s)f[s]=f[s-1]+l[s-1]<<1;if(t){u=new ws(1<<e);var v=15-e;for(s=0;s<n;++s)if(h[s])for(var b=s<<4|h[s],S=e-h[s],C=f[h[s]-1]++<<S,I=C|(1<<S)-1;C<=I;++C)u[i[C]>>>v]=b}else for(u=new ws(n),s=0;s<n;++s)h[s]&&(u[s]=i[f[h[s]-1]++]>>>15-h[s]);return u},_=new bs(288);for(a=0;a<144;++a)_[a]=8;for(a=144;a<256;++a)_[a]=9;for(a=256;a<280;++a)_[a]=7;for(a=280;a<288;++a)_[a]=8;var x=new bs(32);for(a=0;a<32;++a)x[a]=5;var w=p(_,9,0),E=p(x,5,0),P=function(h){return(h/8|0)+(7&h&&1)},R=function(h,e,t){(null==e||e<0)&&(e=0),(null==t||t>h.length)&&(t=h.length);var n=new(h instanceof ws?ws:h instanceof ha?ha:bs)(t-e);return n.set(h.subarray(e,t)),n},z=function(h,e,t){var n=e/8|0;h[n]|=t<<=7&e,h[n+1]|=t>>>8},B=function(h,e,t){var n=e/8|0;h[n]|=t<<=7&e,h[n+1]|=t>>>8,h[n+2]|=t>>>16},H=function(h,e){for(var t=[],n=0;n<h.length;++n)h[n]&&t.push({s:n,f:h[n]});var s=t.length,l=t.slice();if(!s)return[De,0];if(1==s){var u=new bs(t[0].s+1);return u[t[0].s]=1,[u,1]}t.sort(function(te,oe){return te.f-oe.f}),t.push({s:-1,f:25001});var f=t[0],v=t[1],b=0,S=1,C=2;for(t[0]={s:-1,f:f.f+v.f,l:f,r:v};S!=s-1;)f=t[t[b].f<t[C].f?b++:C++],v=t[b!=S&&t[b].f<t[C].f?b++:C++],t[S++]={s:-1,f:f.f+v.f,l:f,r:v};var I=l[0].s;for(n=1;n<s;++n)l[n].s>I&&(I=l[n].s);var D=new ws(I+1),O=$(t[S-1],D,0);if(O>e){n=0;var N=0,j=O-e,U=1<<j;for(l.sort(function(te,oe){return D[oe.s]-D[te.s]||te.f-oe.f});n<s;++n){var Q=l[n].s;if(!(D[Q]>e))break;N+=U-(1<<O-D[Q]),D[Q]=e}for(N>>>=j;N>0;){var Y=l[n].s;D[Y]<e?N-=1<<e-D[Y]++-1:++n}for(;n>=0&&N;--n){var Z=l[n].s;D[Z]==e&&(--D[Z],++N)}O=e}return[new bs(D),O]},$=function(h,e,t){return-1==h.s?Math.max($(h.l,e,t+1),$(h.r,e,t+1)):e[h.s]=t},K=function(h){for(var e=h.length;e&&!h[--e];);for(var t=new ws(++e),n=0,s=h[0],l=1,u=function(v){t[n++]=v},f=1;f<=e;++f)if(h[f]==s&&f!=e)++l;else{if(!s&&l>2){for(;l>138;l-=138)u(32754);l>2&&(u(l>10?l-11<<5|28690:l-3<<5|12305),l=0)}else if(l>3){for(u(s),--l;l>6;l-=6)u(8304);l>2&&(u(l-3<<5|8208),l=0)}for(;l--;)u(s);l=1,s=h[f]}return[t.subarray(0,n),e]},ne=function(h,e){for(var t=0,n=0;n<e.length;++n)t+=h[n]*e[n];return t},le=function(h,e,t){var n=t.length,s=P(e+2);h[s]=255&n,h[s+1]=n>>>8,h[s+2]=255^h[s],h[s+3]=255^h[s+1];for(var l=0;l<n;++l)h[s+l+4]=t[l];return 8*(s+4+n)},be=function(h,e,t,n,s,l,u,f,v,b,S){z(e,S++,t),++s[256];for(var C=H(s,15),I=C[0],D=C[1],O=H(l,15),N=O[0],j=O[1],U=K(I),Q=U[0],Y=U[1],Z=K(N),te=Z[0],oe=Z[1],de=new ws(19),Ce=0;Ce<Q.length;++Ce)de[31&Q[Ce]]++;for(Ce=0;Ce<te.length;++Ce)de[31&te[Ce]]++;for(var Le=H(de,7),Oe=Le[0],Ze=Le[1],et=19;et>4&&!Oe[rg[et-1]];--et);var ot,Ve,at,it,wt=b+5<<3,pt=ne(s,_)+ne(l,x)+u,Ct=ne(s,I)+ne(l,N)+u+14+3*et+ne(de,Oe)+(2*de[16]+3*de[17]+7*de[18]);if(wt<=pt&&wt<=Ct)return le(e,S,h.subarray(v,v+b));if(z(e,S,1+(Ct<pt)),S+=2,Ct<pt){ot=p(I,D,0),Ve=I,at=p(N,j,0),it=N;var dt=p(Oe,Ze,0);for(z(e,S,Y-257),z(e,S+5,oe-1),z(e,S+10,et-4),S+=14,Ce=0;Ce<et;++Ce)z(e,S+3*Ce,Oe[rg[Ce]]);S+=3*et;for(var ei=[Q,te],Zt=0;Zt<2;++Zt){var Xt=ei[Zt];for(Ce=0;Ce<Xt.length;++Ce){var ni=31&Xt[Ce];z(e,S,dt[ni]),S+=Oe[ni],ni>15&&(z(e,S,Xt[Ce]>>>5&127),S+=Xt[Ce]>>>12)}}}else ot=w,Ve=_,at=E,it=x;for(Ce=0;Ce<f;++Ce)if(n[Ce]>255){B(e,S,ot[257+(ni=n[Ce]>>>18&31)]),S+=Ve[ni+257],ni>7&&(z(e,S,n[Ce]>>>23&31),S+=zu[ni]);var Te=31&n[Ce];B(e,S,at[Te]),S+=it[Te],Te>3&&(B(e,S,n[Ce]>>>5&8191),S+=ng[Te])}else B(e,S,ot[n[Ce]]),S+=Ve[n[Ce]];return B(e,S,ot[256]),S+Ve[256]},Se=new ha([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),De=new bs(0),Re=function(){for(var h=new ha(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&3988292384)^t>>>1;h[e]=t}return h}(),ke=function(){var h=-1;return{p:function(e){for(var t=h,n=0;n<e.length;++n)t=Re[255&t^e[n]]^t>>>8;h=t},d:function(){return~h}}},$e=function(h,e){var t={};for(var n in h)t[n]=h[n];for(var n in e)t[n]=e[n];return t},Je=function(h,e,t){for(;t;++e)h[e]=t,t>>>=8};function ht(h,e){return function(h,e,t,n,s){return function(l,u,f,v,b,S){var C=l.length,I=new bs(0+C+5*(1+Math.ceil(C/7e3))+0),D=I.subarray(0,I.length-0),O=0;if(!u||C<8)for(var N=0;N<=C;N+=65535){var j=N+65535;j<C?O=le(D,O,l.subarray(N,j)):(D[N]=S,O=le(D,O,l.subarray(N,C)))}else{for(var U=Se[u-1],Q=U>>>13,Y=8191&U,Z=(1<<f)-1,te=new ws(32768),oe=new ws(Z+1),de=Math.ceil(f/3),Ce=2*de,Le=function(jt){return(l[jt]^l[jt+1]<<de^l[jt+2]<<Ce)&Z},Oe=new ha(25e3),Ze=new ws(288),et=new ws(32),ot=0,Ve=0,at=(N=0,0),it=0,wt=0;N<C;++N){var pt=Le(N),Ct=32767&N,dt=oe[pt];if(te[Ct]=dt,oe[pt]=Ct,it<=N){var ei=C-N;if((ot>7e3||at>24576)&&ei>423){O=be(l,D,0,Oe,Ze,et,Ve,at,wt,N-wt,O),at=ot=Ve=0,wt=N;for(var Zt=0;Zt<286;++Zt)Ze[Zt]=0;for(Zt=0;Zt<30;++Zt)et[Zt]=0}var Xt=2,ni=0,Te=Y,ve=Ct-dt&32767;if(ei>2&&pt==Le(N-ve))for(var tt=Math.min(Q,ei)-1,st=Math.min(32767,N),Pe=Math.min(258,ei);ve<=st&&--Te&&Ct!=dt;){if(l[N+Xt]==l[N+Xt-ve]){for(var Ge=0;Ge<Pe&&l[N+Ge]==l[N+Ge-ve];++Ge);if(Ge>Xt){if(Xt=Ge,ni=ve,Ge>tt)break;var he=Math.min(ve,Ge-2),ze=0;for(Zt=0;Zt<he;++Zt){var Ke=N-ve+Zt+32768&32767,Et=Ke-te[Ke]+32768&32767;Et>ze&&(ze=Et,dt=Ke)}}}ve+=(Ct=dt)-(dt=te[Ct])+32768&32767}if(ni){Oe[at++]=268435456|Im[Xt]<<18|o[ni];var nt=31&Im[Xt],Ft=31&o[ni];Ve+=zu[nt]+ng[Ft],++Ze[257+nt],++et[Ft],it=N+Xt,++ot}else Oe[at++]=l[N],++Ze[l[N]]}}O=be(l,D,S,Oe,Ze,et,Ve,at,wt,N-wt,O)}return R(I,0,0+P(O)+0)}(h,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(h.length)))):12+e.mem,0,0,!0)}(h,e||{})}var We=function(h,e,t,n){for(var s in h){var l=h[s],u=e+s;l instanceof bs?t[u]=[l,n]:Array.isArray(l)?t[u]=[l[0],$e(n,l[1])]:We(l,u+"/",t,n)}},Qe="undefined"!=typeof TextEncoder&&new TextEncoder,gt="undefined"!=typeof TextDecoder&&new TextDecoder;try{gt.decode(De,{stream:!0})}catch(h){}function xt(h,e){if(e){for(var t=new bs(h.length),n=0;n<h.length;++n)t[n]=h.charCodeAt(n);return t}if(Qe)return Qe.encode(h);var s=h.length,l=new bs(h.length+(h.length>>1)),u=0,f=function(S){l[u++]=S};for(n=0;n<s;++n){if(u+5>l.length){var v=new bs(u+8+(s-n<<1));v.set(l),l=v}var b=h.charCodeAt(n);b<128||e?f(b):b<2048?(f(192|b>>6),f(128|63&b)):b>55295&&b<57344?(f(240|(b=65536+(1047552&b)|1023&h.charCodeAt(++n))>>18),f(128|b>>12&63),f(128|b>>6&63),f(128|63&b)):(f(224|b>>12),f(128|b>>6&63),f(128|63&b))}return R(l,0,u)}var vt=function(h){var e=0;if(h)for(var t in h){var n=h[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},bt=function(h,e,t,n,s,l,u,f){var v=n.length,b=t.extra,S=f&&f.length,C=vt(b);Je(h,e,null!=u?33639248:67324752),e+=4,null!=u&&(h[e++]=20,h[e++]=t.os),h[e]=20,e+=2,h[e++]=t.flag<<1|(null==l&&8),h[e++]=s&&8,h[e++]=255&t.compression,h[e++]=t.compression>>8;var I=new Date(null==t.mtime?Date.now():t.mtime),D=I.getFullYear()-1980;if(D<0||D>119)throw"date not in range 1980-2099";if(Je(h,e,D<<25|I.getMonth()+1<<21|I.getDate()<<16|I.getHours()<<11|I.getMinutes()<<5|I.getSeconds()>>>1),e+=4,null!=l&&(Je(h,e,t.crc),Je(h,e+4,l),Je(h,e+8,t.size)),Je(h,e+12,v),Je(h,e+14,C),e+=16,null!=u&&(Je(h,e,S),Je(h,e+6,t.attrs),Je(h,e+10,u),e+=14),h.set(n,e),e+=v,C)for(var O in b){var N=b[O],j=N.length;Je(h,e,+O),Je(h,e+2,j),h.set(N,e+4),e+=4+j}return S&&(h.set(f,e),e+=S),e};class xi{parse(e){return(0,m.Z)(function*(){const t={"model.usda":null};let n='#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n\n';const s={},l={};e.traverseVisible(f=>{if(f.isMesh)if(f.material.isMeshStandardMaterial){const v=f.geometry,b=f.material,S="geometries/Geometry_"+v.id+".usd";if(!(S in t)){const C=`\ndef "Geometry"\n{\n  ${function(D){const N=D.attributes,j=N.position.count;return`\n    def Mesh "Geometry"\n    {\n        int[] faceVertexCounts = [${U=D,Array((null!==U.index?U.index.count:U.attributes.position.count)/3).fill(3).join(", ")}]\n        int[] faceVertexIndices = [${function(U){const Q=U.index,Y=[];if(null!==Q)for(let Z=0;Z<Q.count;Z++)Y.push(Q.getX(Z));else{const Z=U.attributes.position.count;for(let te=0;te<Z;te++)Y.push(te)}return Y.join(", ")}(D)}]\n        normal3f[] normals = [${kt(N.normal,j)}] (\n            interpolation = "vertex"\n        )\n        point3f[] points = [${kt(N.position,j)}]\n        float2[] primvars:st = [${function(U,Q){if(void 0===U)return console.warn("USDZExporter: UVs missing."),Array(Q).fill("(0, 0)").join(", ");const Y=[];for(let Z=0;Z<U.count;Z++){const te=U.getX(Z),oe=U.getY(Z);Y.push(`(${te.toPrecision(7)}, ${1-oe.toPrecision(7)})`)}return Y.join(", ")}(N.uv,j)}] (\n            interpolation = "vertex"\n        )\n        uniform token subdivisionScheme = "none"\n    }\n`;var U}(v)}\n}\n`;t[S]=function(I){let D='#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n\n';return D+=I,xt(D)}(C)}b.uuid in s||(s[b.uuid]=b),n+=function(C,I,D){const O="Object_"+C.id,N=function(j){const U=j.elements;return`( ${Gt(U,0)}, ${Gt(U,4)}, ${Gt(U,8)}, ${Gt(U,12)} )`}(C.matrixWorld);return C.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",C),`def Xform "${O}" (\n    prepend references = @./geometries/Geometry_${I.id}.usd@</Geometry>\n)\n{\n    matrix4d xformOp:transform = ${N}\n    uniform token[] xformOpOrder = ["xformOp:transform"]\n\n    rel material:binding = </Materials/Material_${D.id}>\n}\n\n`}(f,v,b)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",f)}),n+=function(f,v){const b=[];for(const S in f)b.push(Si(f[S],v));return`def "Materials"\n{\n${b.join("")}\n}\n\n`}(s,l),t["model.usda"]=xt(n),n=null;for(const f in l){const v=l[f],b=f.split("_")[1],S=1023===v.format,C=ci(v.image,b),I=yield new Promise(D=>C.toBlob(D,S?"image/png":"image/jpeg",1));t[`textures/Texture_${f}.${S?"png":"jpg"}`]=new Uint8Array(yield I.arrayBuffer())}let u=0;for(const f in t){const v=t[f];u+=34+f.length;const b=63&u;if(4!==b){const S=new Uint8Array(64-b);t[f]=[v,{extra:{12345:S}}]}u=v.length}return function ai(h,e){e||(e={});var t={},n=[];We(h,"",t,e);var Le,Oe,Ze,et,ot,s=0,l=0;for(var u in t){var f=t[u],v=f[0],b=f[1],S=0==b.level?0:8,C=(de=xt(u)).length,I=b.comment,D=I&&xt(I),O=D&&D.length,N=vt(b.extra);if(C>65535)throw"filename too long";var j=S?ht(v,b):v,U=j.length,Q=ke();Q.p(v),n.push($e(b,{size:v.length,crc:Q.d(),c:j,f:de,m:D,u:C!=u.length||D&&I.length!=O,o:s,compression:S})),s+=30+C+N+U,l+=76+2*(C+N)+(O||0)+U}for(var Y=new bs(l+22),Z=s,te=l-s,oe=0;oe<n.length;++oe){var de=n[oe];bt(Y,de.o,de,de.f,de.u,de.c.length);var Ce=30+de.f.length+vt(de.extra);Y.set(de.c,de.o+Ce),bt(Y,s,de,de.f,de.u,de.c.length,de.o,de.m),s+=16+Ce+(de.m?de.m.length:0)}return Ze=n.length,et=te,ot=Z,Je(Le=Y,Oe=s,101010256),Je(Le,Oe+8,Ze),Je(Le,Oe+10,Ze),Je(Le,Oe+12,et),Je(Le,Oe+16,ot),Y}(t,{level:0})})()}}function ci(h,e){if("undefined"!=typeof HTMLImageElement&&h instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&h instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&h instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&h instanceof ImageBitmap){const t=1024/Math.max(h.width,h.height),n=document.createElement("canvas");n.width=h.width*Math.min(1,t),n.height=h.height*Math.min(1,t);const s=n.getContext("2d");if(s.drawImage(h,0,0,n.width,n.height),void 0!==e){const l=parseInt(e,16),u=(l>>16&255)/255,f=(l>>8&255)/255,v=(255&l)/255,b=s.getImageData(0,0,n.width,n.height),S=b.data;for(let C=0;C<S.length;C+=4)S[C+0]=S[C+0]*u,S[C+1]=S[C+1]*f,S[C+2]=S[C+2]*v;s.putImageData(b,0,0)}return n}}function Gt(h,e){return`(${h[e+0]}, ${h[e+1]}, ${h[e+2]}, ${h[e+3]})`}function kt(h,e){if(void 0===h)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const t=[];for(let n=0;n<h.count;n++){const s=h.getX(n),l=h.getY(n),u=h.getZ(n);t.push(`(${s.toPrecision(7)}, ${l.toPrecision(7)}, ${u.toPrecision(7)})`)}return t.join(", ")}function Si(h,e){const t="            ",n=[],s=[];function l(u,f,v){const b=u.id+(v?"_"+v.getHexString():""),S=1023===u.format;return e[b]=u,`\n        def Shader "Transform2d_${f}" (\n            sdrMetadata = {\n                string role = "math"\n            }\n        )\n        {\n            uniform token info:id = "UsdTransform2d"\n            float2 inputs:in.connect = </Materials/Material_${h.id}/uvReader_st.outputs:result>\n            float2 inputs:scale = ${Wn(u.repeat)}\n            float2 inputs:translation = ${Wn(u.offset)}\n            float2 outputs:result\n        }\n\n        def Shader "Texture_${u.id}_${f}"\n        {\n            uniform token info:id = "UsdUVTexture"\n            asset inputs:file = @textures/Texture_${b}.${S?"png":"jpg"}@\n            float2 inputs:st.connect = </Materials/Material_${h.id}/Transform2d_${f}.outputs:result>\n            token inputs:wrapS = "repeat"\n            token inputs:wrapT = "repeat"\n            float outputs:r\n            float outputs:g\n            float outputs:b\n            float3 outputs:rgb\n        }`}return null!==h.map?(n.push(`${t}color3f inputs:diffuseColor.connect = </Materials/Material_${h.id}/Texture_${h.map.id}_diffuse.outputs:rgb>`),s.push(l(h.map,"diffuse",h.color))):n.push(`${t}color3f inputs:diffuseColor = ${Bi(h.color)}`),null!==h.emissiveMap?(n.push(`${t}color3f inputs:emissiveColor.connect = </Materials/Material_${h.id}/Texture_${h.emissiveMap.id}_emissive.outputs:rgb>`),s.push(l(h.emissiveMap,"emissive"))):h.emissive.getHex()>0&&n.push(`${t}color3f inputs:emissiveColor = ${Bi(h.emissive)}`),null!==h.normalMap&&(n.push(`${t}normal3f inputs:normal.connect = </Materials/Material_${h.id}/Texture_${h.normalMap.id}_normal.outputs:rgb>`),s.push(l(h.normalMap,"normal"))),null!==h.aoMap&&(n.push(`${t}float inputs:occlusion.connect = </Materials/Material_${h.id}/Texture_${h.aoMap.id}_occlusion.outputs:r>`),s.push(l(h.aoMap,"occlusion"))),null!==h.roughnessMap&&1===h.roughness?(n.push(`${t}float inputs:roughness.connect = </Materials/Material_${h.id}/Texture_${h.roughnessMap.id}_roughness.outputs:g>`),s.push(l(h.roughnessMap,"roughness"))):n.push(`${t}float inputs:roughness = ${h.roughness}`),null!==h.metalnessMap&&1===h.metalness?(n.push(`${t}float inputs:metallic.connect = </Materials/Material_${h.id}/Texture_${h.metalnessMap.id}_metallic.outputs:b>`),s.push(l(h.metalnessMap,"metallic"))):n.push(`${t}float inputs:metallic = ${h.metalness}`),null!==h.alphaMap?(n.push(`${t}float inputs:opacity.connect = </Materials/Material_${h.id}/Texture_${h.alphaMap.id}_opacity.outputs:r>`),n.push(`${t}float inputs:opacityThreshold = 0.0001`),s.push(l(h.alphaMap,"opacity"))):n.push(`${t}float inputs:opacity = ${h.opacity}`),h.isMeshPhysicalMaterial&&(n.push(`${t}float inputs:clearcoat = ${h.clearcoat}`),n.push(`${t}float inputs:clearcoatRoughness = ${h.clearcoatRoughness}`),n.push(`${t}float inputs:ior = ${h.ior}`)),`\n    def Material "Material_${h.id}"\n    {\n        def Shader "PreviewSurface"\n        {\n            uniform token info:id = "UsdPreviewSurface"\n${n.join("\n")}\n            int inputs:useSpecularWorkflow = 0\n            token outputs:surface\n        }\n\n        token outputs:surface.connect = </Materials/Material_${h.id}/PreviewSurface.outputs:surface>\n        token inputs:frame:stPrimvarName = "st"\n\n        def Shader "uvReader_st"\n        {\n            uniform token info:id = "UsdPrimvarReader_float2"\n            token inputs:varname.connect = </Materials/Material_${h.id}.inputs:frame:stPrimvarName>\n            float2 inputs:fallback = (0.0, 0.0)\n            float2 outputs:result\n        }\n\n${s.join("\n")}\n\n    }\n`}function Bi(h){return`(${h.r}, ${h.g}, ${h.b})`}function Wn(h){return`(${h.x}, ${h.y})`}var qi=function(h,e,t,n){for(var s,l=arguments.length,u=l<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n,f=h.length-1;f>=0;f--)(s=h[f])&&(u=(l<3?s(u):l>3?s(e,t,u):s(e,t))||u);return l>3&&u&&Object.defineProperty(e,t,u),u};let Zn=!1,Fi=!1;const Ei=(Xi=["quick-look","scene-viewer","webxr","none"],h=>{try{const e=dc(h),t=(e.length?e[0].terms:[]).filter(s=>s&&"ident"===s.type).map(s=>s.value).filter(s=>Xi.indexOf(s)>-1),n=new Set;for(const s of t)n.add(s);return n}catch(e){}return new Set});var Xi;const xn="quick-look",En="scene-viewer",Kn="none",Qn=Symbol("arButtonContainer"),is=Symbol("enterARWithWebXR"),Ki=Symbol("openSceneViewer"),Gr=Symbol("openIOSARQuickLook"),Ws=Symbol("canActivateAR"),Cn=Symbol("arMode"),er=Symbol("arModes"),Qi=Symbol("arAnchor"),en=Symbol("preload"),Sr=Symbol("onARButtonContainerClick"),Tr=Symbol("onARStatus"),zn=Symbol("onARTracking"),Er=Symbol("onARTap"),sr=Symbol("selectARMode"),tr=Symbol("triggerLoad");var ao,Ll,Ou;const Na=Symbol("evaluate"),op=Symbol("lastValue");class On{constructor(){this[ao]=null}static evaluatableFor(e,t=Pl){if(e instanceof On)return e;if("number"===e.type)return"%"===e.unit?new N_(e,t):e;switch(e.name.value){case"calc":return new lg(e,t);case"env":return new ag(e)}return Pl}static evaluate(e){return e instanceof On?e.evaluate():e}static isConstant(e){return!(e instanceof On)||e.isConstant}static applyIntrinsics(e,t){const{basis:n,keywords:s}=t,{auto:l}=s;return n.map((u,f)=>{const v=null==l[f]?u:l[f];let b=e[f]?e[f]:v;if("ident"===b.type){const S=b.value;S in s&&(b=s[S][f])}return null!=b&&"ident"!==b.type||(b=v),"%"===b.unit?Fr(b.number/100*u.number,u.unit):(b=vs(b,u),b.unit!==u.unit?u:b)})}get isConstant(){return!1}evaluate(){return this.isConstant&&null!=this[op]||(this[op]=this[Na]()),this[op]}}ao=op;const og=Symbol("percentage"),Dm=Symbol("basis");class N_ extends On{constructor(e,t){super(),this[og]=e,this[Dm]=t}get isConstant(){return!0}[Na](){return Fr(this[og].number/100*this[Dm].number,this[Dm].unit)}}const Bu=Symbol("identNode");class ag extends On{constructor(e){super(),this[Ll]=null;const t=e.arguments.length?e.arguments[0].terms[0]:null;null!=t&&"ident"===t.type&&(this[Bu]=t)}get isConstant(){return!1}[(Ll=Bu,Na)](){return null!=this[Bu]&&"window-scroll-y"===this[Bu].value?{type:"number",number:window.pageYOffset/(Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight)||0,unit:null}:Pl}}const Va=/[\*\/]/,vh=Symbol("evalutor");class lg extends On{constructor(e,t=Pl){if(super(),this[Ou]=null,1!==e.arguments.length)return;const n=e.arguments[0].terms.slice(),s=[];for(;n.length;){const l=n.shift();if(s.length>0){const u=s[s.length-1];if("operator"===u.type&&Va.test(u.value)){const f=s.pop(),v=s.pop();if(null==v)return;s.push(new V_(f,On.evaluatableFor(v,t),On.evaluatableFor(l,t)));continue}}s.push("operator"===l.type?l:On.evaluatableFor(l,t))}for(;s.length>2;){const[l,u,f]=s.splice(0,3);if("operator"!==u.type)return;s.unshift(new V_(u,On.evaluatableFor(l,t),On.evaluatableFor(f,t)))}1===s.length&&(this[vh]=s[0])}get isConstant(){return null==this[vh]||On.isConstant(this[vh])}[(Ou=vh,Na)](){return null!=this[vh]?On.evaluate(this[vh]):Pl}}const Lm=Symbol("operator"),Ga=Symbol("left"),ap=Symbol("right");class V_ extends On{constructor(e,t,n){super(),this[Lm]=e,this[Ga]=t,this[ap]=n}get isConstant(){return On.isConstant(this[Ga])&&On.isConstant(this[ap])}[Na](){const e=vs(On.evaluate(this[Ga])),t=vs(On.evaluate(this[ap])),{number:n,unit:s}=e,{number:l,unit:u}=t;if(null!=u&&null!=s&&u!=s)return Pl;const f=s||u;let v;switch(this[Lm].value){case"+":v=n+l;break;case"-":v=n-l;break;case"/":v=n/l;break;case"*":v=n*l;break;default:return Pl}return{type:"number",number:v,unit:f}}}const ns=Symbol("evaluatables"),Ms=Symbol("intrinsics");class Fu extends On{constructor(e,t){super(),this[Ms]=t;const n=e[0],s=null!=n?n.terms:[];this[ns]=t.basis.map((l,u)=>{const f=s[u];return null==f?{type:"ident",value:"auto"}:"ident"===f.type?f:On.evaluatableFor(f,l)})}get isConstant(){for(const e of this[ns])if(!On.isConstant(e))return!1;return!0}[Na](){const e=this[ns].map(t=>On.evaluate(t));return On.applyIntrinsics(e,this[Ms]).map(t=>t.number)}}var Rm,cg,xc,Y0;const km=Symbol("instances"),J0=Symbol("activateListener"),K0=Symbol("deactivateListener"),Qy=Symbol("notifyInstances"),Q0=Symbol("notify"),ev=Symbol("callback");class bc{constructor(e){this[ev]=e}static[Qy](){for(const e of bc[km])e[Q0]()}static[(Rm=km,J0)](){window.addEventListener("scroll",this[Qy],{passive:!0})}static[K0](){window.removeEventListener("scroll",this[Qy])}observe(){0===bc[km].size&&bc[J0](),bc[km].add(this)}disconnect(){bc[km].delete(this),0===bc[km].size&&bc[K0]()}[Q0](){this[ev]()}}bc[Rm]=new Set;const tv=Symbol("computeStyleCallback"),iv=Symbol("astWalker"),hg=Symbol("dependencies"),nv=Symbol("onScroll");class Wx{constructor(e){this[cg]={},this[xc]=new qd(["function"]),this[Y0]=()=>{this[tv]({relatedState:"window-scroll"})},this[tv]=e}observeEffectsFor(e){const t={},n=this[hg];this[iv].walk(e,s=>{const{name:l}=s,u=s.arguments[0].terms[0];if("env"===l.value&&null!=u&&"ident"===u.type&&"window-scroll-y"===u.value&&null==t["window-scroll"]){const f="window-scroll"in n?n["window-scroll"]:new bc(this[nv]);f.observe(),delete n["window-scroll"],t["window-scroll"]=f}});for(const s in n)n[s].disconnect();this[hg]=t}dispose(){for(const e in this[hg])this[hg][e].disconnect()}}cg=hg,xc=iv,Y0=nv;const Uu=h=>{const e=h.observeEffects||!1,t=h.intrinsics instanceof Function?h.intrinsics:()=>h.intrinsics;return(n,s)=>{const l=n.updated,u=n.connectedCallback,f=n.disconnectedCallback,v=Symbol(`${s}StyleEffector`),b=Symbol(`${s}StyleEvaluator`),S=Symbol(`${s}UpdateEvaluator`),C=Symbol(`${s}EvaluateAndSync`);Object.defineProperties(n,{[v]:{value:null,writable:!0},[b]:{value:null,writable:!0},[S]:{value:function(){const I=dc(this[s]);this[b]=new Fu(I,t(this)),null==this[v]&&e&&(this[v]=new Wx(()=>this[C]())),null!=this[v]&&this[v].observeEffectsFor(I)}},[C]:{value:function(){if(null==this[b])return;const I=this[b].evaluate();this[h.updateHandler](I)}},updated:{value:function(I){I.has(s)&&(this[S](),this[C]()),l.call(this,I)}},connectedCallback:{value:function(){u.call(this),this.requestUpdate(s,this[s])}},disconnectedCallback:{value:function(){f.call(this),null!=this[v]&&(this[v].dispose(),this[v]=null)}}})}},Zx=new Mt,rv=new me,sv=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:Math.PI/8,maximumPolarAngle:Math.PI-Math.PI/8,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,interactionPolicy:"always-allow",touchAction:"pan-y"}),G_=Math.PI/8,e0="user-interaction";class e1 extends qr{constructor(e,t,n){super(),this.camera=e,this.element=t,this.scene=n,this.sensitivity=1,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserChange=!1,this.isUserPointing=!1,this.enablePan=!0,this.panProjection=new se,this.panPerPixel=0,this.spherical=new Tn,this.goalSpherical=new Tn,this.thetaDamper=new rr,this.phiDamper=new rr,this.radiusDamper=new rr,this.logFov=Math.log(sv.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new rr,this.touchMode=null,this.lastPointerPosition={clientX:0,clientY:0},this.startPointerPosition={clientX:0,clientY:0},this.touchDecided=!1,this.onMouseMove=s=>{this.panPerPixel>0?this.movePan(s.clientX,s.clientY):this.handleSinglePointerMove(s),s.cancelable&&s.preventDefault()},this.onTouchMove=s=>{null!==this.touchMode&&(this.touchMode(s),null!==this.touchMode&&s.cancelable&&s.preventDefault())},this.touchModeZoom=s=>{const{targetTouches:l}=s;if(this.lastTouches.length>1&&l.length>1){if(!this._disableZoom){const u=.04*(this.twoTouchDistance(this.lastTouches[0],this.lastTouches[1])-this.twoTouchDistance(l[0],l[1]))/10;this.userAdjustOrbit(0,0,u)}this.panPerPixel>0&&this.movePan(.5*(l[0].clientX+l[1].clientX),.5*(l[0].clientY+l[1].clientY)),this.lastTouches=l}},this.touchModeRotate=s=>{const{targetTouches:l}=s,{touchAction:u}=this._options;if(!this.touchDecided&&"none"!==u){this.touchDecided=!0;const{clientX:f,clientY:v}=l[0],b=Math.abs(f-this.lastPointerPosition.clientX),S=Math.abs(v-this.lastPointerPosition.clientY);if("pan-y"===u&&S>b||"pan-x"===u&&b>S)return void(this.touchMode=null)}this.handleSinglePointerMove(l[0]),this.lastTouches=l},this.onMouseDown=s=>{this.onPointerDown(()=>{self.addEventListener("mousemove",this.onMouseMove),self.addEventListener("mouseup",this.onMouseUp,{once:!0}),this.enablePan&&(2===s.button||s.ctrlKey||s.metaKey||s.shiftKey)&&this.initializePan(),this.lastPointerPosition.clientX=s.clientX,this.lastPointerPosition.clientY=s.clientY,this.startPointerPosition.clientX=s.clientX,this.startPointerPosition.clientY=s.clientY,this.element.style.cursor="grabbing"})},this.onTouchStart=s=>{this.onPointerDown(()=>{const{targetTouches:l,changedTouches:u,touches:f}=s;l.length===u.length&&(this.touchMode=null,this.touchDecided=!1),l.length===f.length&&this.onTouchChange(s)})},this.onMouseUp=s=>{self.removeEventListener("mousemove",this.onMouseMove),this.panPerPixel>0?this.resetRadius():this.recenter(s),this.onPointerUp()},this.onTouchEnd=s=>{s.targetTouches.length>0&&null!==this.touchMode&&this.onTouchChange(s),0===s.targetTouches.length&&(this.panPerPixel>0?this.resetRadius():this.recenter(s.changedTouches[0])),this.onPointerUp()},this.onWheel=s=>{this.canInteract&&(this.userAdjustOrbit(0,0,s.deltaY*(1==s.deltaMode?18:1)*.04/30),s.cancelable&&s.preventDefault())},this.onKeyDown=s=>{let l=!1;switch(s.keyCode){case 33:l=!0,this.userAdjustOrbit(0,0,.04);break;case 34:l=!0,this.userAdjustOrbit(0,0,-.04);break;case 38:l=!0,this.userAdjustOrbit(0,-G_,0);break;case 40:l=!0,this.userAdjustOrbit(0,G_,0);break;case 37:l=!0,this.userAdjustOrbit(-G_,0,0);break;case 39:l=!0,this.userAdjustOrbit(G_,0,0)}l&&s.cancelable&&s.preventDefault()},this._options=Object.assign({},sv),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(!1===this._interactionEnabled){const{element:e}=this;e.addEventListener("mousedown",this.onMouseDown),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchstart",this.onTouchStart,{passive:!0}),e.addEventListener("touchmove",this.onTouchMove,{passive:!1}),e.addEventListener("touchend",this.onTouchEnd),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(!0===this._interactionEnabled){const{element:e}=this;self.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mousedown",this.onMouseDown),this._disableZoom||e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchmove",this.onTouchMove),self.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("touchend",this.onTouchEnd),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(e){this._disableZoom!=e&&(this._disableZoom=e,!0===e?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(e=new Tn){return e.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(e,t){this.camera.near=Math.max(e,t/1e3),this.camera.far=t,this.camera.updateProjectionMatrix()}updateAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setOrbit(e=this.goalSpherical.theta,t=this.goalSpherical.phi,n=this.goalSpherical.radius){const{minimumAzimuthalAngle:s,maximumAzimuthalAngle:l,minimumPolarAngle:u,maximumPolarAngle:f,minimumRadius:v,maximumRadius:b}=this._options,{theta:S,phi:C,radius:I}=this.goalSpherical,D=Al(e,s,l);isFinite(s)||isFinite(l)||(this.spherical.theta=this.wrapAngle(this.spherical.theta-D)+D);const O=Al(t,u,f),N=Al(n,v,b);return(D!==S||O!==C||N!==I)&&(this.goalSpherical.theta=D,this.goalSpherical.phi=O,this.goalSpherical.radius=N,this.goalSpherical.makeSafe(),this.isUserChange=!1,!0)}setRadius(e){this.goalSpherical.radius=e,this.setOrbit()}setFieldOfView(e){const{minimumFieldOfView:t,maximumFieldOfView:n}=this._options;e=Al(e,t,n),this.goalLogFov=Math.log(e)}setDamperDecayTime(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}adjustOrbit(e,t,n){const{theta:s,phi:l,radius:u}=this.goalSpherical,{minimumRadius:f,maximumRadius:v,minimumFieldOfView:b,maximumFieldOfView:S}=this._options,C=this.spherical.theta-s,I=Math.PI-.001,D=s-Al(e,-I-C,I-C),O=l-t,N=0===n?0:((n>0?v:f)-u)/(Math.log(n>0?S:b)-this.goalLogFov),j=u+n*(isFinite(N)?N:2*(v-f));this.setOrbit(D,O,j),0!==n&&this.setFieldOfView(Math.exp(this.goalLogFov+n))}jumpToGoal(){this.update(0,1e4)}update(e,t){if(this.isStationary())return;const{maximumPolarAngle:n,maximumRadius:s}=this._options,l=this.spherical.theta-this.goalSpherical.theta;Math.abs(l)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=2*Math.sign(l)*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,n),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,s),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera()}updateTouchActionStyle(){const{style:e}=this.element;if(this._interactionEnabled){const{touchAction:t}=this._options;e.touchAction=this._disableZoom&&"none"!==t?"manipulation":t}else e.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new vr(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix()),this.dispatchEvent({type:"change",source:this.isUserChange?e0:"none"})}get canInteract(){return"allow-when-focused"==this._options.interactionPolicy?this.element.getRootNode().activeElement===this.element:"always-allow"===this._options.interactionPolicy}userAdjustOrbit(e,t,n){this.adjustOrbit(e*this.sensitivity,t*this.sensitivity,n),this.isUserChange=!0,this.dispatchEvent({type:"change",source:e0})}wrapAngle(e){const t=(e+Math.PI)/(2*Math.PI);return 2*(t-Math.floor(t))*Math.PI-Math.PI}pixelLengthToSphericalAngle(e){return 2*Math.PI*e/this.element.clientHeight}twoTouchDistance(e,t){const{clientX:n,clientY:s}=e,{clientX:l,clientY:u}=t,f=l-n,v=u-s;return Math.sqrt(f*f+v*v)}handleSinglePointerMove(e){const{clientX:t,clientY:n}=e,s=this.pixelLengthToSphericalAngle(t-this.lastPointerPosition.clientX),l=this.pixelLengthToSphericalAngle(n-this.lastPointerPosition.clientY);this.lastPointerPosition.clientX=t,this.lastPointerPosition.clientY=n,!1===this.isUserPointing&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start",pointer:Object.assign({},e)})),this.userAdjustOrbit(s,l,0)}initializePan(){this.scene.element[H_].style.opacity=1;const{theta:e,phi:t}=this.spherical,n=e-this.scene.yaw;this.panPerPixel=.75/this.element.getBoundingClientRect().height,this.panProjection.set(-Math.cos(n),-Math.cos(t)*Math.sin(n),0,0,Math.sin(t),0,Math.sin(n),-Math.cos(t)*Math.cos(n),0)}movePan(e,t){const{scene:n,lastPointerPosition:s}=this,l=rv.set(e-s.clientX,t-s.clientY,0);l.multiplyScalar(this.spherical.radius*this.panPerPixel),s.clientX=e,s.clientY=t;const f=n.getTarget();f.add(l.applyMatrix3(this.panProjection)),n.boundingSphere.clampPoint(f,f),n.setTarget(f.x,f.y,f.z)}recenter(e){if(!this.enablePan||Math.abs(e.clientX-this.startPointerPosition.clientX)>2||Math.abs(e.clientY-this.startPointerPosition.clientY)>2)return;const{scene:t}=this;t.element[H_].style.opacity=0;const n=t.positionAndNormalFromPoint(t.getNDC(e.clientX,e.clientY));if(null==n){const{cameraTarget:s}=t.element;t.element.cameraTarget="",t.element.cameraTarget=s,this.userAdjustOrbit(0,0,1)}else t.target.worldToLocal(n.position),t.setTarget(n.position.x,n.position.y,n.position.z),this.userAdjustOrbit(0,0,-.2)}resetRadius(){if(!this.enablePan||0===this.panPerPixel)return;const{scene:e}=this;e.element[H_].style.opacity=0;const t=e.positionAndNormalFromPoint(Zx.set(0,0));if(null==t)return;e.target.worldToLocal(t.position);const n=e.getTarget(),{theta:s,phi:l}=this.spherical,u=s-e.yaw,f=rv.set(Math.sin(l)*Math.sin(u),Math.cos(l),Math.sin(l)*Math.cos(u)),v=f.dot(t.position.sub(n));n.add(f.multiplyScalar(v)),e.setTarget(n.x,n.y,n.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-v)}onPointerDown(e){this.canInteract&&(this.isUserPointing=!1,e())}onTouchChange(e){const{targetTouches:t,changedTouches:n}=e;switch(t.length){default:case 1:this.touchMode=this.touchModeRotate,this.lastPointerPosition.clientX=t[0].clientX,this.lastPointerPosition.clientY=t[0].clientY,t[0].identifier===n[0].identifier?(this.startPointerPosition.clientX=t[0].clientX,this.startPointerPosition.clientY=t[0].clientY):this.resetRadius();break;case 2:if(this.touchMode=this.touchDecided&&null===this.touchMode?null:this.touchModeZoom,this.touchDecided=!0,this.enablePan){this.initializePan();const s=.5*(t[0].clientX+t[1].clientX),l=.5*(t[0].clientY+t[1].clientY);this.lastPointerPosition.clientX=s,this.lastPointerPosition.clientY=l,this.startPointerPosition.clientX=s,this.startPointerPosition.clientY=l}}this.lastTouches=t}onPointerUp(){this.element.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end",pointer:Object.assign({},this.lastPointerPosition)})}}const ov=h=>h<.5?2*h*h:(4-2*h)*h-1,t1=(h,e,t=ov)=>n=>h+(e-h)*t(n),av=(h,e)=>{const t=[],n=[];let s=h;for(let l=0;l<e.length;++l){const u=e[l],{value:f,frames:v}=u,S=t1(s,f,u.ease||ov);t.push(S),n.push(v),s=f}return((l,u)=>{const f=u.reduce((b,S)=>b+S,0),v=u.map(b=>b/f);return b=>{let S=0,C=1/0,I=()=>0;for(let D=0;D<v.length&&(C=v[D],I=l[D],!(b<=S+C));++D)S+=C;return I((b-S)/C)}})(t,n)};var rs=function(h,e,t,n){for(var s,l=arguments.length,u=l<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n,f=h.length-1;f>=0;f--)(s=h[f])&&(u=(l<3?s(u):l>3?s(e,t,u):s(e,t))||u);return l>3&&u&&Object.defineProperty(e,t,u),u};const n1=av(0,[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]),r1=av(0,[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]),s1=["front","right","back","left"],o1=["upper-","","lower-"],ug="auto",lv="when-focused",t0="wiggle",cv=h=>({basis:[$d(Fr(h.enablePan?30:45,"deg"))],keywords:{auto:[null]}}),c1=h=>({basis:[$d(Fr(h.enablePan?12:25,"deg"))],keywords:{auto:[null]}}),hv=(()=>{const h=dc("0deg 75deg 105%")[0].terms,e=vs(h[0]),t=vs(h[1]);return n=>{const s=n[Nt].idealCameraDistance();return{basis:[e,t,Fr(s,"m")],keywords:{auto:[null,null,Fr(105,"%")]}}}})(),h1=h=>{const e=1.1*h[Nt].boundingSphere.radius*(h.enablePan?2:1);return{basis:[Fr(-1/0,"rad"),Fr(Math.PI/8,"rad"),Fr(e,"m")],keywords:{auto:[null,null,null]}}},u1=h=>{const e=hv(h),t=new Fu([],e).evaluate()[2];return{basis:[Fr(1/0,"rad"),Fr(Math.PI-Math.PI/8,"rad"),Fr(t,"m")],keywords:{auto:[null,null,null]}}},d1=h=>{const e=h[Nt].boundingBox.getCenter(new me);return{basis:[Fr(e.x,"m"),Fr(e.y,"m"),Fr(e.z,"m")],keywords:{auto:[null,null,null]}}},uv=Math.PI/2,p1=Math.PI/3,m1=uv/2,f1=2*Math.PI,$n=Symbol("controls"),dg=Symbol("promptElement"),H_=Symbol("panElement"),n0=Symbol("promptAnimatedContainer"),j_=Symbol("deferInteractionPrompt"),dv=Symbol("updateAria"),pv=Symbol("updateCameraForRadius"),r0=Symbol("onBlur"),s0=Symbol("onFocus"),o0=Symbol("onChange"),pg=Symbol("onPointerChange"),xh=Symbol("waitingToPromptUser"),mg=Symbol("userHasInteracted"),lp=Symbol("promptElementVisibleTime"),fg=Symbol("lastPromptOffset"),gg=Symbol("focusedTime"),a0=Symbol("lastSpherical"),_g=Symbol("jumpCamera"),l0=Symbol("initialized"),yg=Symbol("maintainThetaPhi"),mv=Symbol("syncCameraOrbit"),fv=Symbol("syncFieldOfView"),gv=Symbol("syncCameraTarget"),_v=Symbol("syncMinCameraOrbit"),yv=Symbol("syncMaxCameraOrbit"),vv=Symbol("syncMinFieldOfView"),xv=Symbol("syncMaxFieldOfView");var vg=function(h,e,t,n){for(var s,l=arguments.length,u=l<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n,f=h.length-1;f>=0;f--)(s=h[f])&&(u=(l<3?s(u):l>3?s(e,t,u):s(e,t))||u);return l>3&&u&&Object.defineProperty(e,t,u),u};const W_="auto",cp=Symbol("defaultProgressBarElement"),wv=Symbol("defaultProgressMaskElement"),bh=Symbol("posterContainerElement"),zm=Symbol("defaultPosterElement"),xg=Symbol("posterDismissalSource"),c0=Symbol("hidePoster"),Z_=Symbol("modelIsRevealed"),h0=Symbol("updateProgressBar"),bg=Symbol("lastReportedProgress"),wg=Symbol("transitioned"),u0=Symbol("onTransitionEnd"),v1=Symbol("ariaLabelCallToAction"),d0=Symbol("onClick"),p0=Symbol("onKeydown"),m0=Symbol("onProgress");class f0{constructor(){this.pluginCallbacks=[],this.register(function(e){return new z1(e)}),this.register(function(e){return new O1(e)}),this.register(function(e){return new B1(e)}),this.register(function(e){return new U1(e)}),this.register(function(e){return new N1(e)}),this.register(function(e){return new F1(e)})}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){"object"==typeof n&&(console.warn("THREE.GLTFExporter: parse() expects options as the fourth argument now."),s=n);const l=new k1,u=[];for(let f=0,v=this.pluginCallbacks.length;f<v;f++)u.push(this.pluginCallbacks[f](l));l.setPlugins(u),l.write(e,t,s).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(s,l){n.parse(e,s,l,t)})}}const ua={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987,1001:33071,1e3:10497,1002:33648},Cv={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function Mg(h,e){return h.length===e.length&&h.every(function(t,n){return t===e[n]})}function Av(h){return 4*Math.ceil(h/4)}function y0(h,e=0){const t=Av(h.byteLength);if(t!==h.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(h)),0!==e)for(let s=h.byteLength;s<t;s++)n[s]=e;return n.buffer}return h}let Pv=null;class k1{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}write(e,t,n){var s=this;return(0,m.Z)(function*(){s.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),s.options.animations.length>0&&(s.options.trs=!0),s.processInput(e),yield Promise.all(s.pending);const f=s.json;n=s.options;const v=s.extensionsUsed,b=new Blob(s.buffers,{type:"application/octet-stream"}),S=Object.keys(v);if(S.length>0&&(f.extensionsUsed=S),f.buffers&&f.buffers.length>0&&(f.buffers[0].byteLength=b.size),!0===n.binary){const C=new window.FileReader;C.readAsArrayBuffer(b),C.onloadend=function(){const I=y0(C.result),D=new DataView(new ArrayBuffer(8));D.setUint32(0,I.byteLength,!0),D.setUint32(4,5130562,!0);const O=y0(function(te){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(te).buffer;const oe=new Uint8Array(new ArrayBuffer(te.length));for(let de=0,Ce=te.length;de<Ce;de++){const Le=te.charCodeAt(de);oe[de]=Le>255?32:Le}return oe.buffer}(JSON.stringify(f)),32),N=new DataView(new ArrayBuffer(8));N.setUint32(0,O.byteLength,!0),N.setUint32(4,1313821514,!0);const j=new ArrayBuffer(12),U=new DataView(j);U.setUint32(0,1179937895,!0),U.setUint32(4,2,!0),U.setUint32(8,12+N.byteLength+O.byteLength+D.byteLength+I.byteLength,!0);const Y=new Blob([j,N,O,D,I],{type:"application/octet-stream"}),Z=new window.FileReader;Z.readAsArrayBuffer(Y),Z.onloadend=function(){t(Z.result)}}}else if(f.buffers&&f.buffers.length>0){const C=new window.FileReader;C.readAsDataURL(b),C.onloadend=function(){f.buffers[0].uri=C.result,t(f)}}else t(f)})()}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const n=this.options,s=this.extensionsUsed;try{const l=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&l.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const u in l.gltfExtensions)t.extensions[u]=l.gltfExtensions[u],s[u]=!0;delete l.gltfExtensions}Object.keys(l).length>0&&(t.extras=l)}catch(l){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+l.message)}}getUID(e){return this.uids.has(e)||this.uids.set(e,this.uid++),this.uids.get(e)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new me;for(let n=0,s=e.count;n<s;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),s=new me;for(let l=0,u=n.count;l<u;l++)s.fromBufferAttribute(n,l),0===s.x&&0===s.y&&0===s.z?s.setX(1):s.normalize(),n.setXYZ(l,s.x,s.y,s.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const s={};0===t.offset.x&&0===t.offset.y||(s.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(s.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(s.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const n=null==e?void 0:e.image,s=null==t?void 0:t.image,l=Math.max((null==n?void 0:n.width)||0,(null==s?void 0:s.width)||0),u=Math.max((null==n?void 0:n.height)||0,(null==s?void 0:s.height)||0),f=document.createElement("canvas");f.width=l,f.height=u;const v=f.getContext("2d");v.fillStyle="#00ffff",v.fillRect(0,0,l,u);const b=v.getImageData(0,0,l,u);if(n){v.drawImage(n,0,0,l,u);const C=v.getImageData(0,0,l,u).data;for(let I=2;I<C.length;I+=4)b.data[I]=C[I]}if(s){v.drawImage(s,0,0,l,u);const C=v.getImageData(0,0,l,u).data;for(let I=1;I<C.length;I+=4)b.data[I]=C[I]}v.putImageData(b,0,0);const S=(e||t).clone();return S.source=new Dt(f).source,S}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,s,l){const u=this.json;let f;u.bufferViews||(u.bufferViews=[]),f=5121===t?1:5123===t?2:4;const v=Av(s*e.itemSize*f),b=new DataView(new ArrayBuffer(v));let S=0;for(let I=n;I<n+s;I++)for(let D=0;D<e.itemSize;D++){let O;e.itemSize>4?O=e.array[I*e.itemSize+D]:0===D?O=e.getX(I):1===D?O=e.getY(I):2===D?O=e.getZ(I):3===D&&(O=e.getW(I)),5126===t?b.setFloat32(S,O,!0):5125===t?b.setUint32(S,O,!0):5123===t?b.setUint16(S,O,!0):5121===t&&b.setUint8(S,O),S+=f}const C={buffer:this.processBuffer(b.buffer),byteOffset:this.byteOffset,byteLength:v};return void 0!==l&&(C.target=l),34962===l&&(C.byteStride=e.itemSize*f),this.byteOffset+=v,u.bufferViews.push(C),{id:u.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(s){const l=new window.FileReader;l.readAsArrayBuffer(e),l.onloadend=function(){const u=y0(l.result),f={buffer:t.processBuffer(u),byteOffset:t.byteOffset,byteLength:u.byteLength};t.byteOffset+=u.byteLength,s(n.bufferViews.push(f)-1)}})}processAccessor(e,t,n,s){const l=this.options,u=this.json;let f;if(e.array.constructor===Float32Array)f=5126;else if(e.array.constructor===Uint32Array)f=5125;else if(e.array.constructor===Uint16Array)f=5123;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");f=5121}if(void 0===n&&(n=0),void 0===s&&(s=e.count),l.truncateDrawRange&&void 0!==t&&null===t.index){const I=n+s,D=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;n=Math.max(n,t.drawRange.start),(s=Math.min(I,D)-n)<0&&(s=0)}if(0===s)return null;const v=function(I,D,O){const N={min:new Array(I.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(I.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let j=D;j<D+O;j++)for(let U=0;U<I.itemSize;U++){let Q;I.itemSize>4?Q=I.array[j*I.itemSize+U]:0===U?Q=I.getX(j):1===U?Q=I.getY(j):2===U?Q=I.getZ(j):3===U&&(Q=I.getW(j)),N.min[U]=Math.min(N.min[U],Q),N.max[U]=Math.max(N.max[U],Q)}return N}(e,n,s);let b;void 0!==t&&(b=e===t.index?34963:34962);const S=this.processBufferView(e,f,n,s,b),C={bufferView:S.id,byteOffset:S.byteOffset,componentType:f,count:s,max:v.max,min:v.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(C.normalized=!0),u.accessors||(u.accessors=[]),u.accessors.push(C)-1}processImage(e,t,n,s="image/png"){const l=this,u=l.cache,f=l.json,v=l.options,b=l.pending;u.images.has(e)||u.images.set(e,{});const S=u.images.get(e),C=s+":flipY/"+n.toString();if(void 0!==S[C])return S[C];f.images||(f.images=[]);const I={mimeType:s};if(v.embedImages){const O=Pv=Pv||document.createElement("canvas");O.width=Math.min(e.width,v.maxTextureSize),O.height=Math.min(e.height,v.maxTextureSize);const N=O.getContext("2d");if(!0===n&&(N.translate(0,O.height),N.scale(1,-1)),"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)N.drawImage(e,0,0,O.width,O.height);else{1023!==t&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>v.maxTextureSize||e.height>v.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const j=new Uint8ClampedArray(e.height*e.width*4);for(let U=0;U<j.length;U+=4)j[U+0]=e.data[U+0],j[U+1]=e.data[U+1],j[U+2]=e.data[U+2],j[U+3]=e.data[U+3];N.putImageData(new ImageData(j,e.width,e.height),0,0)}!0===v.binary?b.push(new Promise(function(j){O.toBlob(function(U){l.processBufferViewImage(U).then(function(Q){I.bufferView=Q,j()})},s)})):I.uri=O.toDataURL(s)}else I.uri=e.src;const D=f.images.push(I)-1;return S[C]=D,D}processSampler(e){const t=this.json;return t.samplers||(t.samplers=[]),t.samplers.push({magFilter:ua[e.magFilter],minFilter:ua[e.minFilter],wrapS:ua[e.wrapS],wrapT:ua[e.wrapT]})-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);let s=e.userData.mimeType;"image/webp"===s&&(s="image/png");const l={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(l.name=e.name),this._invokeAll(function(f){f.writeTexture&&f.writeTexture(e,l)});const u=n.textures.push(l)-1;return t.textures.set(e,u),u}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const s={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const l=e.color.toArray().concat([e.opacity]);if(Mg(l,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=l),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const f=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),v={index:this.processTexture(f)};this.applyTextureTransform(v,f),s.pbrMetallicRoughness.metallicRoughnessTexture=v}if(e.map){const f={index:this.processTexture(e.map)};this.applyTextureTransform(f,e.map),s.pbrMetallicRoughness.baseColorTexture=f}if(e.emissive){const f=e.emissive.clone().multiplyScalar(e.emissiveIntensity),v=Math.max(f.r,f.g,f.b);if(v>1&&(f.multiplyScalar(1/v),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),v>0&&(s.emissiveFactor=f.toArray()),e.emissiveMap){const b={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(b,e.emissiveMap),s.emissiveTexture=b}}if(e.normalMap){const f={index:this.processTexture(e.normalMap)};e.normalScale&&1!==e.normalScale.x&&(f.scale=e.normalScale.x),this.applyTextureTransform(f,e.normalMap),s.normalTexture=f}if(e.aoMap){const f={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(f.strength=e.aoMapIntensity),this.applyTextureTransform(f,e.aoMap),s.occlusionTexture=f}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),2===e.side&&(s.doubleSided=!0),""!==e.name&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll(function(f){f.writeMaterial&&f.writeMaterial(e,s)});const u=n.materials.push(s)-1;return t.materials.set(e,u),u}processMesh(e){const t=this.cache,n=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let Y=0,Z=e.material.length;Y<Z;Y++)s.push(e.material[Y].uuid);else s.push(e.material.uuid);const l=s.join(":");if(t.meshes.has(l))return t.meshes.get(l);const u=e.geometry;let f;if(f=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4,!0!==u.isBufferGeometry)throw new Error("THREE.GLTFExporter: Geometry is not of type THREE.BufferGeometry.");const v={},b={},S=[],C=[],I={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},D=u.getAttribute("normal");void 0===D||this.isNormalizedNormalAttribute(D)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),u.setAttribute("normal",this.createNormalizedNormalAttribute(D)));let O=null;for(let Y in u.attributes){if("morph"===Y.slice(0,5))continue;const Z=u.attributes[Y];if(Y=I[Y]||Y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(Y)||(Y="_"+Y),t.attributes.has(this.getUID(Z))){b[Y]=t.attributes.get(this.getUID(Z));continue}O=null;const te=Z.array;"JOINTS_0"!==Y||te instanceof Uint16Array||te instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),O=new un(new Uint16Array(te),Z.itemSize,Z.normalized));const oe=this.processAccessor(O||Z,u);null!==oe&&(b[Y]=oe,t.attributes.set(this.getUID(Z),oe))}if(void 0!==D&&u.setAttribute("normal",D),0===Object.keys(b).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const Y=[],Z=[],te={};if(void 0!==e.morphTargetDictionary)for(const oe in e.morphTargetDictionary)te[e.morphTargetDictionary[oe]]=oe;for(let oe=0;oe<e.morphTargetInfluences.length;++oe){const de={};let Ce=!1;for(const Le in u.morphAttributes){if("position"!==Le&&"normal"!==Le){Ce||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),Ce=!0);continue}const Oe=u.morphAttributes[Le][oe],Ze=Le.toUpperCase(),et=u.attributes[Le];if(t.attributes.has(this.getUID(Oe))){de[Ze]=t.attributes.get(this.getUID(Oe));continue}const ot=Oe.clone();if(!u.morphTargetsRelative)for(let Ve=0,at=Oe.count;Ve<at;Ve++)ot.setXYZ(Ve,Oe.getX(Ve)-et.getX(Ve),Oe.getY(Ve)-et.getY(Ve),Oe.getZ(Ve)-et.getZ(Ve));de[Ze]=this.processAccessor(ot,u),t.attributes.set(this.getUID(et),de[Ze])}C.push(de),Y.push(e.morphTargetInfluences[oe]),void 0!==e.morphTargetDictionary&&Z.push(te[oe])}v.weights=Y,Z.length>0&&(v.extras={},v.extras.targetNames=Z)}const N=Array.isArray(e.material);if(N&&0===u.groups.length)return null;const j=N?e.material:[e.material],U=N?u.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let Y=0,Z=U.length;Y<Z;Y++){const te={mode:f,attributes:b};if(this.serializeUserData(u,te),C.length>0&&(te.targets=C),null!==u.index){let de=this.getUID(u.index);void 0===U[Y].start&&void 0===U[Y].count||(de+=":"+U[Y].start+":"+U[Y].count),t.attributes.has(de)?te.indices=t.attributes.get(de):(te.indices=this.processAccessor(u.index,u,U[Y].start,U[Y].count),t.attributes.set(de,te.indices)),null===te.indices&&delete te.indices}const oe=this.processMaterial(j[U[Y].materialIndex]);null!==oe&&(te.material=oe),S.push(te)}v.primitives=S,n.meshes||(n.meshes=[]),this._invokeAll(function(Y){Y.writeMesh&&Y.writeMesh(e,v)});const Q=n.meshes.push(v)-1;return t.meshes.set(l,Q),Q}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,s={type:n?"orthographic":"perspective"};return n?s.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:Ul.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const n=this.json,s=this.nodeMap;n.animations||(n.animations=[]);const l=(e=f0.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,u=[],f=[];for(let v=0;v<l.length;++v){const b=l[v],S=$i.parseTrackName(b.name);let C=$i.findNode(t,S.nodeName);const I=Cv[S.propertyName];if("bones"===S.objectName&&(C=!0===C.isSkinnedMesh?C.skeleton.getBoneByName(S.objectIndex):void 0),!C||!I)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',b.name),null;const D=1;let O,N=b.values.length/b.times.length;I===Cv.morphTargetInfluences&&(N/=C.morphTargetInfluences.length),!0===b.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(O="CUBICSPLINE",N/=3):O=2300===b.getInterpolation()?"STEP":"LINEAR",f.push({input:this.processAccessor(new un(b.times,D)),output:this.processAccessor(new un(b.values,N)),interpolation:O}),u.push({sampler:f.length-1,target:{node:s.get(C),path:I}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:f,channels:u}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,s=t.nodes[n.get(e)],l=e.skeleton;if(void 0===l)return null;const u=e.skeleton.bones[0];if(void 0===u)return null;const f=[],v=new Float32Array(16*l.bones.length),b=new ii;for(let S=0;S<l.bones.length;++S)f.push(n.get(l.bones[S])),b.copy(l.boneInverses[S]),b.multiply(e.bindMatrix).toArray(v,16*S);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new un(v,16)),joints:f,skeleton:n.get(u)}),s.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const l={};if(n.trs){const f=e.quaternion.toArray(),v=e.position.toArray(),b=e.scale.toArray();Mg(f,[0,0,0,1])||(l.rotation=f),Mg(v,[0,0,0])||(l.translation=v),Mg(b,[1,1,1])||(l.scale=b)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Mg(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(l.matrix=e.matrix.elements);if(""!==e.name&&(l.name=String(e.name)),this.serializeUserData(e,l),e.isMesh||e.isLine||e.isPoints){const f=this.processMesh(e);null!==f&&(l.mesh=f)}else e.isCamera&&(l.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const f=[];for(let v=0,b=e.children.length;v<b;v++){const S=e.children[v];if(S.visible||!1===n.onlyVisible){const C=this.processNode(S);null!==C&&f.push(C)}}f.length>0&&(l.children=f)}this._invokeAll(function(f){f.writeNode&&f.writeNode(e,l)});const u=t.nodes.push(l)-1;return s.set(e,u),u}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};""!==e.name&&(s.name=e.name),t.scenes.push(s);const l=[];for(let u=0,f=e.children.length;u<f;u++){const v=e.children[u];if(v.visible||!1===n.onlyVisible){const b=this.processNode(v);null!==b&&l.push(b)}}l.length>0&&(s.nodes=l),this.serializeUserData(e,s)}processObjects(e){const t=new mt;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const n=[];for(let s=0;s<e.length;s++)e[s]instanceof mt?this.processScene(e[s]):n.push(e[s]);n.length>0&&this.processObjects(n);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class z1{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,s=n.json,l=n.extensionsUsed,u={};e.name&&(u.name=e.name),u.color=e.color.toArray(),u.intensity=e.intensity,e.isDirectionalLight?u.type="directional":e.isPointLight?(u.type="point",e.distance>0&&(u.range=e.distance)):e.isSpotLight&&(u.type="spot",e.distance>0&&(u.range=e.distance),u.spot={},u.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,u.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),l[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},l[this.name]=!0);const f=s.extensions[this.name].lights;f.push(u),t.extensions=t.extensions||{},t.extensions[this.name]={light:f.length-1}}}class O1{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class B1{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const n=this.writer,s=n.extensionsUsed,l={};t.pbrMetallicRoughness.baseColorFactor&&(l.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const u=[1,1,1];if(e.specular.toArray(u,0),l.specularFactor=u,l.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(l.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const f={index:n.processTexture(e.specularMap)};n.applyTextureTransform(f,e.specularMap),l.specularGlossinessTexture=f}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class F1{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.clearcoatFactor=e.clearcoat,e.clearcoatMap){const u={index:n.processTexture(e.clearcoatMap)};n.applyTextureTransform(u,e.clearcoatMap),l.clearcoatTexture=u}if(l.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const u={index:n.processTexture(e.clearcoatRoughnessMap)};n.applyTextureTransform(u,e.clearcoatRoughnessMap),l.clearcoatRoughnessTexture=u}if(e.clearcoatNormalMap){const u={index:n.processTexture(e.clearcoatNormalMap)};n.applyTextureTransform(u,e.clearcoatNormalMap),l.clearcoatNormalTexture=u}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class U1{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.transmissionFactor=e.transmission,e.transmissionMap){const u={index:n.processTexture(e.transmissionMap)};n.applyTextureTransform(u,e.transmissionMap),l.transmissionTexture=u}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class N1{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.thicknessFactor=e.thickness,e.thicknessMap){const u={index:n.processTexture(e.thicknessMap)};n.applyTextureTransform(u,e.thicknessMap),l.thicknessTexture=u}l.attenuationDistance=e.attenuationDistance,l.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}f0.Utils={insertKeyframe:function(h,e){const n=h.getValueSize(),s=new h.TimeBufferType(h.times.length+1),l=new h.ValueBufferType(h.values.length+n),u=h.createInterpolant(new h.ValueBufferType(n));let f;if(0===h.times.length){s[0]=e;for(let v=0;v<n;v++)l[v]=0;f=0}else if(e<h.times[0]){if(Math.abs(h.times[0]-e)<.001)return 0;s[0]=e,s.set(h.times,1),l.set(u.evaluate(e),0),l.set(h.values,n),f=0}else if(e>h.times[h.times.length-1]){if(Math.abs(h.times[h.times.length-1]-e)<.001)return h.times.length-1;s[s.length-1]=e,s.set(h.times,0),l.set(h.values,0),l.set(u.evaluate(e),h.values.length),f=s.length-1}else for(let v=0;v<h.times.length;v++){if(Math.abs(h.times[v]-e)<.001)return v;if(h.times[v]<e&&h.times[v+1]>e){s.set(h.times.slice(0,v+1),0),s[v+1]=e,s.set(h.times.slice(v+1),v+2),l.set(h.values.slice(0,(v+1)*n),0),l.set(u.evaluate(e),(v+1)*n),l.set(h.values.slice((v+1)*n),(v+2)*n),f=v+1;break}}return h.times=s,h.values=l,f},mergeMorphTargetTracks:function(h,e){const t=[],n={},s=h.tracks;for(let l=0;l<s.length;++l){let u=s[l];const f=$i.parseTrackName(u.name),v=$i.findNode(e,f.nodeName);if("morphTargetInfluences"!==f.propertyName||void 0===f.propertyIndex){t.push(u);continue}if(u.createInterpolant!==u.InterpolantFactoryMethodDiscrete&&u.createInterpolant!==u.InterpolantFactoryMethodLinear){if(u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),u=u.clone(),u.setInterpolation(2301)}const b=v.morphTargetInfluences.length,S=v.morphTargetDictionary[f.propertyIndex];if(void 0===S)throw new Error("THREE.GLTFExporter: Morph target name not found: "+f.propertyIndex);let C;if(void 0===n[v.uuid]){C=u.clone();const D=new C.ValueBufferType(b*C.times.length);for(let O=0;O<C.times.length;O++)D[O*b+S]=C.values[O];C.name=(f.nodeName||"")+".morphTargetInfluences",C.values=D,n[v.uuid]=C,t.push(C);continue}const I=u.createInterpolant(new u.ValueBufferType(1));C=n[v.uuid];for(let D=0;D<C.times.length;D++)C.values[D*b+S]=I.evaluate(C.times[D]);for(let D=0;D<u.times.length;D++){const O=this.insertKeyframe(C,u.times[D]);C.values[O*b+S]=u.values[D]}}return h.tracks=t,h}};const Iv=h=>void 0!==h.material&&h.userData&&h.userData.variantMaterials&&!!Array.from(h.userData.variantMaterials.values()).filter(e=>q_(e.material)),q_=h=>h&&h.isMaterial&&!Array.isArray(h);class V1{constructor(e){this.writer=e,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(e){const t=new Set;for(const n of e)n.traverse(s=>{if(!Iv(s))return;const l=s.userData.variantMaterials,u=s.userData.variantData;for(const[f,v]of u){const b=l.get(v.index);q_(b.material)&&t.add(f)}});t.forEach(n=>this.variantNames.push(n))}writeMesh(e,t){if(!Iv(e))return;const n=e.userData,s=n.variantMaterials,l=n.variantData,u=new Map,f=new Map,v=Array.from(l.values()).sort((C,I)=>C.index-I.index);for(const[C,I]of v.entries())f.set(I.index,C);for(const C of l.values()){const I=s.get(C.index).material;if(!q_(I))continue;const D=this.writer.processMaterial(I);u.has(D)||u.set(D,{material:D,variants:[]}),u.get(D).variants.push(f.get(C.index))}const b=Array.from(u.values()).map(C=>C.variants.sort((I,D)=>I-D)&&C).sort((C,I)=>C.material-I.material);if(0===b.length)return;const S=q_(n.originalMaterial)?this.writer.processMaterial(n.originalMaterial):-1;for(const C of t.primitives)S>=0&&(C.material=S),C.extensions=C.extensions||{},C.extensions[this.name]={mappings:b}}afterParse(){if(0===this.variantNames.length)return;const e=this.writer.json;e.extensions=e.extensions||{};const t=this.variantNames.map(n=>({name:n}));e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}}const Cr=Symbol("correlatedObjects"),fn=Symbol("sourceObject"),Rl=Symbol("onUpdate");class Sg{constructor(e,t,n=null){this[Rl]=e,this[fn]=t,this[Cr]=n}}const G1=new lc,Dv=new Pr,H1=new Xo(2,2);let j1=0;const $_=Symbol("threeTexture");class W1 extends Sg{get[$_](){var e;return console.assert(null!=this[Cr]&&this[Cr].size>0,"Image correlated object is undefined"),null===(e=this[Cr])||void 0===e?void 0:e.values().next().value}constructor(e,t,n){super(e,n=null!=n?n:{name:t&&t.image&&t.image.src?t.image.src.split("/").pop():"adhoc_image",uri:t&&t.image&&t.image.src?t.image.src:"adhoc_image"+j1++},new Set(t?[t]:[]))}get name(){return this[fn].name||""}get uri(){return this[fn].uri}get bufferView(){return this[fn].bufferView}get type(){return null!=this.uri?"external":"embedded"}set name(e){this[fn].name=e}setURI(e){var t=this;return(0,m.Z)(function*(){t[fn].uri=e,t[fn].name=e.split("/").pop();const n=yield new Promise((l,u)=>{G1.load(e,l,void 0,u)}),s=t[$_];s.image=n,s.needsUpdate=!0,t[Rl]()})()}createThumbnail(e,t){var n=this;return(0,m.Z)(function*(){const s=new mt;Dv.map=n[$_];const l=new di(H1,Dv);s.add(l);const u=new It(-1,1,1,-1,0,1),{threeRenderer:f}=aa.singleton,v=new Fe(e,t);f.setRenderTarget(v),f.render(s,u),f.setRenderTarget(null);const b=new Uint8Array(e*t*4);f.readRenderTargetPixels(v,0,0,e,t,b),so.width=e,so.height=t;const S=so.getContext("2d"),C=S.createImageData(e,t);return C.data.set(b),S.putImageData(C,0,0),new Promise(function(){var I=(0,m.Z)(function*(D,O){so.toBlob(N=>{if(!N)return O("Failed to capture thumbnail.");D(URL.createObjectURL(N))},"image/png")});return function(D,O){return I.apply(this,arguments)}}())})()}}var Ha,hp,h;(h=Ha||(Ha={}))[h.Nearest=9728]="Nearest",h[h.Linear=9729]="Linear",h[h.NearestMipmapNearest=9984]="NearestMipmapNearest",h[h.LinearMipmapNearest=9985]="LinearMipmapNearest",h[h.NearestMipmapLinear=9986]="NearestMipmapLinear",h[h.LinearMipmapLinear=9987]="LinearMipmapLinear",function(h){h[h.ClampToEdge=33071]="ClampToEdge",h[h.MirroredRepeat=33648]="MirroredRepeat",h[h.Repeat=10497]="Repeat"}(hp||(hp={}));const Z1=(()=>{const h=[Ha.Nearest,Ha.Linear,Ha.NearestMipmapNearest,Ha.LinearMipmapLinear,Ha.NearestMipmapLinear,Ha.LinearMipmapLinear];return e=>h.indexOf(e)>-1})(),q1=(()=>{const h=[Ha.Nearest,Ha.Linear];return e=>h.indexOf(e)>-1})(),$1=(()=>{const h=[hp.ClampToEdge,hp.MirroredRepeat,hp.Repeat];return e=>h.indexOf(e)>-1})(),Lv=Symbol("threeTextures"),Tg=Symbol("setProperty"),Om=Symbol("sourceSampler");class X1 extends Sg{get[Lv](){return console.assert(null!=this[Cr]&&this[Cr].size>0,"Sampler correlated object is undefined"),this[Cr]}get[Om](){return console.assert(null!=this[fn],"Sampler source is undefined"),this[fn]}constructor(e,t,n){null==(n=null!=n?n:{}).minFilter&&(n.minFilter=t?t.minFilter:Ha.LinearMipmapLinear),null==n.magFilter&&(n.magFilter=t?t.magFilter:Ha.Linear),null==n.wrapS&&(n.wrapS=t?t.wrapS:hp.Repeat),null==n.wrapT&&(n.wrapT=t?t.wrapT:hp.Repeat),super(e,n,new Set(t?[t]:[]))}get name(){return this[fn].name||""}get minFilter(){return this[Om].minFilter}get magFilter(){return this[Om].magFilter}get wrapS(){return this[Om].wrapS}get wrapT(){return this[Om].wrapT}setMinFilter(e){this[Tg]("minFilter",e)}setMagFilter(e){this[Tg]("magFilter",e)}setWrapS(e){this[Tg]("wrapS",e)}setWrapT(e){this[Tg]("wrapT",e)}[Tg](e,t){const n=this[Om];if(null!=n){if(((s,l)=>{switch(s){case"minFilter":return Z1(l);case"magFilter":return q1(l);case"wrapS":case"wrapT":return $1(l);default:throw new Error(`Cannot configure property "${s}" on Sampler`)}})(e,t)){n[e]=t;for(const s of this[Lv])s[e]=t,s.needsUpdate=!0}this[Rl]()}}}const Rv=Symbol("image"),kv=Symbol("sampler");class zv extends Sg{constructor(e,t,n=null,s=null,l=null){super(e,n||{},new Set(t?[t]:[])),this[kv]=new X1(e,t,s),this[Rv]=new W1(e,t,l)}get name(){return this[fn].name||""}set name(e){this[fn].name=e}get sampler(){return this[kv]}get source(){return this[Rv]}}var Ov,Bv;const X_=Symbol("texture"),up=Symbol("transform"),v0=Symbol("materials"),Fv=Symbol("usage");var ja;!function(h){h[h.Base=0]="Base",h[h.MetallicRoughness=1]="MetallicRoughness",h[h.Normal=2]="Normal",h[h.Occlusion=3]="Occlusion",h[h.Emissive=4]="Emissive"}(ja||(ja={}));class Eg{constructor(e,t,n,s,l,u){if(this[Ov]=null,this[Bv]={rotation:0,scale:new Mt(1,1),offset:new Mt(0,0)},u&&n){const f=l.textures?l.textures[u.index]:null,v=f&&l.samplers?l.samplers[f.sampler]:null,b=f&&l.images?l.images[f.source]:null;this[up].rotation=n.rotation,this[up].scale.copy(n.repeat),this[up].offset.copy(n.offset),this[X_]=new zv(e,n,f,v,b)}this.onUpdate=e,this[v0]=s,this[Fv]=t}get texture(){return this[X_]}setTexture(e){const t=null!=e?e.source[$_]:null;let n=3001;if(this[X_]=e,this[v0])for(const s of this[v0]){switch(this[Fv]){case ja.Base:s.map=t;break;case ja.MetallicRoughness:n=3e3,s.metalnessMap=t,s.roughnessMap=t;break;case ja.Normal:n=3e3,s.normalMap=t;break;case ja.Occlusion:n=3e3,s.aoMap=t;break;case ja.Emissive:s.emissiveMap=t}s.needsUpdate=!0}t&&(t.encoding=n,t.rotation=this[up].rotation,t.repeat=this[up].scale,t.offset=this[up].offset),this.onUpdate()}}Ov=X_,Bv=up;const Y_=Symbol("threeMaterials"),Uv=Symbol("baseColorTexture"),Nv=Symbol("metallicRoughnessTexture");class Y1 extends Sg{constructor(e,t,n,s){super(e,n,s),null==n.baseColorFactor&&(n.baseColorFactor=[1,1,1,1]),null==n.roughnessFactor&&(n.roughnessFactor=1),null==n.metallicFactor&&(n.metallicFactor=1);const{baseColorTexture:l,metallicRoughnessTexture:u}=n,{map:f,metalnessMap:v}=s.values().next().value;this[Uv]=new Eg(e,ja.Base,f,s,t,l||null),this[Nv]=new Eg(e,ja.MetallicRoughness,v,s,t,u||null)}get[Y_](){return this[Cr]}get baseColorFactor(){return this[fn].baseColorFactor}get metallicFactor(){return this[fn].metallicFactor}get roughnessFactor(){return this[fn].roughnessFactor}get baseColorTexture(){return this[Uv]}get metallicRoughnessTexture(){return this[Nv]}setBaseColorFactor(e){for(const t of this[Y_])t.color.fromArray(e),t.opacity=e[3];this[fn].baseColorFactor=e,this[Rl]()}setMetallicFactor(e){for(const t of this[Y_])t.metalness=e;this[fn].metallicFactor=e,this[Rl]()}setRoughnessFactor(e){for(const t of this[Y_])t.roughness=e;this[fn].roughnessFactor=e,this[Rl]()}}var Vv;const Gv=Symbol("pbrMetallicRoughness"),Hv=Symbol("normalTexture"),jv=Symbol("occlusionTexture"),Wv=Symbol("emissiveTexture"),J1=Symbol("backingThreeMaterial"),x0=Symbol("applyAlphaCutoff"),dp=Symbol("lazyLoadGLTFInfo"),b0=Symbol("initialize"),w0=Symbol("getLoadedMaterial"),Ro=Symbol("ensureMaterialIsLoaded"),Zv=Symbol("gltfIndex"),Cg=Symbol("setActive"),J_=Symbol("variantIndices"),M0=Symbol("isActive"),K_=Symbol("variantSet"),qv=Symbol("modelVariants");class S0 extends Sg{constructor(e,t,n,s,l,u,f,v){super(e,n,f),this[Vv]=new Set,this[Zv]=s,this[M0]=l,this[qv]=u,null==v?this[b0](t):this[dp]=v}get[(Vv=K_,J1)](){return this[Cr].values().next().value}[b0](e){const t=this[Rl],n=this[fn],s=this[Cr];n.extensions&&n.extensions.KHR_materials_pbrSpecularGlossiness&&console.warn(`Material ${n.name} uses a deprecated extension\n          "KHR_materials_pbrSpecularGlossiness", please use\n          "pbrMetallicRoughness" instead. Specular Glossiness materials are\n          currently supported for rendering, but not for our scene-graph API,\n          nor for auto-generation of USDZ for Quick Look.`),null==n.pbrMetallicRoughness&&(n.pbrMetallicRoughness={}),this[Gv]=new Y1(t,e,n.pbrMetallicRoughness,s),null==n.emissiveFactor&&(n.emissiveFactor=[0,0,0]),null==n.doubleSided&&(n.doubleSided=!1),null==n.alphaMode&&(n.alphaMode="OPAQUE"),null==n.alphaCutoff&&(n.alphaCutoff=.5);const{normalTexture:l,occlusionTexture:u,emissiveTexture:f}=n,{normalMap:v,aoMap:b,emissiveMap:S}=s.values().next().value;this[Hv]=new Eg(t,ja.Normal,v,s,e,l||null),this[jv]=new Eg(t,ja.Occlusion,b,s,e,u||null),this[Wv]=new Eg(t,ja.Emissive,S,s,e,f||null)}[w0](){var e=this;return(0,m.Z)(function*(){if(null!=e[dp]){const{set:t,material:n}=yield e[dp].doLazyLoad();return e[Cr]=t,e[b0](e[dp].gltf),e[dp]=void 0,e.ensureLoaded=(0,m.Z)(function*(){}),n}return e[Cr].values().next().value})()}[Ro](){if(null!=this[dp])throw new Error(`Material "${this.name}" has not been loaded, call 'await\n    myMaterial.ensureLoaded()' before using an unloaded material.`)}ensureLoaded(){var e=this;return(0,m.Z)(function*(){yield e[w0]()})()}get isLoaded(){return null==this[dp]}get isActive(){return this[M0]}[Cg](e){this[M0]=e}get name(){return this[fn].name}set name(e){const t=this[fn];if(null!=t&&(t.name=e),null!=this[Cr])for(const n of this[Cr])n.name=e}get pbrMetallicRoughness(){return this[Ro](),this[Gv]}get normalTexture(){return this[Ro](),this[Hv]}get occlusionTexture(){return this[Ro](),this[jv]}get emissiveTexture(){return this[Ro](),this[Wv]}get emissiveFactor(){return this[Ro](),this[fn].emissiveFactor}get index(){return this[Zv]}[J_](){return this[K_]}hasVariant(e){const t=this[qv].get(e);return null!=t&&this[K_].has(t.index)}setEmissiveFactor(e){this[Ro]();for(const t of this[Cr])t.emissive.fromArray(e);this[fn].emissiveFactor=e,this[Rl]()}[x0](){this[Ro]();const e=this[fn];for(const t of this[Cr])t.alphaTest="MASK"===this[fn].alphaMode?e.alphaCutoff:void 0,t.needsUpdate=!0}setAlphaCutoff(e){this[Ro](),this[fn].alphaCutoff=e,this[x0](),this[Rl]()}getAlphaCutoff(){return this[Ro](),this[fn].alphaCutoff}setDoubleSided(e){this[Ro]();for(const t of this[Cr])t.side=e?2:0,t.needsUpdate=!0;this[fn].doubleSided=e,this[Rl]()}getDoubleSided(){return this[Ro](),this[fn].doubleSided}setAlphaMode(e){this[Ro]();const t=(n,s)=>{n.transparent=s,n.depthWrite=!s};this[fn].alphaMode=e;for(const n of this[Cr])t(n,"BLEND"===e),this[x0](),n.needsUpdate=!0;this[Rl]()}getAlphaMode(){return this[Ro](),this[fn].alphaMode}}var $v,Xv,Yv;const Nu=Symbol("materials"),wh=Symbol("variantToMaterialMap"),Mh=Symbol("modelVariants"),Jv=Symbol("mesh"),Kv=Symbol("children"),Qv=Symbol("initialMaterialIdx"),T0=Symbol("activeMaterialIdx");class ex{constructor(e){this.name="",this[$v]=new Array,this.name=e}}$v=Kv;class tx extends ex{constructor(e,t,n,s){super(e.name),this[Xv]=new Map,this[Yv]=new Map,this[Jv]=e;const{gltf:l,threeGLTF:u,threeObjectMap:f}=s;this[Mh]=n,this.mesh.userData.variantData=n;const v=f.get(e.material);null!=v.materials?this[Qv]=this[T0]=v.materials:console.error(`Primitive (${e.name}) missing initial material reference.`);const b=e.userData.associations||{};if(null==b.meshes)return void console.error("Mesh is missing primitive index association");const S=((l.meshes||[])[b.meshes].primitives||[])[b.primitives];if(null!=S){if(null!=S.material)this[Nu].set(S.material,t[S.material]);else{const C=t.findIndex(I=>"Default"===I.name);C>=0?this[Nu].set(C,t[C]):console.warn("gltfPrimitive has no material!")}if(S.extensions&&S.extensions.KHR_materials_variants){const C=S.extensions.KHR_materials_variants,I=u.parser.json.extensions.KHR_materials_variants.variants;for(const D of C.mappings){const O=t[D.material];this[Nu].set(D.material,O);for(const N of D.variants){const{name:j}=I[N];this[wh].set(N,O),O[J_]().add(N),n.has(j)||n.set(j,{name:j,index:N})}}}}else console.error("Mesh primitive definition is missing.")}get mesh(){return this[Jv]}setActiveMaterial(e){var t=this;return(0,m.Z)(function*(){const n=t[Nu].get(e);return null!=n&&(t.mesh.material=yield n[w0](),t[T0]=e),t.mesh.material})()}getActiveMaterial(){return this[Nu].get(this[T0])}getMaterial(e){return this[Nu].get(e)}enableVariant(e){var t=this;return(0,m.Z)(function*(){if(null==e)return t.setActiveMaterial(t[Qv]);if(null!=t[wh]&&t[Mh].has(e)){const n=t[Mh].get(e);return t.enableVariantHelper(n.index)}return null})()}enableVariantHelper(e){var t=this;return(0,m.Z)(function*(){if(null!=t[wh]&&null!=e){const n=t[wh].get(e);if(null!=n)return t.setActiveMaterial(n.index)}return null})()}instantiateVariants(){var e=this;return(0,m.Z)(function*(){if(null!=e[wh])for(const t of e[wh].keys()){if(null!=e.mesh.userData.variantMaterials.get(t).material)continue;const n=yield e.enableVariantHelper(t);null!=n&&(e.mesh.userData.variantMaterials.get(t).material=n)}})()}get variantInfo(){return this[wh]}addVariant(e,t){if(!this.ensureVariantIsUnused(t))return!1;this[Mh].has(t)||this[Mh].set(t,{name:t,index:this[Mh].size});const n=this[Mh].get(t).index;return e[J_]().add(n),this[wh].set(n,e),this[Nu].set(e.index,e),this.updateVariantUserData(n,e),!0}deleteVariant(e){if(this.variantInfo.has(e)){this.variantInfo.delete(e);const t=this.mesh.userData.variantMaterials;null!=t&&t.delete(e)}}updateVariantUserData(e,t){t[J_]().add(e),this.mesh.userData.variantData=this[Mh],this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map,this.mesh.userData.variantMaterials.set(e,{material:t[Cr].values().next().value,gltfMaterialIndex:t.index})}ensureVariantIsUnused(e){const t=this[Mh].get(e);return null==t||!this.variantInfo.has(t.index)||(console.warn(`Primitive cannot add variant '${e}' for this material, it already exists.`),!1)}}var ix,nx,rx,sx,ox,ax;Xv=Nu,Yv=wh;const pp=Symbol("materials"),E0=Symbol("hierarchy"),lx=Symbol("roots"),Sh=Symbol("primitives"),C0=Symbol("correlatedSceneGraph"),cx=Symbol("prepareVariantsForExport"),hx=Symbol("switchVariant"),ux=Symbol("threeScene"),dx=Symbol("materialsFromPoint"),px=Symbol("materialFromPoint"),Zs=Symbol("variantData"),A0=Symbol("availableVariants"),P0=Symbol("modelOnUpdate"),mx=Symbol("cloneMaterial");class K1{constructor(e,t,n,s){this.gltf=e,this.gltfElementMap=t,this.mapKey=n,this.doLazyLoad=s}}class Q1{constructor(e,t=(()=>{})){this[ix]=new Array,this[nx]=new Array,this[rx]=new Array,this[sx]=new Array,this[ox]=()=>{},this[ax]=new Map,this[P0]=t,this[C0]=e;const{gltf:n,threeGLTF:s,gltfElementMap:l}=e;this[ux]=s.scene;for(const[v,b]of n.materials.entries()){const S=l.get(b);if(null!=S)this[pp].push(new S0(t,n,b,v,!0,this[Zs],S));else{const C=(n.materials||[])[v],I=v,D=function(){var O=(0,m.Z)(function*(){const N=yield s.parser.getDependency("material",I),j=new Set;return l.set(C,j),j.add(N),{set:j,material:N}});return function(){return O.apply(this,arguments)}}();this[pp].push(new S0(t,n,C,v,!1,this[Zs],S,new K1(n,l,C,D)))}}const u=new Map,f=new Array;for(const v of s.scene.children)f.push(v);for(;f.length>0;){const v=f.pop();let b=null;v instanceof di?(b=new tx(v,this.materials,this[Zs],e),this[Sh].push(b)):b=new ex(v.name);const S=u.get(v);null!=S?S[Kv].push(b):this[lx].push(b),this[E0].push(b);for(const C of v.children)f.push(C),u.set(v,b)}}get materials(){return this[pp]}[(ix=pp,nx=E0,rx=lx,sx=Sh,ox=P0,ax=Zs,A0)](){const e=Array.from(this[Zs].values());return e.sort((t,n)=>t.index-n.index),e.map(t=>t.name)}getMaterialByName(e){const t=this[pp].filter(n=>n.name===e);return t.length>0?t[0]:null}[dx](e){return e.intersectObject(this[ux],!0).map(t=>{const n=this[E0].find(s=>s instanceof tx&&s.mesh===t.object);return null!=n?n.getActiveMaterial():null})}[px](e){const t=this[dx](e);return t.length>0?t[0]:null}[hx](e){var t=this;return(0,m.Z)(function*(){for(const n of t[Sh])yield n.enableVariant(e);for(const n of t.materials)n[Cg](!1);for(const n of t[Sh])t.materials[n.getActiveMaterial().index][Cg](!0)})()}[cx](){var e=this;return(0,m.Z)(function*(){const t=new Array;for(const n of e[Sh])t.push(n.instantiateVariants());yield Promise.all(t)})()}[mx](e,t){const n=this.materials[e];n.isLoaded||console.error("Cloning an unloaded material,\n           call 'material.ensureLoaded() before cloning the material.");const s=n[Cr],l=JSON.parse(JSON.stringify(n[fn]));l.name=t,this[C0].gltf.materials.push(l);const u=new Set;for(const[v,b]of s.entries()){const S=b.clone();S.name=t+(s.size>1?"_inst"+v:""),u.add(S)}const f=new S0(this[P0],this[C0].gltf,l,this[pp].length,!1,this[Zs],u);return this[pp].push(f),f}createMaterialInstanceForVariant(e,t,n,s=!0){let l=null;for(const u of this[Sh]){const f=this[Zs].get(n);null!=f&&u.variantInfo.has(f.index)||null!=u.getMaterial(e)&&(this.hasVariant(n)||this.createVariant(n),null==l&&(l=this[mx](e,t)),u.addVariant(l,n))}if(s&&null!=l){l[Cg](!0),this.materials[e][Cg](!1);for(const u of this[Sh])u.enableVariant(n)}return l}createVariant(e){this[Zs].has(e)?console.warn(`Variant '${e}'' already exists`):this[Zs].set(e,{name:e,index:this[Zs].size})}hasVariant(e){return this[Zs].has(e)}setMaterialToVariant(e,t){if(null!=this[A0]().find(n=>n===t))if(e<0||e>=this.materials.length)console.error("setMaterialToVariant(): materialIndex is out of bounds.");else for(const n of this[Sh]){const s=n.getMaterial(e);null!=s&&n.addVariant(s,t)}else console.warn(`Can't add material to '${t}', the variant does not exist.'`)}updateVariantName(e,t){const n=this[Zs].get(e);null!=n&&(n.name=t,this[Zs].set(t,n),this[Zs].delete(e))}deleteVariant(e){const t=this[Zs].get(e);if(null!=t){for(const n of this.materials)n.hasVariant(e)&&n[K_].delete(t.index);for(const n of this[Sh])n.deleteVariant(t.index);this[Zs].delete(e)}}}var I0=function(h,e,t,n){for(var s,l=arguments.length,u=l<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n,f=h.length-1;f>=0;f--)(s=h[f])&&(u=(l<3?s(u):l>3?s(e,t,u):s(e,t))||u);return l>3&&u&&Object.defineProperty(e,t,u),u};const Ag=Symbol("currentGLTF"),Bm=Symbol("model"),D0=Symbol("getOnUpdateMethod"),fx=Symbol("textureLoader"),L0=Symbol("originalGltfJson");var R0=function(h,e,t,n){for(var s,l=arguments.length,u=l<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n,f=h.length-1;f>=0;f--)(s=h[f])&&(u=(l<3?s(u):l>3?s(e,t,u):s(e,t))||u);return l>3&&u&&Object.defineProperty(e,t,u),u};const eb=Math.PI/32,tb={basis:[$d(Fr(eb,"rad"))],keywords:{auto:[null]}},Fm=Symbol("autoRotateStartTime"),k0=Symbol("radiansPerSecond"),gx=Symbol("syncRotationRate"),z0=Symbol("onCameraChange"),ib=(h=>{var e,t,n;class s extends h{constructor(){super(...arguments),this[e]=new Map,this[t]=u=>{u.forEach(f=>{f instanceof MutationRecord&&"childList"!==f.type||(f.addedNodes.forEach(v=>{this[_h](v)}),f.removedNodes.forEach(v=>{this[Ru](v)}),this[Vr]())})},this[n]=new MutationObserver(this[ig])}connectedCallback(){super.connectedCallback();for(let f=0;f<this.children.length;++f)this[_h](this.children[f]);const{ShadyDOM:u}=self;null==u?this[rp].observe(this,{childList:!0}):this[rp]=u.observeChildren(this,this[ig])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:u}=self;null==u?this[rp].disconnect():u.unobserveChildren(this[rp])}[(e=oo,t=ig,n=rp,gr)](u,f){super[gr](u,f);const v=this[Nt],{annotationRenderer:b}=v,S=v.getCamera();v.shouldRender()&&(v.updateHotspots(S.position),b.domElement.style.display="",b.render(v,S))}updateHotspot(u){const f=this[oo].get(u.name);null!=f&&(f.updatePosition(u.position),f.updateNormal(u.normal),this[Vr]())}positionAndNormalFromPoint(u,f){const v=this[Nt],b=v.getNDC(u,f),S=v.positionAndNormalFromPoint(b);if(null==S)return null;yh.copy(v.target.matrixWorld).invert();const C=Cm(S.position.applyMatrix4(yh));ku.getNormalMatrix(yh);const I=Cm(S.normal.applyNormalMatrix(ku));let D=null;return null!=S.uv&&(D=F_(S.uv)),{position:C,normal:I,uv:D}}[_h](u){if(!(u instanceof HTMLElement&&0===u.slot.indexOf("hotspot")))return;let f=this[oo].get(u.slot);null!=f?f.increment():(f=new Of({name:u.slot,position:u.dataset.position,normal:u.dataset.normal}),this[oo].set(u.slot,f),this[Nt].addHotspot(f)),this[Nt].queueRender()}[Ru](u){if(!(u instanceof HTMLElement))return;const f=this[oo].get(u.slot);f&&(f.decrement()&&(this[Nt].removeHotspot(f),this[oo].delete(u.slot)),this[Nt].queueRender())}}return s})((h=>{var e,t,n,s;class l extends h{constructor(){super(...arguments),this[e]=void 0,this[t]=null,this[n]=new Pd,this[s]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[Bm]}get availableVariants(){return this.model?this.model[A0]():[]}get originalGltfJson(){return this[L0]}[(e=Bm,t=Ag,n=fx,s=L0,D0)](){return()=>{this[Vr]()}}createTexture(f,v="image/png"){var b=this;return(0,m.Z)(function*(){const S=b[Ag],C=yield new Promise(I=>b[fx].load(f,I));return S&&C?(C.encoding=3001,C.wrapS=1e3,C.wrapT=1e3,C.flipY=!1,C.userData.mimeType=v,new zv(b[D0](),C)):null})()}updated(f){var v=()=>super.updated,b=this;return(0,m.Z)(function*(){if(v().call(b,f),f.has("variantName")){const S=b[Ag],{variantName:C}=b;null!=S&&(yield b[Bm][hx](C),b[Vr](),b.dispatchEvent(new CustomEvent("variant-applied")))}if(f.has("orientation")||f.has("scale")){const{modelContainer:S}=b[Nt],C=dc(b.orientation)[0].terms,I=vs(C[0]).number,D=vs(C[1]).number,O=vs(C[2]).number;S.quaternion.setFromEuler(new vr(D,O,I,"YXZ"));const N=dc(b.scale)[0].terms;S.scale.set(N[0].number,N[1].number,N[2].number),b[Nt].updateBoundingBox(),b[Nt].updateShadow(),b[Vi].arRenderer.onUpdateScene(),b[Vr]()}})()}[Do](){super[Do]();const{currentGLTF:f}=this[Nt];if(null!=f){const{correlatedSceneGraph:v}=f;null!=v&&f!==this[Ag]&&(this[Bm]=new Q1(v,this[D0]()),this[L0]=JSON.parse(JSON.stringify(v.gltf))),"variants"in f.userData&&this.requestUpdate("variantName")}this[Ag]=f,this.dispatchEvent(new CustomEvent("scene-graph-ready"))}exportScene(f){var v=this;return(0,m.Z)(function*(){const b=v[Nt];return new Promise(function(){var S=(0,m.Z)(function*(C){const I={binary:!0,onlyVisible:!0,maxTextureSize:1/0,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1,embedImages:!0};Object.assign(I,f),I.animations=b.animations,I.truncateDrawRange=!0;const D=b.shadow;let O=!1;null!=D&&(O=D.visible,D.visible=!1),yield v[Bm][cx](),(new f0).register(N=>new V1(N)).parse(b.modelContainer.children[0],N=>C(new Blob([I.binary?N:JSON.stringify(N)],{type:I.binary?"application/octet-stream":"application/json"})),I),null!=D&&(D.visible=O)});return function(C){return S.apply(this,arguments)}}())})()}materialFromPoint(f,v){const b=this[Nt],S=b.getNDC(f,v);return b.raycaster.setFromCamera(S,b.getCamera()),this[Bm][px](b.raycaster)}}return I0([si({type:String,attribute:"variant-name"})],l.prototype,"variantName",void 0),I0([si({type:String,attribute:"orientation"})],l.prototype,"orientation",void 0),I0([si({type:String,attribute:"scale"})],l.prototype,"scale",void 0),l})((h=>{var e,t,n;class s extends h{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=3e3,this.rotationPerSecond="auto",this[e]=performance.now(),this[t]=0,this[n]=u=>{this.autoRotate&&"user-interaction"===u.detail.source&&(this[Fm]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[z0]),this[Fm]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[z0]),this[Fm]=performance.now()}updated(u){super.updated(u),u.has("autoRotate")&&(this[Fm]=performance.now())}[(e=Fm,t=k0,gx)](u){this[k0]=u[0]}[gr](u,f){if(super[gr](u,f),!this.autoRotate||!this[gh]()||this[Vi].isPresenting)return;const v=Math.min(f,u-this[Fm]-this.autoRotateDelay);v>0&&(this[Nt].yaw=this.turntableRotation+this[k0]*v*.001)}get turntableRotation(){return this[Nt].yaw}resetTurntableRotation(u=0){this[Nt].yaw=u}}return n=z0,R0([si({type:Boolean,attribute:"auto-rotate"})],s.prototype,"autoRotate",void 0),R0([si({type:Number,attribute:"auto-rotate-delay"})],s.prototype,"autoRotateDelay",void 0),R0([Uu({intrinsics:tb,updateHandler:gx}),si({type:String,attribute:"rotation-per-second"})],s.prototype,"rotationPerSecond",void 0),s})((h=>{var e,t,n;class s extends h{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=0,this.shadowSoftness=1,this.exposure=1,this[e]=null,this[t]=null,this[n]=u=>{u.element===this&&this[oa]()}}connectedCallback(){super.connectedCallback(),this[Vi].loader.addEventListener("preload",this[fm])}disconnectedCallback(){super.disconnectedCallback(),this[Vi].loader.removeEventListener("preload",this[fm])}updated(u){super.updated(u),u.has("shadowIntensity")&&(this[Nt].setShadowIntensity(.5*this.shadowIntensity),this[Vr]()),u.has("shadowSoftness")&&(this[Nt].setShadowSoftness(this.shadowSoftness),this[Vr]()),u.has("exposure")&&(this[Nt].exposure=this.exposure,this[Vr]()),(u.has("environmentImage")||u.has("skyboxImage"))&&this[Fa]()&&this[oa]()}hasBakedShadow(){return this[Nt].bakedShadows.length>0}[(e=ph,t=Tu,n=fm,Do)](){super[Do](),null!=this[ph]&&this[mm](this[ph])}[oa](){var u=this;return(0,m.Z)(function*(){const{skyboxImage:f,environmentImage:v}=u;null!=u[Tu]&&(u[Tu](),u[Tu]=null);const{textureUtils:b}=u[Vi];if(null!=b)try{const{environmentMap:S,skybox:C}=yield new Promise(function(){var I=(0,m.Z)(function*(D,O){const N=b.generateEnvironmentMapAndSkybox(y_(f),v,{progressTracker:u[Lo]});u[Tu]=()=>O(N),D(yield N)});return function(D,O){return I.apply(this,arguments)}}());u[Nt].background=null!=C?C.name===S.name?S:C:null,u[mm](S),u[Nt].dispatchEvent({type:"envmap-update"})}catch(S){if(S instanceof Error)throw u[mm](null),S}})()}[mm](u){this[Nt].environment!==u&&(this[ph]=u,this[Nt].environment=this[ph],this.dispatchEvent(new CustomEvent("environment-change")),this[Vr]())}}return Yd([si({type:String,attribute:"environment-image"})],s.prototype,"environmentImage",void 0),Yd([si({type:String,attribute:"skybox-image"})],s.prototype,"skyboxImage",void 0),Yd([si({type:Number,attribute:"shadow-intensity"})],s.prototype,"shadowIntensity",void 0),Yd([si({type:Number,attribute:"shadow-softness"})],s.prototype,"shadowSoftness",void 0),Yd([si({type:Number})],s.prototype,"exposure",void 0),s})((h=>{var e,t,n,s,l,u,f,v,b,S,C,I,D,O,N,j,U;class Q extends h{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit="0deg 75deg 105%",this.cameraTarget="auto auto auto",this.fieldOfView="auto",this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=3e3,this.interactionPromptStyle=t0,this.interactionPrompt=ug,this.interactionPolicy="always-allow",this.orbitSensitivity=1,this.touchAction="pan-y",this.disableZoom=!1,this.enablePan=!1,this.interpolationDecay=50,this.bounds="legacy",this[e]=this.shadowRoot.querySelector(".interaction-prompt"),this[t]=this.shadowRoot.querySelector(".interaction-prompt > .animated-container"),this[n]=this.shadowRoot.querySelector(".pan-target"),this[s]=1/0,this[l]=0,this[u]=1/0,this[f]=!1,this[v]=!1,this[b]=new e1(this[Nt].camera,this[yc],this[Nt]),this[S]=new Tn,this[C]=!1,this[I]=!1,this[D]=!1,this[O]=()=>{isFinite(this[gg])||(this[gg]=performance.now()),this.interactionPrompt!==lv||this[mg]||(this[xh]=!0)},this[N]=()=>{this.interactionPrompt===lv&&(this[xh]=!1,this[dg].classList.remove("visible"),this[lp]=1/0,this[gg]=1/0)},this[j]=({source:Z})=>{this[dv](),this[Vr](),Z===e0&&(this[mg]=!0,this[j_]()),this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:Z}}))},this[U]=Z=>{"pointer-change-start"===Z.type?this[_c].classList.add("pointer-tumbling"):this[_c].classList.remove("pointer-tumbling")}}getCameraOrbit(){const{theta:Z,phi:te,radius:oe}=this[a0];return{theta:Z,phi:te,radius:oe,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return Cm(this[Vi].isPresenting?this[Vi].arRenderer.target:this[Nt].getTarget())}getFieldOfView(){return this[$n].getFieldOfView()}getMinimumFieldOfView(){return this[$n].options.minimumFieldOfView}getMaximumFieldOfView(){return this[$n].options.maximumFieldOfView}getIdealAspect(){return this[Nt].idealAspect}jumpCameraToGoal(){this[_g]=!0,this.requestUpdate(_g,!1)}resetInteractionPrompt(){this[fg]=0,this[lp]=1/0,this[mg]=!1,this[xh]=this.interactionPrompt===ug&&this.cameraControls}zoom(Z){const te=new WheelEvent("wheel",{deltaY:-30*Z});this[yc].dispatchEvent(te)}connectedCallback(){super.connectedCallback(),this[$n].addEventListener("change",this[o0]),this[$n].addEventListener("pointer-change-start",this[pg]),this[$n].addEventListener("pointer-change-end",this[pg])}disconnectedCallback(){super.disconnectedCallback(),this[$n].removeEventListener("change",this[o0]),this[$n].removeEventListener("pointer-change-start",this[pg]),this[$n].removeEventListener("pointer-change-end",this[pg])}updated(Z){super.updated(Z);const te=this[$n],oe=this[yc];Z.has("cameraControls")&&(this.cameraControls?(te.enableInteraction(),this.interactionPrompt===ug&&(this[xh]=!0),oe.addEventListener("focus",this[s0]),oe.addEventListener("blur",this[r0])):(oe.removeEventListener("focus",this[s0]),oe.removeEventListener("blur",this[r0]),te.disableInteraction(),this[j_]()),this[yc].setAttribute("aria-label",this[Iu])),Z.has("disableZoom")&&(te.disableZoom=this.disableZoom),Z.has("enablePan")&&(te.enablePan=this.enablePan,this.oncontextmenu=this.enablePan?function(){return!1}:null),Z.has("bounds")&&(this[Nt].tightBounds="tight"===this.bounds),(Z.has("interactionPrompt")||Z.has("cameraControls")||Z.has("src"))&&(this.interactionPrompt===ug&&this.cameraControls&&!this[mg]?this[xh]=!0:this[j_]()),Z.has("interactionPromptStyle")&&this[dg].classList.toggle("wiggle",this.interactionPromptStyle===t0),Z.has("interactionPolicy")&&te.applyOptions({interactionPolicy:this.interactionPolicy}),Z.has("touchAction")&&(te.applyOptions({touchAction:this.touchAction}),te.updateTouchActionStyle()),Z.has("orbitSensitivity")&&(te.sensitivity=this.orbitSensitivity),Z.has("interpolationDecay")&&(te.setDamperDecayTime(this.interpolationDecay),this[Nt].setTargetDamperDecayTime(this.interpolationDecay)),!0===this[_g]&&Promise.resolve().then(()=>{te.jumpToGoal(),this[Nt].jumpToGoal(),this[_g]=!1})}updateFraming(){var Z=this;return(0,m.Z)(function*(){const te=Z[Nt],oe=te.adjustedFoV(te.framedFoVDeg);yield te.updateFraming();const de=te.adjustedFoV(te.framedFoVDeg),Ce=Z[$n].getFieldOfView()/oe;Z[$n].setFieldOfView(de*Ce),Z[yg]=!0,Z.requestUpdate("maxFieldOfView"),Z.requestUpdate("fieldOfView"),Z.requestUpdate("minCameraOrbit"),Z.requestUpdate("maxCameraOrbit"),yield Z.requestUpdate("cameraOrbit")})()}[(e=dg,t=n0,n=H_,s=gg,l=fg,u=lp,f=mg,v=xh,b=$n,S=a0,C=_g,I=l0,D=yg,fv)](Z){const te=this[Nt];te.framedFoVDeg=180*Z[0]/Math.PI,this[$n].setFieldOfView(te.adjustedFoV(te.framedFoVDeg))}[mv](Z){if(this[yg]){const{theta:te,phi:oe}=this.getCameraOrbit();Z[0]=te,Z[1]=oe,this[yg]=!1}this[$n].setOrbit(Z[0],Z[1],Z[2])}[_v](Z){this[$n].applyOptions({minimumAzimuthalAngle:Z[0],minimumPolarAngle:Z[1],minimumRadius:Z[2]}),this.jumpCameraToGoal()}[yv](Z){this[$n].applyOptions({maximumAzimuthalAngle:Z[0],maximumPolarAngle:Z[1],maximumRadius:Z[2]}),this[pv](Z[2]),this.jumpCameraToGoal()}[vv](Z){this[$n].applyOptions({minimumFieldOfView:180*Z[0]/Math.PI}),this.jumpCameraToGoal()}[xv](Z){const te=this[Nt].adjustedFoV(180*Z[0]/Math.PI);this[$n].applyOptions({maximumFieldOfView:te}),this.jumpCameraToGoal()}[gv](Z){const[te,oe,de]=Z;this[Vi].arRenderer.isPresenting||this[Nt].setTarget(te,oe,de),this[Vi].arRenderer.updateTarget()}[gr](Z,te){if(super[gr](Z,te),this[Vi].isPresenting||!this[gh]())return;const oe=performance.now();if(this[xh]){const de=this.interactionPrompt===ug?this[Lu]:this[gg];this.loaded&&oe>de+this.interactionPromptThreshold&&(this[xh]=!1,this[lp]=oe,this[dg].classList.add("visible"))}if(isFinite(this[lp])&&this.interactionPromptStyle===t0){const de=this[Nt],Ce=(oe-this[lp])/5e3%1,Le=n1(Ce),Oe=r1(Ce);if(this[n0].style.opacity=`${Oe}`,Le!==this[fg]){const et=(Le-this[fg])*Math.PI/16;this[n0].style.transform=`translateX(${Le*de.width*.05}px)`,this[$n].adjustOrbit(et,0,0),this[fg]=Le}}this[$n].update(Z,te),this[Nt].updateTarget(te)}[j_](){this[xh]=!1,this[dg].classList.remove("visible"),this[lp]=1/0}[pv](Z){const te=2*Math.max(this[Nt].boundingSphere.radius,Z);this[$n].updateNearFar(0,te)}[dv](){const{theta:Z,phi:te}=this[$n].getCameraSpherical(this[a0]),oe=(4+Math.floor((Z%f1+m1)/uv))%4,de=Math.floor(te/p1);this[Em](`View from stage ${o1[de]}${s1[oe]}`)}get[Iu](){return super[Iu]+(this.cameraControls?". Use mouse, touch or arrow keys to move.":"")}[fh](Z){var te=de=>super[de],oe=this;return(0,m.Z)(function*(){const de=oe[$n],Ce=oe[Nt],Le=Ce.adjustedFoV(Ce.framedFoVDeg);te(fh).call(oe,Z);const Oe=Ce.adjustedFoV(Ce.framedFoVDeg)/Le,Ze=de.getFieldOfView()*(isFinite(Oe)?Oe:1);de.updateAspect(oe[Nt].aspect),yield oe.requestUpdate("maxFieldOfView",oe.maxFieldOfView),oe[$n].setFieldOfView(Ze),oe.jumpCameraToGoal()})()}[Do](){super[Do](),this[l0]?this[yg]=!0:this[l0]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}}return O=s0,N=r0,j=o0,U=pg,rs([si({type:Boolean,attribute:"camera-controls"})],Q.prototype,"cameraControls",void 0),rs([Uu({intrinsics:hv,observeEffects:!0,updateHandler:mv}),si({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],Q.prototype,"cameraOrbit",void 0),rs([Uu({intrinsics:d1,observeEffects:!0,updateHandler:gv}),si({type:String,attribute:"camera-target",hasChanged:()=>!0})],Q.prototype,"cameraTarget",void 0),rs([Uu({intrinsics:cv,observeEffects:!0,updateHandler:fv}),si({type:String,attribute:"field-of-view",hasChanged:()=>!0})],Q.prototype,"fieldOfView",void 0),rs([Uu({intrinsics:h1,updateHandler:_v}),si({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],Q.prototype,"minCameraOrbit",void 0),rs([Uu({intrinsics:u1,updateHandler:yv}),si({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],Q.prototype,"maxCameraOrbit",void 0),rs([Uu({intrinsics:c1,updateHandler:vv}),si({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],Q.prototype,"minFieldOfView",void 0),rs([Uu({intrinsics:cv,updateHandler:xv}),si({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],Q.prototype,"maxFieldOfView",void 0),rs([si({type:Number,attribute:"interaction-prompt-threshold"})],Q.prototype,"interactionPromptThreshold",void 0),rs([si({type:String,attribute:"interaction-prompt-style"})],Q.prototype,"interactionPromptStyle",void 0),rs([si({type:String,attribute:"interaction-prompt"})],Q.prototype,"interactionPrompt",void 0),rs([si({type:String,attribute:"interaction-policy"})],Q.prototype,"interactionPolicy",void 0),rs([si({type:Number,attribute:"orbit-sensitivity"})],Q.prototype,"orbitSensitivity",void 0),rs([si({type:String,attribute:"touch-action"})],Q.prototype,"touchAction",void 0),rs([si({type:Boolean,attribute:"disable-zoom"})],Q.prototype,"disableZoom",void 0),rs([si({type:Boolean,attribute:"enable-pan"})],Q.prototype,"enablePan",void 0),rs([si({type:Number,attribute:"interpolation-decay"})],Q.prototype,"interpolationDecay",void 0),rs([si({type:String,attribute:"bounds"})],Q.prototype,"bounds",void 0),Q})((h=>{var e,t,n,s,l,u,f,v,b,S;class C extends h{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arPlacement="floor",this.arModes="webxr scene-viewer",this.iosSrc=null,this.xrEnvironment=!1,this[e]=!1,this[t]=this.shadowRoot.querySelector(".ar-button"),this[n]=document.createElement("a"),this[s]=new Set,this[l]=Kn,this[u]=!1,this[f]=D=>{D.preventDefault(),this.activateAR()},this[v]=({status:D})=>{D!==Eu&&this[Vi].arRenderer.presentedScene!==this[Nt]||(this.setAttribute("ar-status",D),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:D}})),D===Eu?this.removeAttribute("ar-tracking"):D===A_&&this.setAttribute("ar-tracking",Il))},this[b]=({status:D})=>{this.setAttribute("ar-tracking",D),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:D}}))},this[S]=D=>{"_apple_ar_quicklook_button_tapped"==D.data&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[Cn]!==Kn}connectedCallback(){super.connectedCallback(),this[Vi].arRenderer.addEventListener("status",this[Tr]),this.setAttribute("ar-status",Eu),this[Vi].arRenderer.addEventListener("tracking",this[zn]),this[Qi].addEventListener("message",this[Er])}disconnectedCallback(){super.disconnectedCallback(),this[Vi].arRenderer.removeEventListener("status",this[Tr]),this[Vi].arRenderer.removeEventListener("tracking",this[zn]),this[Qi].removeEventListener("message",this[Er])}update(D){var O=()=>super.update,N=this;return(0,m.Z)(function*(){O().call(N,D),D.has("arScale")&&(N[Nt].canScale="fixed"!==N.arScale),D.has("arPlacement")&&(N[Nt].updateShadow(),N[Vr]()),(D.has("ar")||D.has("arModes")||D.has("src")||D.has("iosSrc"))&&(D.has("arModes")&&(N[er]=Ei(N.arModes)),N[sr]())})()}activateAR(){var D=this;return(0,m.Z)(function*(){switch(D[Cn]){case xn:D[Gr]();break;case"webxr":yield D[is]();break;case En:D[Ki]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities")}})()}[(e=Ws,t=Qn,n=Qi,s=er,l=Cn,u=en,f=Sr,v=Tr,b=zn,S=Er,sr)](){var D=this;return(0,m.Z)(function*(){if(D[Cn]=Kn,D.ar){if(null!=D.src)for(const O of D[er]){if("webxr"===O&&hf&&!Zn&&(yield D[Vi].arRenderer.supportsPresentation())){D[Cn]="webxr";break}if("scene-viewer"===O&&df&&!Fi){D[Cn]=En;break}if("quick-look"===O&&nm){D[Cn]=xn;break}}!D.canActivateAR&&null!=D.iosSrc&&nm&&(D[Cn]=xn)}if(D.canActivateAR)D[Qn].classList.add("enabled"),D[Qn].addEventListener("click",D[Sr]);else if(D[Qn].classList.contains("enabled")){D[Qn].removeEventListener("click",D[Sr]),D[Qn].classList.remove("enabled");const O="failed";D.setAttribute("ar-status",O),D.dispatchEvent(new CustomEvent("ar-status",{detail:{status:O}}))}})()}[is](){var D=this;return(0,m.Z)(function*(){console.log("Attempting to present in AR with WebXR..."),yield D[tr]();try{D[Qn].removeEventListener("click",D[Sr]);const{arRenderer:O}=D[Vi];O.placeOnWall="wall"===D.arPlacement,yield O.present(D[Nt],D.xrEnvironment)}catch(O){console.warn("Error while trying to present in AR with WebXR"),console.error(O),yield D[Vi].arRenderer.stopPresenting(),Zn=!0,console.warn("Falling back to next ar-mode"),yield D[sr](),D.activateAR()}finally{D[sr]()}})()}[tr](){var D=this;return(0,m.Z)(function*(){D.loaded||(D[en]=!0,D[Nr](),yield((O,N,j=null)=>new Promise(U=>{O.addEventListener(N,function Q(Y){j&&!j(Y)||(U(Y),O.removeEventListener(N,Q))})}))(D,"load"),D[en]=!1)})()}[Fa](){return super[Fa]()||this[en]}[Ki](){const D=self.location.toString(),O=new URL(D),N=new URL(this.src,D),j=new URLSearchParams(N.search);if(O.hash="#model-viewer-no-ar-fallback",j.set("mode","ar_preferred"),j.has("disable_occlusion")||j.set("disable_occlusion","true"),"fixed"===this.arScale&&j.set("resizable","false"),"wall"===this.arPlacement&&j.set("enable_vertical_placement","true"),j.has("sound")){const Q=new URL(j.get("sound"),D);j.set("sound",Q.toString())}if(j.has("link")){const Q=new URL(j.get("link"),D);j.set("link",Q.toString())}const U=`intent://arvr.google.com/scene-viewer/1.0?${j.toString()+"&file="+encodeURIComponent(N.toString())}#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(O.toString())};end;`;self.addEventListener("hashchange",()=>{"#model-viewer-no-ar-fallback"===self.location.hash&&(Fi=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[sr]())},{once:!0}),this[Qi].setAttribute("href",U),console.log("Attempting to present in AR with Scene Viewer..."),this[Qi].click()}[Gr](){var D=this;return(0,m.Z)(function*(){const O=!D.iosSrc;D[Qn].classList.remove("enabled");const N=O?yield D.prepareUSDZ():D.iosSrc,j=new URL(N,self.location.toString());"fixed"===D.arScale&&(j.hash&&(j.hash+="&"),j.hash+="allowsContentScaling=0");const U=D[Qi];U.setAttribute("rel","ar");const Q=document.createElement("img");U.appendChild(Q),U.setAttribute("href",j.toString()),O&&U.setAttribute("download","model.usdz"),console.log("Attempting to present in AR with Quick Look..."),U.click(),U.removeChild(Q),O&&URL.revokeObjectURL(N),D[Qn].classList.add("enabled")})()}prepareUSDZ(){var D=this;return(0,m.Z)(function*(){const O=D[Lo].beginActivity();yield D[tr]();const N=D[Nt],j=N.shadow;let U=!1;null!=j&&(U=j.visible,j.visible=!1),O(.2);const Q=new xi,Y=yield Q.parse(N.modelContainer),Z=new Blob([Y],{type:"model/vnd.usdz+zip"}),te=URL.createObjectURL(Z);return O(1),null!=j&&(j.visible=U),te})()}}return qi([si({type:Boolean,attribute:"ar"})],C.prototype,"ar",void 0),qi([si({type:String,attribute:"ar-scale"})],C.prototype,"arScale",void 0),qi([si({type:String,attribute:"ar-placement"})],C.prototype,"arPlacement",void 0),qi([si({type:String,attribute:"ar-modes"})],C.prototype,"arModes",void 0),qi([si({type:String,attribute:"ios-src"})],C.prototype,"iosSrc",void 0),qi([si({type:Boolean,attribute:"xr-environment"})],C.prototype,"xrEnvironment",void 0),C})((h=>{var e,t,n,s,l,u,f,v,b,S,C,I,D,O;class N extends h{constructor(...U){super(...U),this.poster=null,this.reveal=W_,this.loading="auto",this.generateSchema=!1,this.seamlessPoster=!1,this[e]=!1,this[t]=!1,this[n]=0,this[s]=null,this[l]=this.shadowRoot.querySelector(".slot.poster"),this[u]=this.shadowRoot.querySelector("#default-poster"),this[f]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[v]=this.shadowRoot.querySelector("#default-progress-bar > .mask"),this[b]=this[zm].getAttribute("aria-label"),this[S]=((te,oe)=>{let de=null;const Ce=(...Le)=>{null==de&&(te(...Le),de=self.setTimeout(()=>de=null,100))};return Ce.flush=()=>{null!=de&&(self.clearTimeout(de),de=null)},Ce})(te=>{const oe=this[cp].parentNode;requestAnimationFrame(()=>{this[wv].style.opacity=""+.2*(1-te),this[cp].style.transform=`scaleX(${te})`,0===te&&(oe.removeChild(this[cp]),oe.appendChild(this[cp])),1===te?this[cp].classList.add("hide"):this[cp].classList.remove("hide")})}),this[C]=()=>{"manual"!==this.reveal&&this.reveal!==W_&&this.dismissPoster()},this[I]=te=>{if("manual"!==this.reveal)switch(te.keyCode){case 32:case 13:this.dismissPoster()}},this[D]=te=>{const oe=te.detail.totalProgress;this[bg]=Math.max(oe,this[bg]),1===oe&&(this[h0].flush(),!this[vc]()||null==this[xg]&&this.reveal!==W_||this[c0]()),this[h0](oe),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:oe}}))},this[O]=()=>{this[wg]=!0;const te=this.getRootNode();te&&te.activeElement===this&&this[yc].focus();const oe=this[zm];oe.setAttribute("aria-hidden","true"),oe.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))};const Q=self.ModelViewerElement||{};mn.setDRACODecoderLocation(Q.dracoDecoderLocation||"https://www.gstatic.com/draco/versioned/decoders/1.4.1/"),mn.setKTX2TranscoderLocation(Q.ktx2TranscoderLocation||"https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/"),Q.meshoptDecoderLocation&&mn.setMeshoptDecoderLocation(Q.meshoptDecoderLocation)}static set dracoDecoderLocation(U){mn.setDRACODecoderLocation(U)}static get dracoDecoderLocation(){return mn.getDRACODecoderLocation()}static set ktx2TranscoderLocation(U){mn.setKTX2TranscoderLocation(U)}static get ktx2TranscoderLocation(){return mn.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(U){mn.setMeshoptDecoderLocation(U)}static get meshoptDecoderLocation(){return mn.getMeshoptDecoderLocation()}static mapURLs(U){aa.singleton.loader[Cl].manager.setURLModifier(U)}dismissPoster(){this[vc]()?this[c0]():(this[xg]="interaction",this[Nr]())}showPoster(){const U=this[bh],Q=this[zm];Q.removeAttribute("tabindex"),Q.removeAttribute("aria-hidden"),U.classList.add("show");const Y=this.modelIsVisible;this[Z_]=!1,this[tp](Y),this[wg]=!1}getDimensions(){return Cm(this[Nt].size)}connectedCallback(){super.connectedCallback(),this[bh].addEventListener("click",this[d0]),this[bh].addEventListener("keydown",this[p0]),this[Lo].addEventListener("progress",this[m0])}disconnectedCallback(){super.disconnectedCallback(),this[bh].removeEventListener("click",this[d0]),this[bh].removeEventListener("keydown",this[p0]),this[Lo].removeEventListener("progress",this[m0])}updated(U){var Q=()=>super.updated,Y=this;return(0,m.Z)(function*(){Q().call(Y,U),U.has("poster")&&null!=Y.poster&&(Y[zm].style.backgroundImage=`url(${Y.poster})`),U.has("alt")&&Y[zm].setAttribute("aria-label",Y[Tm]),(U.has("reveal")||U.has("loading"))&&Y[Nr](),U.has("generateSchema")&&Y[Nt].updateSchema(!0===Y.generateSchema?Y.src:null),U.has("seamlessPoster")&&(!0===Y.seamlessPoster?Y[bh].classList.add("quick"):Y[bh].classList.remove("quick"))})()}[(e=Z_,t=wg,n=bg,s=xg,l=bh,u=zm,f=cp,v=wv,b=v1,S=h0,C=d0,I=p0,D=m0,Fa)](){return!!this.src&&(null!=this[xg]||"eager"===this.loading||this.reveal===W_&&this[gc])}[vc](){const{src:U}=this;return!!U&&super[vc]()&&1===this[bg]}[(O=u0,c0)](){this[xg]=null;const U=this[bh];if(U.classList.contains("show")){const Q=this.modelIsVisible;this[Z_]=!0,this[tp](Q),requestAnimationFrame(()=>{U.classList.remove("show"),!0===this.seamlessPoster?this[u0]():U.addEventListener("transitionend",this[u0],{once:!0})})}else this[wg]=!0}[ip](){return super[ip]()&&this[Z_]}[gh](){return super[gh]()&&this[wg]}[Nr](){var U=Y=>super[Y],Q=this;return(0,m.Z)(function*(){Q[bg]=0,!0===Q.generateSchema&&Q[Nt].updateSchema(Q.src),null!=Q[Nt].currentGLTF&&null!=Q.src&&Q[Fa]()||Q.showPoster(),Q[Em]("Loading"),yield U(Nr).call(Q)})()}}return vg([si({type:String})],N.prototype,"poster",void 0),vg([si({type:String})],N.prototype,"reveal",void 0),vg([si({type:String})],N.prototype,"loading",void 0),vg([si({type:Boolean,attribute:"generate-schema"})],N.prototype,"generateSchema",void 0),vg([si({type:Boolean,attribute:"seamless-poster"})],N.prototype,"seamlessPoster",void 0),N})((h=>{var e;class t extends h{constructor(...s){super(s),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[e]=!0,this[Nt].subscribeMixerEvent("loop",l=>{this.dispatchEvent(new CustomEvent("loop",{detail:{count:l.action._loopCount}}))}),this[Nt].subscribeMixerEvent("finished",()=>{this[Ua]=!0,this.dispatchEvent(new CustomEvent("finished"))})}get availableAnimations(){return this.loaded?this[Nt].animationNames:[]}get duration(){return this[Nt].duration}get paused(){return this[Ua]}get currentTime(){return this[Nt].animationTime}set currentTime(s){this[Nt].animationTime=s,this[Vr]()}get timeScale(){return this[Nt].animationTimeScale}set timeScale(s){this[Nt].animationTimeScale=s}pause(){this[Ua]||(this[Ua]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(s){this.availableAnimations.length>0&&(this[Ua]=!1,this[Pm](s),this.dispatchEvent(new CustomEvent("play")))}[(e=Ua,Do)](){super[Do](),this[Ua]=!0,this.autoplay&&this.play()}[gr](s,l){super[gr](s,l),this[Ua]||!this[gh]()&&!this[Vi].isPresenting||(this[Nt].updateAnimation(l/1e3),this[Vr]())}updated(s){super.updated(s),s.has("autoplay")&&this.autoplay&&this.play(),s.has("animationName")&&this[Pm]()}[Nr](){var s=u=>super[u],l=this;return(0,m.Z)(function*(){return l[Nt].stopAnimation(),s(Nr).call(l)})()}[Pm](s=Jy){var l;const u=null!==(l=s.repetitions)&&void 0!==l?l:1/0;this[Nt].playAnimation(this.animationName,this.animationCrossfadeDuration/1e3,s.pingpong?2202:1===u?2200:2201,u),this[Ua]&&(this[Nt].updateAnimation(0),this[Vr]())}}return np([si({type:Boolean})],t.prototype,"autoplay",void 0),np([si({type:String,attribute:"animation-name"})],t.prototype,"animationName",void 0),np([si({type:Number,attribute:"animation-crossfade-duration"})],t.prototype,"animationCrossfadeDuration",void 0),t})((h=>{var e;const t=Symbol("endPolyfillCoordination");return e=t,class extends h{constructor(){super(...arguments),this[e]=null}connectedCallback(){super.connectedCallback&&super.connectedCallback(),null==this[t]&&(this[t]=(n=>{if(null==n.shadowRoot||n.hasAttribute("data-js-focus-visible"))return()=>{};if(!self.applyFocusVisiblePolyfill){const s=()=>{self.applyFocusVisiblePolyfill(n.shadowRoot)};return self.addEventListener("focus-visible-polyfill-ready",s,{once:!0}),()=>{self.removeEventListener("focus-visible-polyfill-ready",s)}}return self.applyFocusVisiblePolyfill(n.shadowRoot),()=>{}})(this))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),null!=this[t]&&(this[t](),this[t]=null)}}})(Am)))))))));customElements.define("model-viewer",ib);var O0=tn(4366);const nb=["carousel"];function rb(h,e){if(1&h){const t=k.EpF();k.TgZ(0,"div",2)(1,"div",16),k._UZ(2,"img",17),k.TgZ(3,"h3",18)(4,"strong"),k._uU(5),k.qZA()()(),k.TgZ(6,"div",19)(7,"p"),k._uU(8),k.qZA()(),k.TgZ(9,"div",20),k._UZ(10,"model-viewer",21),k.qZA(),k.TgZ(11,"div",22)(12,"div",23)(13,"div",24),k._uU(14," 02 "),k.qZA(),k.TgZ(15,"div",9)(16,"input",25),k.NdJ("ngModelChange",function(){return k.CHM(t),k.oxw(2).zoomGiroChange()})("ngModelChange",function(s){k.CHM(t);const l=k.oxw(2);return l.filesDataConfig[l.actualSlide].actualZoom=s}),k.qZA()(),k.TgZ(17,"div",26),k._uU(18," 01 "),k.qZA()()(),k.TgZ(19,"div",27)(20,"div",28)(21,"div",29),k._uU(22," 0"),k.TgZ(23,"sup"),k._uU(24,"o"),k.qZA()(),k.TgZ(25,"div",30)(26,"input",31),k.NdJ("ngModelChange",function(){return k.CHM(t),k.oxw(2).zoomGiroChange()})("ngModelChange",function(s){k.CHM(t);const l=k.oxw(2);return l.filesDataConfig[l.actualSlide].giro=s}),k.qZA()(),k.TgZ(27,"div",29),k._uU(28," 360"),k.TgZ(29,"sup"),k._uU(30,"o"),k.qZA()()()()()}if(2&h){const t=k.oxw().$implicit,n=k.oxw();k.xp6(5),k.Oqu(t.title),k.xp6(3),k.hij(" ",t.description," "),k.xp6(2),k.uIk("camera-orbit",t.camera_orbit)("src",t.src),k.xp6(6),k.Q6J("min",n.filesDataConfig[n.actualSlide].min)("max",n.filesDataConfig[n.actualSlide].max)("ngModel",n.filesDataConfig[n.actualSlide].actualZoom),k.xp6(10),k.Q6J("min",0)("max",360)("ngModel",n.filesDataConfig[n.actualSlide].giro)}}function sb(h,e){1&h&&k.YNc(0,rb,31,10,"ng-template",15),2&h&&k.Q6J("id",""+e.index)}let ob=(()=>{class h{constructor(){this.carousel=null,this.filesDataConfig=[{min:0,max:150,giro:0,actualZoom:0,originalZoom:250,camera_orbit:"0deg 0deg 250m",title:"Medidor de agua",description:"En IMTech contamos con el \xfanico medidor de agua ultras\xf3nico que existe, la m\xe1s alta tecnolog\xeda para tu hogar",src:"/assets/images/pages/landing/ultrasonic_model.glb"},{min:0,max:100,actualZoom:0,giro:90,originalZoom:150,camera_orbit:"90deg 0deg 150m",title:"Medidor de gas",description:"Nuestro medidor de gas te facilitara tu dia, la m\xe1s alta tecnolog\xeda para tu hogar",src:"/assets/images/pages/landing/gas_model.glb"}],this.actualSlide=0}ngOnInit(){}zoomGiroChange(){this.filesDataConfig[this.actualSlide].camera_orbit=this.filesDataConfig[this.actualSlide].giro+"deg 0deg "+(this.filesDataConfig[this.actualSlide].originalZoom-this.filesDataConfig[this.actualSlide].actualZoom)+"m"}onSlide(t){this.actualSlide=parseInt(t.current)}}return h.\u0275fac=function(t){return new(t||h)},h.\u0275cmp=k.Xpm({type:h,selectors:[["app-models-viewer"]],viewQuery:function(t,n){if(1&t&&k.Gf(nb,7),2&t){let s;k.iGM(s=k.CRH())&&(n.carousel=s.first)}},decls:18,vars:5,consts:[[1,"row","no-margin","full-width","full-height","mobile-design","pa-t-20"],[1,"col-12","no-padding"],[1,"row","full-width","no-margin"],[1,"full-height","no-padding",3,"interval","pauseOnHover","pauseOnFocus","wrap","slide"],["carousel",""],[4,"ngFor","ngForOf"],[1,"row","no-display-600"],[1,"col-12","ff-roboto"],[1,"select-titles","no-margin"],[1,"col-12"],[1,"row","pa-0-10"],[1,"col-6","full-centered","no-padding"],[1,"col-square","full-centered"],["src","/assets/images/pages/landing/meter_gas_btn.png",1,"gas-image"],["src","/assets/images/pages/landing/meter_water_btn.png"],["ngbSlide","","class","col-12 full-height full-centered",3,"id"],[1,"col-12","full-centered","no-display-600"],["src","/assets/images/pages/landing/gawi_logo.png",1,"gawi-logo","pa-r-10"],[1,"no-margin","black-color"],[1,"col-12","no-display-600"],[1,"col-11"],["camera-controls","","alt","A 3D model of an astronaut","data-js-focus-visible","","ar-status","not-presenting",1,"full-width"],[1,"col-1","full-centered"],[1,"full-centered","row","full-height"],[1,"col-12","full-centered","zoom-label"],["type","range","step","1",1,"input-zoom-bar",3,"min","max","ngModel","ngModelChange"],[1,"col-12","full-centered","zoom-label2"],[1,"col-12","full-giro"],[1,"row","no-margin","full-width"],[1,"col-1","full-centered","giro-label"],[1,"col-9"],["type","range","step","1",1,"input-zoom-giro",3,"min","max","ngModel","ngModelChange"]],template:function(t,n){1&t&&(k.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"ngb-carousel",3,4),k.NdJ("slide",function(l){return n.onSlide(l)}),k.YNc(5,sb,1,1,null,5),k.qZA()(),k.TgZ(6,"div",6)(7,"div",7)(8,"label",8),k._uU(9," Selecciona el producto: "),k.qZA()(),k.TgZ(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12),k._UZ(14,"img",13),k.qZA()(),k.TgZ(15,"div",11)(16,"div",12),k._UZ(17,"img",14),k.qZA()()()()()()()),2&t&&(k.xp6(3),k.Q6J("interval",1e5)("pauseOnHover",!0)("pauseOnFocus",!0)("wrap",!0),k.xp6(2),k.Q6J("ngForOf",n.filesDataConfig))},directives:[O0.uo,Hr.sg,O0.xl,Za.eT,Za.Fj,Za.JJ,Za.On],styles:[".carousel-inner[_ngcontent-%COMP%]{height:100%}input[type=range][_ngcontent-%COMP%]{-webkit-appearance:none;margin:18px 0;width:100%}input[type=range][_ngcontent-%COMP%]:focus{outline:none}input[type=range][_ngcontent-%COMP%]::-webkit-slider-runnable-track{width:100%;height:1px;cursor:pointer;background:#4d4d4d;border-radius:1.3px}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{height:6px;width:60px;background:#0067AA;cursor:pointer;-webkit-appearance:none;margin-top:-2px}input[type=range][_ngcontent-%COMP%]:focus::-webkit-slider-runnable-track{background:#0067AA}.giro-label[_ngcontent-%COMP%], .zoom-label[_ngcontent-%COMP%], .zoom-label2[_ngcontent-%COMP%]{height:10%;color:#949494}.select-titles[_ngcontent-%COMP%]{font-size:6.2vw;font-weight:700;text-align:center;color:#000;width:100%}.input-zoom-bar[_ngcontent-%COMP%]{transform:rotate(-90deg)}.col-square[_ngcontent-%COMP%]{margin:6px;background:#E4EFF9;border-radius:17px;width:70%;height:90px}.col-square[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{padding:10px;width:87px;height:55px}.col-square[_ngcontent-%COMP%]   .gas-image[_ngcontent-%COMP%]{width:87px;height:90px}@media (min-width: 0px) and (max-width: 600px){.mobile-design[_ngcontent-%COMP%]   .gawi-logo[_ngcontent-%COMP%]{width:23%}.mobile-design[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-family:Roboto;font-size:6.2vw}.mobile-design[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{vertical-align:sub}.mobile-design[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-top:10px;font-family:Roboto;font-size:4.2vw;color:#515151}.mobile-design[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{width:80px}.mobile-design[_ngcontent-%COMP%]   .input-zoom-giro[_ngcontent-%COMP%]{width:95%!important}}@media screen and (min-width: 600px){.no-display-600[_ngcontent-%COMP%]{display:none!important}}@media (min-width: 602px) and (max-width: 1055px){.giro-label[_ngcontent-%COMP%]{font-size:1.5em}.zoom-label[_ngcontent-%COMP%]{font-size:2em}.zoom-label2[_ngcontent-%COMP%]{font-size:1em}.input-zoom-bar[_ngcontent-%COMP%]{min-width:100px;width:90%!important}.input-zoom-giro[_ngcontent-%COMP%]{width:95%!important}}@media (min-width: 602px) and (max-width: 720px){model-viewer[_ngcontent-%COMP%]{height:220px}}@media (min-width: 720px) and (max-width: 880px){model-viewer[_ngcontent-%COMP%]{height:300px}}@media (min-width: 880px) and (max-width: 1055px){model-viewer[_ngcontent-%COMP%]{height:360px}}@media screen and (min-width: 1055px){model-viewer[_ngcontent-%COMP%]{height:350px}.giro-label[_ngcontent-%COMP%]{font-size:1.8em}.zoom-label[_ngcontent-%COMP%]{font-size:2.5em}.zoom-label2[_ngcontent-%COMP%]{font-size:1.8em}.input-zoom-giro[_ngcontent-%COMP%]{width:100%!important}.input-zoom-bar[_ngcontent-%COMP%]{transform:rotate(-90deg);min-width:190px}}"]}),h})();var ko=tn(7579),Th=tn(6451),Q_=tn(9646),ab=tn(2076),Xn=tn(8505),Pg=tn(3900),B0=tn(590),_x=tn(5698),yx=tn(5684),lb=tn(7359),vx=tn(4482);const hb=(h,e)=>(h.push(e),h);var db=tn(1005),Eh=tn(1777);function pb(h,e){}const mb=function(h,e){return{$implicit:h,index:e}};function fb(h,e){if(1&h&&k.YNc(0,pb,0,0,"ng-template",4),2&h){const t=k.oxw(),n=t.$implicit,s=t.index,l=k.oxw();k.Q6J("ngTemplateOutlet",n.tplRef)("ngTemplateOutletContext",k.WLB(2,mb,l.preparePublicSlide(n),s))}}const gb=function(h,e,t,n){return{width:h,"margin-left":e,"margin-right":t,left:n}};function _b(h,e){if(1&h){const t=k.EpF();k.ynx(0),k.TgZ(1,"div",2),k.NdJ("animationend",function(){const l=k.CHM(t).$implicit;return k.oxw().clear(l.id)}),k.YNc(2,fb,1,5,null,3),k.qZA(),k.BQk()}if(2&h){const t=e.$implicit;k.xp6(1),k.Q6J("ngClass",t.classes)("ngStyle",k.l5B(4,gb,t.width+"px",t.marginL?t.marginL+"px":"",t.marginR?t.marginR+"px":"",t.left))("@autoHeight",t.heightState),k.xp6(1),k.Q6J("ngIf",t.load)}}const yb=function(h,e,t,n,s){return{width:h,transform:e,transition:t,"padding-left":n,"padding-right":s}},vb=function(h,e){return{isMouseDragable:h,isTouchDragable:e}};function xb(h,e){if(1&h&&(k.TgZ(0,"div",4),k._UZ(1,"owl-stage",5),k.qZA()),2&h){const t=k.oxw();k.xp6(1),k.Q6J("owlDraggable",k.WLB(3,vb,null==t.owlDOMData?null:t.owlDOMData.isMouseDragable,null==t.owlDOMData?null:t.owlDOMData.isTouchDragable))("stageData",t.stageData)("slidesData",t.slidesData)}}const bb=function(h,e){return{active:h,"owl-dot-text":e}};function wb(h,e){if(1&h){const t=k.EpF();k.TgZ(0,"div",11),k.NdJ("click",function(){const l=k.CHM(t).$implicit;return k.oxw(2).moveByDot(l.id)}),k._UZ(1,"span",12),k.qZA()}if(2&h){const t=e.$implicit;k.Q6J("ngClass",k.WLB(2,bb,t.active,t.showInnerContent)),k.xp6(1),k.Q6J("innerHTML",t.innerContent,k.oJD)}}const ey=function(h){return{disabled:h}};function Mb(h,e){if(1&h){const t=k.EpF();k.ynx(0),k.TgZ(1,"div",6)(2,"div",7),k.NdJ("click",function(){return k.CHM(t),k.oxw().prev()}),k.qZA(),k.TgZ(3,"div",8),k.NdJ("click",function(){return k.CHM(t),k.oxw().next()}),k.qZA()(),k.TgZ(4,"div",9),k.YNc(5,wb,2,5,"div",10),k.qZA(),k.BQk()}if(2&h){const t=k.oxw();k.xp6(1),k.Q6J("ngClass",k.VKq(7,ey,null==t.navData?null:t.navData.disabled)),k.xp6(1),k.Q6J("ngClass",k.VKq(9,ey,null==t.navData||null==t.navData.prev?null:t.navData.prev.disabled))("innerHTML",null==t.navData||null==t.navData.prev?null:t.navData.prev.htmlText,k.oJD),k.xp6(1),k.Q6J("ngClass",k.VKq(11,ey,null==t.navData||null==t.navData.next?null:t.navData.next.disabled))("innerHTML",null==t.navData||null==t.navData.next?null:t.navData.next.htmlText,k.oJD),k.xp6(1),k.Q6J("ngClass",k.VKq(13,ey,null==t.dotsData?null:t.dotsData.disabled)),k.xp6(1),k.Q6J("ngForOf",null==t.dotsData?null:t.dotsData.dots)}}const Sb=function(h,e,t,n,s){return{"owl-rtl":h,"owl-loaded":e,"owl-responsive":t,"owl-drag":n,"owl-grab":s}};class Tb{constructor(){this.items=3,this.skip_validateItems=!1,this.loop=!1,this.center=!1,this.rewind=!1,this.mouseDrag=!0,this.touchDrag=!0,this.pullDrag=!0,this.freeDrag=!1,this.margin=0,this.stagePadding=0,this.merge=!1,this.mergeFit=!0,this.autoWidth=!1,this.startPosition=0,this.rtl=!1,this.smartSpeed=250,this.fluidSpeed=!1,this.dragEndSpeed=!1,this.responsive={},this.responsiveRefreshRate=200,this.nav=!1,this.navText=["prev","next"],this.navSpeed=!1,this.slideBy=1,this.dots=!0,this.dotsEach=!1,this.dotsData=!1,this.dotsSpeed=!1,this.autoplay=!1,this.autoplayTimeout=5e3,this.autoplayHoverPause=!1,this.autoplaySpeed=!1,this.autoplayMouseleaveTimeout=1,this.lazyLoad=!1,this.lazyLoadEager=0,this.slideTransition="",this.animateOut=!1,this.animateIn=!1,this.autoHeight=!1,this.URLhashListener=!1}}class Eb{constructor(){this.items="number",this.skip_validateItems="boolean",this.loop="boolean",this.center="boolean",this.rewind="boolean",this.mouseDrag="boolean",this.touchDrag="boolean",this.pullDrag="boolean",this.freeDrag="boolean",this.margin="number",this.stagePadding="number",this.merge="boolean",this.mergeFit="boolean",this.autoWidth="boolean",this.startPosition="number|string",this.rtl="boolean",this.smartSpeed="number",this.fluidSpeed="boolean",this.dragEndSpeed="number|boolean",this.responsive={},this.responsiveRefreshRate="number",this.nav="boolean",this.navText="string[]",this.navSpeed="number|boolean",this.slideBy="number|string",this.dots="boolean",this.dotsEach="number|boolean",this.dotsData="boolean",this.dotsSpeed="number|boolean",this.autoplay="boolean",this.autoplayTimeout="number",this.autoplayHoverPause="boolean",this.autoplaySpeed="number|boolean",this.autoplayMouseleaveTimeout="number",this.lazyLoad="boolean",this.lazyLoadEager="number",this.slideTransition="string",this.animateOut="string|boolean",this.animateIn="string|boolean",this.autoHeight="boolean",this.URLhashListener="boolean"}}let F0=(()=>{class h{constructor(t){this.errorHandler=t}log(t,...n){(0,k.X6Q)()&&console.log(t,...n)}error(t){this.errorHandler.handleError(t)}warn(t,...n){console.warn(t,...n)}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(k.qLn))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})();var ty=(()=>(function(h){h.Event="event",h.State="state"}(ty||(ty={})),ty))(),Um=(()=>(function(h){h.Default="default",h.Inner="inner",h.Outer="outer"}(Um||(Um={})),Um))();let Ch=(()=>{class h{constructor(t){this.logger=t,this._viewSettingsShipper$=new ko.x,this._initializedCarousel$=new ko.x,this._changeSettingsCarousel$=new ko.x,this._changedSettingsCarousel$=new ko.x,this._translateCarousel$=new ko.x,this._translatedCarousel$=new ko.x,this._resizeCarousel$=new ko.x,this._resizedCarousel$=new ko.x,this._refreshCarousel$=new ko.x,this._refreshedCarousel$=new ko.x,this._dragCarousel$=new ko.x,this._draggedCarousel$=new ko.x,this.settings={items:0},this.owlDOMData={rtl:!1,isResponsive:!1,isRefreshed:!1,isLoaded:!1,isLoading:!1,isMouseDragable:!1,isGrab:!1,isTouchDragable:!1},this.stageData={transform:"translate3d(0px,0px,0px)",transition:"0s",width:0,paddingL:0,paddingR:0},this._items=[],this._widths=[],this._supress={},this._plugins={},this._current=null,this._clones=[],this._mergers=[],this._speed=null,this._coordinates=[],this._breakpoint=null,this.clonedIdPrefix="cloned-",this._options={},this._invalidated={},this._states={current:{},tags:{initializing:["busy"],animating:["busy"],dragging:["interacting"]}},this._pipe=[{filter:["width","items","settings"],run:n=>{n.current=this._items&&this._items[this.relative(this._current)].id}},{filter:["width","items","settings"],run:n=>{const s=this.settings.margin||"",u=this.settings.rtl,f={"margin-left":u?s:"","margin-right":u?"":s};!this.settings.autoWidth||this.slidesData.forEach(v=>{v.marginL=f["margin-left"],v.marginR=f["margin-right"]}),n.css=f}},{filter:["width","items","settings"],run:n=>{const s=+(this.width()/this.settings.items).toFixed(3)-this.settings.margin,l=!this.settings.autoWidth,u=[];let f=null,v=this._items.length;for(n.items={merge:!1,width:s};v--;)f=this._mergers[v],f=this.settings.mergeFit&&Math.min(f,this.settings.items)||f,n.items.merge=f>1||n.items.merge,u[v]=l?s*f:this._items[v].width?this._items[v].width:s;this._widths=u,this.slidesData.forEach((b,S)=>{b.width=this._widths[S],b.marginR=n.css["margin-right"],b.marginL=n.css["margin-left"]})}},{filter:["items","settings"],run:()=>{const n=[],s=this._items,l=this.settings,u=Math.max(2*l.items,4),f=2*Math.ceil(s.length/2);let v=[],b=[],S=l.loop&&s.length?l.rewind?u:Math.max(u,f):0;for(S/=2;S--;)n.push(this.normalize(n.length/2,!0)),v.push(Object.assign({},this.slidesData[n[n.length-1]])),n.push(this.normalize(s.length-1-(n.length-1)/2,!0)),b.unshift(Object.assign({},this.slidesData[n[n.length-1]]));this._clones=n,v=v.map(C=>(C.id=`${this.clonedIdPrefix}${C.id}`,C.isActive=!1,C.isCloned=!0,C)),b=b.map(C=>(C.id=`${this.clonedIdPrefix}${C.id}`,C.isActive=!1,C.isCloned=!0,C)),this.slidesData=b.concat(this.slidesData).concat(v)}},{filter:["width","items","settings"],run:()=>{const n=this.settings.rtl?1:-1,s=this._clones.length+this._items.length,l=[];let u=-1,f=0,v=0;for(;++u<s;)f=l[u-1]||0,v=this._widths[this.relative(u)]+this.settings.margin,l.push(f+v*n);this._coordinates=l}},{filter:["width","items","settings"],run:()=>{const n=this.settings.stagePadding,s=this._coordinates,l={width:Math.ceil(Math.abs(s[s.length-1]))+2*n,"padding-left":n||"","padding-right":n||""};this.stageData.width=l.width,this.stageData.paddingL=l["padding-left"],this.stageData.paddingR=l["padding-right"]}},{filter:["width","items","settings"],run:n=>{let s=n.current?this.slidesData.findIndex(l=>l.id===n.current):0;s=Math.max(this.minimum(),Math.min(this.maximum(),s)),this.reset(s)}},{filter:["position"],run:()=>{this.animate(this.coordinates(this._current))}},{filter:["width","position","items","settings"],run:()=>{const n=this.settings.rtl?1:-1,s=2*this.settings.stagePadding,l=[];let u,f,v,b,S,C;if(u=this.coordinates(this.current()),"number"==typeof u?u+=s:u=0,f=u+this.width()*n,-1===n&&this.settings.center){const I=this._coordinates.filter(D=>this.settings.items%2==1?D>=u:D>u);u=I.length?I[I.length-1]:u}for(S=0,C=this._coordinates.length;S<C;S++)v=Math.ceil(this._coordinates[S-1]||0),b=Math.ceil(Math.abs(this._coordinates[S])+s*n),(this._op(v,"<=",u)&&this._op(v,">",f)||this._op(b,"<",u)&&this._op(b,">",f))&&l.push(S);this.slidesData.forEach(I=>(I.isActive=!1,I)),l.forEach(I=>{this.slidesData[I].isActive=!0}),this.settings.center&&(this.slidesData.forEach(I=>(I.isCentered=!1,I)),this.slidesData[this.current()].isCentered=!0)}}]}get invalidated(){return this._invalidated}get states(){return this._states}getViewCurSettings(){return this._viewSettingsShipper$.asObservable()}getInitializedState(){return this._initializedCarousel$.asObservable()}getChangeState(){return this._changeSettingsCarousel$.asObservable()}getChangedState(){return this._changedSettingsCarousel$.asObservable()}getTranslateState(){return this._translateCarousel$.asObservable()}getTranslatedState(){return this._translatedCarousel$.asObservable()}getResizeState(){return this._resizeCarousel$.asObservable()}getResizedState(){return this._resizedCarousel$.asObservable()}getRefreshState(){return this._refreshCarousel$.asObservable()}getRefreshedState(){return this._refreshedCarousel$.asObservable()}getDragState(){return this._dragCarousel$.asObservable()}getDraggedState(){return this._draggedCarousel$.asObservable()}setOptions(t){const n=new Tb,s=this._validateOptions(t,n);this._options=Object.assign(Object.assign({},n),s)}_validateOptions(t,n){const s=Object.assign({},t),l=new Eb,u=(f,v)=>(this.logger.log(`options.${v} must be type of ${f}; ${v}=${t[v]} skipped to defaults: ${v}=${n[v]}`),n[v]);for(const f in s)if(s.hasOwnProperty(f))if("number"===l[f])this._isNumeric(s[f])?(s[f]=+s[f],s[f]="items"===f?this._validateItems(s[f],s.skip_validateItems):s[f]):s[f]=u(l[f],f);else if("boolean"===l[f]&&"boolean"!=typeof s[f])s[f]=u(l[f],f);else if("number|boolean"!==l[f]||this._isNumberOrBoolean(s[f]))if("number|string"!==l[f]||this._isNumberOrString(s[f]))if("string|boolean"!==l[f]||this._isStringOrBoolean(s[f])){if("string[]"===l[f])if(Array.isArray(s[f])){let v=!1;s[f].forEach(b=>{v="string"==typeof b}),v||(s[f]=u(l[f],f))}else s[f]=u(l[f],f)}else s[f]=u(l[f],f);else s[f]=u(l[f],f);else s[f]=u(l[f],f);return s}_validateItems(t,n){let s=t;return t>this._items.length?n?this.logger.log("The option 'items' in your options is bigger than the number of slides. The navigation got disabled"):(s=this._items.length,this.logger.log("The option 'items' in your options is bigger than the number of slides. This option is updated to the current number of slides and the navigation got disabled")):t===this._items.length&&(this.settings.dots||this.settings.nav)&&this.logger.log("Option 'items' in your options is equal to the number of slides. So the navigation got disabled"),s}setCarouselWidth(t){this._width=t}setup(t,n,s){this.setCarouselWidth(t),this.setItems(n),this._defineSlidesData(),this.setOptions(s),this.settings=Object.assign({},this._options),this.setOptionsForViewport(),this._trigger("change",{property:{name:"settings",value:this.settings}}),this.invalidate("settings"),this._trigger("changed",{property:{name:"settings",value:this.settings}})}setOptionsForViewport(){const t=this._width,n=this._options.responsive;let s=-1;if(!Object.keys(n).length)return;if(!t)return void(this.settings.items=1);for(const u in n)n.hasOwnProperty(u)&&+u<=t&&+u>s&&(s=Number(u));this.settings=Object.assign(Object.assign(Object.assign({},this._options),n[s]),{items:n[s]&&n[s].items?this._validateItems(n[s].items,this._options.skip_validateItems):this._options.items}),delete this.settings.responsive,this.owlDOMData.isResponsive=!0,this.owlDOMData.isMouseDragable=this.settings.mouseDrag,this.owlDOMData.isTouchDragable=this.settings.touchDrag;const l=[];this._items.forEach(u=>{l.push(this.settings.merge?u.dataMerge:1)}),this._mergers=l,this._breakpoint=s,this.invalidate("settings")}initialize(t){this.enter("initializing"),this.owlDOMData.rtl=this.settings.rtl,this._mergers.length&&(this._mergers=[]),t.forEach(n=>{this._mergers.push(this.settings.merge?n.dataMerge:1)}),this._clones=[],this.reset(this._isNumeric(this.settings.startPosition)?+this.settings.startPosition:0),this.invalidate("items"),this.refresh(),this.owlDOMData.isLoaded=!0,this.owlDOMData.isMouseDragable=this.settings.mouseDrag,this.owlDOMData.isTouchDragable=this.settings.touchDrag,this.sendChanges(),this.leave("initializing"),this._trigger("initialized")}sendChanges(){this._viewSettingsShipper$.next({owlDOMData:this.owlDOMData,stageData:this.stageData,slidesData:this.slidesData,navData:this.navData,dotsData:this.dotsData})}_optionsLogic(){this.settings.autoWidth&&(this.settings.stagePadding=0,this.settings.merge=!1)}update(){let t=0;const n=this._pipe.length,s=u=>this._invalidated[u],l={};for(;t<n;){const u=this._pipe[t].filter.filter(s);(this._invalidated.all||u.length>0)&&this._pipe[t].run(l),t++}this.slidesData.forEach(u=>u.classes=this.setCurSlideClasses(u)),this.sendChanges(),this._invalidated={},this.is("valid")||this.enter("valid")}width(t){switch(t=t||Um.Default){case Um.Inner:case Um.Outer:return this._width;default:return this._width-2*this.settings.stagePadding+this.settings.margin}}refresh(){this.enter("refreshing"),this._trigger("refresh"),this._defineSlidesData(),this.setOptionsForViewport(),this._optionsLogic(),this.update(),this.leave("refreshing"),this._trigger("refreshed")}onResize(t){if(!this._items.length)return!1;this.setCarouselWidth(t),this.enter("resizing"),this._trigger("resize"),this.invalidate("width"),this.refresh(),this.leave("resizing"),this._trigger("resized")}prepareDragging(t){let s,n=null;return s=this.stageData.transform.replace(/.*\(|\)| |[^,-\d]\w|\)/g,"").split(","),n={x:+s[0],y:+s[1]},this.is("animating")&&this.invalidate("position"),"mousedown"===t.type&&(this.owlDOMData.isGrab=!0),this.speed(0),n}enterDragging(){this.enter("dragging"),this._trigger("drag")}defineNewCoordsDrag(t,n){let s=null,l=null,u=null;const f=this.difference(n.pointer,this.pointer(t)),v=this.difference(n.stage.start,f);return!!this.is("dragging")&&(this.settings.loop?(s=this.coordinates(this.minimum()),l=+this.coordinates(this.maximum()+1)-s,v.x=((v.x-s)%l+l)%l+s):(s=this.coordinates(this.settings.rtl?this.maximum():this.minimum()),l=this.coordinates(this.settings.rtl?this.minimum():this.maximum()),u=this.settings.pullDrag?-1*f.x/5:0,v.x=Math.max(Math.min(v.x,s+u),l+u)),v)}finishDragging(t,n,s){const u=this.difference(n.pointer,this.pointer(t)),f=n.stage.current,v=["right","left"][+(this.settings.rtl?u.x<+this.settings.rtl:u.x>+this.settings.rtl)];let b,S,C;(0!==u.x&&this.is("dragging")||!this.is("valid"))&&(this.speed(+this.settings.dragEndSpeed||this.settings.smartSpeed),b=this.closest(f.x,0!==u.x?v:n.direction),S=this.current(),C=this.current(-1===b?void 0:b),S!==C&&(this.invalidate("position"),this.update()),n.direction=v,(Math.abs(u.x)>3||(new Date).getTime()-n.time>300)&&s()),this.is("dragging")&&(this.leave("dragging"),this._trigger("dragged"))}closest(t,n){const l=this.width();let u=this.coordinates(),f=-1;this.settings.center&&(u=u.map(v=>(0===v&&(v+=1e-6),v)));for(let v=0;v<u.length&&("left"===n&&t>u[v]-30&&t<u[v]+30?f=v:"right"===n&&t>u[v]-l-30&&t<u[v]-l+30?f=v+1:this._op(t,"<",u[v])&&this._op(t,">",u[v+1]||u[v]-l)?f="left"===n?v+1:v:null===n&&t>u[v]-30&&t<u[v]+30&&(f=v),-1===f);v++);return this.settings.loop||(this._op(t,">",u[this.minimum()])?f=t=this.minimum():this._op(t,"<",u[this.maximum()])&&(f=t=this.maximum())),f}animate(t){const n=this.speed()>0;this.is("animating")&&this.onTransitionEnd(),n&&(this.enter("animating"),this._trigger("translate")),this.stageData.transform="translate3d("+t+"px,0px,0px)",this.stageData.transition=this.speed()/1e3+"s"+(this.settings.slideTransition?" "+this.settings.slideTransition:"")}is(t){return this._states.current[t]&&this._states.current[t]>0}current(t){return void 0===t?this._current:0!==this._items.length?(t=this.normalize(t),this._current!==t&&(this._trigger("change",{property:{name:"position",value:t}}),this._current=t,this.invalidate("position"),this._trigger("changed",{property:{name:"position",value:this._current}})),this._current):void 0}invalidate(t){return"string"==typeof t&&(this._invalidated[t]=!0,this.is("valid")&&this.leave("valid")),Object.keys(this._invalidated)}reset(t){void 0!==(t=this.normalize(t))&&(this._speed=0,this._current=t,this._suppress(["translate","translated"]),this.animate(this.coordinates(t)),this._release(["translate","translated"]))}normalize(t,n){const s=this._items.length,l=n?0:this._clones.length;return!this._isNumeric(t)||s<1?t=void 0:(t<0||t>=s+l)&&(t=((t-l/2)%s+s)%s+l/2),t}relative(t){return this.normalize(t-=this._clones.length/2,!0)}maximum(t=!1){const n=this.settings;let l,u,f,s=this._coordinates.length;if(n.loop)s=this._clones.length/2+this._items.length-1;else if(n.autoWidth||n.merge){for(l=this._items.length,u=this.slidesData[--l].width,f=this._width;l--&&(u+=+this.slidesData[l].width+this.settings.margin,!(u>f)););s=l+1}else s=n.center?this._items.length-1:this._items.length-n.items;return t&&(s-=this._clones.length/2),Math.max(s,0)}minimum(t=!1){return t?0:this._clones.length/2}items(t){return void 0===t?this._items.slice():(t=this.normalize(t,!0),[this._items[t]])}mergers(t){return void 0===t?this._mergers.slice():(t=this.normalize(t,!0),this._mergers[t])}clones(t){const n=this._clones.length/2,s=n+this._items.length,l=u=>u%2==0?s+u/2:n-(u+1)/2;return void 0===t?this._clones.map((u,f)=>l(f)):this._clones.map((u,f)=>u===t?l(f):null).filter(u=>u)}speed(t){return void 0!==t&&(this._speed=t),this._speed}coordinates(t){let l,u,n=1,s=t-1;return void 0===t?(u=this._coordinates.map((f,v)=>this.coordinates(v)),u):(this.settings.center?(this.settings.rtl&&(n=-1,s=t+1),l=this._coordinates[t],l+=(this.width()-l+(this._coordinates[s]||0))/2*n):l=this._coordinates[s]||0,l=Math.ceil(l),l)}_duration(t,n,s){return 0===s?0:Math.min(Math.max(Math.abs(n-t),1),6)*Math.abs(+s||this.settings.smartSpeed)}to(t,n){let s=this.current(),l=null,u=t-this.relative(s),f=this.maximum(),v=0;const b=+(u>0)-+(u<0),S=this._items.length,C=this.minimum();this.settings.loop?(!this.settings.rewind&&Math.abs(u)>S/2&&(u+=-1*b*S),l=(((t=s+u)-C)%S+S)%S+C,l!==t&&l-u<=f&&l-u>0&&(s=l-u,t=l,v=30,this.reset(s),this.sendChanges())):this.settings.rewind?(f+=1,t=(t%f+f)%f):t=Math.max(C,Math.min(f,t)),setTimeout(()=>{this.speed(this._duration(s,t,n)),this.current(t),this.update()},v)}next(t){t=t||!1,this.to(this.relative(this.current())+1,t)}prev(t){t=t||!1,this.to(this.relative(this.current())-1,t)}onTransitionEnd(t){if(void 0!==t)return!1;this.leave("animating"),this._trigger("translated")}_viewport(){let t;return this._width?t=this._width:this.logger.log("Can not detect viewport width."),t}setItems(t){this._items=t}_defineSlidesData(){let t;this.slidesData&&this.slidesData.length&&(t=new Map,this.slidesData.forEach(n=>{n.load&&t.set(n.id,n.load)})),this.slidesData=this._items.map(n=>({id:`${n.id}`,isActive:!1,tplRef:n.tplRef,dataMerge:n.dataMerge,width:0,isCloned:!1,load:!!t&&t.get(n.id),hashFragment:n.dataHash}))}setCurSlideClasses(t){const n={active:t.isActive,center:t.isCentered,cloned:t.isCloned,animated:t.isAnimated,"owl-animated-in":t.isDefAnimatedIn,"owl-animated-out":t.isDefAnimatedOut};return this.settings.animateIn&&(n[this.settings.animateIn]=t.isCustomAnimatedIn),this.settings.animateOut&&(n[this.settings.animateOut]=t.isCustomAnimatedOut),n}_op(t,n,s){const l=this.settings.rtl;switch(n){case"<":return l?t>s:t<s;case">":return l?t<s:t>s;case">=":return l?t<=s:t>=s;case"<=":return l?t>=s:t<=s}}_trigger(t,n,s,l,u){switch(t){case"initialized":this._initializedCarousel$.next(t);break;case"change":this._changeSettingsCarousel$.next(n);break;case"changed":this._changedSettingsCarousel$.next(n);break;case"drag":this._dragCarousel$.next(t);break;case"dragged":this._draggedCarousel$.next(t);break;case"resize":this._resizeCarousel$.next(t);break;case"resized":this._resizedCarousel$.next(t);break;case"refresh":this._refreshCarousel$.next(t);break;case"refreshed":this._refreshedCarousel$.next(t);break;case"translate":this._translateCarousel$.next(t);break;case"translated":this._translatedCarousel$.next(t)}}enter(t){[t].concat(this._states.tags[t]||[]).forEach(n=>{void 0===this._states.current[n]&&(this._states.current[n]=0),this._states.current[n]++})}leave(t){[t].concat(this._states.tags[t]||[]).forEach(n=>{(0===this._states.current[n]||this._states.current[n])&&this._states.current[n]--})}register(t){t.type===ty.State&&(this._states.tags[t.name]=this._states.tags[t.name]?this._states.tags[t.name].concat(t.tags):t.tags,this._states.tags[t.name]=this._states.tags[t.name].filter((n,s)=>this._states.tags[t.name].indexOf(n)===s))}_suppress(t){t.forEach(n=>{this._supress[n]=!0})}_release(t){t.forEach(n=>{delete this._supress[n]})}pointer(t){const n={x:null,y:null};return(t=(t=t.originalEvent||t||window.event).touches&&t.touches.length?t.touches[0]:t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).pageX?(n.x=t.pageX,n.y=t.pageY):(n.x=t.clientX,n.y=t.clientY),n}_isNumeric(t){return!isNaN(parseFloat(t))}_isNumberOrBoolean(t){return this._isNumeric(t)||"boolean"==typeof t}_isNumberOrString(t){return this._isNumeric(t)||"string"==typeof t}_isStringOrBoolean(t){return"string"==typeof t||"boolean"==typeof t}difference(t,n){return null===t||null===n?{x:0,y:0}:{x:t.x-n.x,y:t.y-n.y}}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(F0))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})(),xx=(()=>{class h{constructor(t){this.carouselService=t,this._initialized=!1,this._pages=[],this._navData={disabled:!1,prev:{disabled:!1,htmlText:""},next:{disabled:!1,htmlText:""}},this._dotsData={disabled:!1,dots:[]},this.spyDataStreams()}ngOnDestroy(){this.navSubscription.unsubscribe()}spyDataStreams(){const t=this.carouselService.getInitializedState().pipe((0,Xn.b)(u=>{this.initialize(),this._updateNavPages(),this.draw(),this.update(),this.carouselService.sendChanges()})),n=this.carouselService.getChangedState().pipe((0,as.h)(u=>"position"===u.property.name),(0,Xn.b)(u=>{this.update()})),s=this.carouselService.getRefreshedState().pipe((0,Xn.b)(()=>{this._updateNavPages(),this.draw(),this.update(),this.carouselService.sendChanges()})),l=(0,Th.T)(t,n,s);this.navSubscription=l.subscribe(()=>{})}initialize(){this._navData.disabled=!0,this._navData.prev.htmlText=this.carouselService.settings.navText[0],this._navData.next.htmlText=this.carouselService.settings.navText[1],this._dotsData.disabled=!0,this.carouselService.navData=this._navData,this.carouselService.dotsData=this._dotsData}_updateNavPages(){let t,n,s;const l=this.carouselService.clones().length/2,u=l+this.carouselService.items().length,f=this.carouselService.maximum(!0),v=[],b=this.carouselService.settings;let S=b.center||b.autoWidth||b.dotsData?1:b.dotsEach||b.items;if(S=+S,"page"!==b.slideBy&&(b.slideBy=Math.min(+b.slideBy,b.items)),b.dots||"page"===b.slideBy)for(t=l,n=0,s=0;t<u;t++){if(n>=S||0===n){if(v.push({start:Math.min(f,t-l),end:t-l+S-1}),Math.min(f,t-l)===f)break;n=0,++s}n+=this.carouselService.mergers(this.carouselService.relative(t))}this._pages=v}draw(){let t;const n=this.carouselService.settings,s=this.carouselService.items(),l=s.length<=n.items;if(this._navData.disabled=!n.nav||l,this._dotsData.disabled=!n.dots||l,n.dots)if(t=this._pages.length-this._dotsData.dots.length,n.dotsData&&0!==t)this._dotsData.dots=[],s.forEach(u=>{this._dotsData.dots.push({active:!1,id:`dot-${u.id}`,innerContent:u.dotContent,showInnerContent:!0})});else if(t>0){const u=this._dotsData.dots.length>0?this._dotsData.dots.length:0;for(let f=0;f<t;f++)this._dotsData.dots.push({active:!1,id:`dot-${f+u}`,innerContent:"",showInnerContent:!1})}else t<0&&this._dotsData.dots.splice(t,Math.abs(t));this.carouselService.navData=this._navData,this.carouselService.dotsData=this._dotsData}update(){this._updateNavButtons(),this._updateDots()}_updateNavButtons(){const t=this.carouselService.settings,n=t.loop||t.rewind,s=this.carouselService.relative(this.carouselService.current());t.nav&&(this._navData.prev.disabled=!n&&s<=this.carouselService.minimum(!0),this._navData.next.disabled=!n&&s>=this.carouselService.maximum(!0)),this.carouselService.navData=this._navData}_updateDots(){let t;!this.carouselService.settings.dots||(this._dotsData.dots.forEach(n=>{!0===n.active&&(n.active=!1)}),t=this._current(),this._dotsData.dots.length&&(this._dotsData.dots[t].active=!0),this.carouselService.dotsData=this._dotsData)}_current(){const t=this.carouselService.relative(this.carouselService.current());let n;const s=this._pages.filter((l,u)=>l.start<=t&&l.end>=t).pop();return n=this._pages.findIndex(l=>l.start===s.start&&l.end===s.end),n}_getPosition(t){let n,s;const l=this.carouselService.settings;return"page"===l.slideBy?(n=this._current(),s=this._pages.length,t?++n:--n,n=this._pages[(n%s+s)%s].start):(n=this.carouselService.relative(this.carouselService.current()),s=this.carouselService.items().length,t?n+=+l.slideBy:n-=+l.slideBy),n}next(t){this.carouselService.to(this._getPosition(!0),t)}prev(t){this.carouselService.to(this._getPosition(!1),t)}to(t,n,s){let l;!s&&this._pages.length?(l=this._pages.length,this.carouselService.to(this._pages[(t%l+l)%l].start,n)):this.carouselService.to(t,n)}moveByDot(t){const n=this._dotsData.dots.findIndex(s=>t===s.id);this.to(n,this.carouselService.settings.dotsSpeed)}toSlideById(t){const n=this.carouselService.slidesData.findIndex(s=>s.id===t&&!1===s.isCloned);-1===n||n===this.carouselService.current()||this.carouselService.to(this.carouselService.relative(n),!1)}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(Ch))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})();const bx=new k.OlP("WindowToken");class U0{get nativeWindow(){throw new Error("Not implemented.")}}let Cb=(()=>{class h extends U0{constructor(){super()}get nativeWindow(){return window}}return h.\u0275fac=function(t){return new(t||h)},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})();const Ib={provide:bx,useFactory:function Ab(h,e){return(0,Hr.NF)(e)?h.nativeWindow:{setTimeout:(n,s)=>{},clearTimeout:n=>{}}},deps:[U0,k.Lbi]},Db=[{provide:U0,useClass:Cb},Ib],N0=new k.OlP("DocumentToken");class V0{get nativeDocument(){throw new Error("Not implemented.")}}let Lb=(()=>{class h extends V0{constructor(){super()}get nativeDocument(){return document}}return h.\u0275fac=function(t){return new(t||h)},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})();const zb={provide:N0,useFactory:function Rb(h,e){return(0,Hr.NF)(e)?h.nativeDocument:{hidden:!1,visibilityState:"visible"}},deps:[V0,k.Lbi]},Ob=[{provide:V0,useClass:Lb},zb];let wx=(()=>{class h{constructor(t,n,s,l){this.carouselService=t,this.ngZone=l,this._timeout=null,this._paused=!1,this._isAutoplayStopped=!1,this.winRef=n,this.docRef=s,this.spyDataStreams()}get isAutoplayStopped(){return this._isAutoplayStopped}set isAutoplayStopped(t){this._isAutoplayStopped=t}ngOnDestroy(){this.autoplaySubscription.unsubscribe()}spyDataStreams(){const t=this.carouselService.getInitializedState().pipe((0,Xn.b)(()=>{this.carouselService.settings.autoplay&&this.play()})),n=this.carouselService.getChangedState().pipe((0,Xn.b)(u=>{this._handleChangeObservable(u)})),s=this.carouselService.getResizedState().pipe((0,Xn.b)(()=>{this.carouselService.settings.autoplay&&!this._isAutoplayStopped?this.play():this.stop()})),l=(0,Th.T)(t,n,s);this.autoplaySubscription=l.subscribe(()=>{})}play(t,n){this._paused&&(this._paused=!1,this._setAutoPlayInterval(this.carouselService.settings.autoplayMouseleaveTimeout)),!this.carouselService.is("rotating")&&(this.carouselService.enter("rotating"),this._setAutoPlayInterval())}_getNextTimeout(t,n){return this._timeout&&this.winRef.clearTimeout(this._timeout),this._isArtificialAutoplayTimeout=!!t,this.ngZone.runOutsideAngular(()=>this.winRef.setTimeout(()=>{this.ngZone.run(()=>{this._paused||this.carouselService.is("busy")||this.carouselService.is("interacting")||this.docRef.hidden||this.carouselService.next(n||this.carouselService.settings.autoplaySpeed)})},t||this.carouselService.settings.autoplayTimeout))}_setAutoPlayInterval(t){this._timeout=this._getNextTimeout(t)}stop(){!this.carouselService.is("rotating")||(this._paused=!0,this.winRef.clearTimeout(this._timeout),this.carouselService.leave("rotating"))}pause(){!this.carouselService.is("rotating")||(this._paused=!0)}_handleChangeObservable(t){"settings"===t.property.name?this.carouselService.settings.autoplay?this.play():this.stop():"position"===t.property.name&&this.carouselService.settings.autoplay&&this._setAutoPlayInterval()}_playAfterTranslated(){(0,Q_.of)("translated").pipe((0,Pg.w)(t=>this.carouselService.getTranslatedState()),(0,B0.P)(),(0,as.h)(()=>this._isArtificialAutoplayTimeout),(0,Xn.b)(()=>this._setAutoPlayInterval())).subscribe(()=>{})}startPausing(){this.carouselService.settings.autoplayHoverPause&&this.carouselService.is("rotating")&&this.pause()}startPlayingMouseLeave(){this.carouselService.settings.autoplayHoverPause&&this.carouselService.is("rotating")&&(this.play(),this._playAfterTranslated())}startPlayingTouchEnd(){this.carouselService.settings.autoplayHoverPause&&this.carouselService.is("rotating")&&(this.play(),this._playAfterTranslated())}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(Ch),k.LFG(bx),k.LFG(N0),k.LFG(k.R0b))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})(),Mx=(()=>{class h{constructor(t){this.carouselService=t,this.spyDataStreams()}ngOnDestroy(){this.lazyLoadSubscription.unsubscribe()}spyDataStreams(){const t=this.carouselService.getInitializedState().pipe((0,Xn.b)(()=>{const u=this.carouselService.settings&&!this.carouselService.settings.lazyLoad;this.carouselService.slidesData.forEach(f=>f.load=!!u)})),n=this.carouselService.getChangeState(),s=this.carouselService.getResizedState(),l=(0,Th.T)(t,n,s).pipe((0,Xn.b)(u=>this._defineLazyLoadSlides(u)));this.lazyLoadSubscription=l.subscribe(()=>{})}_defineLazyLoadSlides(t){if(this.carouselService.settings&&this.carouselService.settings.lazyLoad&&(t.property&&"position"===t.property.name||"initialized"===t||"resized"===t)){const n=this.carouselService.settings,s=this.carouselService.clones().length;let l=n.center&&Math.ceil(n.items/2)||n.items,u=n.center&&-1*l||0,f=(t.property&&void 0!==t.property.value?t.property.value:this.carouselService.current())+u;for(n.lazyLoadEager>0&&(l+=n.lazyLoadEager,n.loop&&(f-=n.lazyLoadEager,l++));u++<l;)this._load(s/2+this.carouselService.relative(f)),s&&this.carouselService.clones(this.carouselService.relative(f)).forEach(v=>this._load(v)),f++}}_load(t){this.carouselService.slidesData[t].load||(this.carouselService.slidesData[t].load=!0)}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(Ch))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})(),G0=(()=>{class h{constructor(t){this.carouselService=t,this.swapping=!0,this.previous=void 0,this.next=void 0,this.spyDataStreams()}ngOnDestroy(){this.animateSubscription.unsubscribe()}spyDataStreams(){const t=this.carouselService.getChangeState().pipe((0,Xn.b)(b=>{"position"===b.property.name&&(this.previous=this.carouselService.current(),this.next=b.property.value)})),n=this.carouselService.getDragState(),s=this.carouselService.getDraggedState(),l=this.carouselService.getTranslatedState(),u=(0,Th.T)(n,s,l).pipe((0,Xn.b)(b=>this.swapping="translated"===b)),f=this.carouselService.getTranslateState().pipe((0,Xn.b)(b=>{this.swapping&&(this.carouselService._options.animateOut||this.carouselService._options.animateIn)&&this._swap()})),v=(0,Th.T)(t,f,u).pipe();this.animateSubscription=v.subscribe(()=>{})}_swap(){if(1!==this.carouselService.settings.items)return;let t;this.carouselService.speed(0);const n=this.carouselService.slidesData[this.previous],s=this.carouselService.slidesData[this.next],l=this.carouselService.settings.animateIn,u=this.carouselService.settings.animateOut;this.carouselService.current()!==this.previous&&(u&&(t=+this.carouselService.coordinates(this.previous)-+this.carouselService.coordinates(this.next),this.carouselService.slidesData.forEach(f=>{f.id===n.id&&(f.left=`${t}px`,f.isAnimated=!0,f.isDefAnimatedOut=!0,f.isCustomAnimatedOut=!0)})),l&&this.carouselService.slidesData.forEach(f=>{f.id===s.id&&(f.isAnimated=!0,f.isDefAnimatedIn=!0,f.isCustomAnimatedIn=!0)}))}clear(t){this.carouselService.slidesData.forEach(n=>{n.id===t&&(n.left="",n.isAnimated=!1,n.isDefAnimatedOut=!1,n.isCustomAnimatedOut=!1,n.isDefAnimatedIn=!1,n.isCustomAnimatedIn=!1,n.classes=this.carouselService.setCurSlideClasses(n))}),this.carouselService.onTransitionEnd()}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(Ch))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})(),Sx=(()=>{class h{constructor(t){this.carouselService=t,this.spyDataStreams()}ngOnDestroy(){this.autoHeightSubscription.unsubscribe()}spyDataStreams(){const t=this.carouselService.getInitializedState().pipe((0,Xn.b)(u=>{this.carouselService.settings.autoHeight?this.update():this.carouselService.slidesData.forEach(f=>f.heightState="full")})),n=this.carouselService.getChangedState().pipe((0,Xn.b)(u=>{this.carouselService.settings.autoHeight&&"position"===u.property.name&&this.update()})),s=this.carouselService.getRefreshedState().pipe((0,Xn.b)(u=>{this.carouselService.settings.autoHeight&&this.update()})),l=(0,Th.T)(t,n,s);this.autoHeightSubscription=l.subscribe(()=>{})}update(){const t=this.carouselService.settings.items;let n=this.carouselService.current(),s=n+t;this.carouselService.settings.center&&(n=t%2==1?n-(t-1)/2:n-t/2,s=t%2==1?n+t:n+t+1),this.carouselService.slidesData.forEach((l,u)=>{l.heightState=u>=n&&u<s?"full":"nulled"})}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(Ch))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})(),Tx=(()=>{class h{constructor(t,n,s){this.carouselService=t,this.route=n,this.router=s,this.spyDataStreams(),this.route||(this.route={fragment:(0,Q_.of)("no route").pipe((0,_x.q)(1))}),this.router||(this.router={navigate:(l,u)=>{}})}ngOnDestroy(){this.hashSubscription.unsubscribe()}spyDataStreams(){const t=this.carouselService.getInitializedState().pipe((0,Xn.b)(()=>this.listenToRoute())),n=this.carouselService.getChangedState().pipe((0,Xn.b)(l=>{if(this.carouselService.settings.URLhashListener&&"position"===l.property.name){const u=this.carouselService.current(),f=this.carouselService.slidesData[u].hashFragment;if(!f||f===this.currentHashFragment)return;this.router.navigate(["./"],{fragment:f,relativeTo:this.route})}})),s=(0,Th.T)(t,n);this.hashSubscription=s.subscribe(()=>{})}rewind(t){const n=this.carouselService.slidesData.findIndex(s=>s.hashFragment===t&&!1===s.isCloned);-1===n||n===this.carouselService.current()||this.carouselService.to(this.carouselService.relative(n),!1)}listenToRoute(){this.route.fragment.pipe((0,yx.T)("URLHash"===this.carouselService.settings.startPosition?0:2)).subscribe(n=>{this.currentHashFragment=n,this.rewind(n)})}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(Ch),k.LFG(Dh.gz,8),k.LFG(Dh.F0,8))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})(),Bb=0,Ex=(()=>{class h{constructor(t){this.tplRef=t,this.id="owl-slide-"+Bb++,this._dataMerge=1,this.width=0,this.dotContent="",this.dataHash=""}set dataMerge(t){this._dataMerge=this.isNumeric(t)?t:1}get dataMerge(){return this._dataMerge}isNumeric(t){return!isNaN(parseFloat(t))}}return h.\u0275fac=function(t){return new(t||h)(k.Y36(k.Rgc))},h.\u0275dir=k.lG2({type:h,selectors:[["ng-template","carouselSlide",""]],inputs:{id:"id",dataMerge:"dataMerge",width:"width",dotContent:"dotContent",dataHash:"dataHash"}}),h})(),Cx=(()=>{class h{constructor(t){this.eventManager=t,this.resizeSubject=new ko.x,this.eventManager.addGlobalEventListener("window","resize",this.onResize.bind(this)),this.eventManager.addGlobalEventListener("window","onload",this.onLoaded.bind(this))}get onResize$(){return this.resizeSubject.asObservable()}onResize(t){this.resizeSubject.next(t.target)}onLoaded(t){this.windowWidth=t.target}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(yi.Qz))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})(),Fb=(()=>{class h{constructor(t,n,s,l,u){this.zone=t,this.el=n,this.renderer=s,this.carouselService=l,this.animateService=u,this._drag={time:null,target:null,pointer:null,stage:{start:null,current:null},direction:null,active:!1,moving:!1},this._oneDragMove$=new ko.x,this.preparePublicSlide=f=>{const v=Object.assign({},f);return delete v.tplRef,v},this.bindOneMouseTouchMove=f=>{this._oneMouseTouchMove(f)},this.bindOnDragMove=f=>{this._onDragMove(f)},this.bindOnDragEnd=f=>{this._onDragEnd(f)},this._oneClickHandler=()=>{this.listenerOneClick=this.renderer.listen(this._drag.target,"click",()=>!1),this.listenerOneClick()}}onMouseDown(t){this.owlDraggable.isMouseDragable&&this._onDragStart(t)}onTouchStart(t){if(t.targetTouches.length>=2)return!1;this.owlDraggable.isTouchDragable&&this._onDragStart(t)}onTouchCancel(t){this._onDragEnd(t)}onDragStart(){if(this.owlDraggable.isMouseDragable)return!1}onSelectStart(){if(this.owlDraggable.isMouseDragable)return!1}ngOnInit(){this._oneMoveSubsription=this._oneDragMove$.pipe((0,B0.P)()).subscribe(()=>{this._sendChanges()})}ngOnDestroy(){this._oneMoveSubsription.unsubscribe()}_onDragStart(t){let n=null;3!==t.which&&(n=this._prepareDragging(t),this._drag.time=(new Date).getTime(),this._drag.target=t.target,this._drag.stage.start=n,this._drag.stage.current=n,this._drag.pointer=this._pointer(t),this.listenerMouseUp=this.renderer.listen(document,"mouseup",this.bindOnDragEnd),this.listenerTouchEnd=this.renderer.listen(document,"touchend",this.bindOnDragEnd),this.zone.runOutsideAngular(()=>{this.listenerOneMouseMove=this.renderer.listen(document,"mousemove",this.bindOneMouseTouchMove),this.listenerOneTouchMove=this.renderer.listen(document,"touchmove",this.bindOneMouseTouchMove)}))}_oneMouseTouchMove(t){const n=this._difference(this._drag.pointer,this._pointer(t));this.listenerATag&&this.listenerATag(),!(Math.abs(n.x)<3&&Math.abs(n.y)<3&&this._is("valid"))&&(Math.abs(n.x)<3&&Math.abs(n.x)<Math.abs(n.y)&&this._is("valid")||(this.listenerOneMouseMove(),this.listenerOneTouchMove(),this._drag.moving=!0,this.blockClickAnchorInDragging(t),this.listenerMouseMove=this.renderer.listen(document,"mousemove",this.bindOnDragMove),this.listenerTouchMove=this.renderer.listen(document,"touchmove",this.bindOnDragMove),t.preventDefault(),this._enterDragging(),this._oneDragMove$.next(t)))}blockClickAnchorInDragging(t){let n=t.target;for(;n&&!(n instanceof HTMLAnchorElement);)n=n.parentElement;n instanceof HTMLAnchorElement&&(this.listenerATag=this.renderer.listen(n,"click",()=>!1))}_onDragMove(t){let n;const s=this.carouselService.defineNewCoordsDrag(t,this._drag);!1!==s&&(n=s,t.preventDefault(),this._drag.stage.current=n,this._animate(n.x-this._drag.stage.start.x))}_animate(t){this.renderer.setStyle(this.el.nativeElement.children[0],"transform",`translate3d(${t}px,0px,0px`),this.renderer.setStyle(this.el.nativeElement.children[0],"transition","0s")}_onDragEnd(t){this.carouselService.owlDOMData.isGrab=!1,this.listenerOneMouseMove(),this.listenerOneTouchMove(),this._drag.moving&&(this.renderer.setStyle(this.el.nativeElement.children[0],"transform",""),this.renderer.setStyle(this.el.nativeElement.children[0],"transition",this.carouselService.speed(+this.carouselService.settings.dragEndSpeed||this.carouselService.settings.smartSpeed)/1e3+"s"),this._finishDragging(t),this.listenerMouseMove(),this.listenerTouchMove()),this._drag={time:null,target:null,pointer:null,stage:{start:null,current:null},direction:null,active:!1,moving:!1},this.listenerMouseUp(),this.listenerTouchEnd()}_prepareDragging(t){return this.carouselService.prepareDragging(t)}_finishDragging(t){this.carouselService.finishDragging(t,this._drag,this._oneClickHandler)}_pointer(t){return this.carouselService.pointer(t)}_difference(t,n){return this.carouselService.difference(t,n)}_is(t){return this.carouselService.is(t)}_enter(t){this.carouselService.enter(t)}_sendChanges(){this.carouselService.sendChanges()}onTransitionEnd(){this.carouselService.onTransitionEnd()}_enterDragging(){this.carouselService.enterDragging()}clear(t){this.animateService.clear(t)}}return h.\u0275fac=function(t){return new(t||h)(k.Y36(k.R0b),k.Y36(k.SBq),k.Y36(k.Qsj),k.Y36(Ch),k.Y36(G0))},h.\u0275cmp=k.Xpm({type:h,selectors:[["owl-stage"]],hostBindings:function(t,n){1&t&&k.NdJ("mousedown",function(l){return n.onMouseDown(l)})("touchstart",function(l){return n.onTouchStart(l)})("touchcancel",function(l){return n.onTouchCancel(l)})("dragstart",function(){return n.onDragStart()})("selectstart",function(){return n.onSelectStart()})},inputs:{owlDraggable:"owlDraggable",stageData:"stageData",slidesData:"slidesData"},decls:3,vars:8,consts:[[1,"owl-stage",3,"ngStyle","transitionend"],[4,"ngFor","ngForOf"],[1,"owl-item",3,"ngClass","ngStyle","animationend"],[4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(t,n){1&t&&(k.TgZ(0,"div")(1,"div",0),k.NdJ("transitionend",function(){return n.onTransitionEnd()}),k.YNc(2,_b,3,9,"ng-container",1),k.qZA()()),2&t&&(k.xp6(1),k.Q6J("ngStyle",k.qbA(2,yb,n.stageData.width+"px",n.stageData.transform,n.stageData.transition,n.stageData.paddingL?n.stageData.paddingL+"px":"",n.stageData.paddingR?n.stageData.paddingR+"px":"")),k.xp6(1),k.Q6J("ngForOf",n.slidesData))},directives:[Hr.PC,Hr.sg,Hr.mk,Hr.O5,Hr.tP],encapsulation:2,data:{animation:[(0,Eh.X$)("autoHeight",[(0,Eh.SB)("nulled",(0,Eh.oB)({height:0})),(0,Eh.SB)("full",(0,Eh.oB)({height:"*"})),(0,Eh.eR)("full => nulled",[(0,Eh.jt)("700ms 350ms")]),(0,Eh.eR)("nulled => full",[(0,Eh.jt)(350)])])]}}),h})(),Ub=(()=>{class h{constructor(t,n,s,l,u,f,v,b,S,C,I,D){this.el=t,this.resizeService=n,this.carouselService=s,this.navigationService=l,this.autoplayService=u,this.lazyLoadService=f,this.animateService=v,this.autoHeightService=b,this.hashService=S,this.logger=C,this.changeDetectorRef=I,this.translated=new k.vpe,this.dragging=new k.vpe,this.change=new k.vpe,this.changed=new k.vpe,this.initialized=new k.vpe,this.slidesData=[],this.carouselLoaded=!1,this.docRef=D}onVisibilityChange(t){if(this.carouselService.settings.autoplay)switch(this.docRef.visibilityState){case"visible":!this.autoplayService.isAutoplayStopped&&this.autoplayService.play();break;case"hidden":this.autoplayService.pause()}}ngOnInit(){this.spyDataStreams(),this.carouselWindowWidth=this.el.nativeElement.querySelector(".owl-carousel").clientWidth}ngOnChanges(){var t;this.prevOptions!==this.options&&(this.prevOptions&&(null===(t=this.slides)||void 0===t?void 0:t.toArray().length)?(this.carouselService.setup(this.carouselWindowWidth,this.slides.toArray(),this.options),this.carouselService.initialize(this.slides.toArray())):(this.carouselLoaded=!1,this.logger.log("There are no slides to show. So the carousel won't be re-rendered")),this.prevOptions=this.options)}ngAfterContentInit(){this.slides.toArray().length?(this.carouselService.setup(this.carouselWindowWidth,this.slides.toArray(),this.options),this.carouselService.initialize(this.slides.toArray()),this._winResizeWatcher()):this.logger.log("There are no slides to show. So the carousel won't be rendered"),this._slidesChangesSubscription=this.slides.changes.pipe((0,Xn.b)(t=>{t.toArray().length?(this.carouselService.setup(this.carouselWindowWidth,t.toArray(),this.options),this.carouselService.initialize(t.toArray())):(this.carouselLoaded=!1,this.logger.log("There are no slides to show. So the carousel won't be re-rendered"))})).subscribe(()=>{})}ngOnDestroy(){this.resizeSubscription&&this.resizeSubscription.unsubscribe(),this._slidesChangesSubscription&&this._slidesChangesSubscription.unsubscribe(),this._allObservSubscription&&this._allObservSubscription.unsubscribe()}spyDataStreams(){this._viewCurSettings$=this.carouselService.getViewCurSettings().pipe((0,Xn.b)(t=>{this.owlDOMData=t.owlDOMData,this.stageData=t.stageData,this.slidesData=t.slidesData,this.carouselLoaded||(this.carouselLoaded=!0),this.navData=t.navData,this.dotsData=t.dotsData,this.changeDetectorRef.markForCheck()})),this._initializedCarousel$=this.carouselService.getInitializedState().pipe((0,Xn.b)(()=>{this.gatherTranslatedData(),this.initialized.emit(this.slidesOutputData)})),this._translatedCarousel$=this.carouselService.getTranslatedState().pipe((0,Xn.b)(()=>{this.gatherTranslatedData(),this.translated.emit(this.slidesOutputData)})),this._changeCarousel$=this.carouselService.getChangeState().pipe((0,Xn.b)(()=>{this.gatherTranslatedData(),this.change.emit(this.slidesOutputData)})),this._changedCarousel$=this.carouselService.getChangeState().pipe((0,Pg.w)(t=>{const n=(0,Q_.of)(t).pipe((0,as.h)(()=>"position"===t.property.name),(0,Pg.w)(()=>(0,ab.D)(this.slidesData)),(0,yx.T)(t.property.value),(0,_x.q)(this.carouselService.settings.items),(0,ur.U)(s=>{const l=this.carouselService.clonedIdPrefix,u=s.id.indexOf(l)>=0?s.id.slice(l.length):s.id;return Object.assign(Object.assign({},s),{id:u,isActive:!0})}),function ub(){return(0,vx.e)((h,e)=>{(function cb(h,e){return(0,vx.e)((0,lb.U)(h,e,arguments.length>=2,!1,!0))})(hb,[])(h).subscribe(e)})}(),(0,ur.U)(s=>({slides:s,startPosition:this.carouselService.relative(t.property.value)})));return(0,Th.T)(n)}),(0,Xn.b)(t=>{this.gatherTranslatedData(),this.changed.emit(t.slides.length?t:this.slidesOutputData)})),this._draggingCarousel$=this.carouselService.getDragState().pipe((0,Xn.b)(()=>{this.gatherTranslatedData(),this.dragging.emit({dragging:!0,data:this.slidesOutputData})}),(0,Pg.w)(()=>this.carouselService.getDraggedState().pipe((0,ur.U)(()=>!!this.carouselService.is("animating")))),(0,Pg.w)(t=>t?this.carouselService.getTranslatedState().pipe((0,B0.P)()):(0,Q_.of)("not animating")),(0,Xn.b)(()=>{this.dragging.emit({dragging:!1,data:this.slidesOutputData})})),this._carouselMerge$=(0,Th.T)(this._viewCurSettings$,this._translatedCarousel$,this._draggingCarousel$,this._changeCarousel$,this._changedCarousel$,this._initializedCarousel$),this._allObservSubscription=this._carouselMerge$.subscribe(()=>{})}_winResizeWatcher(){Object.keys(this.carouselService._options.responsive).length&&(this.resizeSubscription=this.resizeService.onResize$.pipe((0,as.h)(()=>this.carouselWindowWidth!==this.el.nativeElement.querySelector(".owl-carousel").clientWidth),(0,db.g)(this.carouselService.settings.responsiveRefreshRate)).subscribe(()=>{this.carouselService.onResize(this.el.nativeElement.querySelector(".owl-carousel").clientWidth),this.carouselWindowWidth=this.el.nativeElement.querySelector(".owl-carousel").clientWidth}))}onTransitionEnd(){this.carouselService.onTransitionEnd()}next(){!this.carouselLoaded||this.navigationService.next(this.carouselService.settings.navSpeed)}prev(){!this.carouselLoaded||this.navigationService.prev(this.carouselService.settings.navSpeed)}moveByDot(t){!this.carouselLoaded||this.navigationService.moveByDot(t)}to(t){!this.carouselLoaded||this.navigationService.toSlideById(t)}gatherTranslatedData(){let t;const n=this.carouselService.clonedIdPrefix,s=this.slidesData.filter(l=>!0===l.isActive).map(l=>({id:l.id.indexOf(n)>=0?l.id.slice(n.length):l.id,width:l.width,marginL:l.marginL,marginR:l.marginR,center:l.isCentered}));t=this.carouselService.relative(this.carouselService.current()),this.slidesOutputData={startPosition:t,slides:s}}startPausing(){this.autoplayService.startPausing()}startPlayML(){this.autoplayService.startPlayingMouseLeave()}startPlayTE(){this.autoplayService.startPlayingTouchEnd()}stopAutoplay(){this.autoplayService.isAutoplayStopped=!0,this.autoplayService.stop()}startAutoplay(){this.autoplayService.isAutoplayStopped=!1,this.autoplayService.play()}}return h.\u0275fac=function(t){return new(t||h)(k.Y36(k.SBq),k.Y36(Cx),k.Y36(Ch),k.Y36(xx),k.Y36(wx),k.Y36(Mx),k.Y36(G0),k.Y36(Sx),k.Y36(Tx),k.Y36(F0),k.Y36(k.sBO),k.Y36(N0))},h.\u0275cmp=k.Xpm({type:h,selectors:[["owl-carousel-o"]],contentQueries:function(t,n,s){if(1&t&&k.Suo(s,Ex,4),2&t){let l;k.iGM(l=k.CRH())&&(n.slides=l)}},hostBindings:function(t,n){1&t&&k.NdJ("visibilitychange",function(l){return n.onVisibilityChange(l)},!1,k.evT)},inputs:{options:"options"},outputs:{translated:"translated",dragging:"dragging",change:"change",changed:"changed",initialized:"initialized"},features:[k._Bn([xx,wx,Ch,Mx,G0,Sx,Tx]),k.TTD],decls:4,vars:9,consts:[[1,"owl-carousel","owl-theme",3,"ngClass","mouseover","mouseleave","touchstart","touchend"],["owlCarousel",""],["class","owl-stage-outer",4,"ngIf"],[4,"ngIf"],[1,"owl-stage-outer"],[3,"owlDraggable","stageData","slidesData"],[1,"owl-nav",3,"ngClass"],[1,"owl-prev",3,"ngClass","innerHTML","click"],[1,"owl-next",3,"ngClass","innerHTML","click"],[1,"owl-dots",3,"ngClass"],["class","owl-dot",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"owl-dot",3,"ngClass","click"],[3,"innerHTML"]],template:function(t,n){1&t&&(k.TgZ(0,"div",0,1),k.NdJ("mouseover",function(){return n.startPausing()})("mouseleave",function(){return n.startPlayML()})("touchstart",function(){return n.startPausing()})("touchend",function(){return n.startPlayTE()}),k.YNc(2,xb,2,6,"div",2),k.YNc(3,Mb,6,15,"ng-container",3),k.qZA()),2&t&&(k.Q6J("ngClass",k.qbA(3,Sb,null==n.owlDOMData?null:n.owlDOMData.rtl,null==n.owlDOMData?null:n.owlDOMData.isLoaded,null==n.owlDOMData?null:n.owlDOMData.isResponsive,null==n.owlDOMData?null:n.owlDOMData.isMouseDragable,null==n.owlDOMData?null:n.owlDOMData.isGrab)),k.xp6(2),k.Q6J("ngIf",n.carouselLoaded),k.xp6(1),k.Q6J("ngIf",n.slides.toArray().length))},directives:[Fb,Hr.mk,Hr.O5,Hr.sg],styles:[".owl-theme[_ngcontent-%COMP%]{display:block}"],changeDetection:0}),h})(),Nb=(()=>{class h{}return h.\u0275fac=function(t){return new(t||h)},h.\u0275mod=k.oAB({type:h}),h.\u0275inj=k.cJS({providers:[Db,Cx,Ob,F0],imports:[[Hr.ez]]}),h})();function Vb(h,e){1&h&&(k.TgZ(0,"div",113)(1,"div",114),k._UZ(2,"img",115),k.qZA(),k.TgZ(3,"div",116)(4,"h2",37),k._uU(5,"Conoce nuestra variedad de productos"),k.qZA()()())}function Gb(h,e){1&h&&(k.TgZ(0,"div",113)(1,"div",114),k._UZ(2,"img",117),k.qZA(),k.TgZ(3,"div",116)(4,"h2",37),k._uU(5,"Empresa 100% chihuahuense"),k.qZA()()())}function Hb(h,e){1&h&&(k.TgZ(0,"div",113)(1,"div",114),k._UZ(2,"img",118),k.qZA(),k.TgZ(3,"div",116)(4,"h2",37),k._uU(5,"\xa1Materializa tus ideas!"),k.qZA()()())}function jb(h,e){1&h&&(k.TgZ(0,"div",113)(1,"div",114),k._UZ(2,"img",119),k.qZA(),k.TgZ(3,"div",116)(4,"h2",37),k._uU(5,"Conoce nuestro equipo"),k.qZA()()())}let Wb=(()=>{class h{constructor(t,n){this.SEOService=t,this.utilitiesService=n,this.actualDescription=-1,this.initialWidthDescription=-1,this.customOptions={loop:!1,mouseDrag:!0,touchDrag:!0,pullDrag:!0,center:!0,freeDrag:!0,dots:!1,startPosition:1,navSpeed:700,navText:["",""],responsive:{0:{items:2,margin:5},602:{items:2.5,margin:10},1025:{items:3,margin:20},1367:{items:4.5,margin:35}},nav:!1},this.SEOService.updateMeta(()=>{})}ngOnInit(){var t=this;return(0,m.Z)(function*(){t.initialWidthDescription=-1;let n=document.getElementById("description-div");n&&(console.log("P:",n.offsetWidth),yield t.utilitiesService.sleep(1e3),t.initialWidthDescription=n.offsetWidth)})()}changeUsData(t){this.actualDescription=t==this.actualDescription?-1:t}}return h.\u0275fac=function(t){return new(t||h)(k.Y36(ti),k.Y36($s.e))},h.\u0275cmp=k.Xpm({type:h,selectors:[["app-home"]],hostBindings:function(t,n){1&t&&k.NdJ("resize",function(l){return n.ngOnInit(l)},!1,k.Jf7)},decls:388,vars:27,consts:[[1,"row"],[1,"main-banner-col-A"],["id","col-A-banner-position ",1,"col-2","full-right","full-centered"],[1,"no-margin","vertical-description","full-centered"],["src","/assets/images/pages/landing/barra.png",1,"lateral-bar"],[1,"main-banner-col-B"],[1,"col-12",2,"padding","10px"],["src","/assets/images/pages/landing/gawi_logo.png",1,"gawi-logo"],[1,"col-12"],["id","col-B-D-title",1,"pa-t-10","ff-roboto","card-title","black-color"],["id","col-B-banner",1,"ff-roboto","card-description"],[1,"main-banner-col-C"],[1,"full-height"],[1,"main-banner-col-D"],[1,"col-12","ff-roboto"],["id","col-B-D-title",1,"select-titles"],["id","col-D-select-square",1,"pa-10"],[1,"row","no-display-600"],[1,"col-4","full-centered"],[1,"image-icon","full-centered"],["src","/assets/images/pages/landing/micro.png"],["src","/assets/images/pages/landing/fire.png",1,"fire-image"],["src","/assets/images/pages/landing/agua.png",1,"aqua-icon"],[1,"row","pa-t-10"],[1,"col-4","full-centered","no-padding"],[1,"col-square","full-centered"],["src","/assets/images/pages/landing/micro-btn.png"],["src","/assets/images/pages/landing/meter_gas_btn.png",1,"gas-image"],[1,"col-4","full-right","no-padding"],["src","/assets/images/pages/landing/meter_water_btn.png"],["id","usDescription",1,"about-us-base"],[1,"about-us-wires","about-us-figure"],["src","/assets/images/pages/landing/bg_us_layer.svg",1,""],[1,"about-us-banner-margin","about-us-banner"],[1,"history-us-component"],[1,"row","full-width","no-margin"],[3,"click"],[1,"ff-roboto"],[1,"mission-vision-component","ff-roboto","full-left"],[1,"images-col-size",3,"click"],[1,"full-width","full-height","full-centered","gradient-overlay"],["src","/assets/images/pages/landing/gas_meter_description.png"],["src","/assets/images/pages/landing/water_meter_description.png"],["src","/assets/images/pages/landing/loger_description.png"],["id","description-div"],["id","servicesDescription",1,"our-services-base","full-centered"],[1,"about-us-banner-margin","our-services-banner","full-centered"],[1,"about-us-wires","our-services-figure"],["src","/assets/images/pages/landing/bg_us_services_layer.svg",1,""],[1,"row","full-centered","row-us-services-detail","no-margin"],[1,"col-6","col-lg-3","col-md-4"],[1,"full-width","full-centered"],[1,"row","hide-title"],[1,"col-12","full-centered","resp-btn"],["src","/assets/images/pages/landing/services/concept.svg"],[1,"col-12","full-centered"],[1,"white-color","lgxxx-text"],[1,"row","bar"],[1,"white-color","lg-text"],["src","/assets/images/pages/landing/services/merca.svg"],[1,"white-color","md-text"],["src","/assets/images/pages/landing/services/micro.svg"],["src","/assets/images/pages/landing/services/conf.svg"],["src","/assets/images/pages/landing/services/dis.svg"],["src","/assets/images/pages/landing/services/prot.svg"],["src","/assets/images/pages/landing/services/merca2.svg"],["src","/assets/images/pages/landing/services/suministros.svg"],["src","/assets/images/pages/landing/services/test.svg"],["src","/assets/images/pages/landing/services/cert.svg"],["src","/assets/images/pages/landing/services/herr.svg"],["src","/assets/images/pages/landing/services/rev.svg"],["id","usDescription",1,"about-us-base-mobile"],[1,"about-us-banner-margin","about-us-banner-mobile","bg-us","no-padding"],[1,"pa-20"],[1,"pa-10",2,"text-align","justify","padding","10px 30px 20px 30px"],[1,"row","no-margin","no-display-us"],[1,"col-12","no-padding"],[1,"row","card-us-details"],[1,"col-4","no-padding"],[1,"images-col-size"],[1,"col-8","no-padding"],[1,"description-col-size"],[1,"mission-vision-component","ff-roboto","full-left","pa-10"],[1,"row","full-centered"],[1,"col-12","full-centered","pa-t-30","pa-b-20"],[1,"success-cases-title","ff-roboto"],[1,"col-1"],[1,"col-10","success-cases-card",2,"padding","70px 0"],[1,"col-10"],[1,"col-lg-4","col-md-6","full-centered","bottom-align"],["src","/assets/images/pages/landing/cases/azteca.png"],[1,"col-12","full-centered","title-product"],["src","/assets/images/pages/landing/cases/gps.png"],["src","/assets/images/pages/landing/cases/modulos.png"],["src","/assets/images/pages/landing/cases/gas_sombra.png"],["src","/assets/images/pages/landing/cases/meter_water.png",1,"water-meter-img"],["src","/assets/images/pages/landing/cases/eficacy.png",1,"water-meter-img"],[1,"col-12","full-left","pa-t-30","pa-b-20","col-us-clients",2,"padding-left","5%"],[1,"ff-roboto","us-label","black-color"],[1,"row","row-us-clients"],[1,"col-4","col-sm","full-centered"],["src","/assets/images/pages/landing/clients/ADM.png",1,"bg-image-layer"],["src","/assets/images/pages/landing/clients/asteca.png",1,"bg-image-layer"],["src","/assets/images/pages/landing/clients/electro_full.png",1,"bg-image-layer"],["src","/assets/images/pages/landing/clients/foxconn.png",1,"bg-image-layer"],["src","/assets/images/pages/landing/clients/GCC.png",1,"bg-image-layer"],["src","/assets/images/pages/landing/clients/jabil.png",1,"bg-image-layer"],["src","/assets/images/pages/landing/clients/motherson.png",1,"bg-image-layer"],[1,"row","full-centered","row-innovation","no-margin","no-padding",2,"padding-bottom","70px !important"],[1,"col-12","ff-roboto","pa-t-60","white-color","inovation-label",2,"padding-left","6%"],[1,"col-12","pa-t-10"],[3,"options"],["carouselSlide","","class","pa-10",3,"id"],[1,"row","history-card"],[1,"col-12","col-image"],["src","/assets/images/pages/banners/banner1.jpeg"],[1,"col-12","col-description"],["src","/assets/images/pages/banners/banner2.jpeg"],["src","/assets/images/pages/banners/banner3.jpeg"],["src","/assets/images/pages/banners/banner4.jpeg"]],template:function(t,n){1&t&&(k.TgZ(0,"div",0)(1,"div",1)(2,"div",0)(3,"div",2)(4,"label",3),k._uU(5," Explora nuestros productos "),k._UZ(6,"img",4),k.qZA()()()(),k.TgZ(7,"div",5)(8,"div",0)(9,"div",6),k._UZ(10,"img",7),k.qZA(),k.TgZ(11,"div",8)(12,"label",9),k._uU(13," Medidor de agua "),k.qZA()(),k.TgZ(14,"div",8)(15,"label",10),k._uU(16," En IMTECH contamos con el \xfanico medidor de agua ultras\xf3nico hecho en M\xe9xico: alta tecnolog\xeda desde Chihuahua para tu hogar. "),k.qZA()()()(),k.TgZ(17,"div",11)(18,"div",0),k._UZ(19,"app-models-viewer",12),k.qZA()(),k.TgZ(20,"div",13)(21,"div",0)(22,"div",14)(23,"label",15),k._uU(24," \xa1Selecciona el producto! "),k.qZA()(),k.TgZ(25,"div",16)(26,"div",17)(27,"div",18)(28,"div",19),k._UZ(29,"img",20),k.qZA()(),k.TgZ(30,"div",18)(31,"div",19),k._UZ(32,"img",21),k.qZA()(),k.TgZ(33,"div",18),k._UZ(34,"img",22),k.qZA()(),k.TgZ(35,"div",23)(36,"div",24)(37,"div",25),k._UZ(38,"img",26),k.qZA()(),k.TgZ(39,"div",24)(40,"div",25),k._UZ(41,"img",27),k.qZA()(),k.TgZ(42,"div",28)(43,"div",25),k._UZ(44,"img",29),k.qZA()()()()()(),k.TgZ(45,"div",30)(46,"div",31),k._UZ(47,"img",32),k.qZA(),k.TgZ(48,"div",33)(49,"div",0)(50,"h1"),k._uU(51,"Sobre nosotros"),k.qZA()()()(),k.TgZ(52,"div",34)(53,"div",35)(54,"div",36),k.NdJ("click",function(){return n.changeUsData(0)}),k.TgZ(55,"div")(56,"h2",37),k._uU(57," Historia "),k.qZA(),k.TgZ(58,"p",38),k._uU(59," A lo largo de los a\xf1os, desde IMTECH Aplicada hasta IMTECH Desarrollos, hemos logrado consolidarnos como una empresa desarrolladora de productos con presencia en los estados y ciudades m\xe1s importantes del pa\xeds. "),k.qZA()()(),k.TgZ(60,"div",39),k.NdJ("click",function(){return n.changeUsData(0)}),k.TgZ(61,"div",40)(62,"label",37),k._uU(63,"Historia"),k.qZA(),k._UZ(64,"img",41),k.qZA()(),k.TgZ(65,"div",36),k.NdJ("click",function(){return n.changeUsData(1)}),k.TgZ(66,"div")(67,"h2",37),k._uU(68," Misi\xf3n "),k.qZA(),k.TgZ(69,"p",38),k._uU(70," Brindar soluciones en dise\xf1o electr\xf3nico al convertir una idea en un producto innovador, a trav\xe9s de ofrecer el ciclo completo desde el dise\xf1o y desarrollo hasta la producci\xf3n y actualizaci\xf3n constante. "),k.qZA()()(),k.TgZ(71,"div",39),k.NdJ("click",function(){return n.changeUsData(1)}),k.TgZ(72,"div",40)(73,"label",37),k._uU(74,"Misi\xf3n"),k.qZA(),k._UZ(75,"img",42),k.qZA()(),k.TgZ(76,"div",36),k.NdJ("click",function(){return n.changeUsData(2)}),k.TgZ(77,"div")(78,"h2",37),k._uU(79," Visi\xf3n "),k.qZA(),k.TgZ(80,"p",38),k._uU(81," Somos reconocidos por nuestros clientes nacionales e internacionales como una empresa consolidada en el desarrollo de productos electr\xf3nicos innovadores con capacidades de dise\xf1o y manufactura; fundamentados en procesos estandarizados, personal capacitado y rentabilidad superior al promedio. "),k.qZA()()(),k.TgZ(82,"div",39),k.NdJ("click",function(){return n.changeUsData(2)}),k.TgZ(83,"div",40)(84,"label",37),k._uU(85,"Visi\xf3n"),k.qZA(),k._UZ(86,"img",43),k.qZA()(),k.TgZ(87,"div")(88,"div",44)(89,"h2",37),k._uU(90," \xbfQu\xe9 somos y qu\xe9 hacemos? "),k.qZA(),k.TgZ(91,"p",38),k._uU(92," En IMTECH Desarrollos nos dedicamos al desarrollo de producto. Trabajamos en todas las etapas del proceso de desarrollo, desde la idea hasta la fabricaci\xf3n de prototipos, rondas piloto y producci\xf3n, abarcando diversas \xe1reas seg\xfan la necesidad de tu producto. "),k.qZA()()()()(),k.TgZ(93,"div",45)(94,"div",46)(95,"div",0)(96,"h1"),k._uU(97,"Nuestros servicios"),k.qZA()()(),k.TgZ(98,"div",47),k._UZ(99,"img",48),k.qZA()(),k.TgZ(100,"div",49)(101,"div",8)(102,"div",0)(103,"div",50)(104,"button",51)(105,"div",52)(106,"div",53),k._UZ(107,"img",54),k.qZA(),k.TgZ(108,"div",55)(109,"label",56),k._uU(110,"Concepto"),k.qZA()()(),k.TgZ(111,"div",57)(112,"div",55)(113,"label",58),k._uU(114," Esculpimos sobre las ideas originales de nuestros clientes para formar un concepto viable, ponemos en pr\xe1ctica nuestros conocimientos t\xe9cnicos para experimentarlo en la realidad, proyectando un producto terminado. "),k.qZA()()()()(),k.TgZ(115,"div",50)(116,"button",51)(117,"div",52)(118,"div",53),k._UZ(119,"img",59),k.qZA(),k.TgZ(120,"div",55)(121,"label",60),k._uU(122,"Mercadotecnia y "),k._UZ(123,"br"),k._uU(124,"an\xe1lisis de negocios"),k.qZA()()(),k.TgZ(125,"div",57)(126,"div",55)(127,"label",58),k._uU(128," Como, donde y quien comprar\xe1 el producto; respondemos a esas y otras cuestiones del mercadeo: an\xe1lisis de la competencia, mercado, producto, precios, canales de distribuci\xf3n, factibilidad, publicidad y relacionadas. "),k.qZA()()()()(),k.TgZ(129,"div",50)(130,"button",51)(131,"div",52)(132,"div",53),k._UZ(133,"img",61),k.qZA(),k.TgZ(134,"div",55)(135,"label",60),k._uU(136,"Dise\xf1o"),k._UZ(137,"br"),k._uU(138,"electr\xf3nico"),k.qZA()()(),k.TgZ(139,"div",57)(140,"div",55)(141,"label",58),k._uU(142," El cerebro del producto, que determinar\xe1 varias de sus caracter\xedsticas distintivas. Dise\xf1amos todo el entorno electr\xf3nico que sustentar\xe1 sus conductas y reacciones. Tablillas, PCB, contactos, pantallas; entre otros. "),k.qZA()()()()(),k.TgZ(143,"div",50)(144,"button",51)(145,"div",52)(146,"div",53),k._UZ(147,"img",62),k.qZA(),k.TgZ(148,"div",55)(149,"label",60),k._uU(150,"Dise\xf1o mec\xe1nico "),k._UZ(151,"br"),k._uU(152,"e industrial"),k.qZA()()(),k.TgZ(153,"div",57)(154,"div",55)(155,"label",58),k._uU(156," Dise\xf1amos la materia y el movimiento del producto, para determinar su comportamiento f\xedsico: ensambles, materiales, movimientos, resistencias al desgaste, realizaci\xf3n de pruebas, entre otras. "),k.qZA()()()()(),k.TgZ(157,"div",50)(158,"button",51)(159,"div",52)(160,"div",53),k._UZ(161,"img",63),k.qZA(),k.TgZ(162,"div",55)(163,"label",60),k._uU(164,"Dise\xf1o de software"),k._UZ(165,"br"),k._uU(166," y firmware"),k.qZA()()(),k.TgZ(167,"div",57)(168,"div",55)(169,"label",58),k._uU(170," Dise\xf1amos las instrucciones que guiar\xe1n el producto, generamos su mente. a trav\xe9s de programaci\xf3n de sistemas computacionales, organizamos el entorno para controlarlo y conducirlo. "),k.qZA()()()()(),k.TgZ(171,"div",50)(172,"button",51)(173,"div",52)(174,"div",53),k._UZ(175,"img",64),k.qZA(),k.TgZ(176,"div",55)(177,"label",56),k._uU(178,"Prototipado"),k.qZA()()(),k.TgZ(179,"div",57)(180,"div",55)(181,"label",58),k._uU(182," Traemos a la realidad diversas versiones del producto para probarlas bajo diferentes condiciones, elaboramos corridas piloto que nos den informaci\xf3n para terminarlo de la mejor manera. "),k.qZA()()()()(),k.TgZ(183,"div",50)(184,"button",51)(185,"div",52)(186,"div",53),k._UZ(187,"img",65),k.qZA(),k.TgZ(188,"div",55)(189,"label",60),k._uU(190,"Prueba de"),k._UZ(191,"br"),k._uU(192," mercado"),k.qZA()()(),k.TgZ(193,"div",57)(194,"div",55)(195,"label",58),k._uU(196," Colocamos el proyecto contra la realidad, usando los prototipos beta definimos la presentaci\xf3n del producto, quienes lo adquirir\xe1n, precios, cual ser\xe1 su marca, como lo haremos llegar a los clientes. "),k.qZA()()()()(),k.TgZ(197,"div",50)(198,"button",51)(199,"div",52)(200,"div",53),k._UZ(201,"img",66),k.qZA(),k.TgZ(202,"div",55)(203,"label",60),k._uU(204,"Cadena de"),k._UZ(205,"br"),k._uU(206," suministros"),k.qZA()()(),k.TgZ(207,"div",57)(208,"div",55)(209,"label",58),k._uU(210," Determinamos las necesidades para producci\xf3n y quienes las cumplir\xe1n. Todos los elementos necesarios para manufacturar el producto a nivel industrial deben considerarse. "),k.qZA()()()()(),k.TgZ(211,"div",50)(212,"button",51)(213,"div",52)(214,"div",53),k._UZ(215,"img",67),k.qZA(),k.TgZ(216,"div",55)(217,"label",60),k._uU(218,"Equipos de"),k._UZ(219,"br"),k._uU(220," prueba"),k.qZA()()(),k.TgZ(221,"div",57)(222,"div",55)(223,"label",58),k._uU(224," Generamos los equipos necesarios para las pruebas del proyecto durante su producci\xf3n. "),k.qZA()()()()(),k.TgZ(225,"div",50)(226,"button",51)(227,"div",52)(228,"div",53),k._UZ(229,"img",68),k.qZA(),k.TgZ(230,"div",55)(231,"label",60),k._uU(232,"Certificaciones"),k.qZA()()(),k.TgZ(233,"div",57)(234,"div",55)(235,"label",58),k._uU(236," Acopiamos y cumplimos los requisitos que exigen las agencias para obtener la certificaci\xf3n del producto. "),k.qZA()()()()(),k.TgZ(237,"div",50)(238,"button",51)(239,"div",52)(240,"div",53),k._UZ(241,"img",69),k.qZA(),k.TgZ(242,"div",55)(243,"label",60),k._uU(244,"Herramentales"),k.qZA()()(),k.TgZ(245,"div",57)(246,"div",55)(247,"label",58),k._uU(248," Proveemos todas las herramientas necesarias para el proceso de producci\xf3n, ya sean inyectores de pl\xe1stico, est\xe9nciles, programas pick\u2019n play entre otros; todo lo que resulte necesario para elaborar el producto. "),k.qZA()()()()(),k.TgZ(249,"div",50)(250,"button",51)(251,"div",52)(252,"div",53),k._UZ(253,"img",70),k.qZA(),k.TgZ(254,"div",55)(255,"label",56),k._uU(256,"Revisi\xf3n"),k.qZA()()(),k.TgZ(257,"div",57)(258,"div",55)(259,"label",58),k._uU(260," Tomamos el producto terminado y expuesto al publico, para revisarlo, hacer correcciones y adecuaciones necesarias, desde la mercadotecnia, el dise\xf1o industrial, la producci\xf3n, el dise\xf1o de prototipo o de concepto. "),k.qZA()()()()()()()(),k.TgZ(261,"div",71)(262,"div",72)(263,"div",0)(264,"h1",73),k._uU(265,"\xbfQu\xe9 somos y qu\xe9 hacemos?"),k.qZA(),k.TgZ(266,"p",74),k._uU(267," En IMTECH Desarrollos nos dedicamos al desarrollo de producto. Trabajamos en todas las etapas del proceso de desarrollo, desde la idea hasta la fabricaci\xf3n de prototipos, rondas piloto y producci\xf3n, abarcando diversas \xe1reas seg\xfan la necesidad de tu producto. "),k.qZA()()()(),k.TgZ(268,"div",75)(269,"div",76)(270,"div",77)(271,"div",78)(272,"div",79)(273,"div",40)(274,"label",37),k._uU(275,"Misi\xf3n"),k.qZA(),k._UZ(276,"img",42),k.qZA()()(),k.TgZ(277,"div",80)(278,"div",81)(279,"div")(280,"p",82),k._uU(281," Brindar soluciones en dise\xf1o electr\xf3nico al convertir una idea en un producto innovador, a trav\xe9s de ofrecer el ciclo completo desde el dise\xf1o y desarrollo hasta la producci\xf3n y actualizaci\xf3n constante. "),k.qZA()()()()(),k.TgZ(282,"div",77)(283,"div",78)(284,"div",79)(285,"div",40)(286,"label",37),k._uU(287,"Visi\xf3n"),k.qZA(),k._UZ(288,"img",43),k.qZA()()(),k.TgZ(289,"div",80)(290,"div",81)(291,"div")(292,"p",82),k._uU(293," Somos reconocidos por nuestros clientes nacionales e internacionales como una empresa consolidada en el desarrollo de productos electr\xf3nicos innovadores con capacidades de dise\xf1o y manufactura; fundamentados en procesos estandarizados, personal capacitado y rentabilidad superior al promedio. "),k.qZA()()()()(),k.TgZ(294,"div",77)(295,"div",78)(296,"div",79)(297,"div",40)(298,"label",37),k._uU(299,"Visi\xf3n"),k.qZA(),k._UZ(300,"img",41),k.qZA()()(),k.TgZ(301,"div",80)(302,"div",81)(303,"div")(304,"p",82),k._uU(305," En IMTECH Desarrollos nos dedicamos al desarrollo de producto. Trabajamos en todas las etapas del proceso de desarrollo, desde la idea hasta la fabricaci\xf3n de prototipos, rondas piloto y producci\xf3n, abarcando diversas \xe1reas seg\xfan la necesidad de tu producto. "),k.qZA()()()()()()(),k.TgZ(306,"div",83)(307,"div",84)(308,"h1",85),k._uU(309," Casos de \xe9xito "),k.qZA()(),k.TgZ(310,"div",8)(311,"div",0),k._UZ(312,"div",86),k.TgZ(313,"div",87)(314,"div",0),k._UZ(315,"div",86),k.TgZ(316,"div",88)(317,"div",0)(318,"div",89)(319,"div",0)(320,"div",55),k._UZ(321,"img",90),k.qZA(),k.TgZ(322,"div",91),k._uU(323," Medidor Azteca "),k.qZA()()(),k.TgZ(324,"div",89)(325,"div",0)(326,"div",55),k._UZ(327,"img",92),k.qZA(),k.TgZ(328,"div",91),k._uU(329," GPS "),k.qZA()()(),k.TgZ(330,"div",89)(331,"div",0)(332,"div",55),k._UZ(333,"img",93),k.qZA(),k.TgZ(334,"div",91),k._uU(335," Modulos IM "),k.qZA()()(),k.TgZ(336,"div",89)(337,"div",0)(338,"div",55),k._UZ(339,"img",94),k.qZA(),k.TgZ(340,"div",91),k._uU(341," Medidor de gas "),k.qZA()()(),k.TgZ(342,"div",89)(343,"div",0)(344,"div",55),k._UZ(345,"img",95),k.qZA(),k.TgZ(346,"div",91),k._uU(347," Medidor ultrasonico "),k.qZA()()(),k.TgZ(348,"div",89)(349,"div",0)(350,"div",55),k._UZ(351,"img",96),k.qZA(),k.TgZ(352,"div",91),k._uU(353," Medidor de eficiencia "),k.qZA()()()()(),k._UZ(354,"div",86),k.qZA()(),k._UZ(355,"div",86),k.qZA()()(),k.TgZ(356,"div",83)(357,"div",97)(358,"label",98),k._uU(359," Nuestros clientes "),k.qZA()()(),k.TgZ(360,"div",99)(361,"div",100),k._UZ(362,"img",101),k.qZA(),k.TgZ(363,"div",100),k._UZ(364,"img",102),k.qZA(),k.TgZ(365,"div",100),k._UZ(366,"img",103),k.qZA(),k.TgZ(367,"div",100),k._UZ(368,"img",104),k.qZA(),k.TgZ(369,"div",100),k._UZ(370,"img",105),k.qZA(),k.TgZ(371,"div",100),k._UZ(372,"img",106),k.qZA(),k.TgZ(373,"div",100),k._UZ(374,"img",107),k.qZA()(),k.TgZ(375,"div",108)(376,"div",109),k._uU(377," Innovaci\xf3n "),k.qZA(),k.TgZ(378,"div",110)(379,"owl-carousel-o",111),k.ynx(380),k.YNc(381,Vb,6,0,"ng-template",112),k.BQk(),k.ynx(382),k.YNc(383,Gb,6,0,"ng-template",112),k.BQk(),k.ynx(384),k.YNc(385,Hb,6,0,"ng-template",112),k.BQk(),k.ynx(386),k.YNc(387,jb,6,0,"ng-template",112),k.BQk(),k.qZA()()()()),2&t&&(k.xp6(54),k.Tol(0==n.actualDescription?"description-col-size":"description-col-size closed"),k.xp6(1),k.Udp("width",-1==n.initialWidthDescription?"100%":n.initialWidthDescription+"px"),k.xp6(10),k.Tol(1==n.actualDescription?"description-col-size":"description-col-size closed"),k.xp6(1),k.Udp("width",-1==n.initialWidthDescription?"100%":n.initialWidthDescription+"px"),k.xp6(10),k.Tol(2==n.actualDescription?"description-col-size":"description-col-size closed"),k.xp6(1),k.Udp("width",-1==n.initialWidthDescription?"100%":n.initialWidthDescription+"px"),k.xp6(10),k.Tol(-1==n.actualDescription?"description-col-size":"description-col-size closed"),k.xp6(1),k.Udp("width",-1==n.initialWidthDescription?"100%":n.initialWidthDescription+"px"),k.xp6(191),k.Udp("width","100%"),k.xp6(12),k.Udp("width","100%"),k.xp6(12),k.Udp("width","100%"),k.xp6(76),k.Q6J("options",n.customOptions),k.xp6(2),k.Q6J("id","1"),k.xp6(2),k.Q6J("id","2"),k.xp6(2),k.Q6J("id","3"),k.xp6(2),k.Q6J("id","3"))},directives:[ob,Ub,Ex],styles:['.about-us-base[_ngcontent-%COMP%], .about-us-base-mobile[_ngcontent-%COMP%]{background-color:#173c5a;width:100%;display:flex;flex-wrap:wrap}.our-services-base[_ngcontent-%COMP%]{background-color:#a2c905;width:100%;display:flex;flex-wrap:wrap}.about-us-wires[_ngcontent-%COMP%]{height:180px}.about-us-wires[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.about-us-banner-margin[_ngcontent-%COMP%]{margin:auto;color:#fff}@media screen and (min-width: 1590px){.our-services-figure[_ngcontent-%COMP%]{width:45%}.our-services-banner[_ngcontent-%COMP%]{width:55%;margin-left:auto}.our-services-banner[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:left;padding:10px 10px 10px 50px;font-size:5vw}.main-banner-col-B[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}#col-B-D-title[_ngcontent-%COMP%]{font-size:2.8em}#col-B-banner[_ngcontent-%COMP%]{font-size:1.6em}.main-banner-col-D[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%;position:absolute;padding-top:240px;padding-left:9%}#col-D-select-square[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}}@media (min-width: 1367px) and (max-width: 1589px){.our-services-figure[_ngcontent-%COMP%]{width:45%}.our-services-banner[_ngcontent-%COMP%]{width:55%;margin-left:auto}.our-services-banner[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:left;padding:10px 10px 10px 50px;font-size:5vw}.main-banner-col-B[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}#col-B-D-title[_ngcontent-%COMP%]{font-size:2.8em}#col-B-banner[_ngcontent-%COMP%]{font-size:1.6em}.main-banner-col-D[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%;position:absolute;padding-top:240px;padding-left:9%}#col-D-select-square[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}}@media (min-width: 1025px) and (max-width: 1366px){.about-us-banner[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:right;padding-right:50px;font-size:4vw}.our-services-figure[_ngcontent-%COMP%]{width:45%}.our-services-banner[_ngcontent-%COMP%]{width:55%;margin-left:auto}.our-services-banner[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:left;padding:10px 10px 10px 50px;font-size:5vw}.main-banner-col-B[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}#col-B-banner[_ngcontent-%COMP%]{font-size:1.4em}.main-banner-col-D[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%;position:absolute;padding-top:257px;padding-left:9%}#col-D-select-square[_ngcontent-%COMP%]{flex:0 0 46%;max-width:46%}}@media (min-width: 602px) and (max-width: 1055px){.main-banner-col-B[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}#col-B-D-title[_ngcontent-%COMP%]{font-size:3.5vw}#col-B-banner[_ngcontent-%COMP%]{font-size:2vw}.main-banner-col-D[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%;position:absolute;padding-left:9%;padding-top:29%}#col-D-select-square[_ngcontent-%COMP%]{flex:0 0 50%;max-width:50%}}@media (min-width: 361px) and (max-width: 601px){#col-B-D-title[_ngcontent-%COMP%]{font-size:2.8em}#col-B-banner[_ngcontent-%COMP%]{font-size:1.6em}.main-banner-col-B[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}.main-banner-col-D[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%;position:absolute;padding-top:257px;padding-left:9%}#col-D-select-square[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}}.main-banner-col-B[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}@media (min-width: 1px) and (max-width: 360px){#col-B-D-title[_ngcontent-%COMP%]{font-size:2.8em}#col-B-banner[_ngcontent-%COMP%]{font-size:1.6em}.main-banner-col-D[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%;position:absolute;padding-top:257px;padding-left:9%}#col-D-select-square[_ngcontent-%COMP%]{flex:0 0 41%;max-width:41%}}.mission-vision-component[_ngcontent-%COMP%]{text-align:left}.gawi-logo[_ngcontent-%COMP%]{height:50px}.card-title[_ngcontent-%COMP%]{font-size:2.8em;font-weight:600;color:#000}.card-description[_ngcontent-%COMP%]{font-weight:100;font-size:25px;line-height:1.2;color:#7a7a7a}.select-titles[_ngcontent-%COMP%]{font-size:2.45em;font-weight:700;color:#000}.vertical-description[_ngcontent-%COMP%]{transform:rotate(180deg);writing-mode:vertical-rl;text-orientation:mixed;color:#d0d0d0}.vertical-description[_ngcontent-%COMP%]   .lateral-bar[_ngcontent-%COMP%]{height:134px;padding-top:25px}.aqua-icon[_ngcontent-%COMP%]{width:70px}.row-images-opts[_ngcontent-%COMP%]{position:absolute;width:100%;padding-top:20px;z-index:9}.us-label[_ngcontent-%COMP%]{font-size:5.3em;font-weight:600;margin:0}.row-bg-us[_ngcontent-%COMP%]{height:180px;background:#173c5a;z-index:-1}.row-bg-us[_ngcontent-%COMP%]   .bg-image-layer[_ngcontent-%COMP%]{width:100%;height:148px}.row-us-services[_ngcontent-%COMP%]{height:180px;background:#a2c905;z-index:-1}.row-us-services[_ngcontent-%COMP%]   .us-label[_ngcontent-%COMP%]{font-size:5.3em;font-weight:600;margin:0}.row-us-services[_ngcontent-%COMP%]   .bg-image-layer[_ngcontent-%COMP%]{width:100%;height:180px}.row-us-clients[_ngcontent-%COMP%]{height:180px;align-content:center;z-index:-1;display:flex;background-image:url(/assets/images/pages/landing/clients/bg_clients.png)}.row-us-clients[_ngcontent-%COMP%]   .bg-image-layer[_ngcontent-%COMP%]{max-width:80%}.row-innovation[_ngcontent-%COMP%]{background:#80bc00;background-image:url(/assets/images/pages/landing/bg_inovation.svg)}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]{width:100%}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;object-position:center;border-radius:35px 35px 0 0}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]{background:#173c5a;color:#fff;padding:15px 25px;border-radius:0 0 35px 35px}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:xx-large;font-style:italic;font-weight:700}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:x-large;font-weight:100;padding:5px 0}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{line-height:1.5}.row-us-services-detail[_ngcontent-%COMP%]{background:#ffffff;cursor:pointer;padding-top:8px}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]{padding:8px;cursor:pointer}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#a2c907;transition:.5s ease-in-out;width:100%;height:346px;border:2px solid #ffffff;cursor:pointer}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:75%;cursor:pointer}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   div.bar[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   div.bar[_ngcontent-%COMP%]{transition:.5s ease-in-out;opacity:0}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:scale(1.05);z-index:10}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .hide-title[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .hide-title[_ngcontent-%COMP%]{transition:.5s ease-in-out;position:absolute;opacity:1}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus, .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:none}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus   .hide-title[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus   .hide-title[_ngcontent-%COMP%]{opacity:0;position:absolute}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus   div.bar[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus   div.bar[_ngcontent-%COMP%]{opacity:1}.row-us-services-detail[_ngcontent-%COMP%]   .md-text[_ngcontent-%COMP%]{font-size:x-large;font-weight:600;cursor:pointer}.row-us-services-detail[_ngcontent-%COMP%]   .lgxxx-text[_ngcontent-%COMP%]{font-size:xxx-large;cursor:pointer}.row-us-services-detail[_ngcontent-%COMP%]   .lg-text[_ngcontent-%COMP%]{font-size:1.5em;cursor:pointer}.description-col-size[_ngcontent-%COMP%]{transition:1s ease-in-out;width:40%;height:300px;background-color:#80bc00;color:#fff;padding:25px;opacity:1}.description-col-size[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2.2em;font-weight:600}.closed[_ngcontent-%COMP%]{min-width:0px;width:0%;padding:25px 0}.gradient-overlay[_ngcontent-%COMP%]{position:relative;transition:.3s ease-in-out}.gradient-overlay[_ngcontent-%COMP%]:hover{transform:scale(1.05);z-index:10}.gradient-overlay[_ngcontent-%COMP%]:focus{outline:none}.gradient-overlay[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;object-position:center}.gradient-overlay[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{position:absolute;color:#fff;z-index:1;font-size:32px;cursor:pointer}.gradient-overlay[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(circle,#000000d4 0%,#54545442 100%);opacity:.8}.success-cases-card[_ngcontent-%COMP%]{background:#e6e6e6;border-radius:40px}.success-cases-card[_ngcontent-%COMP%]   .btn-more-info[_ngcontent-%COMP%]{color:#777;background-color:#e6e6e6;border:2px solid #777777;font-weight:500}.success-cases-card[_ngcontent-%COMP%]   .title-product[_ngcontent-%COMP%]{font-size:1.5em;font-weight:500;color:#746f63;padding:5px 0}.success-cases-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:70%;max-width:200px;max-height:250px}.success-cases-card[_ngcontent-%COMP%]   .water-meter-img[_ngcontent-%COMP%]{width:80%;max-width:250px;max-height:250px}.success-cases-card[_ngcontent-%COMP%]   .bottom-align[_ngcontent-%COMP%]{align-items:end!important}#col-A-banner-position[_ngcontent-%COMP%]{padding-left:70%}.main-banner-col-A[_ngcontent-%COMP%]{flex:0 0 9%;max-width:9%}.image-icon[_ngcontent-%COMP%]{border-radius:70px;border:2px solid #bcbcbc}#col-D-select-square[_ngcontent-%COMP%]   .image-icon[_ngcontent-%COMP%], #col-D-select-square[_ngcontent-%COMP%]   .aqua-icon[_ngcontent-%COMP%]{width:70%;height:100%;max-width:80px}#col-D-select-square[_ngcontent-%COMP%]   .image-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], #col-D-select-square[_ngcontent-%COMP%]   .aqua-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:55%}@media (min-width: 1px) and (max-width: 601px){.main-banner-col-C[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%;z-index:19;padding-bottom:25px}}@media (min-width: 600px) and (max-width: 1055px){.main-banner-col-A[_ngcontent-%COMP%]{padding-bottom:4%}.main-banner-col-B[_ngcontent-%COMP%]   .gawi-logo[_ngcontent-%COMP%]{height:35px;padding-top:10px}.main-banner-col-C[_ngcontent-%COMP%]{flex:0 0 50%;max-width:50%;z-index:19}.vertical-description[_ngcontent-%COMP%]{font-size:2vw}.col-square[_ngcontent-%COMP%]{margin:0 6px;background:#e4eff9;border-radius:17px;width:70%;height:100%}.col-square[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{padding:10px;width:90%}.col-square[_ngcontent-%COMP%]   .gas-image[_ngcontent-%COMP%]{width:80%}}@media (min-width: 720px) and (max-width: 1055px){.main-banner-col-A[_ngcontent-%COMP%]{padding-bottom:7%}}@media screen and (min-width: 1055px){.main-banner-col-C[_ngcontent-%COMP%]{flex:0 0 50%;max-width:50%;z-index:19}.main-banner-col-A[_ngcontent-%COMP%]{padding-bottom:90px}.col-square[_ngcontent-%COMP%]{margin:0 6px;background:#e4eff9;border-radius:17px;height:140px;max-width:200px;width:92%}.col-square[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{padding:10px;width:150px;height:100px}.col-square[_ngcontent-%COMP%]   .gas-image[_ngcontent-%COMP%]{width:100px}}.images-col-size[_ngcontent-%COMP%]{transition:.3s ease-in-out;width:20%;height:300px;cursor:pointer;padding:0}@media screen and (min-width: 601px){.images-col-size[_ngcontent-%COMP%]{height:170px}.images-col-size[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.2em;font-weight:600}.description-col-size[_ngcontent-%COMP%]{height:170px;padding-top:10px}.description-col-size[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2.6vw;font-weight:600}.description-col-size[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.4vw}}@media screen and (min-width: 1120px){.images-col-size[_ngcontent-%COMP%]{height:300px}.images-col-size[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:3em;font-weight:600}.description-col-size[_ngcontent-%COMP%]{height:300px;padding-top:25px}.description-col-size[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2.2em;font-weight:600}.description-col-size[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.5em}}@media (min-width: 1px) and (max-width: 600px){.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:170px}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .resp-btn[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .resp-btn[_ngcontent-%COMP%]{height:100px}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .lgxxx-text[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .lgxxx-text[_ngcontent-%COMP%]{font-size:large}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .lg-text[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .lg-text[_ngcontent-%COMP%]{font-size:x-small}.row-us-services-detail[_ngcontent-%COMP%]   .col-lg-3[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .row-us-services-detail[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1em}}@media (min-width: 1px) and (max-width: 854px){.our-services-banner[_ngcontent-%COMP%]{position:absolute;width:100%}.our-services-figure[_ngcontent-%COMP%]{width:100%;height:90px}}@media (min-width: 1px) and (max-width: 600px){.our-services-figure[_ngcontent-%COMP%]{height:50px}}.about-us-figure[_ngcontent-%COMP%]{width:55%}.about-us-banner[_ngcontent-%COMP%]{width:45%;margin-left:auto;text-align:right;padding-right:50px;font-size:5vw}.inovation-label[_ngcontent-%COMP%]{font-weight:600;margin:0}@media (min-width: 1px) and (max-width: 470px){.row-innovation[_ngcontent-%COMP%]   .inovation-label[_ngcontent-%COMP%]{font-size:2em}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-image[_ngcontent-%COMP%]{height:150px;padding:0}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]{height:120px;padding:15px 25px}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:initial}}@media (min-width: 470px) and (max-width: 750px){.row-innovation[_ngcontent-%COMP%]   .inovation-label[_ngcontent-%COMP%]{font-size:3em}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-image[_ngcontent-%COMP%]{height:200px;padding:0}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]{height:150px;padding:15px 25px}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:large}}@media (min-width: 750px) and (max-width: 900px){.row-innovation[_ngcontent-%COMP%]   .inovation-label[_ngcontent-%COMP%]{font-size:4em}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-image[_ngcontent-%COMP%]{height:250px;padding:0}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]{height:180px;padding:15px 25px}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:x-large}}@media (min-width: 900px) and (max-width: 1367px){.row-innovation[_ngcontent-%COMP%]   .inovation-label[_ngcontent-%COMP%]{font-size:5em}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-image[_ngcontent-%COMP%]{height:320px;padding:0}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]{height:200px;padding:15px 25px}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:x-large}}@media screen and (min-width: 1367px){.row-innovation[_ngcontent-%COMP%]   .inovation-label[_ngcontent-%COMP%]{font-size:6em}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-image[_ngcontent-%COMP%]{height:270px;padding:0}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]{height:200px;padding:15px 25px}.row-innovation[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .col-description[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:x-large}}.about-us-banner[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{padding:10px 50px 10px 10px;text-align:right}@media (min-width: 0px) and (max-width: 600px){.about-us-base[_ngcontent-%COMP%], .no-display-600[_ngcontent-%COMP%], .main-banner-col-A[_ngcontent-%COMP%], .main-banner-col-B[_ngcontent-%COMP%], .history-us-component[_ngcontent-%COMP%], .main-banner-col-D[_ngcontent-%COMP%], .about-us-base[_ngcontent-%COMP%]{display:none}.row-us-clients[_ngcontent-%COMP%]   .us-label[_ngcontent-%COMP%]{font-size:2.3em}}@media (min-width: 600px) and (max-width: 1055px){.about-us-banner[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:3.5vw}.about-us-wires[_ngcontent-%COMP%]{height:90px}}@media (min-width: 1055px) and (max-width: 1589px){.about-us-banner[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:4vw}.about-us-wires[_ngcontent-%COMP%]{height:120px}}@media screen and (min-width: 1589px){.about-us-banner[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:3.5vw}.about-us-wires[_ngcontent-%COMP%]{height:120px}}.col-us-clients[_ngcontent-%COMP%]   .us-label[_ngcontent-%COMP%]{font-size:4em;color:#746f63;font-weight:700}@media (min-width: 0px) and (max-width: 600px){.col-us-clients[_ngcontent-%COMP%]   .us-label[_ngcontent-%COMP%]{font-size:2em;color:#746f63;font-weight:700}}@media (min-width: 0px) and (max-width: 600px){.description-col-size[_ngcontent-%COMP%], .images-col-size[_ngcontent-%COMP%]{width:100%;height:120px;padding:0;border-radius:0 20px 20px 0}.description-col-size[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .images-col-size[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:large}.description-col-size[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .images-col-size[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:2.4vw}.card-us-details[_ngcontent-%COMP%]{padding:5px 15px}}@media screen and (min-width: 600px){.about-us-base-mobile[_ngcontent-%COMP%]{display:none}.about-us-banner-mobile[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:left;padding-right:0;font-size:4vw}.no-display-us[_ngcontent-%COMP%]{display:none}}.bg-us[_ngcontent-%COMP%]{align-content:center;z-index:1;display:flex;background-image:url(/assets/images/pages/landing/bg_us_layer.svg);object-fit:cover;width:100%}']}),h})();var Ig=tn(9898),Zb=tn(1615);const qb=[{path:"",redirectTo:"/",pathMatch:"full"},{path:"",children:[{path:"",component:Wb,data:{pageTitle:"Informaci\xf3n general de la empresa",title:"IMTECH",description:"",keywords:"",ogUrl:"https://ingmulti.com/#/",ogTitle:"IMTECH",ogDescription:"",ogImage:"https://ingmulti.com/#/assets/minified/images/meta.png",urls:[{title:"Inicio",url:"/dashboard-admin/home"},{title:"Inicio"}]}},{path:"contact",component:(()=>{class h{constructor(t){this.utilitiesService=t,this.mapMapBox=null}ngOnInit(){this.initMapBox()}initMapBox(){try{let t=-106.1111267,n=28.680642;Ig.accessToken=Zb.I.mapBoxApiKey,this.mapMapBox=new Ig.Map({container:"mapa-mapbox-contact",style:"mapbox://styles/mapbox/streets-v11",center:[-106.1111267,28.680642],zoom:16}),this.addMarker(t,n),this.mapMapBox.addControl(new Ig.NavigationControl)}catch(t){this.utilitiesService.showErrorToast("No se pudo inicializar el mapa","Error"),console.log(t)}}addMarker(t,n){const s=document.createElement("div");s.className="marker-imtech",new Ig.Marker(s).setLngLat([t+2e-4,n+1e-4]).setPopup(new Ig.Popup({offset:25,closeOnClick:!1,focusAfterOpen:!1,closeOnMove:!1}).setHTML('<div class="row pa-10"><div class="col-12 full-centered"><img class="pa-30 normal-shadow logo-image-tm" src="/assets/images/pages/contact/logo_trans.png"></div></div>')).addTo(this.mapMapBox).togglePopup()}}return h.\u0275fac=function(t){return new(t||h)(k.Y36($s.e))},h.\u0275cmp=k.Xpm({type:h,selectors:[["app-contact"]],decls:42,vars:0,consts:[[1,"pa-t-40","pa-b-40"],[1,"row","full-width","size-padding"],[1,"col-12"],[1,"ff-roboto"],[1,"row","pa-t-40"],[1,"col-12","col-md-6"],[1,"row"],[1,"col-2","full-centered","no-padding"],["src","./assets/images/pages/contact/location.png"],[1,"col-10","full-centered","full-left"],["src","./assets/images/pages/contact/face.png"],["href","https://www.facebook.com/Imtecnologiaaplicada/","target","_blank",1,"ff-roboto"],[1,"col-12","col-md-6","pa-t-10"],["src","./assets/images/pages/contact/mail.png"],["href","mailto:contacto@ingmulti.com"],["href","mailto:ventas@ingmulti.com"],["src","./assets/images/pages/contact/phone.png",1,"pa-t-10"],[1,"col-12","no-padding","map-container"],["id","mapa-mapbox-contact",1,"map-container"]],template:function(t,n){1&t&&(k.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),k._uU(4," \xa1Contactanos! "),k.qZA()(),k.TgZ(5,"div",2)(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7),k._UZ(10,"img",8),k.qZA(),k.TgZ(11,"div",9)(12,"label",3),k._uU(13," Calle Pedro Vargas 7515, Colonia Lourdes C.P. 31120, Chihuahua, Chihuahua, M\xe9xico "),k.qZA()(),k.TgZ(14,"div",7),k._UZ(15,"img",10),k.qZA(),k.TgZ(16,"div",9)(17,"label",3)(18,"a",11),k._uU(19," https://www.facebook.com/Imtecnologiaaplicada/ "),k.qZA()()()()(),k.TgZ(20,"div",12)(21,"div",6)(22,"div",7),k._UZ(23,"img",13),k.qZA(),k.TgZ(24,"div",9)(25,"label",3)(26,"a",14),k._uU(27,"contacto@ingmulti.com"),k.qZA(),k._UZ(28,"br"),k.TgZ(29,"a",15),k._uU(30,"ventas@ingmulti.com"),k.qZA()()(),k.TgZ(31,"div",7),k._UZ(32,"img",16),k.qZA(),k.TgZ(33,"div",9)(34,"label",3),k._uU(35," (+52) 614 417 81 89"),k._UZ(36,"br"),k._uU(37," (+52) 614 417 82 00 "),k.qZA()()()()()()()(),k.TgZ(38,"div",0)(39,"div",1)(40,"div",17),k._UZ(41,"div",18),k.qZA()()())},styles:[".size-padding[_ngcontent-%COMP%]{padding:0 11%}h1[_ngcontent-%COMP%]{padding-top:30px;font-size:5em;font-weight:700}label[_ngcontent-%COMP%]{font-size:2em;color:#000;line-height:30px!important;overflow-wrap:break-word;width:100%}.col-2[_ngcontent-%COMP%], .col-10[_ngcontent-%COMP%]{padding:15px}a[_ngcontent-%COMP%]{color:#000}a[_ngcontent-%COMP%]:hover, a[_ngcontent-%COMP%]:hover   label[_ngcontent-%COMP%]{color:#2b832f}.map-container[_ngcontent-%COMP%]{width:100%;height:80em;border-radius:100px}@media (min-width: 0px) and (max-width: 600px){.ff-roboto[_ngcontent-%COMP%]{font-size:1.2em;line-height:20px!important;padding-left:10px}img[_ngcontent-%COMP%]{padding:10px;width:140%}h1[_ngcontent-%COMP%]{font-size:3em!important}}@media screen and (min-width: 600px){img[_ngcontent-%COMP%]{width:100%;padding:10px;min-width:80px}}"]}),h})(),data:{pageTitle:"Catalogo de productos",title:"IMTECH | Catalogo de productos",description:"",keywords:"",ogUrl:"https://ingmulti.com/#/",ogTitle:"IMTECH",ogDescription:"",ogImage:"https://ingmulti.com/#/assets/minified/images/meta.png",urls:[{title:"Inicio",url:"/dashboard-admin/home"}]}}]}],Ax=new k.OlP("ngx-mask config"),Px=new k.OlP("new ngx-mask config"),Ix=new k.OlP("initial ngx-mask config"),$b={suffix:"",prefix:"",thousandSeparator:" ",decimalMarker:[".",","],clearIfNotMatch:!1,showTemplate:!1,showMaskTyped:!1,placeHolderCharacter:"_",dropSpecialCharacters:!0,hiddenInput:void 0,shownMaskExpression:"",separatorLimit:"",allowNegativeNumbers:!1,validation:!0,specialCharacters:["-","/","(",")",".",":"," ","+",",","@","[","]",'"',"'"],leadZeroDateTime:!1,triggerOnMaskChange:!1,maskFilled:new k.vpe,patterns:{0:{pattern:new RegExp("\\d")},9:{pattern:new RegExp("\\d"),optional:!0},X:{pattern:new RegExp("\\d"),symbol:"*"},A:{pattern:new RegExp("[a-zA-Z0-9]")},S:{pattern:new RegExp("[a-zA-Z]")},d:{pattern:new RegExp("\\d")},m:{pattern:new RegExp("\\d")},M:{pattern:new RegExp("\\d")},H:{pattern:new RegExp("\\d")},h:{pattern:new RegExp("\\d")},s:{pattern:new RegExp("\\d")}}};let Xb=(()=>{class h{constructor(t){this._config=t,this.maskExpression="",this.actualValue="",this.shownMaskExpression="",this._formatWithSeparators=(n,s,l,u)=>{var f,v;let b=[],S="";if(Array.isArray(l)){const N=new RegExp(l.map(j=>"[\\^$.|?*+()".indexOf(j)>=0?`\\${j}`:j).join("|"));b=n.split(N),S=null!==(v=null===(f=n.match(N))||void 0===f?void 0:f[0])&&void 0!==v?v:""}else b=n.split(l),S=l;const C=b.length>1?`${S}${b[1]}`:"";let I=b[0];const D=this.separatorLimit.replace(/\s/g,"");D&&+D&&(I="-"===I[0]?`-${I.slice(1,I.length).slice(0,D.length)}`:I.slice(0,D.length));const O=/(\d+)(\d{3})/;for(;s&&O.test(I);)I=I.replace(O,"$1"+s+"$2");return void 0===u?I+C:0===u?I:I+C.substr(0,u+1)},this.percentage=n=>Number(n)>=0&&Number(n)<=100,this.getPrecision=n=>{const s=n.split(".");return s.length>1?Number(s[s.length-1]):1/0},this.checkAndRemoveSuffix=n=>{var s,l,u;for(let f=(null===(s=this.suffix)||void 0===s?void 0:s.length)-1;f>=0;f--){const v=this.suffix.substr(f,null===(l=this.suffix)||void 0===l?void 0:l.length);if(n.includes(v)&&(f-1<0||!n.includes(this.suffix.substr(f-1,null===(u=this.suffix)||void 0===u?void 0:u.length))))return n.replace(v,"")}return n},this.checkInputPrecision=(n,s,l)=>{if(s<1/0){if(Array.isArray(l)){const v=l.find(b=>b!==this.thousandSeparator);l=v||l[0]}const u=new RegExp(this._charToRegExpExpression(l)+`\\d{${s}}.*$`),f=n.match(u);f&&f[0].length-1>s&&(n=n.substring(0,n.length-(f[0].length-1-s))),0===s&&this._compareOrIncludes(n[n.length-1],l,this.thousandSeparator)&&(n=n.substring(0,n.length-1))}return n},this._shift=new Set,this.clearIfNotMatch=this._config.clearIfNotMatch,this.dropSpecialCharacters=this._config.dropSpecialCharacters,this.maskSpecialCharacters=this._config.specialCharacters,this.maskAvailablePatterns=this._config.patterns,this.prefix=this._config.prefix,this.suffix=this._config.suffix,this.thousandSeparator=this._config.thousandSeparator,this.decimalMarker=this._config.decimalMarker,this.hiddenInput=this._config.hiddenInput,this.showMaskTyped=this._config.showMaskTyped,this.placeHolderCharacter=this._config.placeHolderCharacter,this.validation=this._config.validation,this.separatorLimit=this._config.separatorLimit,this.allowNegativeNumbers=this._config.allowNegativeNumbers,this.leadZeroDateTime=this._config.leadZeroDateTime}applyMaskWithPattern(t,n){const[s,l]=n;return this.customPattern=l,this.applyMask(t,s)}applyMask(t,n,s=0,l=!1,u=!1,f=(()=>{})){var v,b;if(!n||"string"!=typeof t)return"";let S=0,C="",I=!1,D=!1,O=1,N=!1;t.slice(0,this.prefix.length)===this.prefix&&(t=t.slice(this.prefix.length,t.length)),this.suffix&&(null==t?void 0:t.length)>0&&(t=this.checkAndRemoveSuffix(t));const j=t.toString().split("");"IP"===n&&(this.ipError=j.filter(oe=>"."===oe).length<3&&j.length<7,n="099.099.099.099");const U=[];for(let oe=0;oe<t.length;oe++)(null===(v=t[oe])||void 0===v?void 0:v.match("\\d"))&&U.push(t[oe]);if("CPF_CNPJ"===n&&(this.cpfCnpjError=11!==U.length&&14!==U.length,n=U.length>11?"00.000.000/0000-00":"000.000.000-00"),n.startsWith("percent")){if(t.match("[a-z]|[A-Z]")||t.match(/[-!$%^&*()_+|~=`{}\[\]:";'<>?,\/.]/)){t=this._stripToDecimal(t);const oe=this.getPrecision(n);t=this.checkInputPrecision(t,oe,this.decimalMarker)}t.indexOf(".")>0&&!this.percentage(t.substring(0,t.indexOf(".")))&&(t=`${t.substring(0,t.indexOf(".")-1)}${t.substring(t.indexOf("."),t.length)}`),C=this.percentage(t)?t:t.substring(0,t.length-1)}else if(n.startsWith("separator")){(t.match("[w\u0430-\u044f\u0410-\u042f]")||t.match("[\u0401\u0451\u0410-\u044f]")||t.match("[a-z]|[A-Z]")||t.match(/[-@#!$%\\^&*()_\xa3\xac'+|~=`{}\[\]:";<>.?\/]/)||t.match("[^A-Za-z0-9,]"))&&(t=this._stripToDecimal(t)),t=t.length>1&&"0"===t[0]&&!this._compareOrIncludes(t[1],this.decimalMarker,this.thousandSeparator)&&!u?t.slice(1,t.length):t,u&&(t=this._compareOrIncludes(t[t.length-1],this.decimalMarker,this.thousandSeparator)?t.slice(0,t.length-1):t);const oe=this._charToRegExpExpression(this.thousandSeparator);let de='@#!$%^&*()_+|~=`{}\\[\\]:\\s,\\.";<>?\\/'.replace(oe,"");if(Array.isArray(this.decimalMarker))for(const ot of this.decimalMarker)de=de.replace(this._charToRegExpExpression(ot),"");else de=de.replace(this._charToRegExpExpression(this.decimalMarker),"");const Ce=new RegExp("["+de+"]");(t.match(Ce)||1===t.length&&this._compareOrIncludes(t,this.decimalMarker,this.thousandSeparator))&&(t=t.substring(0,t.length-1));const Le=this.getPrecision(n),Oe=(t=this.checkInputPrecision(t,Le,this.decimalMarker)).replace(new RegExp(oe,"g"),"");C=this._formatWithSeparators(Oe,this.thousandSeparator,this.decimalMarker,Le);const Ze=C.indexOf(",")-t.indexOf(","),et=C.length-t.length;if(et>0&&","!==C[s]){D=!0;let ot=0;do{this._shift.add(s+ot),ot++}while(ot<et)}else 0!==Ze&&s>0&&!(C.indexOf(",")>=s&&s>3)||!(C.indexOf(".")>=s&&s>3)&&et<=0?(this._shift.clear(),D=!0,O=et,this._shift.add(s+=et)):this._shift.clear()}else for(let oe=0,de=j[0];oe<j.length&&S!==n.length;oe++,de=j[oe])if(this._checkSymbolMask(de,n[S])&&"?"===n[S+1])C+=de,S+=2;else if("*"===n[S+1]&&I&&this._checkSymbolMask(de,n[S+2]))C+=de,S+=3,I=!1;else if(this._checkSymbolMask(de,n[S])&&"*"===n[S+1])C+=de,I=!0;else if("?"===n[S+1]&&this._checkSymbolMask(de,n[S+2]))C+=de,S+=3;else if(this._checkSymbolMask(de,n[S])){if("H"===n[S]&&Number(de)>2){S+=1,this._shiftStep(n,S,j.length),oe--,this.leadZeroDateTime&&(C+="0");continue}if("h"===n[S]&&"2"===C&&Number(de)>3){S+=1,oe--;continue}if("m"===n[S]&&Number(de)>5){S+=1,this._shiftStep(n,S,j.length),oe--,this.leadZeroDateTime&&(C+="0");continue}if("s"===n[S]&&Number(de)>5){S+=1,this._shiftStep(n,S,j.length),oe--,this.leadZeroDateTime&&(C+="0");continue}const Ce=31;if("d"===n[S]&&(Number(de)>3&&this.leadZeroDateTime||Number(t.slice(S,S+2))>Ce||"/"===t[S+1])){S+=1,this._shiftStep(n,S,j.length),oe--,this.leadZeroDateTime&&(C+="0");continue}if("M"===n[S]){const Oe=0===S&&(Number(de)>2||Number(t.slice(S,S+2))>12||"/"===t[S+1]),Ze=t.slice(S-3,S-1).includes("/")&&("/"===t[S-2]&&Number(t.slice(S-1,S+1))>12&&"/"!==t[S]||"/"===t[S]||"/"===t[S-3]&&Number(t.slice(S-2,S))>12&&"/"!==t[S-1]||"/"===t[S-1]),et=Number(t.slice(S-3,S-1))<=Ce&&!t.slice(S-3,S-1).includes("/")&&"/"===t[S-1]&&(Number(t.slice(S,S+2))>12||"/"===t[S+1]),ot=Number(t.slice(S-3,S-1))>Ce&&!t.slice(S-3,S-1).includes("/")&&!t.slice(S-2,S).includes("/")&&Number(t.slice(S-2,S))>12,Ve=Number(t.slice(S-3,S-1))<=Ce&&!t.slice(S-3,S-1).includes("/")&&"/"!==t[S-1]&&Number(t.slice(S-1,S+1))>12;if(Number(de)>1&&this.leadZeroDateTime||Oe||Ze||et||ot||Ve){S+=1,this._shiftStep(n,S,j.length),oe--,this.leadZeroDateTime&&(C+="0");continue}}C+=de,S++}else-1!==this.maskSpecialCharacters.indexOf(n[S])?(C+=n[S],S++,this._shiftStep(n,S,j.length),oe--):this.maskSpecialCharacters.indexOf(de)>-1&&this.maskAvailablePatterns[n[S]]&&(null===(b=this.maskAvailablePatterns[n[S]])||void 0===b?void 0:b.optional)?(!!j[S]&&"099.099.099.099"!==n&&"000.000.000-00"!==n&&"00.000.000/0000-00"!==n&&(C+=j[S]),S++,oe--):"*"===this.maskExpression[S+1]&&this._findSpecialChar(this.maskExpression[S+2])&&this._findSpecialChar(de)===this.maskExpression[S+2]&&I||"?"===this.maskExpression[S+1]&&this._findSpecialChar(this.maskExpression[S+2])&&this._findSpecialChar(de)===this.maskExpression[S+2]&&I?(S+=3,C+=de):this.showMaskTyped&&this.maskSpecialCharacters.indexOf(de)<0&&de!==this.placeHolderCharacter&&(N=!0);C.length+1===n.length&&-1!==this.maskSpecialCharacters.indexOf(n[n.length-1])&&(C+=n[n.length-1]);let Q=s+1;for(;this._shift.has(Q);)O++,Q++;let Y=l?S:this._shift.has(s)?O:0;N&&Y--,f(Y,D),O<0&&this._shift.clear();let Z=!1;u&&(Z=j.every(oe=>this.maskSpecialCharacters.includes(oe)));let te=`${this.prefix}${Z?"":C}${this.suffix}`;return 0===C.length&&(te=`${this.prefix}${C}`),te}_findSpecialChar(t){return this.maskSpecialCharacters.find(n=>n===t)}_checkSymbolMask(t,n){return this.maskAvailablePatterns=this.customPattern?this.customPattern:this.maskAvailablePatterns,this.maskAvailablePatterns[n]&&this.maskAvailablePatterns[n].pattern&&this.maskAvailablePatterns[n].pattern.test(t)}_stripToDecimal(t){return t.split("").filter((n,s)=>n.match("^-?\\d")||n.match("\\s")||"."===n||","===n||"-"===n&&0===s&&this.allowNegativeNumbers).join("")}_charToRegExpExpression(t){return t&&(" "===t?"\\s":"[\\^$.|?*+()".indexOf(t)>=0?`\\${t}`:t)}_shiftStep(t,n,s){const l=/[*?]/g.test(t.slice(0,n))?s:n;this._shift.add(l+this.prefix.length||0)}_compareOrIncludes(t,n,s){return Array.isArray(n)?n.filter(l=>l!==s).includes(t):t===n}}return h.\u0275fac=function(t){return new(t||h)(k.LFG(Ax))},h.\u0275prov=k.Yz7({token:h,factory:h.\u0275fac}),h})();function Yb(h,e){return Object.assign(Object.assign({},h),e instanceof Function?e():e)}let Jb=(()=>{class h{static forRoot(t){return{ngModule:h,providers:[{provide:Px,useValue:t},{provide:Ix,useValue:$b},{provide:Ax,useFactory:Yb,deps:[Ix,Px]},Xb]}}static forChild(){return{ngModule:h}}}return h.\u0275fac=function(t){return new(t||h)},h.\u0275mod=k.oAB({type:h}),h.\u0275inj=k.cJS({}),h})();const Dx="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};Dx.KeyboardEvent||(Dx.KeyboardEvent=function(h,e){});const Kb={validation:!1};let Qb=(()=>{class h{}return h.\u0275fac=function(t){return new(t||h)},h.\u0275mod=k.oAB({type:h}),h.\u0275inj=k.cJS({imports:[[Hr.ez,Za.u5,Jb.forRoot(Kb),O0.IJ]]}),h})(),ew=(()=>{class h{}return h.\u0275fac=function(t){return new(t||h)},h.\u0275mod=k.oAB({type:h}),h.\u0275inj=k.cJS({imports:[[Dh.Bz.forChild(qb),Hr.ez,Za.u5,Za.UX,Qb,Nb]]}),h})()},9898:function(X0){X0.exports=function(){"use strict";var Ih,tn,Hr;function Za(m,k){if(Ih)if(tn){var as="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ih+")(sharedChunk); ("+tn+")(sharedChunk); self.onerror = null;",ur={};Ih(ur),Hr=k(ur),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Hr.workerUrl=window.URL.createObjectURL(new Blob([as],{type:"text/javascript"})))}else tn=k;else Ih=k}return Za(0,function(m){var k="2.8.0",as=ur;function ur(o,i,a,c){this.cx=3*o,this.bx=3*(a-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=c,this.p2x=a,this.p2y=c}ur.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},ur.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},ur.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},ur.prototype.solveCurveX=function(o,i){var a,c,p,_,x;for(void 0===i&&(i=1e-6),p=o,x=0;x<8;x++){if(_=this.sampleCurveX(p)-o,Math.abs(_)<i)return p;var w=this.sampleCurveDerivativeX(p);if(Math.abs(w)<1e-6)break;p-=_/w}if((p=o)<(a=0))return a;if(p>(c=1))return c;for(;a<c;){if(_=this.sampleCurveX(p),Math.abs(_-o)<i)return p;o>_?a=p:c=p,p=.5*(c-a)+a}return p},ur.prototype.solve=function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))};var ct=yi;function yi(o,i){this.x=o,this.y=i}yi.prototype={clone:function(){return new yi(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,a=o.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),a=Math.sin(o),c=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=c,this},_rotateAround:function(o,i){var a=Math.cos(o),c=Math.sin(o),p=i.y+c*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-c*(this.y-i.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yi.convert=function(o){return o instanceof yi?o:Array.isArray(o)?new yi(o[0],o[1]):o};var ti="undefined"!=typeof self?self:{};const $s=Math.PI/180,pa=180/Math.PI;function Ai(o){return o*$s}function Fn(o){return o*pa}const Mc=[[0,0],[1,0],[1,1],[0,1]];function ma(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,a=i*o;return 4*(o<.5?a:3*(o-i)+a-.75)}function fa(o,i,a,c){const p=new as(o,i,a,c);return function(_){return p.solve(_)}}const Xs=fa(.25,.1,.25,1);function Pi(o,i,a){return Math.min(a,Math.max(i,o))}function Ts(o,i,a){return(a=Pi((a-o)/(i-o),0,1))*a*(3-2*a)}function Es(o,i,a){const c=a-i,p=((o-i)%c+c)%c+i;return p===i?a:p}function qa(o,i,a){if(!o.length)return a(null,[]);let c=o.length;const p=new Array(o.length);let _=null;o.forEach((x,w)=>{i(x,(E,P)=>{E&&(_=E),p[w]=P,0==--c&&a(_,p)})})}function Sc(o){const i=[];for(const a in o)i.push(o[a]);return i}function Pn(o,...i){for(const a of i)for(const c in a)o[c]=a[c];return o}let Tc=1;function lo(){return Tc++}function jr(){return function o(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Ec(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function zo(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function $a(o,i){o.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function co(o,i){return-1!==o.indexOf(i,o.length-i.length)}function Oo(o,i,a){const c={};for(const p in o)c[p]=i.call(a||this,o[p],p,o);return c}function Xa(o,i,a){const c={};for(const p in o)i.call(a||this,o[p],p,o)&&(c[p]=o[p]);return c}function Wr(o){return Array.isArray(o)?o.map(Wr):"object"==typeof o&&o?Oo(o,Wr):o}const Cc={};function nn(o){Cc[o]||("undefined"!=typeof console&&console.warn(o),Cc[o]=!0)}function ir(o,i,a){return(a.y-o.y)*(i.x-o.x)>(i.y-o.y)*(a.x-o.x)}function ga(o){let i=0;for(let a,c,p=0,_=o.length,x=_-1;p<_;x=p++)a=o[p],c=o[x],i+=(c.x-a.x)*(a.y+c.y);return i}function Ys(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Bl(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,c,p,_)=>{const x=p||_;return i[c]=!x||x.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let Bo,Ac,Ya,ho,vi=null;function ls(o){if(null==vi){const i=o.navigator?o.navigator.userAgent:null;vi=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return vi}function Pc(o){try{const i=ti[o];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(i){return!1}}const Zr={now:()=>void 0!==Ya?Ya:ti.performance.now(),setNow(o){Ya=o},restoreNow(){Ya=void 0},frame(o){const i=ti.requestAnimationFrame(o);return{cancel:()=>ti.cancelAnimationFrame(i)}},getImageData(o,i=0){const{width:a,height:c}=o;ho||(ho=ti.document.createElement("canvas"));const p=ho.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return(a>ho.width||c>ho.height)&&(ho.width=a,ho.height=c),p.clearRect(-i,-i,a+2*i,c+2*i),p.drawImage(o,0,0,a,c),p.getImageData(-i,-i,a+2*i,c+2*i)},resolveURL:o=>(Bo||(Bo=ti.document.createElement("a")),Bo.href=o,Bo.href),get devicePixelRatio(){return ti.devicePixelRatio},get prefersReducedMotion(){return!!ti.matchMedia&&(null==Ac&&(Ac=ti.matchMedia("(prefers-reduced-motion: reduce)")),Ac.matches)}};let uo;const zi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==uo){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{uo=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch(i){uo=o}}return uo},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Js={supported:!1,testSupport:function(o){!_a&&Cs&&(Fl?Ka(o):Ja=o)}};let Ja,Cs,_a=!1,Fl=!1;function Ka(o){const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Cs),o.isContextLost())return;Js.supported=!0}catch(a){}o.deleteTexture(i),_a=!0}ti.document&&(Cs=ti.document.createElement("img"),Cs.onload=function(){Ja&&Ka(Ja),Ja=null,Fl=!0},Cs.onerror=function(){_a=!0,Ja=null},Cs.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Qa="01",Fo="NO_ACCESS_TOKEN";function As(o){return 0===o.indexOf("mapbox:")}function el(o){return zi.API_URL_REGEX.test(o)}const si=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function cs(o){const i=o.match(si);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Uo(o){const i=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${i}`}function Ic(o){if(!o)return null;const i=o.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(ti.atob(i[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(a){return null}}class ya{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const a=Ic(zi.ACCESS_TOKEN);let c="";return c=a&&a.u?ti.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(p,_)=>String.fromCharCode(Number("0x"+_)))):zi.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const i=Pc("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{const p=ti.localStorage.getItem(a);p&&(this.eventData=JSON.parse(p));const _=ti.localStorage.getItem(c);_&&(this.anonId=_)}catch(p){nn("Unable to read from LocalStorage")}}saveEventData(){const i=Pc("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{ti.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&ti.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(p){nn("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,a,c,p){if(!zi.EVENTS_URL)return;const _=cs(zi.EVENTS_URL);_.params.push(`access_token=${p||zi.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:Qa,userId:this.anonId},w=a?Pn(x,a):x,E={url:Uo(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=Me(E,P=>{this.pendingRequest=null,c(P),this.saveEventData(),this.processRequests(p)})}queueRequest(i,a){this.queue.push(i),this.processRequests(a)}}const va=new class extends ya{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,i){zi.EVENTS_URL&&zi.ACCESS_TOKEN&&Array.isArray(o)&&o.some(a=>As(a)||el(a))&&this.queueRequest(Date.now(),i)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Ic(zi.ACCESS_TOKEN),a=i?i.u:zi.ACCESS_TOKEN;let c=a!==this.eventData.tokenU;zo(this.anonId)||(this.anonId=jr(),c=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),x=new Date(p),w=(p-this.eventData.lastSuccess)/864e5;c=c||w>=1||w<-1||_.getDate()!==x.getDate()}else c=!0;c?this.postEvent(p,{"enabled.telemetry":!1},_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=a)},o):this.processRequests()}},qr=va.postTurnstileEvent.bind(va),Jn=new class extends ya{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,i,a,c){this.skuToken=i,this.errorCb=c,zi.EVENTS_URL&&(a||zi.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Fo)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),zo(this.anonId)||(this.anonId=jr()),this.postEvent(a,{skuToken:this.skuToken},c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o))}},tl=Jn.postMapLoadEvent.bind(Jn),po=new class extends ya{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,i,a,c){if(!zi.API_URL||!zi.SESSION_PATH)return;const p=cs(zi.API_URL+zi.SESSION_PATH);p.params.push(`sku=${i||""}`),p.params.push(`access_token=${c||zi.ACCESS_TOKEN||""}`);const _={url:Uo(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ue(_,x=>{this.pendingRequest=null,a(x),this.saveEventData(),this.processRequests(c)})}getSessionAPI(o,i,a,c){this.skuToken=i,this.errorCb=c,zi.SESSION_PATH&&zi.API_URL&&(a||zi.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Fo)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||this.getSession(a,this.skuToken,c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o)}},xa=po.getSessionAPI.bind(po),or=new Set,ar="mapbox-tiles";let hs,Ps,No=500,ba=50;function Vo(){ti.caches&&!hs&&(hs=ti.caches.open(ar))}function Ul(o){const i=o.indexOf("?");return i<0?o:o.slice(0,i)}let Mt=1/0;const se={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(se);class W extends Error{constructor(i,a,c){401===a&&el(c)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const X=Ys()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ti.location.protocol?ti.parent:ti).location.href,ae=function(o,i){if(!(/^file:/.test(a=o.url)||/^file:/.test(X())&&!/^\w+:/.test(a))){if(ti.fetch&&ti.Request&&ti.AbortController&&ti.Request.prototype.hasOwnProperty("signal"))return function(c,p){const _=new ti.AbortController,x=new ti.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:X(),signal:_.signal});let w=!1,E=!1;const P=(R=x.url).indexOf("sku=")>0&&el(R);var R;"json"===c.type&&x.headers.set("Accept","application/json");const z=(H,$,K)=>{if(E)return;if(H&&"SecurityError"!==H.message&&nn(H),$&&K)return B($);const ne=Date.now();ti.fetch(x).then(le=>{if(le.ok){const be=P?le.clone():null;return B(le,be,ne)}return p(new W(le.statusText,le.status,c.url))}).catch(le=>{20!==le.code&&p(new Error(le.message))})},B=(H,$,K)=>{("arrayBuffer"===c.type?H.arrayBuffer():"json"===c.type?H.json():H.text()).then(ne=>{E||($&&K&&function(le,be,Se){if(Vo(),!hs)return;const De={status:be.status,statusText:be.statusText,headers:new ti.Headers};be.headers.forEach((qe,$e)=>De.headers.set($e,qe));const Re=Bl(be.headers.get("Cache-Control")||"");if(Re["no-store"])return;Re["max-age"]&&De.headers.set("Expires",new Date(Se+1e3*Re["max-age"]).toUTCString());const ke=De.headers.get("Expires");ke&&(new Date(ke).getTime()-Se<42e4||function(qe,$e){if(void 0===Ps)try{new Response(new ReadableStream),Ps=!0}catch(Je){Ps=!1}Ps?$e(qe.body):qe.blob().then($e)}(be,qe=>{const $e=new ti.Response(qe,De);Vo(),hs&&hs.then(Je=>Je.put(Ul(le.url),$e)).catch(Je=>nn(Je.message))}))}(x,$,K),w=!0,p(null,ne,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(ne=>{E||p(new Error(ne.message))})};return P?function(H,$){if(Vo(),!hs)return $(null);const K=Ul(H.url);hs.then(ne=>{ne.match(K).then(le=>{const be=function(Se){if(!Se)return!1;const De=new Date(Se.headers.get("Expires")||0),Re=Bl(Se.headers.get("Cache-Control")||"");return De>Date.now()&&!Re["no-cache"]}(le);ne.delete(K),be&&ne.put(K,le.clone()),$(null,le,be)}).catch($)}).catch($)}(x,z):z(null,null),{cancel:()=>{E=!0,w||_.abort()}}}(o,i);if(Ys()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i,void 0,!0)}var a;return function(c,p){const _=new ti.XMLHttpRequest;_.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(_.responseType="arraybuffer");for(const x in c.headers)_.setRequestHeader(x,c.headers[x]);return"json"===c.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===c.credentials,_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let x=_.response;if("json"===c.type)try{x=JSON.parse(_.response)}catch(w){return p(w)}p(null,x,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else p(new W(_.statusText,_.status,c.url))},_.send(c.body),{cancel:()=>_.abort()}}(o,i)},fe=function(o,i){return ae(Pn(o,{type:"arrayBuffer"}),i)},Me=function(o,i){return ae(Pn(o,{method:"POST"}),i)},Ue=function(o,i){return ae(Pn(o,{method:"GET"}),i)};function Be(o){const i=ti.document.createElement("a");return i.href=o,i.protocol===ti.document.location.protocol&&i.host===ti.document.location.host}const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let we,rt;we=[],rt=0;const At=function(o,i){if(Js.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),rt>=zi.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:o,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return we.push(_),_}rt++;let a=!1;const c=()=>{if(!a)for(a=!0,rt--;we.length&&rt<zi.MAX_PARALLEL_IMAGE_REQUESTS;){const _=we.shift(),{requestParameters:x,callback:w,cancelled:E}=_;E||(_.cancel=At(x,w).cancel)}},p=fe(o,(_,x,w,E)=>{c(),_?i(_):x&&(ti.createImageBitmap?function(P,R){const z=new ti.Blob([new Uint8Array(P)],{type:"image/png"});ti.createImageBitmap(z).then(B=>{R(null,B)}).catch(B=>{R(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(P,R)=>i(P,R,w,E)):function(P,R){const z=new ti.Image,B=ti.URL;z.onload=()=>{R(null,z),B.revokeObjectURL(z.src),z.onload=null,ti.requestAnimationFrame(()=>{z.src=Ae})},z.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new ti.Blob([new Uint8Array(P)],{type:"image/png"});z.src=P.byteLength?B.createObjectURL(H):Ae}(x,(P,R)=>i(P,R,w,E)))});return{cancel:()=>{p.cancel(),c()}}};function ut(o,i,a){a[o]&&-1!==a[o].indexOf(i)||(a[o]=a[o]||[],a[o].push(i))}function Qt(o,i,a){if(a&&a[o]){const c=a[o].indexOf(i);-1!==c&&a[o].splice(c,1)}}class Jt{constructor(i,a={}){Pn(this,a),this.type=i}}class Dt extends Jt{constructor(i,a={}){super("error",Pn({error:i},a))}}class Rt{on(i,a){return this._listeners=this._listeners||{},ut(i,a,this._listeners),this}off(i,a){return Qt(i,a,this._listeners),Qt(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},ut(i,a,this._oneTimeListeners),this):new Promise(c=>this.once(i,c))}fire(i,a){"string"==typeof i&&(i=new Jt(i,a||{}));const c=i.type;if(this.listens(c)){i.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of p)w.call(this,i);const _=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of _)Qt(c,w,this._oneTimeListeners),w.call(this,i);const x=this._eventedParent;x&&(Pn(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(i))}else i instanceof Dt&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}var Fe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Di(o,...i){for(const a of i)for(const c in a)o[c]=a[c];return o}function Ut(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function ui(o){if(Array.isArray(o))return o.map(ui);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const a in o)i[a]=ui(o[a]);return i}return Ut(o)}class me extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class Go{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[c,p]of a)this.bindings[c]=p}concat(i){return new Go(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const mo={kind:"null"},yt={kind:"number"},fi={kind:"string"},pi={kind:"boolean"},Is={kind:"color"},Ds={kind:"object"},gi={kind:"value"},Ls={kind:"collator"},us={kind:"formatted"},Un={kind:"resolvedImage"};function lr(o,i){return{kind:"array",itemType:o,N:i}}function on(o){if("array"===o.kind){const i=on(o.itemType);return"number"==typeof o.N?`array<${i}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${i}>`}return o.kind}const Lh=[mo,yt,fi,pi,Is,us,Ds,lr(gi),Un];function wa(o,i){if("error"===i.kind)return null;if("array"===o.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!wa(o.itemType,i.itemType))&&("number"!=typeof o.N||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if("value"===o.kind)for(const a of Lh)if(!wa(a,i))return null}return`Expected ${on(o)} but found ${on(i)} instead.`}function fo(o,i){return i.some(a=>a.kind===o.kind)}function Ma(o,i){return i.some(a=>"null"===a?null===o:"array"===a?Array.isArray(o):"object"===a?o&&!Array.isArray(o)&&"object"==typeof o:a===typeof o)}function Rh(o){var i={exports:{}};return o(i,i.exports),i.exports}var kh=Rh(function(o,i){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(w){return(w=Math.round(w))<0?0:w>255?255:w}function p(w){return c("%"===w[w.length-1]?parseFloat(w)/100*255:parseInt(w))}function _(w){return(E="%"===w[w.length-1]?parseFloat(w)/100:parseFloat(w))<0?0:E>1?1:E;var E}function x(w,E,P){return P<0?P+=1:P>1&&(P-=1),6*P<1?w+(E-w)*P*6:2*P<1?E:3*P<2?w+(E-w)*(2/3-P)*6:w}try{i.parseCSSColor=function(w){var E,P=w.replace(/ /g,"").toLowerCase();if(P in a)return a[P].slice();if("#"===P[0])return 4===P.length?(E=parseInt(P.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===P.length&&(E=parseInt(P.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var R=P.indexOf("("),z=P.indexOf(")");if(-1!==R&&z+1===P.length){var B=P.substr(0,R),H=P.substr(R+1,z-(R+1)).split(","),$=1;switch(B){case"rgba":if(4!==H.length)return null;$=_(H.pop());case"rgb":return 3!==H.length?null:[p(H[0]),p(H[1]),p(H[2]),$];case"hsla":if(4!==H.length)return null;$=_(H.pop());case"hsl":if(3!==H.length)return null;var K=(parseFloat(H[0])%360+360)%360/360,ne=_(H[1]),le=_(H[2]),be=le<=.5?le*(ne+1):le+ne-le*ne,Se=2*le-be;return[c(255*x(Se,be,K+1/3)),c(255*x(Se,be,K)),c(255*x(Se,be,K-1/3)),$];default:return null}}return null}}catch(w){}});class Ii{constructor(i,a,c,p=1){this.r=i,this.g=a,this.b=c,this.a=p}static parse(i){if(!i)return;if(i instanceof Ii)return i;if("string"!=typeof i)return;const a=kh.parseCSSColor(i);return a?new Ii(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[i,a,c,p]=this.toArray();return`rgba(${Math.round(i)},${Math.round(a)},${Math.round(c)},${p})`}toArray(){const{r:i,g:a,b:c,a:p}=this;return 0===p?[0,0,0,0]:[255*i/p,255*a/p,255*c/p,p]}}Ii.black=new Ii(0,0,0,1),Ii.white=new Ii(1,1,1,1),Ii.transparent=new Ii(0,0,0,0),Ii.red=new Ii(1,0,0,1),Ii.blue=new Ii(0,0,1,1);class Sa{constructor(i,a,c){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ks{constructor(i,a,c,p,_){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=c,this.fontStack=p,this.textColor=_}}class cn{constructor(i){this.sections=i}static fromString(i){return new cn([new Ks(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof cn?i:cn.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){i.push(["image",a.image.name]);continue}i.push(a.text);const c={};a.fontStack&&(c["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(c["font-scale"]=a.scale),a.textColor&&(c["text-color"]=["rgba"].concat(a.textColor.toArray())),i.push(c)}return i}}class Ar{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Ar({name:i,available:!1}):null}serialize(){return["image",this.name]}}function $r(o,i,a,c){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[o,i,a,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[o,i,a,c]:[o,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qs(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof Ii||o instanceof Sa||o instanceof cn||o instanceof Ar)return!0;if(Array.isArray(o)){for(const i of o)if(!Qs(i))return!1;return!0}if("object"==typeof o){for(const i in o)if(!Qs(o[i]))return!1;return!0}return!1}function In(o){if(null===o)return mo;if("string"==typeof o)return fi;if("boolean"==typeof o)return pi;if("number"==typeof o)return yt;if(o instanceof Ii)return Is;if(o instanceof Sa)return Ls;if(o instanceof cn)return us;if(o instanceof Ar)return Un;if(Array.isArray(o)){const i=o.length;let a;for(const c of o){const p=In(c);if(a){if(a===p)continue;a=gi;break}a=p}return lr(a||gi,i)}return Ds}function Rs(o){const i=typeof o;return null===o?"":"string"===i||"number"===i||"boolean"===i?String(o):o instanceof Ii||o instanceof cn||o instanceof Ar?o.toString():JSON.stringify(o)}class eo{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(2!==i.length)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Qs(i[1]))return a.error("invalid value");const c=i[1];let p=In(c);const _=a.expectedType;return"array"!==p.kind||0!==p.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(p=_),new eo(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ii?["rgba"].concat(this.value.toArray()):this.value instanceof cn?this.value.serialize():this.value}}class Dn{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ii={string:fi,number:yt,boolean:pi,object:Ds};class _r{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let c,p=1;const _=i[0];if("array"===_){let w,E;if(i.length>2){const P=i[1];if("string"!=typeof P||!(P in ii)||"object"===P)return a.error('The item type argument of "array" must be one of string, number, boolean',1);w=ii[P],p++}else w=gi;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=i[2],p++}c=lr(w,E)}else c=ii[_];const x=[];for(;p<i.length;p++){const w=a.parse(i[p],p,gi);if(!w)return null;x.push(w)}return new _r(c,x)}evaluate(i){for(let a=0;a<this.args.length;a++){const c=this.args[a].evaluate(i);if(!wa(this.type,In(c)))return c;if(a===this.args.length-1)throw new Dn(`Expected value to be of type ${on(this.type)}, but found ${on(In(c))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if("array"===i.kind){const c=i.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){a.push(c.kind);const p=i.N;("number"==typeof p||this.args.length>1)&&a.push(p)}}return a.concat(this.args.map(c=>c.serialize()))}}class yr{constructor(i){this.type=us,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const c=i[1];if(!Array.isArray(c)&&"object"==typeof c)return a.error("First argument must be an image or text section.");const p=[];let _=!1;for(let x=1;x<=i.length-1;++x){const w=i[x];if(_&&"object"==typeof w&&!Array.isArray(w)){_=!1;let E=null;if(w["font-scale"]&&(E=a.parse(w["font-scale"],1,yt),!E))return null;let P=null;if(w["text-font"]&&(P=a.parse(w["text-font"],1,lr(fi)),!P))return null;let R=null;if(w["text-color"]&&(R=a.parse(w["text-color"],1,Is),!R))return null;const z=p[p.length-1];z.scale=E,z.font=P,z.textColor=R}else{const E=a.parse(i[x],1,gi);if(!E)return null;const P=E.type.kind;if("string"!==P&&"value"!==P&&"null"!==P&&"resolvedImage"!==P)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new yr(p)}evaluate(i){return new cn(this.sections.map(a=>{const c=a.content.evaluate(i);return In(c)===Un?new Ks("",c,null,null,null):new Ks(Rs(c),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const c={};a.scale&&(c["font-scale"]=a.scale.serialize()),a.font&&(c["text-font"]=a.font.serialize()),a.textColor&&(c["text-color"]=a.textColor.serialize()),i.push(c)}return i}}class Nl{constructor(i){this.type=Un,this.input=i}static parse(i,a){if(2!==i.length)return a.error("Expected two arguments.");const c=a.parse(i[1],1,fi);return c?new Nl(c):a.error("No image name provided.")}evaluate(i){const a=this.input.evaluate(i),c=Ar.fromString(a);return c&&i.availableImages&&(c.available=i.availableImages.indexOf(a)>-1),c}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Nm={"to-boolean":pi,"to-color":Is,"to-number":yt,"to-string":fi};class cr{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const c=i[0];if(("to-boolean"===c||"to-string"===c)&&2!==i.length)return a.error("Expected one argument.");const p=Nm[c],_=[];for(let x=1;x<i.length;x++){const w=a.parse(i[x],x,gi);if(!w)return null;_.push(w)}return new cr(p,_)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let a,c;for(const p of this.args){if(a=p.evaluate(i),c=null,a instanceof Ii)return a;if("string"==typeof a){const _=i.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(c=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:$r(a[0],a[1],a[2],a[3]),!c))return new Ii(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Dn(c||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const c of this.args){if(a=c.evaluate(i),null===a)return 0;const p=Number(a);if(!isNaN(p))return p}throw new Dn(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?cn.fromString(Rs(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Ar.fromString(Rs(this.args[0].evaluate(i))):Rs(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new yr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Nl(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}const zh=["Unknown","Point","LineString","Polygon"];class Xr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?zh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:c,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*a-i[0])+this.featureDistanceData.bearing[1]*(p*a-i[1])}return 0}parseColor(i){let a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=Ii.parse(i)),a}}class Yr{constructor(i,a,c,p){this.name=i,this.type=a,this._evaluate=c,this.args=p}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const c=i[0],p=Yr.definitions[c];if(!p)return a.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,x=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=x.filter(([P])=>!Array.isArray(P)||P.length===i.length-1);let E=null;for(const[P,R]of w){E=new ps(a.registry,a.path,null,a.scope);const z=[];let B=!1;for(let H=1;H<i.length;H++){const $=i[H],K=Array.isArray(P)?P[H-1]:P.type,ne=E.parse($,1+z.length,K);if(!ne){B=!0;break}z.push(ne)}if(!B)if(Array.isArray(P)&&P.length!==z.length)E.error(`Expected ${P.length} arguments, but found ${z.length} instead.`);else{for(let H=0;H<z.length;H++){const $=Array.isArray(P)?P[H]:P.type,K=z[H];E.concat(H+1).checkSubtype($,K.type)}if(0===E.errors.length)return new Yr(c,_,R,z)}}if(1===w.length)a.errors.push(...E.errors);else{const P=(w.length?w:x).map(([z])=>{return B=z,Array.isArray(B)?`(${B.map(on).join(", ")})`:`(${on(B.type)}...)`;var B}).join(" | "),R=[];for(let z=1;z<i.length;z++){const B=a.parse(i[z],1+R.length);if(!B)return null;R.push(on(B.type))}a.error(`Expected arguments of type ${P}, but found (${R.join(", ")}) instead.`)}return null}static register(i,a){Yr.definitions=a;for(const c in a)i[c]=Yr}}class Dc{constructor(i,a,c){this.type=Ls,this.locale=c,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(2!==i.length)return a.error("Expected one argument.");const c=i[1];if("object"!=typeof c||Array.isArray(c))return a.error("Collator options argument must be an object.");const p=a.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,pi);if(!p)return null;const _=a.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,pi);if(!_)return null;let x=null;return c.locale&&(x=a.parse(c.locale,1,fi),!x)?null:new Dc(p,_,x)}evaluate(i){return new Sa(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const vr=8192;function Lc(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function Oh(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function Gu(o,i){const a=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(a*p*vr),Math.round(c*p*vr)]}function Ho(o,i,a){const c=o[0]-i[0],p=o[1]-i[1],_=o[0]-a[0],x=o[1]-a[1];return c*x-_*p==0&&c*_<=0&&p*x<=0}function to(o,i){let a=!1;for(let x=0,w=i.length;x<w;x++){const E=i[x];for(let P=0,R=E.length;P<R-1;P++){if(Ho(o,E[P],E[P+1]))return!1;(p=E[P])[1]>(c=o)[1]!=(_=E[P+1])[1]>c[1]&&c[0]<(_[0]-p[0])*(c[1]-p[1])/(_[1]-p[1])+p[0]&&(a=!a)}}var c,p,_;return a}function Bh(o,i){for(let a=0;a<i.length;a++)if(to(o,i[a]))return!0;return!1}function Vl(o,i,a,c){const p=c[0]-a[0],_=c[1]-a[1],x=(o[0]-a[0])*_-p*(o[1]-a[1]),w=(i[0]-a[0])*_-p*(i[1]-a[1]);return x>0&&w<0||x<0&&w>0}function Vm(o,i,a){for(const P of a)for(let R=0;R<P.length-1;++R)if((w=[(x=P[R+1])[0]-(_=P[R])[0],x[1]-_[1]])[0]*(E=[(p=i)[0]-(c=o)[0],p[1]-c[1]])[1]-w[1]*E[0]!=0&&Vl(c,p,_,x)&&Vl(_,x,c,p))return!0;var c,p,_,x,w,E;return!1}function gp(o,i){for(let a=0;a<o.length;++a)if(!to(o[a],i))return!1;for(let a=0;a<o.length-1;++a)if(Vm(o[a],o[a+1],i))return!1;return!0}function _p(o,i){for(let a=0;a<i.length;a++)if(gp(o,i[a]))return!0;return!1}function Rc(o,i,a){const c=[];for(let p=0;p<o.length;p++){const _=[];for(let x=0;x<o[p].length;x++){const w=Gu(o[p][x],a);Lc(i,w),_.push(w)}c.push(_)}return c}function Gl(o,i,a){const c=[];for(let p=0;p<o.length;p++){const _=Rc(o[p],i,a);c.push(_)}return c}function yp(o,i,a,c){if(o[0]<a[0]||o[0]>a[2]){const p=.5*c;let _=o[0]-a[0]>p?-c:a[0]-o[0]>p?c:0;0===_&&(_=o[0]-a[2]>p?-c:a[2]-o[0]>p?c:0),o[0]+=_}Lc(i,o)}function Hu(o,i,a,c){const p=Math.pow(2,c.z)*vr,_=[c.x*vr,c.y*vr],x=[];if(!o)return x;for(const w of o)for(const E of w){const P=[E.x+_[0],E.y+_[1]];yp(P,i,a,p),x.push(P)}return x}function Ni(o,i,a,c){const p=Math.pow(2,c.z)*vr,_=[c.x*vr,c.y*vr],x=[];if(!o)return x;for(const E of o){const P=[];for(const R of E){const z=[R.x+_[0],R.y+_[1]];Lc(i,z),P.push(z)}x.push(P)}if(i[2]-i[0]<=p/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of x)for(const P of E)yp(P,i,a,p)}var w;return x}class dr{constructor(i,a){this.type=pi,this.geojson=i,this.geometries=a}static parse(i,a){if(2!==i.length)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Qs(i[1])){const c=i[1];if("FeatureCollection"===c.type)for(let p=0;p<c.features.length;++p){const _=c.features[p].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new dr(c,c.features[p].geometry)}else if("Feature"===c.type){const p=c.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new dr(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new dr(c,c)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(a,c){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(!x)return!1;if("Polygon"===c.type){const w=Rc(c.coordinates,_,x),E=Hu(a.geometry(),p,_,x);if(!Oh(p,_))return!1;for(const P of E)if(!to(P,w))return!1}if("MultiPolygon"===c.type){const w=Gl(c.coordinates,_,x),E=Hu(a.geometry(),p,_,x);if(!Oh(p,_))return!1;for(const P of E)if(!Bh(P,w))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(a,c){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(!x)return!1;if("Polygon"===c.type){const w=Rc(c.coordinates,_,x),E=Ni(a.geometry(),p,_,x);if(!Oh(p,_))return!1;for(const P of E)if(!gp(P,w))return!1}if("MultiPolygon"===c.type){const w=Gl(c.coordinates,_,x),E=Ni(a.geometry(),p,_,x);if(!Oh(p,_))return!1;for(const P of E)if(!_p(P,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Nn(o){if(o instanceof Yr&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof dr)return!1;let i=!0;return o.eachChild(a=>{i&&!Nn(a)&&(i=!1)}),i}function il(o){if(o instanceof Yr&&"feature-state"===o.name)return!1;let i=!0;return o.eachChild(a=>{i&&!il(a)&&(i=!1)}),i}function ds(o,i){if(o instanceof Yr&&i.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild(c=>{a&&!ds(c,i)&&(a=!1)}),a}class ks{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(2!==i.length||"string"!=typeof i[1])return a.error("'var' expression requires exactly one string literal argument.");const c=i[1];return a.scope.has(c)?new ks(c,a.scope.get(c)):a.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ps{constructor(i,a=[],c,p=new Go,_=[]){this.registry=i,this.path=a,this.key=a.map(x=>`[${x}]`).join(""),this.scope=p,this.errors=_,this.expectedType=c}parse(i,a,c,p,_={}){return a?this.concat(a,c,p)._parse(i,_):this._parse(i,_)}_parse(i,a){function c(p,_,x){return"assert"===x?new _r(_,[p]):"coerce"===x?new cr(_,[p]):p}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=i[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[p];if(_){let x=_.parse(i,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,E=x.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==E.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(w,E))return null}else x=c(x,w,a.typeAnnotation||"coerce");else x=c(x,w,a.typeAnnotation||"assert")}if(!(x instanceof eo)&&"resolvedImage"!==x.type.kind&&kc(x)){const w=new Xr;try{x=new eo(x.type,x.evaluate(w))}catch(E){return this.error(E.message),null}}return x}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,c){const p="number"==typeof i?this.path.concat(i):this.path,_=c?this.scope.concat(c):this.scope;return new ps(this.registry,p,a||null,_,this.errors)}error(i,...a){const c=`${this.key}${a.map(p=>`[${p}]`).join("")}`;this.errors.push(new me(c,i))}checkSubtype(i,a){const c=wa(i,a);return c&&this.error(c),c}}function kc(o){if(o instanceof ks)return kc(o.boundExpression);if(o instanceof Yr&&"error"===o.name||o instanceof Dc||o instanceof dr)return!1;const i=o instanceof cr||o instanceof _r;let a=!0;return o.eachChild(c=>{a=i?a&&kc(c):a&&c instanceof eo}),!!a&&Nn(o)&&ds(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function nl(o,i){const a=o.length-1;let c,p,_=0,x=a,w=0;for(;_<=x;)if(w=Math.floor((_+x)/2),c=o[w],p=o[w+1],c<=i){if(w===a||i<p)return w;_=w+1}else{if(!(c>i))throw new Dn("Input is not a number.");x=w-1}return 0}class rl{constructor(i,a,c){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[p,_]of c)this.labels.push(p),this.outputs.push(_)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const c=a.parse(i[1],1,yt);if(!c)return null;const p=[];let _=null;a.expectedType&&"value"!==a.expectedType.kind&&(_=a.expectedType);for(let x=1;x<i.length;x+=2){const w=1===x?-1/0:i[x],E=i[x+1],P=x,R=x+1;if("number"!=typeof w)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(p.length&&p[p.length-1][0]>=w)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const z=a.parse(E,R,_);if(!z)return null;_=_||z.type,p.push([w,z])}return new rl(_,c,p)}evaluate(i){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(i);const p=this.input.evaluate(i);if(p<=a[0])return c[0].evaluate(i);const _=a.length;return p>=a[_-1]?c[_-1].evaluate(i):c[nl(a,p)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}function Yt(o,i,a){return o*(1-a)+i*a}var Ln=Object.freeze({__proto__:null,number:Yt,color:function(o,i,a){return new Ii(Yt(o.r,i.r,a),Yt(o.g,i.g,a),Yt(o.b,i.b,a),Yt(o.a,i.a,a))},array:function(o,i,a){return o.map((c,p)=>Yt(c,i[p],a))}});const Pr=4/29,hn=6/29,Hl=3*hn*hn,un=Math.PI/180,ju=180/Math.PI;function zc(o){return o>.008856451679035631?Math.pow(o,1/3):o/Hl+Pr}function vn(o){return o>hn?o*o*o:Hl*(o-Pr)}function jl(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Jr(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Wl(o){const i=Jr(o.r),a=Jr(o.g),c=Jr(o.b),p=zc((.4124564*i+.3575761*a+.1804375*c)/.95047),_=zc((.2126729*i+.7151522*a+.072175*c)/1);return{l:116*_-16,a:500*(p-_),b:200*(_-zc((.0193339*i+.119192*a+.9503041*c)/1.08883)),alpha:o.a}}function Ta(o){let i=(o.l+16)/116,a=isNaN(o.a)?i:i+o.a/500,c=isNaN(o.b)?i:i-o.b/200;return i=1*vn(i),a=.95047*vn(a),c=1.08883*vn(c),new Ii(jl(3.2404542*a-1.5371385*i-.4985314*c),jl(-.969266*a+1.8760108*i+.041556*c),jl(.0556434*a-.2040259*i+1.0572252*c),o.alpha)}function ms(o,i,a){const c=i-o;return o+a*(c>180||c<-180?c-360*Math.round(c/360):c)}const jo={forward:Wl,reverse:Ta,interpolate:function(o,i,a){return{l:Yt(o.l,i.l,a),a:Yt(o.a,i.a,a),b:Yt(o.b,i.b,a),alpha:Yt(o.alpha,i.alpha,a)}}},Vn={forward:function(o){const{l:i,a,b:c}=Wl(o),p=Math.atan2(c,a)*ju;return{h:p<0?p+360:p,c:Math.sqrt(a*a+c*c),l:i,alpha:o.a}},reverse:function(o){const i=o.h*un,a=o.c;return Ta({l:o.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:o.alpha})},interpolate:function(o,i,a){return{h:ms(o.h,i.h,a),c:Yt(o.c,i.c,a),l:Yt(o.l,i.l,a),alpha:Yt(o.alpha,i.alpha,a)}}};var an=Object.freeze({__proto__:null,lab:jo,hcl:Vn});class Kr{constructor(i,a,c,p,_){this.type=i,this.operator=a,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[x,w]of _)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(i,a,c,p){let _=0;if("exponential"===i.name)_=Wo(a,i.base,c,p);else if("linear"===i.name)_=Wo(a,1,c,p);else if("cubic-bezier"===i.name){const x=i.controlPoints;_=new as(x[0],x[1],x[2],x[3]).solve(Wo(a,1,c,p))}return _}static parse(i,a){let[c,p,_,...x]=i;if(!Array.isArray(p)||0===p.length)return a.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const P=p[1];if("number"!=typeof P)return a.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:P}}else{if("cubic-bezier"!==p[0])return a.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const P=p.slice(1);if(4!==P.length||P.some(R=>"number"!=typeof R||R<0||R>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:P}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,yt),!_)return null;const w=[];let E=null;"interpolate-hcl"===c||"interpolate-lab"===c?E=Is:a.expectedType&&"value"!==a.expectedType.kind&&(E=a.expectedType);for(let P=0;P<x.length;P+=2){const R=x[P],z=x[P+1],B=P+3,H=P+4;if("number"!=typeof R)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(w.length&&w[w.length-1][0]>=R)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const $=a.parse(z,H,E);if(!$)return null;E=E||$.type,w.push([R,$])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Kr(E,c,p,_,w):a.error(`Type ${on(E)} is not interpolatable.`)}evaluate(i){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(i);const p=this.input.evaluate(i);if(p<=a[0])return c[0].evaluate(i);const _=a.length;if(p>=a[_-1])return c[_-1].evaluate(i);const x=nl(a,p),w=Kr.interpolationFactor(this.interpolation,p,a[x],a[x+1]),E=c[x].evaluate(i),P=c[x+1].evaluate(i);return"interpolate"===this.operator?Ln[this.type.kind.toLowerCase()](E,P,w):"interpolate-hcl"===this.operator?Vn.reverse(Vn.interpolate(Vn.forward(E),Vn.forward(P),w)):jo.reverse(jo.interpolate(jo.forward(E),jo.forward(P),w))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,i,this.input.serialize()];for(let c=0;c<this.labels.length;c++)a.push(this.labels[c],this.outputs[c].serialize());return a}}function Wo(o,i,a,c){const p=c-a,_=o-a;return 0===p?0:1===i?_/p:(Math.pow(i,_)-1)/(Math.pow(i,p)-1)}class sl{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let c=null;const p=a.expectedType;p&&"value"!==p.kind&&(c=p);const _=[];for(const w of i.slice(1)){const E=a.parse(w,1+_.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,_.push(E)}const x=p&&_.some(w=>wa(p,w.type));return new sl(x?gi:c,_)}evaluate(i){let a,c=null,p=0;for(const _ of this.args){if(p++,c=_.evaluate(i),c&&c instanceof Ar&&!c.available&&(a||(a=c),c=null,p===this.args.length))return a;if(null!==c)break}return c}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class zs{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const c=[];for(let _=1;_<i.length-1;_+=2){const x=i[_];if("string"!=typeof x)return a.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=a.parse(i[_+1],_+1);if(!w)return null;c.push([x,w])}const p=a.parse(i[i.length-1],i.length-1,a.expectedType,c);return p?new zs(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,c]of this.bindings)i.push(a,c.serialize());return i.push(this.result.serialize()),i}}class go{constructor(i,a,c){this.type=i,this.index=a,this.input=c}static parse(i,a){if(3!==i.length)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=a.parse(i[1],1,yt),p=a.parse(i[2],2,lr(a.expectedType||gi));return c&&p?new go(p.type.itemType,c,p):null}evaluate(i){const a=this.index.evaluate(i),c=this.input.evaluate(i);if(a<0)throw new Dn(`Array index out of bounds: ${a} < 0.`);if(a>=c.length)throw new Dn(`Array index out of bounds: ${a} > ${c.length-1}.`);if(a!==Math.floor(a))throw new Dn(`Array index must be an integer, but found ${a} instead.`);return c[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class io{constructor(i,a){this.type=pi,this.needle=i,this.haystack=a}static parse(i,a){if(3!==i.length)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=a.parse(i[1],1,gi),p=a.parse(i[2],2,gi);return c&&p?fo(c.type,[pi,fi,yt,mo,gi])?new io(c,p):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(c.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(null==c)return!1;if(!Ma(a,["boolean","string","number","null"]))throw new Dn(`Expected first argument to be of type boolean, string, number or null, but found ${on(In(a))} instead.`);if(!Ma(c,["string","array"]))throw new Dn(`Expected second argument to be of type array or string, but found ${on(In(c))} instead.`);return c.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Zl{constructor(i,a,c){this.type=yt,this.needle=i,this.haystack=a,this.fromIndex=c}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=a.parse(i[1],1,gi),p=a.parse(i[2],2,gi);if(!c||!p)return null;if(!fo(c.type,[pi,fi,yt,mo,gi]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(c.type)} instead`);if(4===i.length){const _=a.parse(i[3],3,yt);return _?new Zl(c,p,_):null}return new Zl(c,p)}evaluate(i){const a=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!Ma(a,["boolean","string","number","null"]))throw new Dn(`Expected first argument to be of type boolean, string, number or null, but found ${on(In(a))} instead.`);if(!Ma(c,["string","array"]))throw new Dn(`Expected second argument to be of type array or string, but found ${on(In(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(i);return c.indexOf(a,p)}return c.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ql{constructor(i,a,c,p,_,x){this.inputType=i,this.type=a,this.input=c,this.cases=p,this.outputs=_,this.otherwise=x}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let c,p;a.expectedType&&"value"!==a.expectedType.kind&&(p=a.expectedType);const _={},x=[];for(let P=2;P<i.length-1;P+=2){let R=i[P];const z=i[P+1];Array.isArray(R)||(R=[R]);const B=a.concat(P);if(0===R.length)return B.error("Expected at least one branch label.");for(const $ of R){if("number"!=typeof $&&"string"!=typeof $)return B.error("Branch labels must be numbers or strings.");if("number"==typeof $&&Math.abs($)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof $&&Math.floor($)!==$)return B.error("Numeric branch labels must be integer values.");if(c){if(B.checkSubtype(c,In($)))return null}else c=In($);if(void 0!==_[String($)])return B.error("Branch labels must be unique.");_[String($)]=x.length}const H=a.parse(z,P,p);if(!H)return null;p=p||H.type,x.push(H)}const w=a.parse(i[1],1,gi);if(!w)return null;const E=a.parse(i[i.length-1],i.length-1,p);return E?"value"!==w.type.kind&&a.concat(1).checkSubtype(c,w.type)?null:new ql(c,p,w,_,x,E):null}evaluate(i){const a=this.input.evaluate(i);return(In(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),c=[],p={};for(const x of a){const w=p[this.cases[x]];void 0===w?(p[this.cases[x]]=c.length,c.push([this.cases[x],[x]])):c[w][1].push(x)}const _=x=>"number"===this.inputType.kind?Number(x):x;for(const[x,w]of c)i.push(1===w.length?_(w[0]):w.map(_)),i.push(this.outputs[x].serialize());return i.push(this.otherwise.serialize()),i}}class $l{constructor(i,a,c){this.type=i,this.branches=a,this.otherwise=c}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let c;a.expectedType&&"value"!==a.expectedType.kind&&(c=a.expectedType);const p=[];for(let x=1;x<i.length-1;x+=2){const w=a.parse(i[x],x,pi);if(!w)return null;const E=a.parse(i[x+1],x+1,c);if(!E)return null;p.push([w,E]),c=c||E.type}const _=a.parse(i[i.length-1],i.length-1,c);return _?new $l(c,p,_):null}evaluate(i){for(const[a,c]of this.branches)if(a.evaluate(i))return c.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,c]of this.branches)i(a),i(c);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class ol{constructor(i,a,c,p){this.type=i,this.input=a,this.beginIndex=c,this.endIndex=p}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=a.parse(i[1],1,gi),p=a.parse(i[2],2,yt);if(!c||!p)return null;if(!fo(c.type,[lr(gi),fi,gi]))return a.error(`Expected first argument to be of type array or string, but found ${on(c.type)} instead`);if(4===i.length){const _=a.parse(i[3],3,yt);return _?new ol(c.type,c,p,_):null}return new ol(c.type,c,p)}evaluate(i){const a=this.input.evaluate(i),c=this.beginIndex.evaluate(i);if(!Ma(a,["string","array"]))throw new Dn(`Expected first argument to be of type array or string, but found ${on(In(a))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(i);return a.slice(c,p)}return a.slice(c)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Oc(o,i){return"=="===o||"!="===o?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Bc(o,i,a,c){return 0===c.compare(i,a)}function Zo(o,i,a){const c="=="!==o&&"!="!==o;return class jx{constructor(_,x,w){this.type=pi,this.lhs=_,this.rhs=x,this.collator=w,this.hasUntypedArgument="value"===_.type.kind||"value"===x.type.kind}static parse(_,x){if(3!==_.length&&4!==_.length)return x.error("Expected two or three arguments.");const w=_[0];let E=x.parse(_[1],1,gi);if(!E)return null;if(!Oc(w,E.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${on(E.type)}'.`);let P=x.parse(_[2],2,gi);if(!P)return null;if(!Oc(w,P.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${on(P.type)}'.`);if(E.type.kind!==P.type.kind&&"value"!==E.type.kind&&"value"!==P.type.kind)return x.error(`Cannot compare types '${on(E.type)}' and '${on(P.type)}'.`);c&&("value"===E.type.kind&&"value"!==P.type.kind?E=new _r(P.type,[E]):"value"!==E.type.kind&&"value"===P.type.kind&&(P=new _r(E.type,[P])));let R=null;if(4===_.length){if("string"!==E.type.kind&&"string"!==P.type.kind&&"value"!==E.type.kind&&"value"!==P.type.kind)return x.error("Cannot use collator to compare non-string types.");if(R=x.parse(_[3],3,Ls),!R)return null}return new jx(E,P,R)}evaluate(_){const x=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(c&&this.hasUntypedArgument){const E=In(x),P=In(w);if(E.kind!==P.kind||"string"!==E.kind&&"number"!==E.kind)throw new Dn(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${P.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=In(x),P=In(w);if("string"!==E.kind||"string"!==P.kind)return i(_,x,w)}return this.collator?a(_,x,w,this.collator.evaluate(_)):i(_,x,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[o];return this.eachChild(x=>{_.push(x.serialize())}),_}}}const Fh=Zo("==",function(o,i,a){return i===a},Bc),Uh=Zo("!=",function(o,i,a){return i!==a},function(o,i,a,c){return!Bc(0,i,a,c)}),Nh=Zo("<",function(o,i,a){return i<a},function(o,i,a,c){return c.compare(i,a)<0}),Vh=Zo(">",function(o,i,a){return i>a},function(o,i,a,c){return c.compare(i,a)>0}),di=Zo("<=",function(o,i,a){return i<=a},function(o,i,a,c){return c.compare(i,a)<=0}),Gh=Zo(">=",function(o,i,a){return i>=a},function(o,i,a,c){return c.compare(i,a)>=0});class _o{constructor(i,a,c,p,_){this.type=fi,this.number=i,this.locale=a,this.currency=c,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(i,a){if(3!==i.length)return a.error("Expected two arguments.");const c=a.parse(i[1],1,yt);if(!c)return null;const p=i[2];if("object"!=typeof p||Array.isArray(p))return a.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=a.parse(p.locale,1,fi),!_))return null;let x=null;if(p.currency&&(x=a.parse(p.currency,1,fi),!x))return null;let w=null;if(p["min-fraction-digits"]&&(w=a.parse(p["min-fraction-digits"],1,yt),!w))return null;let E=null;return p["max-fraction-digits"]&&(E=a.parse(p["max-fraction-digits"],1,yt),!E)?null:new _o(c,_,x,w,E)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class qo{constructor(i){this.type=yt,this.input=i}static parse(i,a){if(2!==i.length)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const c=a.parse(i[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?a.error(`Expected argument of type string or array, but found ${on(c.type)} instead.`):new qo(c):null}evaluate(i){const a=this.input.evaluate(i);if("string"==typeof a||Array.isArray(a))return a.length;throw new Dn(`Expected value to be of type string or array, but found ${on(In(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}const Gn={"==":Fh,"!=":Uh,">":Vh,"<":Nh,">=":Gh,"<=":di,array:_r,at:go,boolean:_r,case:$l,coalesce:sl,collator:Dc,format:yr,image:Nl,in:io,"index-of":Zl,interpolate:Kr,"interpolate-hcl":Kr,"interpolate-lab":Kr,length:qo,let:zs,literal:eo,match:ql,number:_r,"number-format":_o,object:_r,slice:ol,step:rl,string:_r,"to-boolean":cr,"to-color":cr,"to-number":cr,"to-string":cr,var:ks,within:dr};function Wu(o,[i,a,c,p]){i=i.evaluate(o),a=a.evaluate(o),c=c.evaluate(o);const _=p?p.evaluate(o):1,x=$r(i,a,c,_);if(x)throw new Dn(x);return new Ii(i/255*_,a/255*_,c/255*_,_)}function xr(o,i){return o in i}function Fc(o,i){const a=i[o];return void 0===a?null:a}function bn(o){return{type:o}}function al(o){return{result:"success",value:o}}function yo(o){return{result:"error",value:o}}function $o(o){return"data-driven"===o["property-type"]||"cross-faded-data-driven"===o["property-type"]}function Hh(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Zu(o){return!!o.expression&&o.expression.interpolated}function Hi(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Ir(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function ll(o){return o}function Xl(o,i){const a="color"===i.type,c=o.stops&&"object"==typeof o.stops[0][0],p=c||!(c||void 0!==o.property),_=o.type||(Zu(i)?"exponential":"interval");if(a&&((o=Di({},o)).stops&&(o.stops=o.stops.map(P=>[P[0],Ii.parse(P[1])])),o.default=Ii.parse(o.default?o.default:i.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!an[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let x,w,E;if("exponential"===_)x=Xo;else if("interval"===_)x=Gm;else if("categorical"===_){x=xp,w=Object.create(null);for(const P of o.stops)w[P[0]]=P[1];E=typeof o.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);x=Li}if(c){const P={},R=[];for(let H=0;H<o.stops.length;H++){const $=o.stops[H],K=$[0].zoom;void 0===P[K]&&(P[K]={zoom:K,type:o.type,property:o.property,default:o.default,stops:[]},R.push(K)),P[K].stops.push([$[0].value,$[1]])}const z=[];for(const H of R)z.push([P[H].zoom,Xl(P[H],i)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Kr.interpolationFactor.bind(void 0,B),zoomStops:z.map(H=>H[0]),evaluate:({zoom:H},$)=>Xo({stops:z,base:o.base},i,H).evaluate(H,$)}}if(p){const P="exponential"===_?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Kr.interpolationFactor.bind(void 0,P),zoomStops:o.stops.map(R=>R[0]),evaluate:({zoom:R})=>x(o,i,R,w,E)}}return{kind:"source",evaluate(P,R){const z=R&&R.properties?R.properties[o.property]:void 0;return void 0===z?Ea(o.default,i.default):x(o,i,z,w,E)}}}function Ea(o,i,a){return void 0!==o?o:void 0!==i?i:void 0!==a?a:void 0}function xp(o,i,a,c,p){return Ea(typeof a===p?c[a]:void 0,o.default,i.default)}function Gm(o,i,a){if("number"!==Hi(a))return Ea(o.default,i.default);const c=o.stops.length;if(1===c||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[c-1][0])return o.stops[c-1][1];const p=nl(o.stops.map(_=>_[0]),a);return o.stops[p][1]}function Xo(o,i,a){const c=void 0!==o.base?o.base:1;if("number"!==Hi(a))return Ea(o.default,i.default);const p=o.stops.length;if(1===p||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[p-1][0])return o.stops[p-1][1];const _=nl(o.stops.map(R=>R[0]),a),x=function(R,z,B,H){const $=H-B,K=R-B;return 0===$?0:1===z?K/$:(Math.pow(z,K)-1)/(Math.pow(z,$)-1)}(a,c,o.stops[_][0],o.stops[_+1][0]),w=o.stops[_][1],E=o.stops[_+1][1];let P=Ln[i.type]||ll;if(o.colorSpace&&"rgb"!==o.colorSpace){const R=an[o.colorSpace];P=(z,B)=>R.reverse(R.interpolate(R.forward(z),R.forward(B),x))}return"function"==typeof w.evaluate?{evaluate(...R){const z=w.evaluate.apply(void 0,R),B=E.evaluate.apply(void 0,R);if(void 0!==z&&void 0!==B)return P(z,B,x)}}:P(w,E,x)}function Li(o,i,a){return"color"===i.type?a=Ii.parse(a):"formatted"===i.type?a=cn.fromString(a.toString()):"resolvedImage"===i.type?a=Ar.fromString(a.toString()):Hi(a)===i.type||"enum"===i.type&&i.values[a]||(a=void 0),Ea(a,o.default,i.default)}Yr.register(Gn,{error:[{kind:"error"},[fi],(o,[i])=>{throw new Dn(i.evaluate(o))}],typeof:[fi,[gi],(o,[i])=>on(In(i.evaluate(o)))],"to-rgba":[lr(yt,4),[Is],(o,[i])=>i.evaluate(o).toArray()],rgb:[Is,[yt,yt,yt],Wu],rgba:[Is,[yt,yt,yt,yt],Wu],has:{type:pi,overloads:[[[fi],(o,[i])=>xr(i.evaluate(o),o.properties())],[[fi,Ds],(o,[i,a])=>xr(i.evaluate(o),a.evaluate(o))]]},get:{type:gi,overloads:[[[fi],(o,[i])=>Fc(i.evaluate(o),o.properties())],[[fi,Ds],(o,[i,a])=>Fc(i.evaluate(o),a.evaluate(o))]]},"feature-state":[gi,[fi],(o,[i])=>Fc(i.evaluate(o),o.featureState||{})],properties:[Ds,[],o=>o.properties()],"geometry-type":[fi,[],o=>o.geometryType()],id:[gi,[],o=>o.id()],zoom:[yt,[],o=>o.globals.zoom],pitch:[yt,[],o=>o.globals.pitch||0],"distance-from-center":[yt,[],o=>o.distanceFromCenter()],"heatmap-density":[yt,[],o=>o.globals.heatmapDensity||0],"line-progress":[yt,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[yt,[],o=>o.globals.skyRadialProgress||0],accumulated:[gi,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[yt,bn(yt),(o,i)=>{let a=0;for(const c of i)a+=c.evaluate(o);return a}],"*":[yt,bn(yt),(o,i)=>{let a=1;for(const c of i)a*=c.evaluate(o);return a}],"-":{type:yt,overloads:[[[yt,yt],(o,[i,a])=>i.evaluate(o)-a.evaluate(o)],[[yt],(o,[i])=>-i.evaluate(o)]]},"/":[yt,[yt,yt],(o,[i,a])=>i.evaluate(o)/a.evaluate(o)],"%":[yt,[yt,yt],(o,[i,a])=>i.evaluate(o)%a.evaluate(o)],ln2:[yt,[],()=>Math.LN2],pi:[yt,[],()=>Math.PI],e:[yt,[],()=>Math.E],"^":[yt,[yt,yt],(o,[i,a])=>Math.pow(i.evaluate(o),a.evaluate(o))],sqrt:[yt,[yt],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[yt,[yt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[yt,[yt],(o,[i])=>Math.log(i.evaluate(o))],log2:[yt,[yt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[yt,[yt],(o,[i])=>Math.sin(i.evaluate(o))],cos:[yt,[yt],(o,[i])=>Math.cos(i.evaluate(o))],tan:[yt,[yt],(o,[i])=>Math.tan(i.evaluate(o))],asin:[yt,[yt],(o,[i])=>Math.asin(i.evaluate(o))],acos:[yt,[yt],(o,[i])=>Math.acos(i.evaluate(o))],atan:[yt,[yt],(o,[i])=>Math.atan(i.evaluate(o))],min:[yt,bn(yt),(o,i)=>Math.min(...i.map(a=>a.evaluate(o)))],max:[yt,bn(yt),(o,i)=>Math.max(...i.map(a=>a.evaluate(o)))],abs:[yt,[yt],(o,[i])=>Math.abs(i.evaluate(o))],round:[yt,[yt],(o,[i])=>{const a=i.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[yt,[yt],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[yt,[yt],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[pi,[fi,gi],(o,[i,a])=>o.properties()[i.value]===a.value],"filter-id-==":[pi,[gi],(o,[i])=>o.id()===i.value],"filter-type-==":[pi,[fi],(o,[i])=>o.geometryType()===i.value],"filter-<":[pi,[fi,gi],(o,[i,a])=>{const c=o.properties()[i.value],p=a.value;return typeof c==typeof p&&c<p}],"filter-id-<":[pi,[gi],(o,[i])=>{const a=o.id(),c=i.value;return typeof a==typeof c&&a<c}],"filter->":[pi,[fi,gi],(o,[i,a])=>{const c=o.properties()[i.value],p=a.value;return typeof c==typeof p&&c>p}],"filter-id->":[pi,[gi],(o,[i])=>{const a=o.id(),c=i.value;return typeof a==typeof c&&a>c}],"filter-<=":[pi,[fi,gi],(o,[i,a])=>{const c=o.properties()[i.value],p=a.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[pi,[gi],(o,[i])=>{const a=o.id(),c=i.value;return typeof a==typeof c&&a<=c}],"filter->=":[pi,[fi,gi],(o,[i,a])=>{const c=o.properties()[i.value],p=a.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[pi,[gi],(o,[i])=>{const a=o.id(),c=i.value;return typeof a==typeof c&&a>=c}],"filter-has":[pi,[gi],(o,[i])=>i.value in o.properties()],"filter-has-id":[pi,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[pi,[lr(fi)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[pi,[lr(gi)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[pi,[fi,lr(gi)],(o,[i,a])=>a.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[pi,[fi,lr(gi)],(o,[i,a])=>function(c,p,_,x){for(;_<=x;){const w=_+x>>1;if(p[w]===c)return!0;p[w]>c?x=w-1:_=w+1}return!1}(o.properties()[i.value],a.value,0,a.value.length-1)],all:{type:pi,overloads:[[[pi,pi],(o,[i,a])=>i.evaluate(o)&&a.evaluate(o)],[bn(pi),(o,i)=>{for(const a of i)if(!a.evaluate(o))return!1;return!0}]]},any:{type:pi,overloads:[[[pi,pi],(o,[i,a])=>i.evaluate(o)||a.evaluate(o)],[bn(pi),(o,i)=>{for(const a of i)if(a.evaluate(o))return!0;return!1}]]},"!":[pi,[pi],(o,[i])=>!i.evaluate(o)],"is-supported-script":[pi,[fi],(o,[i])=>{const a=o.globals&&o.globals.isSupportedScript;return!a||a(i.evaluate(o))}],upcase:[fi,[fi],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[fi,[fi],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[fi,bn(gi),(o,i)=>i.map(a=>Rs(a.evaluate(o))).join("")],"resolved-locale":[fi,[Ls],(o,[i])=>i.evaluate(o).resolvedLocale()]});class Ht{constructor(i,a){var c;this.expression=i,this._warningHistory={},this._evaluator=new Xr,this._defaultValue=a?"color"===(c=a).type&&Ir(c.default)?new Ii(0,0,0,0):"color"===c.type?Ii.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(i,a,c,p,_,x,w,E){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,c,p,_,x,w,E){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null;try{const P=this.expression.evaluate(this._evaluator);if(null==P||"number"==typeof P&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new Dn(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,"undefined"!=typeof console&&console.warn(P.message)),this._defaultValue}}}function Dr(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in Gn}function Uc(o,i){const a=new ps(Gn,[],i?function(p){const _={color:Is,string:fi,number:yt,enum:fi,boolean:pi,formatted:us,resolvedImage:Un};return"array"===p.type?lr(_[p.value]||gi,p.length):_[p.type]}(i):void 0),c=a.parse(o,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return c?al(new Ht(c,i)):yo(a.errors)}class qu{constructor(i,a){this.kind=i,this._styleExpression=a,this.isStateDependent="constant"!==i&&!il(a.expression)}evaluateWithoutErrorHandling(i,a,c,p,_,x){return this._styleExpression.evaluateWithoutErrorHandling(i,a,c,p,_,x)}evaluate(i,a,c,p,_,x){return this._styleExpression.evaluate(i,a,c,p,_,x)}}class $u{constructor(i,a,c,p){this.kind=i,this.zoomStops=c,this._styleExpression=a,this.isStateDependent="camera"!==i&&!il(a.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,a,c,p,_,x){return this._styleExpression.evaluateWithoutErrorHandling(i,a,c,p,_,x)}evaluate(i,a,c,p,_,x){return this._styleExpression.evaluate(i,a,c,p,_,x)}interpolationFactor(i,a,c){return this.interpolationType?Kr.interpolationFactor(this.interpolationType,i,a,c):0}}function bp(o,i){if("error"===(o=Uc(o,i)).result)return o;const a=o.value.expression,c=Nn(a);if(!c&&!$o(i))return yo([new me("","data expressions not supported")]);const p=ds(a,["zoom","pitch","distance-from-center"]);if(!p&&!Hh(i))return yo([new me("","zoom expressions not supported")]);const _=Wh(a);return _||p?_ instanceof me?yo([_]):_ instanceof Kr&&!Zu(i)?yo([new me("",'"interpolate" expressions cannot be used with this property')]):al(_?new $u(c?"camera":"composite",o.value,_.labels,_ instanceof Kr?_.interpolation:void 0):new qu(c?"constant":"source",o.value)):yo([new me("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jh{constructor(i,a){this._parameters=i,this._specification=a,Di(this,Xl(this._parameters,this._specification))}static deserialize(i){return new jh(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Wh(o){let i=null;if(o instanceof zs)i=Wh(o.result);else if(o instanceof sl){for(const a of o.args)if(i=Wh(a),i)break}else(o instanceof rl||o instanceof Kr)&&o.input instanceof Yr&&"zoom"===o.input.name&&(i=o);return i instanceof me||o.eachChild(a=>{const c=Wh(a);c instanceof me?i=c:!i&&c?i=new me("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&c&&i!==c&&(i=new me("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class It{constructor(i,a,c,p){this.message=(i?`${i}: `:"")+c,p&&(this.identifier=p),null!=a&&a.__line__&&(this.line=a.__line__)}}function fs(o){const i=o.key,a=o.value,c=o.valueSpec||{},p=o.objectElementValidators||{},_=o.style,x=o.styleSpec;let w=[];const E=Hi(a);if("object"!==E)return[new It(i,a,`object expected, ${E} found`)];for(const P in a){const R=P.split(".")[0],z=c[R]||c["*"];let B;p[R]?B=p[R]:c[R]?B=ji:p["*"]?B=p["*"]:c["*"]&&(B=ji),B?w=w.concat(B({key:(i&&`${i}.`)+P,value:a[P],valueSpec:z,style:_,styleSpec:x,object:a,objectKey:P},a)):w.push(new It(i,a[P],`unknown property "${P}"`))}for(const P in c)p[P]||c[P].required&&void 0===c[P].default&&void 0===a[P]&&w.push(new It(i,a,`missing required property "${P}"`));return w}function cl(o){const i=o.value,a=o.valueSpec,c=o.style,p=o.styleSpec,_=o.key,x=o.arrayElementValidator||ji;if("array"!==Hi(i))return[new It(_,i,`array expected, ${Hi(i)} found`)];if(a.length&&i.length!==a.length)return[new It(_,i,`array length ${a.length} expected, length ${i.length} found`)];if(a["min-length"]&&i.length<a["min-length"])return[new It(_,i,`array length at least ${a["min-length"]} expected, length ${i.length} found`)];let w={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};p.$version<7&&(w.function=a.function),"object"===Hi(a.value)&&(w=a.value);let E=[];for(let P=0;P<i.length;P++)E=E.concat(x({array:i,arrayIndex:P,value:i[P],valueSpec:w,style:c,styleSpec:p,key:`${_}[${P}]`}));return E}function Xu(o){const i=o.key,a=o.value,c=o.valueSpec;let p=Hi(a);if("number"===p&&a!=a&&(p="NaN"),"number"!==p)return[new It(i,a,`number expected, ${p} found`)];if("minimum"in c){let _=c.minimum;if("array"===Hi(c.minimum)&&(_=c.minimum[o.arrayIndex]),a<_)return[new It(i,a,`${a} is less than the minimum value ${_}`)]}if("maximum"in c){let _=c.maximum;if("array"===Hi(c.maximum)&&(_=c.maximum[o.arrayIndex]),a>_)return[new It(i,a,`${a} is greater than the maximum value ${_}`)]}return[]}function Zh(o){const i=o.valueSpec,a=Ut(o.value.type);let c,p,_,x={};const w="categorical"!==a&&void 0===o.value.property,E=!w,P="array"===Hi(o.value.stops)&&"array"===Hi(o.value.stops[0])&&"object"===Hi(o.value.stops[0][0]),R=fs({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(H){if("identity"===a)return[new It(H.key,H.value,'identity function may not have a "stops" property')];let $=[];const K=H.value;return $=$.concat(cl({key:H.key,value:K,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:z})),"array"===Hi(K)&&0===K.length&&$.push(new It(H.key,K,"array must have at least one stop")),$},default:function(H){return ji({key:H.key,value:H.value,valueSpec:i,style:H.style,styleSpec:H.styleSpec})}}});return"identity"===a&&w&&R.push(new It(o.key,o.value,'missing required property "property"')),"identity"===a||o.value.stops||R.push(new It(o.key,o.value,'missing required property "stops"')),"exponential"===a&&o.valueSpec.expression&&!Zu(o.valueSpec)&&R.push(new It(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(E&&!$o(o.valueSpec)?R.push(new It(o.key,o.value,"property functions not supported")):w&&!Hh(o.valueSpec)&&R.push(new It(o.key,o.value,"zoom functions not supported"))),"categorical"!==a&&!P||void 0!==o.value.property||R.push(new It(o.key,o.value,'"property" property is required')),R;function z(H){let $=[];const K=H.value,ne=H.key;if("array"!==Hi(K))return[new It(ne,K,`array expected, ${Hi(K)} found`)];if(2!==K.length)return[new It(ne,K,`array length 2 expected, length ${K.length} found`)];if(P){if("object"!==Hi(K[0]))return[new It(ne,K,`object expected, ${Hi(K[0])} found`)];if(void 0===K[0].zoom)return[new It(ne,K,"object stop key must have zoom")];if(void 0===K[0].value)return[new It(ne,K,"object stop key must have value")];const le=Ut(K[0].zoom);if("number"!=typeof le)return[new It(ne,K[0].zoom,"stop zoom values must be numbers")];if(_&&_>le)return[new It(ne,K[0].zoom,"stop zoom values must appear in ascending order")];le!==_&&(_=le,p=void 0,x={}),$=$.concat(fs({key:`${ne}[0]`,value:K[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Xu,value:B}}))}else $=$.concat(B({key:`${ne}[0]`,value:K[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},K));return Dr(ui(K[1]))?$.concat([new It(`${ne}[1]`,K[1],"expressions are not allowed in function stops.")]):$.concat(ji({key:`${ne}[1]`,value:K[1],valueSpec:i,style:H.style,styleSpec:H.styleSpec}))}function B(H,$){const K=Hi(H.value),ne=Ut(H.value),le=null!==H.value?H.value:$;if(c){if(K!==c)return[new It(H.key,le,`${K} stop domain type must match previous stop domain type ${c}`)]}else c=K;if("number"!==K&&"string"!==K&&"boolean"!==K&&"number"!=typeof ne&&"string"!=typeof ne&&"boolean"!=typeof ne)return[new It(H.key,le,"stop domain value must be a number, string, or boolean")];if("number"!==K&&"categorical"!==a){let be=`number expected, ${K} found`;return $o(i)&&void 0===a&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(H.key,le,be)]}return"categorical"!==a||"number"!==K||"number"==typeof ne&&isFinite(ne)&&Math.floor(ne)===ne?"categorical"!==a&&"number"===K&&"number"==typeof ne&&"number"==typeof p&&void 0!==p&&ne<p?[new It(H.key,le,"stop domain values must appear in ascending order")]:(p=ne,"categorical"===a&&ne in x?[new It(H.key,le,"stop domain values must be unique")]:(x[ne]=!0,[])):[new It(H.key,le,`integer expected, found ${String(ne)}`)]}}function Os(o){const i=("property"===o.expressionContext?bp:Uc)(ui(o.value),o.valueSpec);if("error"===i.result)return i.value.map(c=>new It(`${o.key}${c.key}`,o.value,c.message));const a=i.value.expression||i.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!a.outputDefined())return[new It(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!il(a))return[new It(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return Qr(a,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!ds(a,["zoom","feature-state"]))return[new It(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!Nn(a))return[new It(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qr(o,i){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const p of i.valueSpec.expression.parameters)a.delete(p);if(0===a.size)return[];const c=[];return o instanceof Yr&&a.has(o.name)?[new It(i.key,i.value,`["${o.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(o.eachChild(p=>{c.push(...Qr(p,i))}),c)}function Yl(o){const i=o.key,a=o.value,c=o.valueSpec,p=[];return Array.isArray(c.values)?-1===c.values.indexOf(Ut(a))&&p.push(new It(i,a,`expected one of [${c.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(c.values).indexOf(Ut(a))&&p.push(new It(i,a,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(a)} found`)),p}function Yo(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!Yo(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Jo(o,i="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Yo(o)||(o=Nc(o));const a=o;let c=!0;try{c=function(P){if(!Ko(P))return P;let R=ui(P);return Yu(R),R=Jl(R),R}(a)}catch(P){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const p=Fe[`filter_${i}`],_=Uc(c,p);let x=null;if("error"===_.result)throw new Error(_.value.map(P=>`${P.key}: ${P.message}`).join(", "));x=(P,R,z)=>_.value.evaluate(P,R,{},z);let w=null,E=null;if(c!==a){const P=Uc(a,p);if("error"===P.result)throw new Error(P.value.map(R=>`${R.key}: ${R.message}`).join(", "));w=(R,z,B,H,$)=>P.value.evaluate(R,z,{},B,void 0,void 0,H,$),E=!Nn(P.value.expression)}return x=x,{filter:x,dynamicFilter:w||void 0,needGeometry:$h(c),needFeature:!!E}}function Jl(o){if(!Array.isArray(o))return o;const i=function(a){if(qh.has(a[0]))for(let c=1;c<a.length;c++)if(Ko(a[c]))return!0;return a}(o);return!0===i?i:i.map(a=>Jl(a))}function Yu(o){let i=!1;const a=[];if("case"===o[0]){for(let c=1;c<o.length-1;c+=2)i=i||Ko(o[c]),a.push(o[c+1]);a.push(o[o.length-1])}else if("match"===o[0]){i=i||Ko(o[1]);for(let c=2;c<o.length-1;c+=2)a.push(o[c+1]);a.push(o[o.length-1])}else if("step"===o[0]){i=i||Ko(o[1]);for(let c=1;c<o.length-1;c+=2)a.push(o[c+1])}i&&(o.length=0,o.push("any",...a));for(let c=1;c<o.length;c++)Yu(o[c])}function Ko(o){if(!Array.isArray(o))return!1;if("pitch"===(i=o[0])||"distance-from-center"===i)return!0;var i;for(let a=1;a<o.length;a++)if(Ko(o[a]))return!0;return!1}const qh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ju(o,i){return o<i?-1:o>i?1:0}function $h(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let i=1;i<o.length;i++)if($h(o[i]))return!0;return!1}function Nc(o){if(!o)return!0;const i=o[0];return o.length<=1?"any"!==i:"=="===i?Vc(o[1],o[2],"=="):"!="===i?Gc(Vc(o[1],o[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Vc(o[1],o[2],i):"any"===i?(a=o.slice(1),["any"].concat(a.map(Nc))):"all"===i?["all"].concat(o.slice(1).map(Nc)):"none"===i?["all"].concat(o.slice(1).map(Nc).map(Gc)):"in"===i?Ku(o[1],o.slice(2)):"!in"===i?Gc(Ku(o[1],o.slice(2))):"has"===i?Qu(o[1]):"!has"===i?Gc(Qu(o[1])):"within"!==i||o;var a}function Vc(o,i,a){switch(o){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,o,i]}}function Ku(o,i){if(0===i.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Ju)]]:["filter-in-small",o,["literal",i]]}}function Qu(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Gc(o){return["!",o]}function vo(o){return Yo(ui(o.value))?Os(Di({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):ed(o)}function ed(o){const i=o.value,a=o.key;if("array"!==Hi(i))return[new It(a,i,`array expected, ${Hi(i)} found`)];const c=o.styleSpec;let p,_=[];if(i.length<1)return[new It(a,i,"filter array must have at least 1 element")];switch(_=_.concat(Yl({key:`${a}[0]`,value:i[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Ut(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Ut(i[1])&&_.push(new It(a,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&_.push(new It(a,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(p=Hi(i[1]),"string"!==p&&_.push(new It(`${a}[1]`,i[1],`string expected, ${p} found`)));for(let x=2;x<i.length;x++)p=Hi(i[x]),"$type"===Ut(i[1])?_=_.concat(Yl({key:`${a}[${x}]`,value:i[x],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&_.push(new It(`${a}[${x}]`,i[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)_=_.concat(ed({key:`${a}[${x}]`,value:i[x],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":p=Hi(i[1]),2!==i.length?_.push(new It(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==p&&_.push(new It(`${a}[1]`,i[1],`string expected, ${p} found`));break;case"within":p=Hi(i[1]),2!==i.length?_.push(new It(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==p&&_.push(new It(`${a}[1]`,i[1],`object expected, ${p} found`))}return _}function td(o,i){const a=o.key,c=o.style,p=o.styleSpec,_=o.value,x=o.objectKey,w=p[`${i}_${o.layerType}`];if(!w)return[];const E=x.match(/^(.*)-transition$/);if("paint"===i&&E&&w[E[1]]&&w[E[1]].transition)return ji({key:a,value:_,valueSpec:p.transition,style:c,styleSpec:p});const P=o.valueSpec||w[x];if(!P)return[new It(a,_,`unknown property "${x}"`)];let R;if("string"===Hi(_)&&$o(P)&&!P.tokens&&(R=/^{([^}]+)}$/.exec(_)))return[new It(a,_,`"${x}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const z=[];return"symbol"===o.layerType&&("text-field"===x&&c&&!c.glyphs&&z.push(new It(a,_,'use of "text-field" requires a style "glyphs" property')),"text-font"===x&&Ir(ui(_))&&"identity"===Ut(_.type)&&z.push(new It(a,_,'"text-font" does not support identity functions'))),z.concat(ji({key:o.key,value:_,valueSpec:P,style:c,styleSpec:p,expressionContext:"property",propertyType:i,propertyKey:x}))}function Hc(o){return td(o,"paint")}function Xh(o){return td(o,"layout")}function id(o){let i=[];const a=o.value,c=o.key,p=o.style,_=o.styleSpec;a.type||a.ref||i.push(new It(c,a,'either "type" or "ref" is required'));let x=Ut(a.type);const w=Ut(a.ref);if(a.id){const E=Ut(a.id);for(let P=0;P<o.arrayIndex;P++){const R=p.layers[P];Ut(R.id)===E&&i.push(new It(c,a.id,`duplicate layer id "${a.id}", previously used at line ${R.id.__line__}`))}}if("ref"in a){let E;["type","source","source-layer","filter","layout"].forEach(P=>{P in a&&i.push(new It(c,a[P],`"${P}" is prohibited for ref layers`))}),p.layers.forEach(P=>{Ut(P.id)===w&&(E=P)}),E?E.ref?i.push(new It(c,a.ref,"ref cannot reference another ref layer")):x=Ut(E.type):"string"==typeof w&&i.push(new It(c,a.ref,`ref layer "${w}" not found`))}else if("background"!==x&&"sky"!==x)if(a.source){const E=p.sources&&p.sources[a.source],P=E&&Ut(E.type);E?"vector"===P&&"raster"===x?i.push(new It(c,a.source,`layer "${a.id}" requires a raster source`)):"raster"===P&&"raster"!==x?i.push(new It(c,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==P||a["source-layer"]?"raster-dem"===P&&"hillshade"!==x?i.push(new It(c,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!a.paint||!a.paint["line-gradient"]||"geojson"===P&&E.lineMetrics||i.push(new It(c,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new It(c,a,`layer "${a.id}" must specify a "source-layer"`)):i.push(new It(c,a.source,`source "${a.source}" not found`))}else i.push(new It(c,a,'missing required property "source"'));return i=i.concat(fs({key:c,value:a,valueSpec:_.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ji({key:`${c}.type`,value:a.type,valueSpec:_.layer.type,style:o.style,styleSpec:o.styleSpec,object:a,objectKey:"type"}),filter:E=>vo(Di({layerType:x},E)),layout:E=>fs({layer:a,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":P=>Xh(Di({layerType:x},P))}}),paint:E=>fs({layer:a,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":P=>Hc(Di({layerType:x},P))}})}})),i}function xo(o){const i=o.value,a=o.key,c=Hi(i);return"string"!==c?[new It(a,i,`string expected, ${c} found`)]:[]}const nd={promoteId:function({key:o,value:i}){if("string"===Hi(i))return xo({key:o,value:i});{const a=[];for(const c in i)a.push(...xo({key:`${o}.${c}`,value:i[c]}));return a}}};function rd(o){const i=o.value,a=o.key,c=o.styleSpec,p=o.style;if(!i.type)return[new It(a,i,'"type" is required')];const _=Ut(i.type);let x;switch(_){case"vector":case"raster":case"raster-dem":return x=fs({key:a,value:i,valueSpec:c[`source_${_.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:nd}),x;case"geojson":if(x=fs({key:a,value:i,valueSpec:c.source_geojson,style:p,styleSpec:c,objectElementValidators:nd}),i.cluster)for(const w in i.clusterProperties){const[E,P]=i.clusterProperties[w],R="string"==typeof E?[E,["accumulated"],["get",w]]:E;x.push(...Os({key:`${a}.${w}.map`,value:P,expressionContext:"cluster-map"})),x.push(...Os({key:`${a}.${w}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return x;case"video":return fs({key:a,value:i,valueSpec:c.source_video,style:p,styleSpec:c});case"image":return fs({key:a,value:i,valueSpec:c.source_image,style:p,styleSpec:c});case"canvas":return[new It(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yl({key:`${a}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:c})}}function sd(o){const i=o.value,a=o.styleSpec,c=a.light,p=o.style;let _=[];const x=Hi(i);if(void 0===i)return _;if("object"!==x)return _=_.concat([new It("light",i,`object expected, ${x} found`)]),_;for(const w in i){const E=w.match(/^(.*)-transition$/);_=_.concat(E&&c[E[1]]&&c[E[1]].transition?ji({key:w,value:i[w],valueSpec:a.transition,style:p,styleSpec:a}):c[w]?ji({key:w,value:i[w],valueSpec:c[w],style:p,styleSpec:a}):[new It(w,i[w],`unknown property "${w}"`)])}return _}function od(o){const i=o.value,a=o.key,c=o.style,p=o.styleSpec,_=p.terrain;let x=[];const w=Hi(i);if(void 0===i)return x;if("object"!==w)return x=x.concat([new It("terrain",i,`object expected, ${w} found`)]),x;for(const E in i){const P=E.match(/^(.*)-transition$/);x=x.concat(P&&_[P[1]]&&_[P[1]].transition?ji({key:E,value:i[E],valueSpec:p.transition,style:c,styleSpec:p}):_[E]?ji({key:E,value:i[E],valueSpec:_[E],style:c,styleSpec:p}):[new It(E,i[E],`unknown property "${E}"`)])}if(i.source){const E=c.sources&&c.sources[i.source],P=E&&Ut(E.type);E?"raster-dem"!==P&&x.push(new It(a,i.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):x.push(new It(a,i.source,`source "${i.source}" not found`))}else x.push(new It(a,i,'terrain is missing required property "source"'));return x}function ad(o){const i=o.value,a=o.style,c=o.styleSpec,p=c.fog;let _=[];const x=Hi(i);if(void 0===i)return _;if("object"!==x)return _=_.concat([new It("fog",i,`object expected, ${x} found`)]),_;for(const w in i){const E=w.match(/^(.*)-transition$/);_=_.concat(E&&p[E[1]]&&p[E[1]].transition?ji({key:w,value:i[w],valueSpec:c.transition,style:a,styleSpec:c}):p[w]?ji({key:w,value:i[w],valueSpec:p[w],style:a,styleSpec:c}):[new It(w,i[w],`unknown property "${w}"`)])}return _}const bo={"*":()=>[],array:cl,boolean:function(o){const i=o.value,a=o.key,c=Hi(i);return"boolean"!==c?[new It(a,i,`boolean expected, ${c} found`)]:[]},number:Xu,color:function(o){const i=o.key,a=o.value,c=Hi(a);return"string"!==c?[new It(i,a,`color expected, ${c} found`)]:null===kh.parseCSSColor(a)?[new It(i,a,`color expected, "${a}" found`)]:[]},enum:Yl,filter:vo,function:Zh,layer:id,object:fs,source:rd,light:sd,terrain:od,fog:ad,string:xo,formatted:function(o){return 0===xo(o).length?[]:Os(o)},resolvedImage:function(o){return 0===xo(o).length?[]:Os(o)},projection:function(o){const i=o.value,a=o.styleSpec,c=a.projection,p=o.style;let _=[];const x=Hi(i);if("object"===x)for(const w in i)_=_.concat(ji({key:w,value:i[w],valueSpec:c[w],style:p,styleSpec:a}));else"string"!==x&&(_=_.concat([new It("projection",i,`object or string expected, ${x} found`)]));return _}};function ji(o){const i=o.value,a=o.valueSpec,c=o.styleSpec;return a.expression&&Ir(Ut(i))?Zh(o):a.expression&&Dr(ui(i))?Os(o):a.type&&bo[a.type]?bo[a.type](o):fs(Di({},o,{valueSpec:a.type?c[a.type]:a}))}function dn(o){const i=o.value,a=o.key,c=xo(o);return c.length||(-1===i.indexOf("{fontstack}")&&c.push(new It(a,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&c.push(new It(a,i,'"glyphs" url must include a "{range}" token'))),c}function Ca(o,i=Fe){return Qo(ji({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,objectElementValidators:{glyphs:dn,"*":()=>[]}}))}const Hm=o=>Qo(Hc(o)),jm=o=>Qo(Xh(o));function Qo(o){return o.slice().sort((i,a)=>i.line&&a.line?i.line-a.line:0)}function wp(o,i){let a=!1;if(i&&i.length)for(const c of i)o.fire(new Dt(new Error(c.message))),a=!0;return a}var hl=wo;function wo(o,i,a){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var p=new Int32Array(this.arrayBuffer);o=p[0],this.d=(i=p[1])+2*(a=p[2]);for(var _=0;_<this.d*this.d;_++){var x=p[3+_],w=p[3+_+1];c.push(x===w?null:p.subarray(x,w))}var E=p[3+c.length+1];this.keys=p.subarray(p[3+c.length],E),this.bboxes=p.subarray(E),this.insert=this._insertReadonly}else{this.d=i+2*a;for(var P=0;P<this.d*this.d;P++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=o,this.padding=a,this.scale=i/o,this.uid=0;var R=a/i*o;this.min=-R,this.max=o+R}wo.prototype.insert=function(o,i,a,c,p){this._forEachCell(i,a,c,p,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p)},wo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},wo.prototype._insertCell=function(o,i,a,c,p,_){this.cells[p].push(_)},wo.prototype.query=function(o,i,a,c,p){var _=this.min,x=this.max;if(o<=_&&i<=_&&x<=a&&x<=c&&!p)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(o,i,a,c,this._queryCell,w,{},p),w},wo.prototype._queryCell=function(o,i,a,c,p,_,x,w){var E=this.cells[p];if(null!==E)for(var P=this.keys,R=this.bboxes,z=0;z<E.length;z++){var B=E[z];if(void 0===x[B]){var H=4*B;(w?w(R[H+0],R[H+1],R[H+2],R[H+3]):o<=R[H+2]&&i<=R[H+3]&&a>=R[H+0]&&c>=R[H+1])?(x[B]=!0,_.push(P[B])):x[B]=!1}}},wo.prototype._forEachCell=function(o,i,a,c,p,_,x,w){for(var E=this._convertToCellCoord(o),P=this._convertToCellCoord(i),R=this._convertToCellCoord(a),z=this._convertToCellCoord(c),B=E;B<=R;B++)for(var H=P;H<=z;H++){var $=this.d*H+B;if((!w||w(this._convertFromCellCoord(B),this._convertFromCellCoord(H),this._convertFromCellCoord(B+1),this._convertFromCellCoord(H+1)))&&p.call(this,o,i,a,c,$,_,x,w))return}},wo.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},wo.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},wo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,i=3+this.cells.length+1+1,a=0,c=0;c<this.cells.length;c++)a+=this.cells[c].length;var p=new Int32Array(i+a+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var _=i,x=0;x<o.length;x++){var w=o[x];p[3+x]=_,p.set(w,_),_+=w.length}return p[3+o.length]=_,p.set(this.keys,_),p[3+o.length+1]=_+=this.keys.length,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer};const ul={};function Bt(o,i={}){ul[o.name]={klass:o,omit:i.omit||[]}}Bt(Object),hl.serialize=function(o,i){const a=o.toArrayBuffer();return i&&i.push(a),{buffer:a}},hl.deserialize=function(o){return new hl(o.buffer)},Bt(hl),Bt(Ii),Bt(Error),Bt(W),Bt(Ar),Bt(jh),Bt(Ht,{omit:["_evaluator"]}),Bt($u),Bt(qu),Bt(Yr,{omit:["_evaluate"]});for(const o in Gn)ul[Gn[o].name]||Bt(Gn[o]);function Mp(o){return o&&"undefined"!=typeof ArrayBuffer&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function Yh(o){return ti.ImageBitmap&&o instanceof ti.ImageBitmap}function jc(o,i){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Mp(o)||Yh(o))return i&&i.push(o),o;if(ArrayBuffer.isView(o)){const a=o;return i&&i.push(a.buffer),a}if(o instanceof ti.ImageData)return i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const a=[];for(const c of o)a.push(jc(c,i));return a}if("object"==typeof o){const a=o.constructor,c=a.name;if(!ul[c])throw new Error(`can't serialize object of unregistered class ${c}`);const p=a.serialize?a.serialize(o,i):{};if(!a.serialize){for(const _ in o)o.hasOwnProperty(_)&&(ul[c].omit.indexOf(_)>=0||(p[_]=jc(o[_],i)));o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof o)}function Kl(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Mp(o)||Yh(o)||ArrayBuffer.isView(o)||o instanceof ti.ImageData)return o;if(Array.isArray(o))return o.map(Kl);if("object"==typeof o){const i=o.$name||"Object",{klass:a}=ul[i];if(!a)throw new Error(`can't deserialize unregistered class ${i}`);if(a.deserialize)return a.deserialize(o);const c=Object.create(a.prototype);for(const p of Object.keys(o))"$name"!==p&&(c[p]=Kl(o[p]));return c}throw new Error("can't deserialize object of type "+typeof o)}class ld{constructor(){this.first=!0}update(i,a){const c=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=a),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=c,!0))}}const Sp=o=>o>=1536&&o<=1791,Jh=o=>o>=1872&&o<=1919,Wc=o=>o>=2208&&o<=2303,cd=o=>o>=11904&&o<=12031,Tp=o=>o>=12032&&o<=12255,hd=o=>o>=12272&&o<=12287,Kh=o=>o>=12288&&o<=12351,Zc=o=>o>=12352&&o<=12447,Qh=o=>o>=12448&&o<=12543,Ep=o=>o>=12544&&o<=12591,Cp=o=>o>=12704&&o<=12735,Ap=o=>o>=12736&&o<=12783,ud=o=>o>=12784&&o<=12799,Pp=o=>o>=12800&&o<=13055,Ip=o=>o>=13056&&o<=13311,Dp=o=>o>=13312&&o<=19903,dd=o=>o>=19968&&o<=40959,Lp=o=>o>=40960&&o<=42127,Rp=o=>o>=42128&&o<=42191,kp=o=>o>=44032&&o<=55215,qc=o=>o>=63744&&o<=64255,pd=o=>o>=64336&&o<=65023,zp=o=>o>=65040&&o<=65055,Ql=o=>o>=65072&&o<=65103,Op=o=>o>=65104&&o<=65135,eu=o=>o>=65136&&o<=65279,tu=o=>o>=65280&&o<=65519;function $c(o){for(const i of o)if(nu(i.charCodeAt(0)))return!0;return!1}function iu(o){for(const i of o)if(!md(i.charCodeAt(0)))return!1;return!0}function md(o){return!(Sp(o)||Jh(o)||Wc(o)||pd(o)||eu(o))}function nu(o){return!(746!==o&&747!==o&&(o<4352||!(Cp(o)||Ep(o)||Ql(o)&&!(o>=65097&&o<=65103)||qc(o)||Ip(o)||cd(o)||Ap(o)||!(!Kh(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||Dp(o)||dd(o)||Pp(o)||(i=o,i>=12592&&i<=12687)||(i=>i>=43360&&i<=43391)(o)||(i=>i>=55216&&i<=55295)(o)||(i=>i>=4352&&i<=4607)(o)||kp(o)||Zc(o)||hd(o)||(i=>i>=12688&&i<=12703)(o)||Tp(o)||ud(o)||Qh(o)&&12540!==o||!(!tu(o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Op(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(i=>i>=5120&&i<=5759)(o)||(i=>i>=6320&&i<=6399)(o)||zp(o)||(i=>i>=19904&&i<=19967)(o)||Lp(o)||Rp(o))));var i}function no(o){return!(nu(o)||(i=o,(a=i)>=128&&a<=255&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||(a=>a>=8192&&a<=8303)(i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||(a=>a>=8448&&a<=8527)(i)||(a=>a>=8528&&a<=8591)(i)||(a=>a>=8960&&a<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||(a=>a>=9216&&a<=9279)(i)&&9251!==i||(a=>a>=9280&&a<=9311)(i)||(a=>a>=9312&&a<=9471)(i)||(a=>a>=9632&&a<=9727)(i)||(a=>a>=9728&&a<=9983)(i)&&!(i>=9754&&i<=9759)||(a=>a>=11008&&a<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Kh(i)||Qh(i)||(a=>a>=57344&&a<=63743)(i)||Ql(i)||Op(i)||tu(i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i,a}function Xc(o){return o>=1424&&o<=2303||pd(o)||eu(o)}function Wm(o,i){return!(!i&&Xc(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(a=o,a>=6016&&a<=6143));var a}function Bp(o){for(const i of o)if(Xc(i.charCodeAt(0)))return!0;return!1}const fd="deferred",Yc="loading",dl="loaded";let ru=null,Lr="unavailable",gs=null;const pl=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(Lr="error"),ru&&ru(o)};function ml(){gd.fire(new Jt("pluginStateChange",{pluginStatus:Lr,pluginURL:gs}))}const gd=new Rt,su=function(){return Lr},fl=function(){if(Lr!==fd||!gs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Lr=Yc,ml(),gs&&fe({url:gs},o=>{o?pl(o):(Lr=dl,ml())})},Bs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Lr===dl||null!=Bs.applyArabicShaping,isLoading:()=>Lr===Yc,setState(o){Lr=o.pluginStatus,gs=o.pluginURL},isParsed:()=>null!=Bs.applyArabicShaping&&null!=Bs.processBidirectionalText&&null!=Bs.processStyledBidirectionalText,getPluginURL:()=>gs};class ln{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ld,this.transition={},this.pitch=0)}isSupportedScript(i){return function(a,c){for(const p of a)if(!Wm(p.charCodeAt(0),c))return!1;return!0}(i,Bs.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,a=i-Math.floor(i),c=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*a}}}class ec{constructor(i,a){this.property=i,this.value=a,this.expression=function(c,p){if(Ir(c))return new jh(c,p);if(Dr(c)){const _=bp(c,p);if("error"===_.result)throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=c;return"string"==typeof c&&"color"===p.type&&(_=Ii.parse(c)),{kind:"constant",evaluate:()=>_}}}(void 0===a?i.specification.default:a,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,a,c){return this.property.possiblyEvaluate(this,i,a,c)}}class tc{constructor(i){this.property=i,this.value=new ec(i,void 0)}transitioned(i,a){return new r(this.property,this.value,a,Pn({},i.transition,this.transition),i.now)}untransitioned(){return new r(this.property,this.value,null,{},0)}}class g{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Wr(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new tc(this._values[i].property)),this._values[i].value=new ec(this._values[i].property,null===a?void 0:Wr(a))}getTransition(i){return Wr(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new tc(this._values[i].property)),this._values[i].transition=Wr(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(i[a]=c);const p=this.getTransition(a);void 0!==p&&(i[`${a}-transition`]=p)}return i}transitioned(i,a){const c=new d(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(i,a._values[p]);return c}untransitioned(){const i=new d(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class r{constructor(i,a,c,p,_){const x=p.delay||0,w=p.duration||0;_=_||0,this.property=i,this.value=a,this.begin=_+x,this.end=this.begin+w,i.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(i,a,c){const p=i.now||0,_=this.value.possiblyEvaluate(i,a,c),x=this.prior;if(x){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return x.possiblyEvaluate(i,a,c);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,a,c),_,ma(w))}}return _}}class d{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,c){const p=new T(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(i,a,c);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class y{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Wr(this._values[i].value)}setValue(i,a){this._values[i]=new ec(this._values[i].property,null===a?void 0:Wr(a))}serialize(){const i={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(i[a]=c)}return i}possiblyEvaluate(i,a,c){const p=new T(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(i,a,c);return p}}class M{constructor(i,a,c){this.property=i,this.value=a,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,a,c,p){return this.property.evaluate(this.value,this.parameters,i,a,c,p)}}class T{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class A{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,c){const p=Ln[this.specification.type];return p?p(i,a,c):i}}class L{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,c,p){return new M(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(a,null,{},c,p)}:i.expression,a)}interpolate(i,a,c){if("constant"!==i.value.kind||"constant"!==a.value.kind)return i;if(void 0===i.value.value||void 0===a.value.value)return new M(this,{kind:"constant",value:void 0},i.parameters);const p=Ln[this.specification.type];return p?new M(this,{kind:"constant",value:p(i.value.value,a.value.value,c)},i.parameters):i}evaluate(i,a,c,p,_,x){return"constant"===i.kind?i.value:i.evaluate(a,c,p,_,x)}}class F extends L{possiblyEvaluate(i,a,c,p){if(void 0===i.value)return new M(this,{kind:"constant",value:void 0},a);if("constant"===i.expression.kind){const _=i.expression.evaluate(a,null,{},c,p),x="resolvedImage"===i.property.specification.type&&"string"!=typeof _?_.name:_,w=this._calculate(x,x,x,a);return new M(this,{kind:"constant",value:w},a)}if("camera"===i.expression.kind){const _=this._calculate(i.expression.evaluate({zoom:a.zoom-1}),i.expression.evaluate({zoom:a.zoom}),i.expression.evaluate({zoom:a.zoom+1}),a);return new M(this,{kind:"constant",value:_},a)}return new M(this,i.expression,a)}evaluate(i,a,c,p,_,x){if("source"===i.kind){const w=i.evaluate(a,c,p,_,x);return this._calculate(w,w,w,a)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(a.zoom)-1},c,p),i.evaluate({zoom:Math.floor(a.zoom)},c,p),i.evaluate({zoom:Math.floor(a.zoom)+1},c,p),a):i.value}_calculate(i,a,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:a,other:c}:{from:c,to:a,other:i}}interpolate(i){return i}}class V{constructor(i){this.specification=i}possiblyEvaluate(i,a,c,p){if(void 0!==i.value){if("constant"===i.expression.kind){const _=i.expression.evaluate(a,null,{},c,p);return this._calculate(_,_,_,a)}return this._calculate(i.expression.evaluate(new ln(Math.floor(a.zoom-1),a)),i.expression.evaluate(new ln(Math.floor(a.zoom),a)),i.expression.evaluate(new ln(Math.floor(a.zoom+1),a)),a)}}_calculate(i,a,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:a}:{from:c,to:a}}interpolate(i){return i}}class G{constructor(i){this.specification=i}possiblyEvaluate(i,a,c,p){return!!i.expression.evaluate(a,null,{},c,p)}interpolate(){return!1}}class q{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in i){const c=i[a];c.specification.overridable&&this.overridableProperties.push(a);const p=this.defaultPropertyValues[a]=new ec(c,void 0),_=this.defaultTransitionablePropertyValues[a]=new tc(c);this.defaultTransitioningPropertyValues[a]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate({})}}}function ee(o,i){return 256*(o=Pi(Math.floor(o),0,255))+Pi(Math.floor(i),0,255)}Bt(L),Bt(A),Bt(F),Bt(V),Bt(G);const re={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ie{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class J{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&(i.isTransferred=!0,a.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ge(o,i=1){let a=0,c=0;return{members:o.map(p=>{const _=re[p.type].BYTES_PER_ELEMENT,x=a=ce(a,Math.max(i,_)),w=p.components||1;return c=Math.max(c,_),a+=_*w,{name:p.name,type:p.type,components:w,offset:x}}),size:ce(a,Math.max(c,i)),alignment:i}}function ce(o,i){return Math.ceil(o/i)*i}class pe extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const c=this.length;return this.resize(c+1),this.emplace(c,i,a)}emplace(i,a,c){const p=2*i;return this.int16[p+0]=a,this.int16[p+1]=c,i}}pe.prototype.bytesPerElement=4,Bt(pe);class _e extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,c)}emplace(i,a,c,p){const _=3*i;return this.int16[_+0]=a,this.int16[_+1]=c,this.int16[_+2]=p,i}}_e.prototype.bytesPerElement=6,Bt(_e);class ye extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,c,p)}emplace(i,a,c,p,_){const x=4*i;return this.int16[x+0]=a,this.int16[x+1]=c,this.int16[x+2]=p,this.int16[x+3]=_,i}}ye.prototype.bytesPerElement=8,Bt(ye);class ue extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,c,p,_,x,w)}emplace(i,a,c,p,_,x,w,E){const P=6*i,R=12*i,z=3*i;return this.int16[P+0]=a,this.int16[P+1]=c,this.uint8[R+4]=p,this.uint8[R+5]=_,this.uint8[R+6]=x,this.uint8[R+7]=w,this.float32[z+2]=E,i}}ue.prototype.bytesPerElement=12,Bt(ue);class xe extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,c)}emplace(i,a,c,p){const _=3*i;return this.float32[_+0]=a,this.float32[_+1]=c,this.float32[_+2]=p,i}}xe.prototype.bytesPerElement=12,Bt(xe);class Ne extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w,E,P,R){const z=this.length;return this.resize(z+1),this.emplace(z,i,a,c,p,_,x,w,E,P,R)}emplace(i,a,c,p,_,x,w,E,P,R,z){const B=10*i;return this.uint16[B+0]=a,this.uint16[B+1]=c,this.uint16[B+2]=p,this.uint16[B+3]=_,this.uint16[B+4]=x,this.uint16[B+5]=w,this.uint16[B+6]=E,this.uint16[B+7]=P,this.uint16[B+8]=R,this.uint16[B+9]=z,i}}Ne.prototype.bytesPerElement=20,Bt(Ne);class He extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w,E){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,c,p,_,x,w,E)}emplace(i,a,c,p,_,x,w,E,P){const R=8*i;return this.uint16[R+0]=a,this.uint16[R+1]=c,this.uint16[R+2]=p,this.uint16[R+3]=_,this.uint16[R+4]=x,this.uint16[R+5]=w,this.uint16[R+6]=E,this.uint16[R+7]=P,i}}He.prototype.bytesPerElement=16,Bt(He);class Ye extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,a,c,p,_,x)}emplace(i,a,c,p,_,x,w){const E=6*i;return this.int16[E+0]=a,this.int16[E+1]=c,this.int16[E+2]=p,this.int16[E+3]=_,this.int16[E+4]=x,this.int16[E+5]=w,i}}Ye.prototype.bytesPerElement=12,Bt(Ye);class Xe extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne){const le=this.length;return this.resize(le+1),this.emplace(le,i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne)}emplace(i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne,le){const be=16*i;return this.int16[be+0]=a,this.int16[be+1]=c,this.int16[be+2]=p,this.int16[be+3]=_,this.uint16[be+4]=x,this.uint16[be+5]=w,this.uint16[be+6]=E,this.uint16[be+7]=P,this.int16[be+8]=R,this.int16[be+9]=z,this.int16[be+10]=B,this.int16[be+11]=H,this.int16[be+12]=$,this.int16[be+13]=K,this.int16[be+14]=ne,this.int16[be+15]=le,i}}Xe.prototype.bytesPerElement=32,Bt(Xe);class St extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}St.prototype.bytesPerElement=4,Bt(St);class Ie extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w,E,P,R,z,B,H){const $=this.length;return this.resize($+1),this.emplace($,i,a,c,p,_,x,w,E,P,R,z,B,H)}emplace(i,a,c,p,_,x,w,E,P,R,z,B,H,$){const K=20*i,ne=10*i;return this.int16[K+0]=a,this.int16[K+1]=c,this.int16[K+2]=p,this.int16[K+3]=_,this.int16[K+4]=x,this.float32[ne+3]=w,this.float32[ne+4]=E,this.float32[ne+5]=P,this.float32[ne+6]=R,this.int16[K+14]=z,this.uint32[ne+8]=B,this.uint16[K+18]=H,this.uint16[K+19]=$,i}}Ie.prototype.bytesPerElement=40,Bt(Ie);class mt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,c,p,_,x,w)}emplace(i,a,c,p,_,x,w,E){const P=8*i;return this.int16[P+0]=a,this.int16[P+1]=c,this.int16[P+2]=p,this.int16[P+4]=_,this.int16[P+5]=x,this.int16[P+6]=w,this.int16[P+7]=E,i}}mt.prototype.bytesPerElement=16,Bt(mt);class ft extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,i,a,c,p,_)}emplace(i,a,c,p,_,x){const w=4*i,E=8*i;return this.float32[w+0]=a,this.float32[w+1]=c,this.float32[w+2]=p,this.int16[E+6]=_,this.int16[E+7]=x,i}}ft.prototype.bytesPerElement=16,Bt(ft);class Tt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,c,p)}emplace(i,a,c,p,_){const x=12*i,w=3*i;return this.uint8[x+0]=a,this.uint8[x+1]=c,this.float32[w+1]=p,this.float32[w+2]=_,i}}Tt.prototype.bytesPerElement=12,Bt(Tt);class je extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,c)}emplace(i,a,c,p){const _=3*i;return this.uint16[_+0]=a,this.uint16[_+1]=c,this.uint16[_+2]=p,i}}je.prototype.bytesPerElement=6,Bt(je);class $t extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne,le,be,Se,De,Re){const ke=this.length;return this.resize(ke+1),this.emplace(ke,i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne,le,be,Se,De,Re)}emplace(i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne,le,be,Se,De,Re,ke){const qe=30*i,$e=15*i,Je=60*i;return this.int16[qe+0]=a,this.int16[qe+1]=c,this.int16[qe+2]=p,this.float32[$e+2]=_,this.float32[$e+3]=x,this.uint16[qe+8]=w,this.uint16[qe+9]=E,this.uint32[$e+5]=P,this.uint32[$e+6]=R,this.uint32[$e+7]=z,this.uint16[qe+16]=B,this.uint16[qe+17]=H,this.uint16[qe+18]=$,this.float32[$e+10]=K,this.float32[$e+11]=ne,this.uint8[Je+48]=le,this.uint8[Je+49]=be,this.uint8[Je+50]=Se,this.uint32[$e+13]=De,this.int16[qe+28]=Re,this.uint8[Je+58]=ke,i}}$t.prototype.bytesPerElement=60,Bt($t);class Wt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne,le,be,Se,De,Re,ke,qe,$e,Je,ht,We,Qe,gt,xt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne,le,be,Se,De,Re,ke,qe,$e,Je,ht,We,Qe,gt,xt)}emplace(i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne,le,be,Se,De,Re,ke,qe,$e,Je,ht,We,Qe,gt,xt,vt){const bt=38*i,ai=19*i;return this.int16[bt+0]=a,this.int16[bt+1]=c,this.int16[bt+2]=p,this.float32[ai+2]=_,this.float32[ai+3]=x,this.int16[bt+8]=w,this.int16[bt+9]=E,this.int16[bt+10]=P,this.int16[bt+11]=R,this.int16[bt+12]=z,this.int16[bt+13]=B,this.uint16[bt+14]=H,this.uint16[bt+15]=$,this.uint16[bt+16]=K,this.uint16[bt+17]=ne,this.uint16[bt+18]=le,this.uint16[bt+19]=be,this.uint16[bt+20]=Se,this.uint16[bt+21]=De,this.uint16[bt+22]=Re,this.uint16[bt+23]=ke,this.uint16[bt+24]=qe,this.uint16[bt+25]=$e,this.uint16[bt+26]=Je,this.uint16[bt+27]=ht,this.uint16[bt+28]=We,this.uint32[ai+15]=Qe,this.float32[ai+16]=gt,this.float32[ai+17]=xt,this.float32[ai+18]=vt,i}}Wt.prototype.bytesPerElement=76,Bt(Wt);class zt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}zt.prototype.bytesPerElement=4,Bt(zt);class Ot extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,c,p,_,x,w)}emplace(i,a,c,p,_,x,w,E){const P=7*i;return this.float32[P+0]=a,this.float32[P+1]=c,this.float32[P+2]=p,this.float32[P+3]=_,this.float32[P+4]=x,this.float32[P+5]=w,this.float32[P+6]=E,i}}Ot.prototype.bytesPerElement=28,Bt(Ot);class Kt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,i,a,c,p,_)}emplace(i,a,c,p,_,x){const w=5*i;return this.float32[w+0]=a,this.float32[w+1]=c,this.float32[w+2]=p,this.float32[w+3]=_,this.float32[w+4]=x,i}}Kt.prototype.bytesPerElement=20,Bt(Kt);class li extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,c,p)}emplace(i,a,c,p,_){const x=6*i;return this.uint32[3*i+0]=a,this.uint16[x+2]=c,this.uint16[x+3]=p,this.uint16[x+4]=_,i}}li.prototype.bytesPerElement=12,Bt(li);class Vt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const c=this.length;return this.resize(c+1),this.emplace(c,i,a)}emplace(i,a,c){const p=2*i;return this.uint16[p+0]=a,this.uint16[p+1]=c,i}}Vt.prototype.bytesPerElement=4,Bt(Vt);class oi extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}oi.prototype.bytesPerElement=2,Bt(oi);class Mi extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const c=this.length;return this.resize(c+1),this.emplace(c,i,a)}emplace(i,a,c){const p=2*i;return this.float32[p+0]=a,this.float32[p+1]=c,i}}Mi.prototype.bytesPerElement=8,Bt(Mi);class pn extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,c,p)}emplace(i,a,c,p,_){const x=4*i;return this.float32[x+0]=a,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=_,i}}pn.prototype.bytesPerElement=16,Bt(pn);class nr extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,c,p,_,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,c,p,_,x,w)}emplace(i,a,c,p,_,x,w,E){const P=8*i,R=4*i;return this.int16[P+0]=a,this.int16[P+1]=c,this.int16[P+2]=p,this.int16[P+3]=_,this.int16[P+4]=x,this.int16[P+5]=w,this.float32[R+3]=E,i}}nr.prototype.bytesPerElement=16,Bt(nr);class pr extends ie{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}pr.prototype.size=12;class Rr extends Ye{get(i){return new pr(this,i)}}Bt(Rr);class Fs extends ie{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fs.prototype.size=40;class Us extends Ie{get(i){return new Fs(this,i)}}Bt(Us);class ea extends ie{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}ea.prototype.size=60;class Mo extends $t{get(i){return new ea(this,i)}}Bt(Mo);class wn extends ie{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}wn.prototype.size=76;class Rn extends Wt{get(i){return new wn(this,i)}}Bt(Rn);class Oi extends zt{getoffsetX(i){return this.float32[1*i+0]}}Bt(Oi);class kn extends _e{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Bt(kn);class kr extends ie{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kr.prototype.size=12;class _n extends li{get(i){return new kr(this,i)}}Bt(_n);class _s extends ie{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}_s.prototype.size=4;class Jc extends Vt{get(i){return new _s(this,i)}}Bt(Jc);class zr extends ie{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}zr.prototype.size=16;class ta extends nr{get(i){return new zr(this,i)}}Bt(ta);const _d=ge([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ou=ge([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ia=Rh(function(o){o.exports=function(i,a){var c,p,_,x,w,E,P,R;for(p=i.length-(c=3&i.length),_=a,w=3432918353,E=461845907,R=0;R<p;)P=255&i.charCodeAt(R)|(255&i.charCodeAt(++R))<<8|(255&i.charCodeAt(++R))<<16|(255&i.charCodeAt(++R))<<24,++R,_=27492+(65535&(x=5*(65535&(_=(_^=P=(65535&(P=(P=(65535&P)*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*E+(((P>>>16)*E&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(P=0,c){case 3:P^=(255&i.charCodeAt(R+2))<<16;case 2:P^=(255&i.charCodeAt(R+1))<<8;case 1:_^=P=(65535&(P=(P=(65535&(P^=255&i.charCodeAt(R)))*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*E+(((P>>>16)*E&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}}),Kc=Rh(function(o){o.exports=function(i,a){for(var c,p=i.length,_=a^p,x=0;p>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(c>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:_^=(255&i.charCodeAt(x+2))<<16;case 2:_^=(255&i.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}}),es=ia,au=Kc;es.murmur3=ia,es.murmur2=au;class yd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,a,c,p){this.ids.push(Zm(i)),this.positions.push(a,c,p)}getPositions(i){const a=Zm(i);let c=0,p=this.ids.length-1;for(;c<p;){const x=c+p>>1;this.ids[x]>=a?p=x:c=x+1}const _=[];for(;this.ids[c]===a;)_.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return _}static serialize(i,a){const c=new Float64Array(i.ids),p=new Uint32Array(i.positions);return vd(c,p,0,c.length-1),a&&a.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(i){const a=new yd;return a.ids=i.ids,a.positions=i.positions,a.indexed=!0,a}}function Zm(o){const i=+o;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:es(String(o))}function vd(o,i,a,c){for(;a<c;){const p=o[a+c>>1];let _=a-1,x=c+1;for(;;){do{_++}while(o[_]<p);do{x--}while(o[x]>p);if(_>=x)break;Qc(o,_,x),Qc(i,3*_,3*x),Qc(i,3*_+1,3*x+1),Qc(i,3*_+2,3*x+2)}x-a<c-x?(vd(o,i,a,x),a=x+1):(vd(o,i,x+1,c),c=x)}}function Qc(o,i,a){const c=o[i];o[i]=o[a],o[a]=c}Bt(yd);class So{constructor(i,a){this.gl=i.gl,this.location=a}}class xd extends So{constructor(i,a){super(i,a),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class qm extends So{constructor(i,a){super(i,a),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class bd extends So{constructor(i,a){super(i,a),this.current=Ii.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Og=new Float32Array(16),Fp=new Float32Array(9),Bg=new Float32Array(4);function wd(o){return[ee(255*o.r,255*o.g),ee(255*o.b,255*o.a)]}class ic{constructor(i,a,c){this.value=i,this.uniformNames=a.map(p=>`u_${p}`),this.type=c}setUniform(i,a,c){i.set(c.constantOr(this.value))}getBinding(i,a,c){return"color"===this.type?new bd(i,a):new xd(i,a)}}class gl{constructor(i,a){this.uniformNames=a.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,a){this.pixelRatioFrom=a.pixelRatio||1,this.pixelRatioTo=i.pixelRatio||1,this.patternFrom=a.tl.concat(a.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,a,c,p){const _="u_pattern_to"===p||"u_dash_to"===p?this.patternTo:"u_pattern_from"===p||"u_dash_from"===p?this.patternFrom:"u_pixel_ratio_to"===p?this.pixelRatioTo:"u_pixel_ratio_from"===p?this.pixelRatioFrom:null;_&&i.set(_)}getBinding(i,a,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new qm(i,a):new xd(i,a)}}class Aa{constructor(i,a,c,p){this.expression=i,this.type=c,this.maxValue=0,this.paintVertexAttributes=a.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(i,a,c,p,_,x){const w=this.paintVertexArray.length,E=this.expression.evaluate(new ln(0),a,{},_,p,x);this.paintVertexArray.resize(i),this._setPaintValue(w,i,E)}updatePaintArray(i,a,c,p,_){const x=this.expression.evaluate({zoom:0},c,p,void 0,_);this._setPaintValue(i,a,x)}_setPaintValue(i,a,c){if("color"===this.type){const p=wd(c);for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=i;p<a;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class To{constructor(i,a,c,p,_,x){this.expression=i,this.uniformNames=a.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=a.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,a,c,p,_,x){const w=this.expression.evaluate(new ln(this.zoom),a,{},_,p,x),E=this.expression.evaluate(new ln(this.zoom+1),a,{},_,p,x),P=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(P,i,w,E)}updatePaintArray(i,a,c,p,_){const x=this.expression.evaluate({zoom:this.zoom},c,p,void 0,_),w=this.expression.evaluate({zoom:this.zoom+1},c,p,void 0,_);this._setPaintValue(i,a,x,w)}_setPaintValue(i,a,c,p){if("color"===this.type){const _=wd(c),x=wd(p);for(let w=i;w<a;w++)this.paintVertexArray.emplace(w,_[0],_[1],x[0],x[1])}else{for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a){const c=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,p=Pi(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);i.set(p)}getBinding(i,a,c){return new xd(i,a)}}class Pa{constructor(i,a,c,p,_,x,w){this.expression=i,this.type=c,this.useIntegerZoom=p,this.zoom=_,this.layerId=w,this.paintVertexAttributes=("array"===c?ou:_d).members;for(let E=0;E<a.length;++E);this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(i,a,c){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(p,i,a.patterns&&a.patterns[this.layerId],c)}updatePaintArray(i,a,c,p,_,x){this._setPaintValues(i,a,c.patterns&&c.patterns[this.layerId],x)}_setPaintValues(i,a,c,p){if(!p||!c)return;const{min:_,mid:x,max:w}=c,E=p[_],P=p[x],R=p[w];if(E&&P&&R)for(let z=i;z<a;z++)this._setPaintValue(this.zoomInPaintVertexArray,z,P,E),this._setPaintValue(this.zoomOutPaintVertexArray,z,P,R)}_setPaintValue(i,a,c,p){i.emplace(a,c.tl[0],c.tl[1],c.br[0],c.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1],c.pixelRatio,p.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class mr{constructor(i,a,c=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const _ in i.paint._values){if(!c(_))continue;const x=i.paint.get(_);if(!(x instanceof M&&$o(x.property.specification)))continue;const w=$m(_,i.type),E=x.value,P=x.property.specification.type,R=x.property.useIntegerZoom,z=x.property.specification["property-type"],B="cross-faded"===z||"cross-faded-data-driven"===z,H="line-dasharray"===String(_)&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==E.kind||H)if("source"===E.kind||H||B){const $=Np(_,P,"source");this.binders[_]=B?new Pa(E,w,P,R,a,$,i.id):new Aa(E,w,P,$),p.push(`/a_${_}`)}else{const $=Np(_,P,"composite");this.binders[_]=new To(E,w,P,R,a,$),p.push(`/z_${_}`)}else this.binders[_]=B?new gl(E.value,w):new ic(E.value,w,P),p.push(`/u_${_}`)}this.cacheKey=p.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof Aa||a instanceof To?a.maxValue:0}populatePaintArrays(i,a,c,p,_,x){for(const w in this.binders){const E=this.binders[w];(E instanceof Aa||E instanceof To||E instanceof Pa)&&E.populatePaintArray(i,a,c,p,_,x)}}setConstantPatternPositions(i,a){for(const c in this.binders){const p=this.binders[c];p instanceof gl&&p.setConstantPatternPositions(i,a)}}updatePaintArrays(i,a,c,p,_,x){let w=!1;for(const E in i){const P=a.getPositions(E);for(const R of P){const z=c.feature(R.index);for(const B in this.binders){const H=this.binders[B];if((H instanceof Aa||H instanceof To||H instanceof Pa)&&!0===H.expression.isStateDependent){const $=p.paint.get(B);H.expression=$.value,H.updatePaintArray(R.start,R.end,z,i[E],_,x),w=!0}}}}return w}defines(){const i=[];for(const a in this.binders){const c=this.binders[a];(c instanceof ic||c instanceof gl)&&i.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return i}getBinderAttributes(){const i=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof Aa||c instanceof To||c instanceof Pa)for(let p=0;p<c.paintVertexAttributes.length;p++)i.push(c.paintVertexAttributes[p].name)}return i}getBinderUniforms(){const i=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof ic||c instanceof gl||c instanceof To)for(const p of c.uniformNames)i.push(p)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,a){const c=[];for(const p in this.binders){const _=this.binders[p];if(_ instanceof ic||_ instanceof gl||_ instanceof To)for(const x of _.uniformNames)if(a[x]){const w=_.getBinding(i,a[x],x);c.push({name:x,property:p,binding:w})}}return c}setUniforms(i,a,c,p){for(const{name:_,property:x,binding:w}of a)this.binders[x].setUniform(w,p,c.get(x),_)}updatePaintBuffers(i){this._buffers=[];for(const a in this.binders){const c=this.binders[a];if(i&&c instanceof Pa){const p=2===i.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(c instanceof Aa||c instanceof To)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(i){for(const a in this.binders){const c=this.binders[a];(c instanceof Aa||c instanceof To||c instanceof Pa)&&c.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof Aa||a instanceof To||a instanceof Pa)&&a.destroy()}}}class Ia{constructor(i,a,c=(()=>!0)){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new mr(p,a,c);this.needsUpload=!1,this._featureMap=new yd,this._bufferOffset=0}populatePaintArrays(i,a,c,p,_,x,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(i,a,p,_,x,w);void 0!==a.id&&this._featureMap.add(a.id,c,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,c,p,_){for(const x of c)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(i,this._featureMap,a,x,p,_)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const Fg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function $m(o,i){return Fg[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}const Up={"line-pattern":{source:Ne,composite:Ne},"fill-pattern":{source:Ne,composite:Ne},"fill-extrusion-pattern":{source:Ne,composite:Ne},"line-dasharray":{source:He,composite:He}},Xm={color:{source:Mi,composite:pn},number:{source:zt,composite:Mi}};function Np(o,i,a){const c=Up[o];return c&&c[a]||Xm[i][a]}Bt(ic),Bt(gl),Bt(Aa),Bt(Pa),Bt(To),Bt(mr,{omit:["_buffers"]}),Bt(Ia);const lu="-transition";class Eo extends Rt{constructor(i,a){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=(i=i).metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),a.layout&&(this._unevaluatedLayout=new y(a.layout)),a.paint)){this._transitionablePaint=new g(a.paint);for(const c in i.paint)this.setPaintProperty(c,i.paint[c],{validate:!1});for(const c in i.layout)this.setLayoutProperty(c,i.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new T(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a,c={}){null!=a&&this._validate(jm,`layers.${this.id}.layout.${i}`,i,a,c)||("visibility"!==i?this._unevaluatedLayout.setValue(i,a):this.visibility=a)}getPaintProperty(i){return co(i,lu)?this._transitionablePaint.getTransition(i.slice(0,-lu.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a,c={}){if(null!=a&&this._validate(Hm,`layers.${this.id}.paint.${i}`,i,a,c))return!1;if(co(i,lu))return this._transitionablePaint.setTransition(i.slice(0,-lu.length),a||void 0),!1;{const p=this._transitionablePaint._values[i],_="cross-faded-data-driven"===p.property.specification["property-type"],x=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(i,a),this._handleSpecialPaintPropertyUpdate(i);const E=this._transitionablePaint._values[i].value;return E.isDataDriven()||x||_||this._handleOverridablePaintPropertyUpdate(i,w,E)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,a,c){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Xa(i,(a,c)=>!(void 0===a||"layout"===c&&!Object.keys(a).length||"paint"===c&&!Object.keys(a).length))}_validate(i,a,c,p,_={}){return(!_||!1!==_.validate)&&wp(this,i.call(Ca,{key:a,layerType:this.type,objectKey:c,value:p,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof M&&$o(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Jo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Ug=ge([{name:"a_pos",components:2,type:"Int16"}],4),Md=ge([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class yn{constructor(i=[]){this.segments=i}prepareSegment(i,a,c,p){let _=this.segments[this.segments.length-1];return i>yn.MAX_VERTEX_ARRAY_LENGTH&&nn(`Max vertices per segment is ${yn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!_||_.vertexLength+i>yn.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:a.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==p&&(_.sortKey=p),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,c,p){return new yn([{vertexOffset:i,primitiveOffset:a,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}yn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(yn);var hi=8192;class _l{constructor(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof Wi?new Wi(i.lng,i.lat):Wi.convert(i),this}setSouthWest(i){return this._sw=i instanceof Wi?new Wi(i.lng,i.lat):Wi.convert(i),this}extend(i){const a=this._sw,c=this._ne;let p,_;if(i instanceof Wi)p=i,_=i;else{if(!(i instanceof _l))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(_l.convert(i)):this.extend(Wi.convert(i)):this;if(p=i._sw,_=i._ne,!p||!_)return this}return a||c?(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),c.lng=Math.max(_.lng,c.lng),c.lat=Math.max(_.lat,c.lat)):(this._sw=new Wi(p.lng,p.lat),this._ne=new Wi(_.lng,_.lat)),this}getCenter(){return new Wi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Wi(this.getWest(),this.getNorth())}getSouthEast(){return new Wi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:c}=Wi.convert(i);let p=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(i){return!i||i instanceof _l?i:new _l(i)}}const cu=6371008.8;class Wi{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Wi(Es(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,c=this.lat*a,p=i.lat*a,_=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((i.lng-this.lng)*a);return cu*Math.acos(Math.min(_,1))}toBounds(i=0){const a=360*i/40075017,c=a/Math.cos(Math.PI/180*this.lat);return new _l(new Wi(this.lng-c,this.lat-a),new Wi(this.lng+c,this.lat+a))}static convert(i){if(i instanceof Wi)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new Wi(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new Wi(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ym=2*Math.PI*cu;function Sd(o){return Ym*Math.cos(o*Math.PI/180)}function hu(o){return(180+o)/360}function uu(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function nc(o,i){return o/Sd(i)}function ts(o){return 360*o-180}function br(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Jm(o,i){return o*Sd(br(i))}const Or=85.051129;class rc{constructor(i,a,c=0){this.x=+i,this.y=+a,this.z=+c}static fromLngLat(i,a=0){const c=Wi.convert(i);return new rc(hu(c.lng),uu(c.lat),nc(a,c.lat))}toLngLat(){return new Wi(ts(this.x),br(this.y))}toAltitude(){return Jm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ym*(i=br(this.y),1/Math.cos(i*Math.PI/180));var i}}function Km(o,i,a,c,p,_,x,w,E){const P=(i+c)/2,R=(a+p)/2,z=new ct(P,R);w(z),function(B,H,$,K,ne,le){const be=$-ne,Se=K-le;return Math.abs((K-H)*be-($-B)*Se)/Math.hypot(be,Se)}(z.x,z.y,_.x,_.y,x.x,x.y)>=E?(Km(o,i,a,P,R,_,z,w,E),Km(o,P,R,c,p,z,x,w,E)):o.push(x)}function sy(o,i,a){let c=o[0],p=c.x,_=c.y;i(c);const x=[c];for(let w=1;w<o.length;w++){const E=o[w],{x:P,y:R}=E;i(E),Km(x,p,_,P,R,c,E,i,a),p=P,_=R,c=E}return x}const Qm=Math.pow(2,14)-1,Ng=-Qm-1;function oy(o,i){const a=Math.round(o.x*i),c=Math.round(o.y*i);return o.x=Pi(a,Ng,Qm),o.y=Pi(c,Ng,Qm),(a<o.x||a>o.x+1||c<o.y||c>o.y+1)&&nn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function yl(o,i,a){const c=o.loadGeometry(),p=o.extent,_=hi/p;if(i&&a&&a.projection.isReprojectedInTileSpace){const x=1<<i.z,{scale:w,x:E,y:P,projection:R}=a,z=B=>{const H=ts((i.x+B.x/p)/x),$=br((i.y+B.y/p)/x),K=R.project(H,$);B.x=(K.x*w-E)*p,B.y=(K.y*w-P)*p};for(let B=0;B<c.length;B++)if(1!==o.type)c[B]=sy(c[B],z,1);else{const H=[];for(const $ of c[B])$.x<0||$.x>=p||$.y<0||$.y>=p||(z($),H.push($));c[B]=H}}for(const x of c)for(const w of x)oy(w,_);return c}function eh(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?yl(o):[]}}function du(o,i,a,c,p){o.emplaceBack(2*i+(c+1)/2,2*a+(p+1)/2)}function Vp(o,i,a,c){o.emplaceBack(i.x,i.y,i.z,16384*a[0],16384*a[1],16384*a[2],c)}class sc{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new pe,this.indexArray=new je,this.segments=new yn,this.programConfigurations=new Ia(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(i,a,c,p){const _=this.layers[0],x=[];let w=null;"circle"===_.type&&(w=_.layout.get("circle-sort-key"));for(const{feature:P,id:R,index:z,sourceLayerIndex:B}of i){const H=this.layers[0]._featureFilter.needGeometry,$=eh(P,H);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),$,c))continue;const K=w?w.evaluate($,{},c):void 0,ne={id:R,properties:P.properties,type:P.type,sourceLayerIndex:B,index:z,geometry:H?$.geometry:yl(P,c,p),patterns:{},sortKey:K};x.push(ne)}w&&x.sort((P,R)=>P.sortKey-R.sortKey);let E=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new ta,E=p.projection);for(const P of x){const{geometry:R,index:z,sourceLayerIndex:B}=P,H=i[z].feature;this.addFeature(P,R,z,a.availableImages,c,E),a.featureIndex.insert(H,R,z,B,this.index)}}update(i,a,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ug.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Md.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,a,c,p,_,x){for(const w of a)for(const E of w){const P=E.x,R=E.y;if(P<0||P>=hi||R<0||R>=hi)continue;if(x){const H=x.projectTilePoint(P,R,_),$=x.upVector(_,P,R),K=br((R/hi+_.y)/(1<<_.z)),ne=x.pixelsPerMeter(K,1)/nc(1,K),le=this.globeExtVertexArray;Vp(le,H,$,ne),Vp(le,H,$,ne),Vp(le,H,$,ne),Vp(le,H,$,ne)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),B=z.vertexLength;du(this.layoutVertexArray,P,R,-1,-1),du(this.layoutVertexArray,P,R,1,-1),du(this.layoutVertexArray,P,R,1,1),du(this.layoutVertexArray,P,R,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+3,B+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,{},p,_)}}function Vg(o,i){for(let a=0;a<o.length;a++)if(Da(i,o[a]))return!0;for(let a=0;a<i.length;a++)if(Da(o,i[a]))return!0;return!!pu(o,i)}function Hn(o,i,a){return!!Da(o,i)||!!th(i,o,a)}function Td(o,i){if(1===o.length)return tf(i,o[0]);for(let a=0;a<i.length;a++){const c=i[a];for(let p=0;p<c.length;p++)if(Da(o,c[p]))return!0}for(let a=0;a<o.length;a++)if(tf(i,o[a]))return!0;for(let a=0;a<i.length;a++)if(pu(o,i[a]))return!0;return!1}function Gg(o,i,a){if(o.length>1){if(pu(o,i))return!0;for(let c=0;c<i.length;c++)if(th(i[c],o,a))return!0}for(let c=0;c<o.length;c++)if(th(o[c],i,a))return!0;return!1}function pu(o,i){if(0===o.length||0===i.length)return!1;for(let a=0;a<o.length-1;a++){const c=o[a],p=o[a+1];for(let _=0;_<i.length-1;_++)if(Gp(c,p,i[_],i[_+1]))return!0}return!1}function Gp(o,i,a,c){return ir(o,a,c)!==ir(i,a,c)&&ir(o,i,a)!==ir(o,i,c)}function th(o,i,a){const c=a*a;if(1===i.length)return o.distSqr(i[0])<c;for(let p=1;p<i.length;p++)if(ef(o,i[p-1],i[p])<c)return!0;return!1}function ef(o,i,a){const c=i.distSqr(a);if(0===c)return o.distSqr(i);const p=((o.x-i.x)*(a.x-i.x)+(o.y-i.y)*(a.y-i.y))/c;return o.distSqr(p<0?i:p>1?a:a.sub(i)._mult(p)._add(i))}function tf(o,i){let a,c,p,_=!1;for(let x=0;x<o.length;x++){a=o[x];for(let w=0,E=a.length-1;w<a.length;E=w++)c=a[w],p=a[E],c.y>i.y!=p.y>i.y&&i.x<(p.x-c.x)*(i.y-c.y)/(p.y-c.y)+c.x&&(_=!_)}return _}function Da(o,i){let a=!1;for(let c=0,p=o.length-1;c<o.length;p=c++){const _=o[c],x=o[p];_.y>i.y!=x.y>i.y&&i.x<(x.x-_.x)*(i.y-_.y)/(x.y-_.y)+_.x&&(a=!a)}return a}function Hp(o,i,a,c,p){for(const x of o)if(i<=x.x&&a<=x.y&&c>=x.x&&p>=x.y)return!0;const _=[new ct(i,a),new ct(i,p),new ct(c,p),new ct(c,a)];if(o.length>2)for(const x of _)if(Da(o,x))return!0;for(let x=0;x<o.length-1;x++)if(oc(o[x],o[x+1],_))return!0;return!1}function oc(o,i,a){const c=a[0],p=a[2];if(o.x<c.x&&i.x<c.x||o.x>p.x&&i.x>p.x||o.y<c.y&&i.y<c.y||o.y>p.y&&i.y>p.y)return!1;const _=ir(o,i,a[0]);return _!==ir(o,i,a[1])||_!==ir(o,i,a[2])||_!==ir(o,i,a[3])}function ih(o,i,a){const c=i.paint.get(o).value;return"constant"===c.kind?c.value:a.programConfigurations.get(i.id).getMaxValue(o)}function Ed(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function nh(o,i,a,c,p){if(!i[0]&&!i[1])return o;const _=ct.convert(i)._mult(p);"viewport"===a&&_._rotate(-c);const x=[];for(let w=0;w<o.length;w++)x.push(o[w].sub(_));return x}function Hg(o,i,a,c){const p=ct.convert(o)._mult(c);return"viewport"===i&&p._rotate(-a),p}Bt(sc,{omit:["layers"]});const nf=new q({"circle-sort-key":new L(Fe.layout_circle["circle-sort-key"])});var jg={paint:new q({"circle-radius":new L(Fe.paint_circle["circle-radius"]),"circle-color":new L(Fe.paint_circle["circle-color"]),"circle-blur":new L(Fe.paint_circle["circle-blur"]),"circle-opacity":new L(Fe.paint_circle["circle-opacity"]),"circle-translate":new A(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new A(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new A(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new A(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new L(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new L(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new L(Fe.paint_circle["circle-stroke-opacity"])}),layout:nf},jp=1e-6,jn="undefined"!=typeof Float32Array?Float32Array:Array;function vl(){var o=new jn(9);return jn!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function na(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Wp(o,i,a){var c=i[0],p=i[1],_=i[2],x=i[3],w=i[4],E=i[5],P=i[6],R=i[7],z=i[8],B=i[9],H=i[10],$=i[11],K=i[12],ne=i[13],le=i[14],be=i[15],Se=a[0],De=a[1],Re=a[2],ke=a[3];return o[0]=Se*c+De*w+Re*z+ke*K,o[1]=Se*p+De*E+Re*B+ke*ne,o[2]=Se*_+De*P+Re*H+ke*le,o[3]=Se*x+De*R+Re*$+ke*be,o[4]=(Se=a[4])*c+(De=a[5])*w+(Re=a[6])*z+(ke=a[7])*K,o[5]=Se*p+De*E+Re*B+ke*ne,o[6]=Se*_+De*P+Re*H+ke*le,o[7]=Se*x+De*R+Re*$+ke*be,o[8]=(Se=a[8])*c+(De=a[9])*w+(Re=a[10])*z+(ke=a[11])*K,o[9]=Se*p+De*E+Re*B+ke*ne,o[10]=Se*_+De*P+Re*H+ke*le,o[11]=Se*x+De*R+Re*$+ke*be,o[12]=(Se=a[12])*c+(De=a[13])*w+(Re=a[14])*z+(ke=a[15])*K,o[13]=Se*p+De*E+Re*B+ke*ne,o[14]=Se*_+De*P+Re*H+ke*le,o[15]=Se*x+De*R+Re*$+ke*be,o}function ac(o,i,a){var c,p,_,x,w,E,P,R,z,B,H,$,K=a[0],ne=a[1],le=a[2];return i===o?(o[12]=i[0]*K+i[4]*ne+i[8]*le+i[12],o[13]=i[1]*K+i[5]*ne+i[9]*le+i[13],o[14]=i[2]*K+i[6]*ne+i[10]*le+i[14],o[15]=i[3]*K+i[7]*ne+i[11]*le+i[15]):(p=i[1],_=i[2],x=i[3],w=i[4],E=i[5],P=i[6],R=i[7],z=i[8],B=i[9],H=i[10],$=i[11],o[0]=c=i[0],o[1]=p,o[2]=_,o[3]=x,o[4]=w,o[5]=E,o[6]=P,o[7]=R,o[8]=z,o[9]=B,o[10]=H,o[11]=$,o[12]=c*K+w*ne+z*le+i[12],o[13]=p*K+E*ne+B*le+i[13],o[14]=_*K+P*ne+H*le+i[14],o[15]=x*K+R*ne+$*le+i[15]),o}function xl(o,i,a){var c=a[0],p=a[1],_=a[2];return o[0]=i[0]*c,o[1]=i[1]*c,o[2]=i[2]*c,o[3]=i[3]*c,o[4]=i[4]*p,o[5]=i[5]*p,o[6]=i[6]*p,o[7]=i[7]*p,o[8]=i[8]*_,o[9]=i[9]*_,o[10]=i[10]*_,o[11]=i[11]*_,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o}function Zp(o,i,a){var c=Math.sin(a),p=Math.cos(a),_=i[4],x=i[5],w=i[6],E=i[7],P=i[8],R=i[9],z=i[10],B=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=_*p+P*c,o[5]=x*p+R*c,o[6]=w*p+z*c,o[7]=E*p+B*c,o[8]=P*p-_*c,o[9]=R*p-x*c,o[10]=z*p-w*c,o[11]=B*p-E*c,o}function qp(o,i,a){var c=Math.sin(a),p=Math.cos(a),_=i[0],x=i[1],w=i[2],E=i[3],P=i[8],R=i[9],z=i[10],B=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=_*p-P*c,o[1]=x*p-R*c,o[2]=w*p-z*c,o[3]=E*p-B*c,o[8]=_*c+P*p,o[9]=x*c+R*p,o[10]=w*c+z*p,o[11]=E*c+B*p,o}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var ay=Wp;function Sn(){var o=new jn(3);return jn!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function La(o){var i=new jn(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i}function Wg(o){return Math.hypot(o[0],o[1],o[2])}function mu(o,i,a){var c=new jn(3);return c[0]=o,c[1]=i,c[2]=a,c}function Zg(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o[2]=i[2]+a[2],o}function ra(o,i,a){return o[0]=i[0]-a[0],o[1]=i[1]-a[1],o[2]=i[2]-a[2],o}function rh(o,i,a){return o[0]=i[0]*a[0],o[1]=i[1]*a[1],o[2]=i[2]*a[2],o}function $p(o,i,a){return o[0]=Math.min(i[0],a[0]),o[1]=Math.min(i[1],a[1]),o[2]=Math.min(i[2],a[2]),o}function sh(o,i,a){return o[0]=Math.max(i[0],a[0]),o[1]=Math.max(i[1],a[1]),o[2]=Math.max(i[2],a[2]),o}function Cd(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o}function bl(o,i,a,c){return o[0]=i[0]+a[0]*c,o[1]=i[1]+a[1]*c,o[2]=i[2]+a[2]*c,o}function Ra(o,i){var a=i[0],c=i[1],p=i[2],_=a*a+c*c+p*p;return _>0&&(_=1/Math.sqrt(_)),o[0]=i[0]*_,o[1]=i[1]*_,o[2]=i[2]*_,o}function wl(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]}function Xp(o,i,a){var c=i[0],p=i[1],_=i[2],x=a[0],w=a[1],E=a[2];return o[0]=p*E-_*w,o[1]=_*x-c*E,o[2]=c*w-p*x,o}function oh(o,i,a){var c=i[0],p=i[1],_=i[2],x=a[3]*c+a[7]*p+a[11]*_+a[15];return o[0]=(a[0]*c+a[4]*p+a[8]*_+a[12])/(x=x||1),o[1]=(a[1]*c+a[5]*p+a[9]*_+a[13])/x,o[2]=(a[2]*c+a[6]*p+a[10]*_+a[14])/x,o}function ah(o,i,a){var c=a[0],p=a[1],_=a[2],x=i[0],w=i[1],E=i[2],P=p*E-_*w,R=_*x-c*E,z=c*w-p*x,B=p*z-_*R,H=_*P-c*z,$=c*R-p*P,K=2*a[3];return R*=K,z*=K,H*=2,$*=2,o[0]=x+(P*=K)+(B*=2),o[1]=w+R+H,o[2]=E+z+$,o}var Ad,Br=ra,Ml=rh,Sl=Wg;function lc(o,i,a){var c=i[0],p=i[1],_=i[2],x=i[3];return o[0]=a[0]*c+a[4]*p+a[8]*_+a[12]*x,o[1]=a[1]*c+a[5]*p+a[9]*_+a[13]*x,o[2]=a[2]*c+a[6]*p+a[10]*_+a[14]*x,o[3]=a[3]*c+a[7]*p+a[11]*_+a[15]*x,o}function qg(){var o=new jn(4);return jn!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function $g(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Pd(o,i,a){a*=.5;var c=i[0],p=i[1],_=i[2],x=i[3],w=Math.sin(a),E=Math.cos(a);return o[0]=c*E+x*w,o[1]=p*E+_*w,o[2]=_*E-p*w,o[3]=x*E-c*w,o}Sn(),Ad=new jn(4),jn!=Float32Array&&(Ad[0]=0,Ad[1]=0,Ad[2]=0,Ad[3]=0),Sn(),mu(1,0,0),mu(0,1,0),qg(),qg(),vl();class Co{constructor(i,a){this.points=i,this.planes=a}static fromInvProjectionMatrix(i,a,c,p){const _=Math.pow(2,c),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const P=lc([],E,i),R=1/P[3]/a*_;return(z=P)[0]=(B=P)[0]*(H=[R,R,p?1/P[3]:R,R])[0],z[1]=B[1]*H[1],z[2]=B[2]*H[2],z[3]=B[3]*H[3],z;var z,B,H}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const P=Ra([],Xp([],Br([],x[E[0]],x[E[1]]),Br([],x[E[2]],x[E[1]]))),R=-wl(P,x[E[1]]);return P.concat(R)});return new Co(x,w)}}class Ns{constructor(i,a){this.min=i,this.max=a,this.center=Cd([],Zg([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],c=La(this.min),p=La(this.max);for(let _=0;_<a.length;_++)c[_]=a[_]?this.min[_]:this.center[_],p[_]=a[_]?this.center[_]:this.max[_];return p[2]=this.max[2],new Ns(c,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){const a=this.getCorners();let c=!0;for(let p=0;p<i.planes.length;p++){const _=i.planes[p];let x=0;for(let w=0;w<a.length;w++)x+=wl(_,a[w])+_[3]>=0;if(0===x)return 0;x!==a.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let _=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<i.points.length;w++){const E=i.points[w][p]-this.min[p];_=Math.min(_,E),x=Math.max(x,E)}if(x<0||_>this.max[p]-this.min[p])return 0}return 1}}function rf(o,i,a,c,p,_,x,w,E){if(_&&o.queryGeometry.isAboveHorizon)return!1;_&&(E*=o.pixelToTileUnitsFactor);for(const P of i)for(const R of P){const z=R.add(w),B=p&&a.elevation?a.elevation.exaggeration()*p.getElevationAt(z.x,z.y,!0):0,H=_?z:Xg(z,B,c),$=_?o.tilespaceRays.map(ne=>Jg(ne,B)):o.queryGeometry.screenGeometry,K=lc([],[R.x,R.y,B,1],c);if(!x&&_?E*=K[3]/a.cameraToCenterDistance:x&&!_&&(E*=a.cameraToCenterDistance/K[3]),Hn($,H,E))return!0}return!1}function Xg(o,i,a){const c=lc([],[o.x,o.y,i,1],a);return new ct(c[0]/c[3],c[1]/c[3])}const Yp=mu(0,0,0),Yg=mu(0,0,1);function Jg(o,i){const a=Sn();return Yp[2]=i,o.intersectsPlane(Yp,Yg,a),new ct(a[0],a[1])}class sf extends sc{}function fu(o,{width:i,height:a},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*a*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(i*a*c);return o.width=i,o.height=a,o.data=p,o}function Jp(o,i,a){const{width:c,height:p}=i;c===o.width&&p===o.height||(Kp(o,i,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,p)},a),o.width=c,o.height=p,o.data=i.data)}function Kp(o,i,a,c,p,_){if(0===p.width||0===p.height)return i;if(p.width>o.width||p.height>o.height||a.x>o.width-p.width||a.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||c.x>i.width-p.width||c.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const x=o.data,w=i.data;for(let E=0;E<p.height;E++){const P=((a.y+E)*o.width+a.x)*_,R=((c.y+E)*i.width+c.x)*_;for(let z=0;z<p.width*_;z++)w[R+z]=x[P+z]}return i}Bt(sf,{omit:["layers"]});class Ao{constructor(i,a){fu(this,i,1,a)}resize(i){Jp(this,new Ao(i),1)}clone(){return new Ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,c,p,_){Kp(i,a,c,p,_,1)}}class ys{constructor(i,a){fu(this,i,4,a)}resize(i){Jp(this,new ys(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,c,p,_){Kp(i,a,c,p,_,4)}}Bt(Ao),Bt(ys);var of={paint:new q({"heatmap-radius":new L(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new L(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new A(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new G(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new A(Fe.paint_heatmap["heatmap-opacity"])})};function Qp(o){const i={},a=o.resolution||256,c=o.clips?o.clips.length:1,p=o.image||new ys({width:a,height:c}),_=(x,w,E)=>{i[o.evaluationKey]=E;const P=o.expression.evaluate(i);p.data[x+w+0]=Math.floor(255*P.r/P.a),p.data[x+w+1]=Math.floor(255*P.g/P.a),p.data[x+w+2]=Math.floor(255*P.b/P.a),p.data[x+w+3]=Math.floor(255*P.a)};if(o.clips)for(let x=0,w=0;x<c;++x,w+=4*a)for(let E=0,P=0;E<a;E++,P+=4){const R=E/(a-1),{start:z,end:B}=o.clips[x];_(w,P,z*(1-R)+B*R)}else for(let x=0,w=0;x<a;x++,w+=4)_(0,w,x/(a-1));return p}var em={paint:new q({"hillshade-illumination-direction":new A(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new A(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new A(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new A(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new A(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new A(Fe.paint_hillshade["hillshade-accent-color"])})};const cc=ge([{name:"a_pos",components:2,type:"Int16"}],4),{members:Kg}=cc;var gu=tm,ly=tm;function tm(o,i,a){a=a||2;var c,p,_,x,w,E,P,R=i&&i.length,z=R?i[0]*a:o.length,B=Qg(o,0,z,a,!0),H=[];if(!B||B.next===B.prev)return H;if(R&&(B=function(K,ne,le,be){var Se,De,Re,ke=[];for(Se=0,De=ne.length;Se<De;Se++)(Re=Qg(K,ne[Se]*be,Se<De-1?ne[Se+1]*be:K.length,be,!1))===Re.next&&(Re.steiner=!0),ke.push(e_(Re));for(ke.sort(py),Se=0;Se<ke.length;Se++)le=hc(le=my(ke[Se],le),le.next);return le}(o,i,B,a)),o.length>80*a){c=_=o[0],p=x=o[1];for(var $=a;$<z;$+=a)(w=o[$])<c&&(c=w),(E=o[$+1])<p&&(p=E),w>_&&(_=w),E>x&&(x=E);P=0!==(P=Math.max(_-c,x-p))?1/P:0}return Id(B,H,a,c,p,P),H}function Qg(o,i,a,c,p){var _,x;if(p===kd(o,i,a,c)>0)for(_=i;_<a;_+=c)x=Rd(_,o[_],o[_+1],x);else for(_=a-c;_>=i;_-=c)x=Rd(_,o[_],o[_+1],x);return x&&sa(x,x.next)&&(vu(x),x=x.next),x}function hc(o,i){if(!o)return o;i||(i=o);var a,c=o;do{if(a=!1,c.steiner||!sa(c,c.next)&&0!==Tn(c.prev,c,c.next))c=c.next;else{if(vu(c),(c=i=c.prev)===c.next)break;a=!0}}while(a||c!==i);return i}function Id(o,i,a,c,p,_,x){if(o){!x&&_&&function(R,z,B,H){var $=R;do{null===$.z&&($.z=af($.x,$.y,z,B,H)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next}while($!==R);$.prevZ.nextZ=null,$.prevZ=null,function(K){var ne,le,be,Se,De,Re,ke,qe,$e=1;do{for(le=K,K=null,De=null,Re=0;le;){for(Re++,be=le,ke=0,ne=0;ne<$e&&(ke++,be=be.nextZ);ne++);for(qe=$e;ke>0||qe>0&&be;)0!==ke&&(0===qe||!be||le.z<=be.z)?(Se=le,le=le.nextZ,ke--):(Se=be,be=be.nextZ,qe--),De?De.nextZ=Se:K=Se,Se.prevZ=De,De=Se;le=be}De.nextZ=null,$e*=2}while(Re>1)}($)}(o,c,p,_);for(var w,E,P=o;o.prev!==o.next;)if(w=o.prev,E=o.next,_?hy(o,c,p,_):cy(o))i.push(w.i/a),i.push(o.i/a),i.push(E.i/a),vu(o),o=E.next,P=E.next;else if((o=E)===P){x?1===x?Id(o=uy(hc(o),i,a),i,a,c,p,_,2):2===x&&dy(o,i,a,c,p,_):Id(hc(o),i,a,c,p,_,1);break}}}function cy(o){var i=o.prev,a=o,c=o.next;if(Tn(i,a,c)>=0)return!1;for(var p=o.next.next;p!==o.prev;){if(lh(i.x,i.y,a.x,a.y,c.x,c.y,p.x,p.y)&&Tn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function hy(o,i,a,c){var p=o.prev,_=o,x=o.next;if(Tn(p,_,x)>=0)return!1;for(var w=p.x>_.x?p.x>x.x?p.x:x.x:_.x>x.x?_.x:x.x,E=p.y>_.y?p.y>x.y?p.y:x.y:_.y>x.y?_.y:x.y,P=af(p.x<_.x?p.x<x.x?p.x:x.x:_.x<x.x?_.x:x.x,p.y<_.y?p.y<x.y?p.y:x.y:_.y<x.y?_.y:x.y,i,a,c),R=af(w,E,i,a,c),z=o.prevZ,B=o.nextZ;z&&z.z>=P&&B&&B.z<=R;){if(z!==o.prev&&z!==o.next&&lh(p.x,p.y,_.x,_.y,x.x,x.y,z.x,z.y)&&Tn(z.prev,z,z.next)>=0||(z=z.prevZ,B!==o.prev&&B!==o.next&&lh(p.x,p.y,_.x,_.y,x.x,x.y,B.x,B.y)&&Tn(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;z&&z.z>=P;){if(z!==o.prev&&z!==o.next&&lh(p.x,p.y,_.x,_.y,x.x,x.y,z.x,z.y)&&Tn(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;B&&B.z<=R;){if(B!==o.prev&&B!==o.next&&lh(p.x,p.y,_.x,_.y,x.x,x.y,B.x,B.y)&&Tn(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function uy(o,i,a){var c=o;do{var p=c.prev,_=c.next.next;!sa(p,_)&&Dd(p,c,c.next,_)&&yu(p,_)&&yu(_,p)&&(i.push(p.i/a),i.push(c.i/a),i.push(_.i/a),vu(c),vu(c.next),c=o=_),c=c.next}while(c!==o);return hc(c)}function dy(o,i,a,c,p,_){var x=o;do{for(var w=x.next.next;w!==x.prev;){if(x.i!==w.i&&lf(x,w)){var E=t_(x,w);return x=hc(x,x.next),E=hc(E,E.next),Id(x,i,a,c,p,_),void Id(E,i,a,c,p,_)}w=w.next}x=x.next}while(x!==o)}function py(o,i){return o.x-i.x}function my(o,i){var a=function(_,x){var w,E=x,P=_.x,R=_.y,z=-1/0;do{if(R<=E.y&&R>=E.next.y&&E.next.y!==E.y){var B=E.x+(R-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(B<=P&&B>z){if(z=B,B===P){if(R===E.y)return E;if(R===E.next.y)return E.next}w=E.x<E.next.x?E:E.next}}E=E.next}while(E!==x);if(!w)return null;if(P===z)return w;var H,$=w,K=w.x,ne=w.y,le=1/0;E=w;do{P>=E.x&&E.x>=K&&P!==E.x&&lh(R<ne?P:z,R,K,ne,R<ne?z:P,R,E.x,E.y)&&(H=Math.abs(R-E.y)/(P-E.x),yu(E,_)&&(H<le||H===le&&(E.x>w.x||E.x===w.x&&$i(w,E)))&&(w=E,le=H)),E=E.next}while(E!==$);return w}(o,i);if(!a)return i;var c=t_(a,o),p=hc(a,a.next);return hc(c,c.next),i===a?p:i}function $i(o,i){return Tn(o.prev,o,i.prev)<0&&Tn(i.next,o,o.next)<0}function af(o,i,a,c,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-a)*p)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-c)*p)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function e_(o){var i=o,a=o;do{(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next}while(i!==o);return a}function lh(o,i,a,c,p,_,x,w){return(p-x)*(i-w)-(o-x)*(_-w)>=0&&(o-x)*(c-w)-(a-x)*(i-w)>=0&&(a-x)*(_-w)-(p-x)*(c-w)>=0}function lf(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(a,c){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==c.i&&p.next.i!==c.i&&Dd(p,p.next,a,c))return!0;p=p.next}while(p!==a);return!1}(o,i)&&(yu(o,i)&&yu(i,o)&&function(a,c){var p=a,_=!1,x=(a.x+c.x)/2,w=(a.y+c.y)/2;do{p.y>w!=p.next.y>w&&p.next.y!==p.y&&x<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next}while(p!==a);return _}(o,i)&&(Tn(o.prev,o,i.prev)||Tn(o,i.prev,i))||sa(o,i)&&Tn(o.prev,o,o.next)>0&&Tn(i.prev,i,i.next)>0)}function Tn(o,i,a){return(i.y-o.y)*(a.x-i.x)-(i.x-o.x)*(a.y-i.y)}function sa(o,i){return o.x===i.x&&o.y===i.y}function Dd(o,i,a,c){var p=Ld(Tn(o,i,a)),_=Ld(Tn(o,i,c)),x=Ld(Tn(a,c,o)),w=Ld(Tn(a,c,i));return p!==_&&x!==w||!(0!==p||!_u(o,a,i))||!(0!==_||!_u(o,c,i))||!(0!==x||!_u(a,o,c))||!(0!==w||!_u(a,i,c))}function _u(o,i,a){return i.x<=Math.max(o.x,a.x)&&i.x>=Math.min(o.x,a.x)&&i.y<=Math.max(o.y,a.y)&&i.y>=Math.min(o.y,a.y)}function Ld(o){return o>0?1:o<0?-1:0}function yu(o,i){return Tn(o.prev,o,o.next)<0?Tn(o,i,o.next)>=0&&Tn(o,o.prev,i)>=0:Tn(o,i,o.prev)<0||Tn(o,o.next,i)<0}function t_(o,i){var a=new im(o.i,o.x,o.y),c=new im(i.i,i.x,i.y),p=o.next,_=i.prev;return o.next=i,i.prev=o,a.next=p,p.prev=a,c.next=a,a.prev=c,_.next=c,c.prev=_,c}function Rd(o,i,a,c){var p=new im(o,i,a);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function vu(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function im(o,i,a){this.i=o,this.x=i,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function kd(o,i,a,c){for(var p=0,_=i,x=a-c;_<a;_+=c)p+=(o[x]-o[_])*(o[_+1]+o[x+1]),x=_;return p}function cf(o,i,a,c,p){hf(o,i,a||0,c||o.length-1,p||fy)}function hf(o,i,a,c,p){for(;c>a;){if(c-a>600){var _=c-a+1,x=i-a+1,w=Math.log(_),E=.5*Math.exp(2*w/3),P=.5*Math.sqrt(w*E*(_-E)/_)*(x-_/2<0?-1:1);hf(o,i,Math.max(a,Math.floor(i-x*E/_+P)),Math.min(c,Math.floor(i+(_-x)*E/_+P)),p)}var R=o[i],z=a,B=c;for(zd(o,a,i),p(o[c],R)>0&&zd(o,a,c);z<B;){for(zd(o,z,B),z++,B--;p(o[z],R)<0;)z++;for(;p(o[B],R)>0;)B--}0===p(o[a],R)?zd(o,a,B):zd(o,++B,c),B<=i&&(a=B+1),i<=B&&(c=B-1)}}function zd(o,i,a){var c=o[i];o[i]=o[a],o[a]=c}function fy(o,i){return o<i?-1:o>i?1:0}function nm(o,i){const a=o.length;if(a<=1)return[o];const c=[];let p,_;for(let x=0;x<a;x++){const w=ga(o[x]);0!==w&&(o[x].area=Math.abs(w),void 0===_&&(_=w<0),_===w<0?(p&&c.push(p),p=[o[x]]):p.push(o[x]))}if(p&&c.push(p),i>1)for(let x=0;x<c.length;x++)c[x].length<=i||(cf(c[x],i,1,c[x].length-1,gy),c[x]=c[x].slice(0,i));return c}function gy(o,i){return i.area-o.area}function uf(o,i,a){const c=a.patternDependencies;let p=!1;for(const _ of i){const x=_.paint.get(`${o}-pattern`);x.isConstant()||(p=!0);const w=x.constantOr(null);w&&(p=!0,c[w.to]=!0,c[w.from]=!0)}return p}function df(o,i,a,c,p){const _=p.patternDependencies;for(const x of i){const w=x.paint.get(`${o}-pattern`).value;if("constant"!==w.kind){let E=w.evaluate({zoom:c-1},a,{},p.availableImages),P=w.evaluate({zoom:c},a,{},p.availableImages),R=w.evaluate({zoom:c+1},a,{},p.availableImages);E=E&&E.name?E.name:E,P=P&&P.name?P.name:P,R=R&&R.name?R.name:R,_[E]=!0,_[P]=!0,_[R]=!0,a.patterns[x.id]={min:E,mid:P,max:R}}}return a}tm.deviation=function(o,i,a,c){var p=i&&i.length,_=Math.abs(kd(o,0,p?i[0]*a:o.length,a));if(p)for(var x=0,w=i.length;x<w;x++)_-=Math.abs(kd(o,i[x]*a,x<w-1?i[x+1]*a:o.length,a));var E=0;for(x=0;x<c.length;x+=3){var P=c[x]*a,R=c[x+1]*a,z=c[x+2]*a;E+=Math.abs((o[P]-o[z])*(o[R+1]-o[P+1])-(o[P]-o[R])*(o[z+1]-o[P+1]))}return 0===_&&0===E?0:Math.abs((E-_)/_)},tm.flatten=function(o){for(var i=o[0][0].length,a={vertices:[],holes:[],dimensions:i},c=0,p=0;p<o.length;p++){for(var _=0;_<o[p].length;_++)for(var x=0;x<i;x++)a.vertices.push(o[p][_][x]);p>0&&a.holes.push(c+=o[p-1].length)}return a},gu.default=ly;class rm{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pe,this.indexArray=new je,this.indexArray2=new Vt,this.programConfigurations=new Ia(i.layers,i.zoom),this.segments=new yn,this.segments2=new yn,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection}populate(i,a,c,p){this.hasPattern=uf("fill",this.layers,a);const _=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:w,id:E,index:P,sourceLayerIndex:R}of i){const z=this.layers[0]._featureFilter.needGeometry,B=eh(w,z);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),B,c))continue;const H=_?_.evaluate(B,{},c,a.availableImages):void 0,$={id:E,properties:w.properties,type:w.type,sourceLayerIndex:R,index:P,geometry:z?B.geometry:yl(w,c,p),patterns:{},sortKey:H};x.push($)}_&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:P,sourceLayerIndex:R}=w;if(this.hasPattern){const z=df("fill",this.layers,w,this.zoom,a);this.patternFeatures.push(z)}else this.addFeature(w,E,P,c,{},a.availableImages);a.featureIndex.insert(i[P].feature,E,P,R,this.index)}}update(i,a,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,c,p)}addFeatures(i,a,c,p,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,a,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Kg),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,a,c,p,_,x=[]){for(const w of nm(a,500)){let E=0;for(const $ of w)E+=$.length;const P=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),R=P.vertexLength,z=[],B=[];for(const $ of w){if(0===$.length)continue;$!==w[0]&&B.push(z.length/2);const K=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),ne=K.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(ne+$.length-1,ne),z.push($[0].x),z.push($[0].y);for(let le=1;le<$.length;le++)this.layoutVertexArray.emplaceBack($[le].x,$[le].y),this.indexArray2.emplaceBack(ne+le-1,ne+le),z.push($[le].x),z.push($[le].y);K.vertexLength+=$.length,K.primitiveLength+=$.length}const H=gu(z,B);for(let $=0;$<H.length;$+=3)this.indexArray.emplaceBack(R+H[$],R+H[$+1],R+H[$+2]);P.vertexLength+=E,P.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,_,x,p)}}Bt(rm,{omit:["layers","patternFeatures"]});const pf=new q({"fill-sort-key":new L(Fe.layout_fill["fill-sort-key"])});var _y={paint:new q({"fill-antialias":new A(Fe.paint_fill["fill-antialias"]),"fill-opacity":new L(Fe.paint_fill["fill-opacity"]),"fill-color":new L(Fe.paint_fill["fill-color"]),"fill-outline-color":new L(Fe.paint_fill["fill-outline-color"]),"fill-translate":new A(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new A(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new F(Fe.paint_fill["fill-pattern"])}),layout:pf};const yy=ge([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),vy=ge([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Zi=ge([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:xy}=yy;var i_=xu;function xu(o,i,a,c,p){this.properties={},this.extent=a,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=p,o.readFields(by,this,i)}function by(o,i,a){1==o?i.id=a.readVarint():2==o?function(c,p){for(var _=c.readVarint()+c.pos;c.pos<_;){var x=p._keys[c.readVarint()],w=p._values[c.readVarint()];p.properties[x]=w}}(a,i):3==o?i.type=a.readVarint():4==o&&(i._geometry=a.pos)}function wy(o){for(var i,a,c=0,p=0,_=o.length,x=_-1;p<_;x=p++)c+=((a=o[x]).x-(i=o[p]).x)*(i.y+a.y);return c}xu.types=["Unknown","Point","LineString","Polygon"],xu.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,a=o.readVarint()+o.pos,c=1,p=0,_=0,x=0,w=[];o.pos<a;){if(p<=0){var E=o.readVarint();c=7&E,p=E>>3}if(p--,1===c||2===c)_+=o.readSVarint(),x+=o.readSVarint(),1===c&&(i&&w.push(i),i=[]),i.push(new ct(_,x));else{if(7!==c)throw new Error("unknown command "+c);i&&i.push(i[0].clone())}}return i&&w.push(i),w},xu.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,a=1,c=0,p=0,_=0,x=1/0,w=-1/0,E=1/0,P=-1/0;o.pos<i;){if(c<=0){var R=o.readVarint();a=7&R,c=R>>3}if(c--,1===a||2===a)(p+=o.readSVarint())<x&&(x=p),p>w&&(w=p),(_+=o.readSVarint())<E&&(E=_),_>P&&(P=_);else if(7!==a)throw new Error("unknown command "+a)}return[x,E,w,P]},xu.prototype.toGeoJSON=function(o,i,a){var c,p,_=this.extent*Math.pow(2,a),x=this.extent*o,w=this.extent*i,E=this.loadGeometry(),P=xu.types[this.type];function R(H){for(var $=0;$<H.length;$++){var K=H[$];H[$]=[360*(K.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+w)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(c=0;c<E.length;c++)z[c]=E[c][0];R(E=z);break;case 2:for(c=0;c<E.length;c++)R(E[c]);break;case 3:for(E=function(H){var $=H.length;if($<=1)return[H];for(var K,ne,le=[],be=0;be<$;be++){var Se=wy(H[be]);0!==Se&&(void 0===ne&&(ne=Se<0),ne===Se<0?(K&&le.push(K),K=[H[be]]):K.push(H[be]))}return K&&le.push(K),le}(E),c=0;c<E.length;c++)for(p=0;p<E[c].length;p++)R(E[c][p])}1===E.length?E=E[0]:P="Multi"+P;var B={type:"Feature",geometry:{type:P,coordinates:E},properties:this.properties};return"id"in this&&(B.id=this.id),B};var n_=r_;function r_(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(My,this,i),this.length=this._features.length}function My(o,i,a){15===o?i.version=a.readVarint():1===o?i.name=a.readString():5===o?i.extent=a.readVarint():2===o?i._features.push(a.pos):3===o?i._keys.push(a.readString()):4===o&&i._values.push(function(c){for(var p=null,_=c.readVarint()+c.pos;c.pos<_;){var x=c.readVarint()>>3;p=1===x?c.readString():2===x?c.readFloat():3===x?c.readDouble():4===x?c.readVarint64():5===x?c.readVarint():6===x?c.readSVarint():7===x?c.readBoolean():null}return p}(a))}function Sy(o,i,a){if(3===o){var c=new n_(a,a.readVarint()+a.pos);c.length&&(i[c.name]=c)}}r_.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new i_(this._pbf,i,this.extent,this._keys,this._values)};var ch={VectorTile:function(o,i){this.layers=o.readFields(Sy,{},i)},VectorTileFeature:i_,VectorTileLayer:n_};function sm(o,i,a,c){const p=[],_=0===c?(x,w,E,P,R,z)=>{x.push(new ct(z,E+(z-w)/(P-w)*(R-E)))}:(x,w,E,P,R,z)=>{x.push(new ct(w+(z-E)/(R-E)*(P-w),z))};for(const x of o){const w=[];for(const E of x){if(E.length<=2)continue;const P=[];for(let B=0;B<E.length-1;B++){const H=E[B].x,$=E[B].y,K=E[B+1].x,ne=E[B+1].y,le=0===c?H:$,be=0===c?K:ne;le<i?be>i&&_(P,H,$,K,ne,i):le>a?be<a&&_(P,H,$,K,ne,a):P.push(E[B]),be<i&&le>=i&&_(P,H,$,K,ne,i),be>a&&le<=a&&_(P,H,$,K,ne,a)}let R=E[E.length-1];const z=0===c?R.x:R.y;z>=i&&z<=a&&P.push(R),P.length&&(R=P[P.length-1],P[0].x===R.x&&P[0].y===R.y||P.push(P[0]),w.push(P))}w.length&&p.push(w)}return p}const s_=ch.VectorTileFeature.types,Ty=Math.pow(2,13);function Od(o,i,a,c,p,_,x,w){o.emplaceBack((i<<1)+x,(a<<1)+_,(Math.floor(c*Ty)<<1)+p,Math.round(w))}function Bd(o,i,a){o.emplaceBack(i.x,i.y,i.z,16384*a[0],16384*a[1],16384*a[2])}class o_{constructor(){this.acc=new ct(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ct(i.x,i.y),this.max=new ct(i.x,i.y))}append(i,a){this.currentPolyCount.edges++,this.acc._add(i);const c=this.min,p=this.max;i.x<c.x?c.x=i.x:i.x>p.x&&(p.x=i.x),i.y<c.y?c.y=i.y:i.y>p.y&&(p.y=i.y),((0===i.x||i.x===hi)&&i.x===a.x)!=((0===i.y||i.y===hi)&&i.y===a.y)&&this.processBorderOverlap(i,a),a.x<0!=i.x<0&&this.addBorderIntersection(0,Yt(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>hi!=i.x>hi&&this.addBorderIntersection(1,Yt(a.y,i.y,(hi-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,Yt(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>hi!=i.y>hi&&this.addBorderIntersection(3,Yt(a.x,i.x,(hi-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[i];a<c[0]&&(c[0]=a),a>c[1]&&(c[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const c=0===i.x?0:1;this.addBorderIntersection(c,a.y),this.addBorderIntersection(c,i.y)}else{const c=0===i.y?2:3;this.addBorderIntersection(c,a.x),this.addBorderIntersection(c,i.x)}}centroid(){const i=this.polyCount.reduce((a,c)=>a+c.edges,0);return 0!==i?this.acc.div(i)._round():new ct(0,0)}span(){return new ct(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0)}}class Fd{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new ye,this.centroidVertexArray=new Jc,this.indexArray=new je,this.programConfigurations=new Ia(i.layers,i.zoom),this.segments=new yn,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=i.enableTerrain}populate(i,a,c,p){this.features=[],this.hasPattern=uf("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const x=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*x/(x*x+1)/hi/(1<<_.z)}(c);for(const{feature:_,id:x,index:w,sourceLayerIndex:E}of i){const P=this.layers[0]._featureFilter.needGeometry,R=eh(_,P);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),R,c))continue;const z={id:x,sourceLayerIndex:E,index:w,geometry:P?R.geometry:yl(_,c,p),properties:_.properties,type:_.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push(df("fill-extrusion",this.layers,z,this.zoom,a)):this.addFeature(z,z.geometry,w,c,{},a.availableImages,p),a.featureIndex.insert(_,z.geometry,w,E,this.index,B)}this.sortBorders()}addFeatures(i,a,c,p,_){for(const x of this.features){const{geometry:w}=x;this.addFeature(x,w,x.index,a,c,p,_)}this.sortBorders()}update(i,a,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,xy),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,Zi.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,vy.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,c,p,_,x,w){const E=[new ct(0,0),new ct(hi,hi)],P=w.projection,R="globe"===P.name,z=this.enableTerrain&&!R?new o_:null;R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Rr);const B=nm(a,500);for(let K=B.length-1;K>=0;K--){const ne=B[K];(0===ne.length||(H=ne[0]).every(le=>le.x<=0)||H.every(le=>le.x>=hi)||H.every(le=>le.y<=0)||H.every(le=>le.y>=hi))&&B.splice(K,1)}var H;let $;if(R){const ne=1<<p.z,le=ts(p.x/ne),be=ts((p.x+1)/ne),Se=br(p.y/ne),De=br((p.y+1)/ne);$=function(Re,ke,qe,$e,Je=0,ht){const We=[];if(!Re.length||!qe||!$e)return We;const Qe=(ci,mi)=>{for(const Gt of ci)We.push({polygon:Gt,bounds:mi})},gt=Math.ceil(Math.log2(qe)),xt=Math.ceil(Math.log2($e)),vt=gt-xt,bt=[];for(let ci=0;ci<Math.abs(vt);ci++)bt.push(vt>0?0:1);for(let ci=0;ci<Math.min(gt,xt);ci++)bt.push(0),bt.push(1);let ai=Re;if(ai=sm(ai,ke[0].y-Je,ke[1].y+Je,1),ai=sm(ai,ke[0].x-Je,ke[1].x+Je,0),!ai.length)return We;const xi=[];for(bt.length?xi.push({polygons:ai,bounds:ke,depth:0}):Qe(ai,ke);xi.length;){const ci=xi.pop(),mi=ci.depth,Gt=bt[mi],kt=ci.bounds[0],Si=ci.bounds[1],Bi=0===Gt?kt.x:kt.y,Wn=0===Gt?Si.x:Si.y,qi=ht?ht(Gt,Bi,Wn):.5*(Bi+Wn),Zn=sm(ci.polygons,Bi-Je,qi+Je,Gt),Fi=sm(ci.polygons,qi-Je,Wn+Je,Gt);if(Zn.length){const Ei=[kt,new ct(0===Gt?qi:Si.x,1===Gt?qi:Si.y)];bt.length>mi+1?xi.push({polygons:Zn,bounds:Ei,depth:mi+1}):Qe(Zn,Ei)}if(Fi.length){const Ei=[new ct(0===Gt?qi:kt.x,1===Gt?qi:kt.y),Si];bt.length>mi+1?xi.push({polygons:Fi,bounds:Ei,depth:mi+1}):Qe(Fi,Ei)}}return We}(B,E,Math.ceil((be-le)/11.25),Math.ceil((Se-De)/11.25),1,(Re,ke,qe)=>{if(0===Re)return.5*(ke+qe);{const $e=br((p.y+ke/hi)/ne);return(uu(.5*(br((p.y+qe/hi)/ne)+$e))*ne-p.y)*hi}})}else{$=[];for(const K of B)$.push({polygon:K,bounds:E})}for(const K of $){const ne=K.polygon;let le=0,be=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let qe=0;qe<ne.length;qe++){const $e=ne[qe];if(0===$e.length)continue;le+=$e.length;let Je=0;z&&z.startRing($e[0]);for(let ht=0;ht<$e.length;ht++){const We=$e[ht];if(ht>=1){const Qe=$e[ht-1];if(!mf(We,Qe,K.bounds)){z&&z.append(We,Qe),be.vertexLength+4>yn.MAX_VERTEX_ARRAY_LENGTH&&(be=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const gt=We.sub(Qe)._perp(),xt=gt.x/(Math.abs(gt.x)+Math.abs(gt.y)),vt=gt.y>0?1:0,bt=Qe.dist(We);Je+bt>32768&&(Je=0),Od(this.layoutVertexArray,We.x,We.y,xt,vt,0,0,Je),Od(this.layoutVertexArray,We.x,We.y,xt,vt,0,1,Je),Je+=bt,Od(this.layoutVertexArray,Qe.x,Qe.y,xt,vt,0,0,Je),Od(this.layoutVertexArray,Qe.x,Qe.y,xt,vt,0,1,Je);const ai=be.vertexLength;if(this.indexArray.emplaceBack(ai,ai+2,ai+1),this.indexArray.emplaceBack(ai+1,ai+2,ai+3),be.vertexLength+=4,be.primitiveLength+=2,R){const xi=this.layoutVertexExtArray,ci=P.projectTilePoint(We.x,We.y,p),mi=P.projectTilePoint(Qe.x,Qe.y,p),Gt=P.upVector(p,We.x,We.y),kt=P.upVector(p,Qe.x,Qe.y);Bd(xi,ci,Gt),Bd(xi,ci,Gt),Bd(xi,mi,kt),Bd(xi,mi,kt)}}}}}if(be.vertexLength+le>yn.MAX_VERTEX_ARRAY_LENGTH&&(be=this.segments.prepareSegment(le,this.layoutVertexArray,this.indexArray)),"Polygon"!==s_[i.type])continue;const Se=[],De=[],Re=be.vertexLength;for(let qe=0;qe<ne.length;qe++){const $e=ne[qe];if(0!==$e.length){$e!==ne[0]&&De.push(Se.length/2);for(let Je=0;Je<$e.length;Je++){const ht=$e[Je];Od(this.layoutVertexArray,ht.x,ht.y,0,0,1,1,0),Se.push(ht.x),Se.push(ht.y),z&&z.currentPolyCount.top++,R&&Bd(this.layoutVertexExtArray,P.projectTilePoint(ht.x,ht.y,p),P.upVector(p,ht.x,ht.y))}}}const ke=gu(Se,De);for(let qe=0;qe<ke.length;qe+=3)this.indexArray.emplaceBack(Re+ke[qe],Re+ke[qe+2],Re+ke[qe+1]);be.primitiveLength+=ke.length/3,be.vertexLength+=le}if(z&&z.polyCount.length>0){if(z.borders){z.vertexArrayOffset=this.centroidVertexArray.length;const K=z.borders,ne=this.featuresOnBorder.push(z)-1;for(let le=0;le<4;le++)K[le][0]!==Number.MAX_VALUE&&this.borders[le].push(ne)}this.encodeCentroid(z.borders?void 0:z.centroid(),z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,_,x,p)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((a,c)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[c].borders[i][0])}encodeCentroid(i,a,c=!0){let p,_;if(i)if(0!==i.y){const w=a.span()._mult(this.tileToMeter);p=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(w.x/10)),_=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else p=Math.ceil(7*(i.x+450)),_=0;else p=0,_=+c;let x=c?this.centroidVertexArray.length:a.vertexArrayOffset;for(const w of a.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let E=0;E<2*w.edges;E++)this.centroidVertexArray.emplace(x++,0,_),this.centroidVertexArray.emplace(x++,p,_);for(let E=0;E<w.top;E++)this.centroidVertexArray.emplace(x++,p,_)}}}function mf(o,i,a){return o.x===i.x&&(o.x<a[0].x||o.x>a[1].x)||o.y===i.y&&(o.y<a[0].y||o.y>a[1].y)}Bt(Fd,{omit:["layers","features"]}),Bt(o_);var Ey={paint:new q({"fill-extrusion-opacity":new A(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new L(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new A(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new A(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new F(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new L(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new L(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new A(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ud(o,i){return o.x*i.x+o.y*i.y}function uc(o,i){if(1===o.length){let a=0;const c=i[a++];let p;for(;!p||c.equals(p);)if(p=i[a++],!p)return 1/0;for(;a<i.length;a++){const _=i[a],x=o[0],w=p.sub(c),E=_.sub(c),P=x.sub(c),R=Ud(w,w),z=Ud(w,E),B=Ud(E,E),H=Ud(P,w),$=Ud(P,E),K=R*B-z*z,ne=(B*H-z*$)/K,le=(R*$-z*H)/K,be=c.z*(1-ne-le)+p.z*ne+_.z*le;if(isFinite(be))return be}return 1/0}{let a=1/0;for(const c of i)a=Math.min(a,c.z);return a}}function a_(o){const i=new ct(o[0],o[1]);return i.z=o[2],i}function Cy(o,i,a,c,p,_,x,w){const E=x*p.getElevationAt(o,i,!0,!0),P=0!==_[0],R=P?0===_[1]?x*(_[0]/7-450):x*function(z,B,H){const $=Math.floor(B[0]/8),K=Math.floor(B[1]/8),ne=10*(B[0]-8*$),le=10*(B[1]-8*K),be=z.getElevationAt($,K,!0,!0),Se=z.getMeterToDEM(H),De=Math.floor(.5*(ne*Se-1)),Re=Math.floor(.5*(le*Se-1)),ke=z.tileCoordToPixel($,K),qe=2*De+1,$e=2*Re+1,Je=(xi=qe,ci=$e,[(vt=z).getElevationAtPixel(bt=ke.x-De,ai=ke.y-Re,!0),vt.getElevationAtPixel(bt+ci,ai,!0),vt.getElevationAtPixel(bt,ai+ci,!0),vt.getElevationAtPixel(bt+xi,ai+ci,!0)]),ht=Math.abs(Je[0]-Je[1]),We=Math.abs(Je[2]-Je[3]),Qe=Math.abs(Je[0]-Je[2])+Math.abs(Je[1]-Je[3]),gt=Math.min(.25,.5*Se*(ht+We)/qe),xt=Math.min(.25,.5*Se*Qe/$e);var vt,bt,ai,xi,ci;return be+Math.max(gt*ne,xt*le)}(p,_,w):E;return{base:E+(0===a)?-1:a,top:P?Math.max(R+c,E+a+2):E+c}}const Ay=ge([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Py}=Ay,Iy=ge([{name:"a_packed",components:3,type:"Float32"}]),{members:Dy}=Iy,Ly=ch.VectorTileFeature.types,l_=Math.cos(Math.PI/180*37.5);class Nd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new ue,this.layoutVertexArray2=new xe,this.indexArray=new je,this.programConfigurations=new Ia(i.layers,i.zoom),this.segments=new yn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(i,a,c,p){this.hasPattern=uf("line",this.layers,a);const _=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:R,id:z,index:B,sourceLayerIndex:H}of i){const $=this.layers[0]._featureFilter.needGeometry,K=eh(R,$);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),K,c))continue;const ne=_?_.evaluate(K,{},c):void 0,le={id:z,properties:R.properties,type:R.type,sourceLayerIndex:H,index:B,geometry:$?K.geometry:yl(R,c,p),patterns:{},sortKey:ne};x.push(le)}_&&x.sort((R,z)=>R.sortKey-z.sortKey);const{lineAtlas:w,featureIndex:E}=a,P=this.addConstantDashes(w);for(const R of x){const{geometry:z,index:B,sourceLayerIndex:H}=R;if(P&&this.addFeatureDashes(R,w),this.hasPattern){const $=df("line",this.layers,R,this.zoom,a);this.patternFeatures.push($)}else this.addFeature(R,z,B,c,w.positions,a.availableImages);E.insert(i[B].feature,z,B,H,this.index)}}addConstantDashes(i){let a=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,_=c.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==_.kind)a=!0;else{const x=_.value,w=p.value;if(!w)continue;i.addDash(w.from,x),i.addDash(w.to,x),w.other&&i.addDash(w.other,x)}}return a}addFeatureDashes(i,a){const c=this.zoom;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,x=p.layout.get("line-cap").value;if("constant"===_.kind&&"constant"===x.kind)continue;let w,E,P,R,z,B;if("constant"===_.kind){const ne=_.value;if(!ne)continue;w=ne.other||ne.to,E=ne.to,P=ne.from}else w=_.evaluate({zoom:c-1},i),E=_.evaluate({zoom:c},i),P=_.evaluate({zoom:c+1},i);"constant"===x.kind?R=z=B=x.value:(R=x.evaluate({zoom:c-1},i),z=x.evaluate({zoom:c},i),B=x.evaluate({zoom:c+1},i)),a.addDash(w,R),a.addDash(E,z),a.addDash(P,B);const H=a.getKey(w,R),$=a.getKey(E,z),K=a.getKey(P,B);i.patterns[p.id]={min:H,mid:$,max:K}}}update(i,a,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,c,p)}addFeatures(i,a,c,p,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,a,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Dy)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Py),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,a,c,p,_,x){const w=this.layers[0].layout,E=w.get("line-join").evaluate(i,{}),P=w.get("line-cap").evaluate(i,{}),R=w.get("line-miter-limit"),z=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const B of a)this.addLine(B,i,E,P,R,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,_,x,p)}addLine(i,a,c,p,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<i.length-1;le++)this.totalDistance+=i[le].dist(i[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===Ly[a.type];let E=i.length;for(;E>=2&&i[E-1].equals(i[E-2]);)E--;let P=0;for(;P<E-1&&i[P].equals(i[P+1]);)P++;if(E<(w?3:2))return;"bevel"===c&&(_=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let B,H,$,K,ne;this.e1=this.e2=-1,w&&(B=i[E-2],ne=i[P].sub(B)._unit()._perp());for(let le=P;le<E;le++){if($=le===E-1?w?i[P+1]:void 0:i[le+1],$&&i[le].equals($))continue;ne&&(K=ne),B&&(H=B),B=i[le],ne=$?$.sub(B)._unit()._perp():K,K=K||ne;let be=K.add(ne);0===be.x&&0===be.y||be._unit();const Se=K.x*ne.x+K.y*ne.y,De=be.x*ne.x+be.y*ne.y,Re=0!==De?1/De:1/0,ke=2*Math.sqrt(2-2*De),qe=De<l_&&H&&$,$e=K.x*ne.y-K.y*ne.x>0;if(qe&&le>P){const We=B.dist(H);if(We>2*R){const Qe=B.sub(B.sub(H)._mult(R/We)._round());this.updateDistance(H,Qe),this.addCurrentVertex(Qe,K,0,0,z),H=Qe}}const Je=H&&$;let ht=Je?c:w?"butt":p;if(Je&&"round"===ht&&(Re<x?ht="miter":Re<=2&&(ht="fakeround")),"miter"===ht&&Re>_&&(ht="bevel"),"bevel"===ht&&(Re>2&&(ht="flipbevel"),Re<_&&(ht="miter")),H&&this.updateDistance(H,B),"miter"===ht)be._mult(Re),this.addCurrentVertex(B,be,0,0,z);else if("flipbevel"===ht){if(Re>100)be=ne.mult(-1);else{const We=Re*K.add(ne).mag()/K.sub(ne).mag();be._perp()._mult(We*($e?-1:1))}this.addCurrentVertex(B,be,0,0,z),this.addCurrentVertex(B,be.mult(-1),0,0,z)}else if("bevel"===ht||"fakeround"===ht){const We=-Math.sqrt(Re*Re-1),Qe=$e?We:0,gt=$e?0:We;if(H&&this.addCurrentVertex(B,K,Qe,gt,z),"fakeround"===ht){const xt=Math.round(180*ke/Math.PI/20);for(let vt=1;vt<xt;vt++){let bt=vt/xt;if(.5!==bt){const xi=bt-.5;bt+=bt*xi*(bt-1)*((1.0904+Se*(Se*(3.55645-1.43519*Se)-3.2452))*xi*xi+(.848013+Se*(.215638*Se-1.06021)))}const ai=ne.sub(K)._mult(bt)._add(K)._unit()._mult($e?-1:1);this.addHalfVertex(B,ai.x,ai.y,!1,$e,0,z)}}$&&this.addCurrentVertex(B,ne,-Qe,-gt,z)}else if("butt"===ht)this.addCurrentVertex(B,be,0,0,z);else if("square"===ht){const We=H?1:-1;H||this.addCurrentVertex(B,be,We,We,z),this.addCurrentVertex(B,be,0,0,z),H&&this.addCurrentVertex(B,be,We,We,z)}else"round"===ht&&(H&&(this.addCurrentVertex(B,K,0,0,z),this.addCurrentVertex(B,K,1,1,z,!0)),$&&(this.addCurrentVertex(B,ne,-1,-1,z,!0),this.addCurrentVertex(B,ne,0,0,z)));if(qe&&le<E-1){const We=B.dist($);if(We>2*R){const Qe=B.add($.sub(B)._mult(R/We)._round());this.updateDistance(B,Qe),this.addCurrentVertex(Qe,ne,0,0,z),B=Qe}}}}addCurrentVertex(i,a,c,p,_,x=!1){const w=a.y*p-a.x,E=-a.y-a.x*p;this.addHalfVertex(i,a.x+a.y*c,a.y-a.x*c,x,!1,c,_),this.addHalfVertex(i,w,E,x,!0,-p,_)}addHalfVertex({x:i,y:a},c,p,_,x,w,E){this.layoutVertexArray.emplaceBack((i<<1)+(_?1:0),(a<<1)+(x?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const P=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),E.primitiveLength++),x?this.e2=P:this.e1=P}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,a){this.distance+=i.dist(a),this.updateScaledDistance()}}Bt(Nd,{omit:["layers","patternFeatures"]});const Vd=new q({"line-cap":new L(Fe.layout_line["line-cap"]),"line-join":new L(Fe.layout_line["line-join"]),"line-miter-limit":new A(Fe.layout_line["line-miter-limit"]),"line-round-limit":new A(Fe.layout_line["line-round-limit"]),"line-sort-key":new L(Fe.layout_line["line-sort-key"])});var ff={paint:new q({"line-opacity":new L(Fe.paint_line["line-opacity"]),"line-color":new L(Fe.paint_line["line-color"]),"line-translate":new A(Fe.paint_line["line-translate"]),"line-translate-anchor":new A(Fe.paint_line["line-translate-anchor"]),"line-width":new L(Fe.paint_line["line-width"]),"line-gap-width":new L(Fe.paint_line["line-gap-width"]),"line-offset":new L(Fe.paint_line["line-offset"]),"line-blur":new L(Fe.paint_line["line-blur"]),"line-dasharray":new F(Fe.paint_line["line-dasharray"]),"line-pattern":new F(Fe.paint_line["line-pattern"]),"line-gradient":new G(Fe.paint_line["line-gradient"])}),layout:Vd};const gf=new class extends L{possiblyEvaluate(o,i){return i=new ln(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(o,i)}evaluate(o,i,a,c){return i=Pn({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(o,i,a,c)}}(ff.paint.properties["line-width"].specification);function _f(o,i){return i>0?i+2*o:o}gf.useIntegerZoom=!0;const yf=ge([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),bu=ge([{name:"a_projected_pos",components:3,type:"Float32"}],4);ge([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ry=ge([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ky=ge([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const c_=ge([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),zy=ge([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ge([{name:"triangle",components:3,type:"Uint16"}]),ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ge([{type:"Float32",name:"offsetX"}]),ge([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Vs=128;function Tl(o,i){const{expression:a}=i;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new ln(o+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:p}=a;let _=0;for(;_<c.length&&c[_]<=o;)_++;_=Math.max(0,_-1);let x=_;for(;x<c.length&&c[x]<o+1;)x++;x=Math.min(c.length-1,x);const w=c[_],E=c[x];return"composite"===a.kind?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:E,minSize:a.evaluate(new ln(w)),maxSize:a.evaluate(new ln(E)),interpolationType:p}}}function om(o,{uSize:i,uSizeT:a},{lowerSize:c,upperSize:p}){return"source"===o.kind?c/Vs:"composite"===o.kind?Yt(c/Vs,p/Vs,a):i}function wu(o,i){let a=0,c=0;if("constant"===o.kind)c=o.layoutSize;else if("source"!==o.kind){const{interpolationType:p,minZoom:_,maxZoom:x}=o,w=p?Pi(Kr.interpolationFactor(p,i,_,x),0,1):0;"camera"===o.kind?c=Yt(o.minSize,o.maxSize,w):a=w}return{uSizeT:a,uSize:c}}var h_=Object.freeze({__proto__:null,getSizeData:Tl,evaluateSizeForFeature:om,evaluateSizeForZoom:wu,SIZE_PACK_FACTOR:Vs});function vf(o,i,a){return o.sections.forEach(c=>{c.text=function(p,_,x){const w=_.layout.get("text-transform").evaluate(x,{});return"uppercase"===w?p=p.toLocaleUpperCase():"lowercase"===w&&(p=p.toLocaleLowerCase()),Bs.applyArabicShaping&&(p=Bs.applyArabicShaping(p)),p}(c.text,i,a)}),o}const Gd={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function u_(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function d_(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var xf=function(o,i,a,c,p){var _,x,w=8*p-c-1,E=(1<<w)-1,P=E>>1,R=-7,z=a?p-1:0,B=a?-1:1,H=o[i+z];for(z+=B,_=H&(1<<-R)-1,H>>=-R,R+=w;R>0;_=256*_+o[i+z],z+=B,R-=8);for(x=_&(1<<-R)-1,_>>=-R,R+=c;R>0;x=256*x+o[i+z],z+=B,R-=8);if(0===_)_=1-P;else{if(_===E)return x?NaN:1/0*(H?-1:1);x+=Math.pow(2,c),_-=P}return(H?-1:1)*x*Math.pow(2,_-c)},p_=function(o,i,a,c,p,_){var x,w,E,P=8*_-p-1,R=(1<<P)-1,z=R>>1,B=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,H=c?0:_-1,$=c?1:-1,K=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,x=R):(x=Math.floor(Math.log(i)/Math.LN2),i*(E=Math.pow(2,-x))<1&&(x--,E*=2),(i+=x+z>=1?B/E:B*Math.pow(2,1-z))*E>=2&&(x++,E/=2),x+z>=R?(w=0,x=R):x+z>=1?(w=(i*E-1)*Math.pow(2,p),x+=z):(w=i*Math.pow(2,z-1)*Math.pow(2,p),x=0));p>=8;o[a+H]=255&w,H+=$,w/=256,p-=8);for(x=x<<p|w,P+=p;P>0;o[a+H]=255&x,H+=$,x/=256,P-=8);o[a+H-$]|=128*K},hh=Ji;function Ji(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Ji.Varint=0,Ji.Fixed64=1,Ji.Bytes=2,Ji.Fixed32=5;var Po=4294967296,bf=1/Po,wf="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function fr(o){return o.type===Ji.Bytes?o.readVarint()+o.pos:o.pos+1}function Hd(o,i,a){var c=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(c);for(var p=a.pos-1;p>=o;p--)a.buf[p+c]=a.buf[p]}function jd(o,i){for(var a=0;a<o.length;a++)i.writeVarint(o[a])}function Mf(o,i){for(var a=0;a<o.length;a++)i.writeSVarint(o[a])}function Oy(o,i){for(var a=0;a<o.length;a++)i.writeFloat(o[a])}function By(o,i){for(var a=0;a<o.length;a++)i.writeDouble(o[a])}function Fy(o,i){for(var a=0;a<o.length;a++)i.writeBoolean(o[a])}function m_(o,i){for(var a=0;a<o.length;a++)i.writeFixed32(o[a])}function f_(o,i){for(var a=0;a<o.length;a++)i.writeSFixed32(o[a])}function El(o,i){for(var a=0;a<o.length;a++)i.writeFixed64(o[a])}function Sf(o,i){for(var a=0;a<o.length;a++)i.writeSFixed64(o[a])}function Wd(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function uh(o,i,a){o[a]=i,o[a+1]=i>>>8,o[a+2]=i>>>16,o[a+3]=i>>>24}function Tf(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}function Ef(o,i,a){i.glyphs=[],1===o&&a.readMessage(Cf,i)}function Cf(o,i,a){if(3===o){const{id:c,bitmap:p,width:_,height:x,left:w,top:E,advance:P}=a.readMessage(Af,{});i.glyphs.push({id:c,bitmap:new Ao({width:_+6,height:x+6},p),metrics:{width:_,height:x,left:w,top:E,advance:P}})}else 4===o?i.ascender=a.readSVarint():5===o&&(i.descender=a.readSVarint())}function Af(o,i,a){1===o?i.id=a.readVarint():2===o?i.bitmap=a.readBytes():3===o?i.width=a.readVarint():4===o?i.height=a.readVarint():5===o?i.left=a.readSVarint():6===o?i.top=a.readSVarint():7===o&&(i.advance=a.readVarint())}function Cl(o){let i=0,a=0;for(const x of o)i+=x.w*x.h,a=Math.max(a,x.w);o.sort((x,w)=>w.h-x.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let p=0,_=0;for(const x of o)for(let w=c.length-1;w>=0;w--){const E=c[w];if(!(x.w>E.w||x.h>E.h)){if(x.x=E.x,x.y=E.y,_=Math.max(_,x.y+x.h),p=Math.max(p,x.x+x.w),x.w===E.w&&x.h===E.h){const P=c.pop();w<c.length&&(c[w]=P)}else x.h===E.h?(E.x+=x.w,E.w-=x.w):x.w===E.w?(E.y+=x.h,E.h-=x.h):(c.push({x:E.x+x.w,y:E.y,w:E.w-x.w,h:x.h}),E.y+=x.h,E.h-=x.h);break}}return{w:p,h:_,fill:i/(p*_)||0}}Ji.prototype={destroy:function(){this.buf=null},readFields:function(o,i,a){for(a=a||this.length;this.pos<a;){var c=this.readVarint(),p=c>>3,_=this.pos;this.type=7&c,o(p,i,this),this.pos===_&&this.skip(c)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=Wd(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Tf(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Wd(this.buf,this.pos)+Wd(this.buf,this.pos+4)*Po;return this.pos+=8,o},readSFixed64:function(){var o=Wd(this.buf,this.pos)+Tf(this.buf,this.pos+4)*Po;return this.pos+=8,o},readFloat:function(){var o=xf(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=xf(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,a,c=this.buf;return i=127&(a=c[this.pos++]),a<128?i:(i|=(127&(a=c[this.pos++]))<<7,a<128?i:(i|=(127&(a=c[this.pos++]))<<14,a<128?i:(i|=(127&(a=c[this.pos++]))<<21,a<128?i:function(p,_,x){var w,E,P=x.buf;if(w=(112&(E=P[x.pos++]))>>4,E<128||(w|=(127&(E=P[x.pos++]))<<3,E<128)||(w|=(127&(E=P[x.pos++]))<<10,E<128)||(w|=(127&(E=P[x.pos++]))<<17,E<128)||(w|=(127&(E=P[x.pos++]))<<24,E<128)||(w|=(1&(E=P[x.pos++]))<<31,E<128))return function Gs(o,i,a){return a?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}(p,w,_);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(a=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&wf?wf.decode(this.buf.subarray(i,o)):function(a,c,p){for(var _="",x=c;x<p;){var w,E,P,R=a[x],z=null,B=R>239?4:R>223?3:R>191?2:1;if(x+B>p)break;1===B?R<128&&(z=R):2===B?128==(192&(w=a[x+1]))&&(z=(31&R)<<6|63&w)<=127&&(z=null):3===B?(E=a[x+2],128==(192&(w=a[x+1]))&&128==(192&E)&&((z=(15&R)<<12|(63&w)<<6|63&E)<=2047||z>=55296&&z<=57343)&&(z=null)):4===B&&(E=a[x+2],P=a[x+3],128==(192&(w=a[x+1]))&&128==(192&E)&&128==(192&P)&&((z=(15&R)<<18|(63&w)<<12|(63&E)<<6|63&P)<=65535||z>=1114112)&&(z=null)),null===z?(z=65533,B=1):z>65535&&(z-=65536,_+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),_+=String.fromCharCode(z),x+=B}return _}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==Ji.Bytes)return o.push(this.readVarint(i));var a=fr(this);for(o=o||[];this.pos<a;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==Ji.Bytes)return o.push(this.readSVarint());var i=fr(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Ji.Bytes)return o.push(this.readBoolean());var i=fr(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Ji.Bytes)return o.push(this.readFloat());var i=fr(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Ji.Bytes)return o.push(this.readDouble());var i=fr(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Ji.Bytes)return o.push(this.readFixed32());var i=fr(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Ji.Bytes)return o.push(this.readSFixed32());var i=fr(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Ji.Bytes)return o.push(this.readFixed64());var i=fr(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Ji.Bytes)return o.push(this.readSFixed64());var i=fr(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===Ji.Varint)for(;this.buf[this.pos++]>127;);else if(i===Ji.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Ji.Fixed32)this.pos+=4;else{if(i!==Ji.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),uh(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),uh(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),uh(this.buf,-1&o,this.pos),uh(this.buf,Math.floor(o*bf),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),uh(this.buf,-1&o,this.pos),uh(this.buf,Math.floor(o*bf),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,a){var c,p,_,w;if(i>=0?(c=i%4294967296|0,p=i/4294967296|0):(p=~(-i/4294967296),4294967295^(c=~(-i%4294967296))?c=c+1|0:(c=0,p=p+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),_=c,(w=a).buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7),function(_,x){var w=(7&_)<<4;x.buf[x.pos++]|=w|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))}(p,a)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(c,p,_){for(var x,w,E=0;E<p.length;E++){if((x=p.charCodeAt(E))>55295&&x<57344){if(!w){x>56319||E+1===p.length?(c[_++]=239,c[_++]=191,c[_++]=189):w=x;continue}if(x<56320){c[_++]=239,c[_++]=191,c[_++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(c[_++]=239,c[_++]=191,c[_++]=189,w=null);x<128?c[_++]=x:(x<2048?c[_++]=x>>6|192:(x<65536?c[_++]=x>>12|224:(c[_++]=x>>18|240,c[_++]=x>>12&63|128),c[_++]=x>>6&63|128),c[_++]=63&x|128)}return _}(this.buf,o,this.pos);var a=this.pos-i;a>=128&&Hd(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeFloat:function(o){this.realloc(4),p_(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),p_(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var a=0;a<i;a++)this.buf[this.pos++]=o[a]},writeRawMessage:function(o,i){this.pos++;var a=this.pos;o(i,this);var c=this.pos-a;c>=128&&Hd(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,i,a){this.writeTag(o,Ji.Bytes),this.writeRawMessage(i,a)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,jd,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,Mf,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,Fy,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,Oy,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,By,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,m_,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,f_,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,El,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,Sf,i)},writeBytesField:function(o,i){this.writeTag(o,Ji.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,Ji.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,Ji.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,Ji.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,Ji.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,Ji.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,Ji.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,Ji.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,Ji.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,Ji.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,Boolean(i))}};class ka{constructor(i,{pixelRatio:a,version:c,stretchX:p,stretchY:_,content:x}){this.paddedRect=i,this.pixelRatio=a,this.stretchX=p,this.stretchY=_,this.content=x,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Pf{constructor(i,a){const c={},p={};this.haveRenderCallbacks=[];const _=[];this.addImages(i,c,_),this.addImages(a,p,_);const{w:x,h:w}=Cl(_),E=new ys({width:x||1,height:w||1});for(const P in i){const R=i[P],z=c[P].paddedRect;ys.copy(R.data,E,{x:0,y:0},{x:z.x+1,y:z.y+1},R.data)}for(const P in a){const R=a[P],z=p[P].paddedRect,B=z.x+1,H=z.y+1,$=R.data.width,K=R.data.height;ys.copy(R.data,E,{x:0,y:0},{x:B,y:H},R.data),ys.copy(R.data,E,{x:0,y:K-1},{x:B,y:H-1},{width:$,height:1}),ys.copy(R.data,E,{x:0,y:0},{x:B,y:H+K},{width:$,height:1}),ys.copy(R.data,E,{x:$-1,y:0},{x:B-1,y:H},{width:1,height:K}),ys.copy(R.data,E,{x:0,y:0},{x:B+$,y:H},{width:1,height:K})}this.image=E,this.iconPositions=c,this.patternPositions=p}addImages(i,a,c){for(const p in i){const _=i[p],x={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(x),a[p]=new ka(x,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>i.hasImage(c)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in i.updatedImages)this.patchUpdatedImage(this.iconPositions[c],i.getImage(c),a),this.patchUpdatedImage(this.patternPositions[c],i.getImage(c),a)}patchUpdatedImage(i,a,c){if(!i||!a||i.version===a.version)return;i.version=a.version;const[p,_]=i.tl;c.update(a.data,void 0,{x:p,y:_})}}Bt(ka),Bt(Pf);const mn={horizontal:1,vertical:2,horizontalOnly:3};class Mu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,a){const c=new Mu;return c.scale=i||1,c.fontStack=a,c}static forImage(i){const a=new Mu;return a.imageName=i,a}}class ro{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a){const c=new ro;for(let p=0;p<i.sections.length;p++){const _=i.sections[p];_.image?c.addImageSection(_):c.addTextSection(_,a)}return c}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(a,c){let p="";for(let _=0;_<a.length;_++){const x=a.charCodeAt(_+1)||null,w=a.charCodeAt(_-1)||null;p+=!c&&(x&&no(x)&&!Gd[a[_+1]]||w&&no(w)&&!Gd[a[_-1]])||!Gd[a[_]]?a[_]:Gd[a[_]]}return p}(this.text,i)}trim(){let i=0;for(let c=0;c<this.text.length&&Zd[this.text.charCodeAt(c)];c++)i++;let a=this.text.length;for(let c=this.text.length-1;c>=0&&c>=i&&Zd[this.text.charCodeAt(c)];c--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const c=new ro;return c.text=this.text.substring(i,a),c.sectionIndex=this.sectionIndex.slice(i,a),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(Mu.forText(i.scale,i.fontStack||a));const c=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(c)}addImageSection(i){const a=i.image?i.image.name:"";if(0===a.length)return void nn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Mu.forImage(a)),this.sectionIndex.push(this.sections.length-1)):nn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function am(o,i,a,c,p,_,x,w,E,P,R,z,B,H,$,K){const ne=ro.fromFeature(o,p);let le;z===mn.vertical&&ne.verticalizePunctuation(B);const{processBidirectionalText:be,processStyledBidirectionalText:Se}=Bs;if(be&&1===ne.sections.length){le=[];const ke=be(ne.toString(),lm(ne,P,_,i,c,H,$));for(const qe of ke){const $e=new ro;$e.text=qe,$e.sections=ne.sections;for(let Je=0;Je<qe.length;Je++)$e.sectionIndex.push(0);le.push($e)}}else if(Se){le=[];const ke=Se(ne.text,ne.sectionIndex,lm(ne,P,_,i,c,H,$));for(const qe of ke){const $e=new ro;$e.text=qe[0],$e.sectionIndex=qe[1],$e.sections=ne.sections,le.push($e)}}else le=function(ke,qe){const $e=[],Je=ke.text;let ht=0;for(const We of qe)$e.push(ke.substring(ht,We)),ht=We;return ht<Je.length&&$e.push(ke.substring(ht,Je.length)),$e}(ne,lm(ne,P,_,i,c,H,$));const De=[],Re={positionedLines:De,text:ne.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ke,qe,$e,Je,ht,We,Qe,gt,xt,vt,bt,ai){let xi=0,ci=0,mi=0;const Gt="right"===gt?1:"left"===gt?0:.5;let kt=!1;for(const Fi of ht){const Ei=Fi.getSections();for(const Xi of Ei){if(Xi.imageName)continue;const xn=qe[Xi.fontStack];if(xn&&(kt=void 0!==xn.ascender&&void 0!==xn.descender,!kt))break}if(!kt)break}let Si=0;for(const Fi of ht){Fi.trim();const Ei=Fi.getMaxScale(),Xi=24*(Ei-1),xn={positionedGlyphs:[],lineOffset:0};ke.positionedLines[Si]=xn;const En=xn.positionedGlyphs;let qn=0;if(!Fi.length()){ci+=We,++Si;continue}let Kn=0,Qn=0;for(let Ki=0;Ki<Fi.length();Ki++){const Gr=Fi.getSection(Ki),Ws=Fi.getSectionIndex(Ki),Cn=Fi.getCharCode(Ki);let er=Gr.scale,Qi=null,en=null,Sr=null,Tr=24,zn=0;const Er=!(xt===mn.horizontal||!bt&&!nu(Cn)||bt&&(Zd[Cn]||(Bi=Cn,Sp(Bi)||Jh(Bi)||Wc(Bi)||pd(Bi)||eu(Bi))));if(Gr.imageName){const sr=Je[Gr.imageName];if(!sr)continue;Sr=Gr.imageName,ke.iconsInText=ke.iconsInText||!0,en=sr.paddedRect;const tr=sr.displaySize;er=24*er/ai,Qi={width:tr[0],height:tr[1],left:1,top:-3,advance:Er?tr[1]:tr[0],localGlyph:!1},zn=kt?-Qi.height*er:24*Ei-17-tr[1]*er,Tr=Qi.advance;const ao=(Er?tr[0]:tr[1])*er-24*Ei;ao>0&&ao>qn&&(qn=ao)}else{const sr=$e[Gr.fontStack];if(!sr)continue;sr[Cn]&&(en=sr[Cn]);const tr=qe[Gr.fontStack];if(!tr)continue;const ao=tr.glyphs[Cn];if(!ao)continue;if(Qi=ao.metrics,Tr=8203!==Cn?24:0,kt){const Ll=void 0!==tr.ascender?Math.abs(tr.ascender):0,Ou=void 0!==tr.descender?Math.abs(tr.descender):0,Na=(Ll+Ou)*er;Kn<Na&&(Kn=Na,Qn=(Ll-Ou)/2*er),zn=-Ll*er}else zn=24*(Ei-er)-17}Er?(ke.verticalizable=!0,En.push({glyph:Cn,imageName:Sr,x:xi,y:ci+zn,vertical:Er,scale:er,localGlyph:Qi.localGlyph,fontStack:Gr.fontStack,sectionIndex:Ws,metrics:Qi,rect:en}),xi+=Tr*er+vt):(En.push({glyph:Cn,imageName:Sr,x:xi,y:ci+zn,vertical:Er,scale:er,localGlyph:Qi.localGlyph,fontStack:Gr.fontStack,sectionIndex:Ws,metrics:Qi,rect:en}),xi+=Qi.advance*er+vt)}0!==En.length&&(mi=Math.max(xi-vt,mi),kt?cm(En,Gt,qn,Qn,We*Ei/2):cm(En,Gt,qn,0,We/2)),xi=0;const is=We*Ei+qn;xn.lineOffset=Math.max(qn,Xi),ci+=is,++Si}var Bi;const Wn=ci,{horizontalAlign:qi,verticalAlign:Zn}=Al(Qe);(function(Fi,Ei,Xi,xn,En,qn){const Kn=(Ei-Xi)*En,Qn=-qn*xn;for(const is of Fi)for(const Ki of is.positionedGlyphs)Ki.x+=Kn,Ki.y+=Qn})(ke.positionedLines,Gt,qi,Zn,mi,Wn),ke.top+=-Zn*Wn,ke.bottom=ke.top+Wn,ke.left+=-qi*mi,ke.right=ke.left+mi,ke.hasBaseline=kt}(Re,i,a,c,le,x,w,E,z,P,B,K),!function(ke){for(const qe of ke)if(0!==qe.positionedGlyphs.length)return!1;return!0}(De)&&Re}const Zd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},g_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function If(o,i,a,c,p,_){if(i.imageName){const x=c[i.imageName];return x?x.displaySize[0]*i.scale*24/_+p:0}{const x=a[i.fontStack],w=x&&x.glyphs[o];return w?w.metrics.advance*i.scale+p:0}}function __(o,i,a,c){const p=Math.pow(o-i,2);return c?o<i?p/2:2*p:p+Math.abs(a)*a}function y_(o,i,a){let c=0;return 10===o&&(c-=1e4),a&&(c+=150),40!==o&&65288!==o||(c+=50),41!==i&&65289!==i||(c+=50),c}function Df(o,i,a,c,p,_){let x=null,w=__(i,a,p,_);for(const E of c){const P=__(i-E.x,a,p,_)+E.badness;P<=w&&(x=E,w=P)}return{index:o,x:i,priorBreak:x,badness:w}}function v_(o){return o?v_(o.priorBreak).concat(o.index):[]}function lm(o,i,a,c,p,_,x){if("point"!==_)return[];if(!o)return[];const w=[],E=function(B,H,$,K,ne,le){let be=0;for(let Se=0;Se<B.length();Se++){const De=B.getSection(Se);be+=If(B.getCharCode(Se),De,K,ne,H,le)}return be/Math.max(1,Math.ceil(be/$))}(o,i,a,c,p,x),P=o.text.indexOf("\u200b")>=0;let R=0;for(let B=0;B<o.length();B++){const H=o.getSection(B),$=o.getCharCode(B);if(Zd[$]||(R+=If($,H,c,p,i,x)),B<o.length()-1){const K=!((z=$)<11904||!(Cp(z)||Ep(z)||Ql(z)||qc(z)||Ip(z)||cd(z)||Ap(z)||Kh(z)||Dp(z)||dd(z)||Pp(z)||tu(z)||Zc(z)||hd(z)||Tp(z)||ud(z)||Qh(z)||zp(z)||Rp(z)||Lp(z)));(g_[$]||K||H.imageName)&&w.push(Df(B+1,R,E,w,y_($,o.getCharCode(B+1),K&&P),!1))}}var z;return v_(Df(o.length(),R,E,w,0,!0))}function Al(o){let i=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function cm(o,i,a,c,p){if(!(i||a||c||p))return;const _=o.length-1,x=o[_],w=(x.x+x.metrics.advance*x.scale)*i;for(let E=0;E<=_;E++)o[E].x-=w,o[E].y+=a+c+p}function x_(o,i,a){const{horizontalAlign:c,verticalAlign:p}=Al(a),_=i[0]-o.displaySize[0]*c,x=i[1]-o.displaySize[1]*p;return{image:o,top:x,bottom:x+o.displaySize[1],left:_,right:_+o.displaySize[0]}}function Lf(o,i,a,c,p,_){const x=o.image;let w;if(x.content){const ne=x.content,le=x.pixelRatio||1;w=[ne[0]/le,ne[1]/le,x.displaySize[0]-ne[2]/le,x.displaySize[1]-ne[3]/le]}const E=i.left*_,P=i.right*_;let R,z,B,H;"width"===a||"both"===a?(H=p[0]+E-c[3],z=p[0]+P+c[1]):(H=p[0]+(E+P-x.displaySize[0])/2,z=H+x.displaySize[0]);const $=i.top*_,K=i.bottom*_;return"height"===a||"both"===a?(R=p[1]+$-c[0],B=p[1]+K+c[2]):(R=p[1]+($+K-x.displaySize[1])/2,B=R+x.displaySize[1]),{image:x,top:R,right:z,bottom:B,left:H,collisionPadding:w}}class rr extends ct{constructor(i,a,c,p,_){super(i,a),this.angle=p,this.z=c,void 0!==_&&(this.segment=_)}clone(){return new rr(this.x,this.y,this.z,this.angle,this.segment)}}function Fr(o,i,a,c,p){if(void 0===i.segment)return!0;let _=i,x=i.segment+1,w=0;for(;w>-a/2;){if(x--,x<0)return!1;w-=o[x].dist(_),_=o[x]}w+=o[x].dist(o[x+1]),x++;const E=[];let P=0;for(;w<a/2;){const R=o[x],z=o[x+1];if(!z)return!1;let B=o[x-1].angleTo(R)-R.angleTo(z);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:B}),P+=B;w-E[0].distance>c;)P-=E.shift().angleDelta;if(P>p)return!1;x++,w+=R.dist(z)}return!0}function dc(o){let i=0;for(let a=0;a<o.length-1;a++)i+=o[a].dist(o[a+1]);return i}function Rf(o,i,a){return o?.6*i*a:0}function b_(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function Uy(o,i,a,c,p,_){const x=Rf(a,p,_),w=b_(a,c)*_;let E=0;const P=dc(o)/2;for(let R=0;R<o.length-1;R++){const z=o[R],B=o[R+1],H=z.dist(B);if(E+H>P){const $=(P-E)/H,K=Yt(z.x,B.x,$),ne=Yt(z.y,B.y,$),le=new rr(K,ne,0,B.angleTo(z),R);return!x||Fr(o,le,w,x,i)?le:void 0}E+=H}}function Ny(o,i,a,c,p,_,x,w,E){const P=Rf(c,_,x),R=b_(c,p),z=R*x,B=0===o[0].x||o[0].x===E||0===o[0].y||o[0].y===E;return i-z<i/4&&(i=z+i/4),kf(o,B?i/2*w%i:(R/2+2*_)*x*w%i,i,P,a,z,B,!1,E)}function kf(o,i,a,c,p,_,x,w,E){const P=_/2,R=dc(o);let z=0,B=i-a,H=[];for(let $=0;$<o.length-1;$++){const K=o[$],ne=o[$+1],le=K.dist(ne),be=ne.angleTo(K);for(;B+a<z+le;){B+=a;const Se=(B-z)/le,De=Yt(K.x,ne.x,Se),Re=Yt(K.y,ne.y,Se);if(De>=0&&De<E&&Re>=0&&Re<E&&B-P>=0&&B+P<=R){const ke=new rr(De,Re,0,be,$);ke._round(),c&&!Fr(o,ke,_,c,p)||H.push(ke)}}z+=le}return w||H.length||x||(H=kf(o,z/2,a,c,p,_,x,!0,E)),H}function zf(o,i,a,c,p){const _=[];for(let x=0;x<o.length;x++){const w=o[x];let E;for(let P=0;P<w.length-1;P++){let R=w[P],z=w[P+1];R.x<i&&z.x<i||(R.x<i?R=new ct(i,R.y+(i-R.x)/(z.x-R.x)*(z.y-R.y))._round():z.x<i&&(z=new ct(i,R.y+(i-R.x)/(z.x-R.x)*(z.y-R.y))._round()),R.y<a&&z.y<a||(R.y<a?R=new ct(R.x+(a-R.y)/(z.y-R.y)*(z.x-R.x),a)._round():z.y<a&&(z=new ct(R.x+(a-R.y)/(z.y-R.y)*(z.x-R.x),a)._round()),R.x>=c&&z.x>=c||(R.x>=c?R=new ct(c,R.y+(c-R.x)/(z.x-R.x)*(z.y-R.y))._round():z.x>=c&&(z=new ct(c,R.y+(c-R.x)/(z.x-R.x)*(z.y-R.y))._round()),R.y>=p&&z.y>=p||(R.y>=p?R=new ct(R.x+(p-R.y)/(z.y-R.y)*(z.x-R.x),p)._round():z.y>=p&&(z=new ct(R.x+(p-R.y)/(z.y-R.y)*(z.x-R.x),p)._round()),E&&R.equals(E[E.length-1])||(E=[R],_.push(E)),E.push(z)))))}}return _}Bt(rr);const qd=1e20;function Pl(o,i,a,c,p,_,x,w,E){for(let P=i;P<i+c;P++)$d(o,a*_+P,_,p,x,w,E);for(let P=a;P<a+p;P++)$d(o,P*_+i,1,c,x,w,E)}function $d(o,i,a,c,p,_,x){_[0]=0,x[0]=-qd,x[1]=qd,p[0]=o[i];for(let w=1,E=0,P=0;w<c;w++){p[w]=o[i+w*a];const R=w*w;do{const z=_[E];P=(p[w]-p[z]+R-z*z)/(w-z)/2}while(P<=x[E]&&--E>-1);E++,_[E]=w,x[E]=P,x[E+1]=qd}for(let w=0,E=0;w<c;w++){for(;x[E+1]<w;)E++;const P=_[E],R=w-P;o[i+w*a]=p[P]+R*R}}const hm={none:0,ideographs:1,all:2};class vs{constructor(i,a,c){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,a){const c=[];for(const p in i)for(const _ of i[p])c.push({stack:p,id:_});qa(c,({stack:p,id:_},x)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=w.glyphs[_];if(void 0!==E)return void x(null,{stack:p,id:_,glyph:E});if(E=this._tinySDF(w,p,_),E)return w.glyphs[_]=E,void x(null,{stack:p,id:_,glyph:E});const P=Math.floor(_/256);if(256*P>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[P])return void x(null,{stack:p,id:_,glyph:E});let R=w.requests[P];R||(R=w.requests[P]=[],vs.loadGlyphRange(p,P,this.url,this.requestManager,(z,B)=>{if(B){w.ascender=B.ascender,w.descender=B.descender;for(const H in B.glyphs)this._doesCharSupportLocalGlyph(+H)||(w.glyphs[+H]=B.glyphs[+H]);w.ranges[P]=!0}for(const H of R)H(z,B);delete w.requests[P]})),R.push((z,B)=>{z?x(z):B&&x(null,{stack:p,id:_,glyph:B.glyphs[_]||null})})},(p,_)=>{if(p)a(p);else if(_){const x={};for(const{stack:w,id:E,glyph:P}of _)void 0===x[w]&&(x[w]={}),void 0===x[w].glyphs&&(x[w].glyphs={}),x[w].glyphs[E]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},x[w].ascender=this.entries[w].ascender,x[w].descender=this.entries[w].descender;a(null,x)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==hm.none&&(this.localGlyphMode===hm.all?!!this.localFontFamily:!!this.localFontFamily&&(dd(i)||kp(i)||Zc(i)||Qh(i)||Kh(i)))}_tinySDF(i,a,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let _=i.tinySDF;if(!_){let K="400";/bold/i.test(a)?K="900":/medium/i.test(a)?K="500":/light/i.test(a)&&(K="200"),_=i.tinySDF=new vs.TinySDF({fontFamily:p,fontWeight:K,fontSize:48,buffer:6,radius:16}),_.fontWeight=K}if(this.localGlyphs[_.fontWeight][c])return this.localGlyphs[_.fontWeight][c];const x=String.fromCharCode(c),{data:w,width:E,height:P,glyphWidth:R,glyphHeight:z,glyphLeft:B,glyphTop:H,glyphAdvance:$}=_.draw(x);return this.localGlyphs[_.fontWeight][c]={id:c,bitmap:new Ao({width:E,height:P},w),metrics:{width:R/2,height:z/2,left:B/2,top:H/2-27,advance:$/2,localGlyph:!0}}}}function Of(o,i,a,c){const p=[],_=o.image,x=_.pixelRatio,w=_.paddedRect.w-2,E=_.paddedRect.h-2,P=o.right-o.left,R=o.bottom-o.top,z=_.stretchX||[[0,w]],B=_.stretchY||[[0,E]],H=(We,Qe)=>We+Qe[1]-Qe[0],$=z.reduce(H,0),K=B.reduce(H,0),ne=w-$,le=E-K;let be=0,Se=$,De=0,Re=K,ke=0,qe=ne,$e=0,Je=le;if(_.content&&c){const We=_.content;be=dh(z,0,We[0]),De=dh(B,0,We[1]),Se=dh(z,We[0],We[2]),Re=dh(B,We[1],We[3]),ke=We[0]-be,$e=We[1]-De,qe=We[2]-We[0]-Se,Je=We[3]-We[1]-Re}const ht=(We,Qe,gt,xt)=>{const vt=um(We.stretch-be,Se,P,o.left),bt=dm(We.fixed-ke,qe,We.stretch,$),ai=um(Qe.stretch-De,Re,R,o.top),xi=dm(Qe.fixed-$e,Je,Qe.stretch,K),ci=um(gt.stretch-be,Se,P,o.left),mi=dm(gt.fixed-ke,qe,gt.stretch,$),Gt=um(xt.stretch-De,Re,R,o.top),kt=dm(xt.fixed-$e,Je,xt.stretch,K),Si=new ct(vt,ai),Bi=new ct(ci,ai),Wn=new ct(ci,Gt),qi=new ct(vt,Gt),Zn=new ct(bt/x,xi/x),Fi=new ct(mi/x,kt/x),Ei=i*Math.PI/180;if(Ei){const En=Math.sin(Ei),qn=Math.cos(Ei),Kn=[qn,-En,En,qn];Si._matMult(Kn),Bi._matMult(Kn),qi._matMult(Kn),Wn._matMult(Kn)}const Xi=We.stretch+We.fixed,xn=Qe.stretch+Qe.fixed;return{tl:Si,tr:Bi,bl:qi,br:Wn,tex:{x:_.paddedRect.x+1+Xi,y:_.paddedRect.y+1+xn,w:gt.stretch+gt.fixed-Xi,h:xt.stretch+xt.fixed-xn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zn,pixelOffsetBR:Fi,minFontScaleX:qe/x/P,minFontScaleY:Je/x/R,isSDF:a}};if(c&&(_.stretchX||_.stretchY)){const We=w_(z,ne,$),Qe=w_(B,le,K);for(let gt=0;gt<We.length-1;gt++){const xt=We[gt],vt=We[gt+1];for(let bt=0;bt<Qe.length-1;bt++)p.push(ht(xt,Qe[bt],vt,Qe[bt+1]))}}else p.push(ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return p}function dh(o,i,a){let c=0;for(const p of o)c+=Math.max(i,Math.min(a,p[1]))-Math.max(i,Math.min(a,p[0]));return c}function w_(o,i,a){const c=[{fixed:-1,stretch:0}];for(const[p,_]of o){const x=c[c.length-1];c.push({fixed:p-x.stretch,stretch:x.stretch}),c.push({fixed:p-x.stretch,stretch:x.stretch+(_-p)})}return c.push({fixed:i+1,stretch:a}),c}function um(o,i,a,c){return o/i*a+c}function dm(o,i,a,c){return o-i*a/c}function M_(o,i,a,c){const p=i+o.positionedLines[c].lineOffset;return 0===c?a+p/2:a+(p+(i+o.positionedLines[c-1].lineOffset))/2}vs.loadGlyphRange=function(o,i,a,c,p){const _=256*i,x=_+255,w=c.transformRequest(c.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${_}-${x}`),se.Glyphs);fe(w,(E,P)=>{if(E)p(E);else if(P){const R={},z=new hh(P).readFields(Ef,{});for(const B of z.glyphs)R[B.id]=B;p(null,{glyphs:R,ascender:z.ascender,descender:z.descender})}})},vs.TinySDF=class{constructor({fontSize:o=24,buffer:i=3,radius:a=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:x="normal"}){this.buffer=i,this.cutoff=c,this.radius=a;const w=this.size=o+4*i,E=this._createCanvas(w),P=this.ctx=E.getContext("2d",{willReadFrequently:!0});P.font=`${x} ${_} ${o}px ${p}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(o){const i=document.createElement("canvas");return i.width=i.height=o,i}draw(o){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(o),x=Math.floor(a),w=Math.min(this.size-this.buffer,Math.ceil(_-p)),E=Math.min(this.size-this.buffer,Math.ceil(a)+Math.ceil(c)),P=w+2*this.buffer,R=E+2*this.buffer,z=P*R,B=new Uint8ClampedArray(z),H={data:B,width:P,height:R,glyphWidth:w,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:i};if(0===w||0===E)return H;const{ctx:$,buffer:K,gridInner:ne,gridOuter:le}=this;$.clearRect(K,K,w,E),$.fillText(o,K,K+x+1);const be=$.getImageData(K,K,w,E);le.fill(qd,0,z),ne.fill(0,0,z);for(let Se=0;Se<E;Se++)for(let De=0;De<w;De++){const Re=be.data[4*(Se*w+De)+3]/255;if(0===Re)continue;const ke=(Se+K)*P+De+K;if(1===Re)le[ke]=0,ne[ke]=qd;else{const qe=.5-Re;le[ke]=qe>0?qe*qe:0,ne[ke]=qe<0?qe*qe:0}}Pl(le,0,0,P,R,P,this.f,this.v,this.z),Pl(ne,K,K,w,E,P,this.f,this.v,this.z);for(let Se=0;Se<z;Se++){const De=Math.sqrt(le[Se])-Math.sqrt(ne[Se]);B[Se]=Math.round(255-255*(De/this.radius+this.cutoff))}return H}};class Vy{constructor(i=[],a=Bf){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:c}=this,p=a[i];for(;i>0;){const _=i-1>>1,x=a[_];if(c(p,x)>=0)break;a[i]=x,i=_}a[i]=p}_down(i){const{data:a,compare:c}=this,p=this.length>>1,_=a[i];for(;i<p;){let x=1+(i<<1),w=a[x];const E=x+1;if(E<this.length&&c(a[E],w)<0&&(x=E,w=a[E]),c(w,_)>=0)break;a[i]=w,i=x}a[i]=_}}function Bf(o,i){return o<i?-1:o>i?1:0}function S_(o,i=1,a=!1){let c=1/0,p=1/0,_=-1/0,x=-1/0;const w=o[0];for(let H=0;H<w.length;H++){const $=w[H];(!H||$.x<c)&&(c=$.x),(!H||$.y<p)&&(p=$.y),(!H||$.x>_)&&(_=$.x),(!H||$.y>x)&&(x=$.y)}const E=Math.min(_-c,x-p);let P=E/2;const R=new Vy([],T_);if(0===E)return new ct(c,p);for(let H=c;H<_;H+=E)for(let $=p;$<x;$+=E)R.push(new Su(H+P,$+P,P,o));let z=function(H){let $=0,K=0,ne=0;const le=H[0];for(let be=0,Se=le.length,De=Se-1;be<Se;De=be++){const Re=le[be],ke=le[De],qe=Re.x*ke.y-ke.x*Re.y;K+=(Re.x+ke.x)*qe,ne+=(Re.y+ke.y)*qe,$+=3*qe}return new Su(K/$,ne/$,0,H)}(o),B=R.length;for(;R.length;){const H=R.pop();(H.d>z.d||!z.d)&&(z=H,a&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,B)),H.max-z.d<=i||(P=H.h/2,R.push(new Su(H.p.x-P,H.p.y-P,P,o)),R.push(new Su(H.p.x+P,H.p.y-P,P,o)),R.push(new Su(H.p.x-P,H.p.y+P,P,o)),R.push(new Su(H.p.x+P,H.p.y+P,P,o)),B+=4)}return a&&(console.log(`num probes: ${B}`),console.log(`best distance: ${z.d}`)),z.p}function T_(o,i){return i.max-o.max}function Su(o,i,a,c){this.p=new ct(o,i),this.h=a,this.d=function(p,_){let x=!1,w=1/0;for(let E=0;E<_.length;E++){const P=_[E];for(let R=0,z=P.length,B=z-1;R<z;B=R++){const H=P[R],$=P[B];H.y>p.y!=$.y>p.y&&p.x<($.x-H.x)*(p.y-H.y)/($.y-H.y)+H.x&&(x=!x),w=Math.min(w,ef(p,H,$))}}return(x?1:-1)*Math.sqrt(w)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const pm=Number.POSITIVE_INFINITY,Xd=Math.sqrt(2);function E_(o,i){return i[1]!==pm?function(a,c,p){let _=0,x=0;switch(c=Math.abs(c),p=Math.abs(p),a){case"top-right":case"top-left":case"top":x=p-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-p}switch(a){case"top-right":case"bottom-right":case"right":_=-c;break;case"top-left":case"bottom-left":case"left":_=c}return[_,x]}(o,i[0],i[1]):function(a,c){let p=0,_=0;c<0&&(c=0);const x=c/Xd;switch(a){case"top-right":case"top-left":_=x-7;break;case"bottom-right":case"bottom-left":_=7-x;break;case"bottom":_=7-c;break;case"top":_=c-7}switch(a){case"top-right":case"bottom-right":p=-x;break;case"top-left":case"bottom-left":p=x;break;case"left":p=c;break;case"right":p=-c}return[p,_]}(o,i[0])}function Yd(o,i,a,c,p,_,x,w,E,P){o.createArrays(),o.tilePixelRatio=hi/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const R=o.layers[0].layout,z=o.layers[0]._unevaluatedLayout._values,B={};if("composite"===o.textSizeData.kind){const{minZoom:K,maxZoom:ne}=o.textSizeData;B.compositeTextSizes=[z["text-size"].possiblyEvaluate(new ln(K),w),z["text-size"].possiblyEvaluate(new ln(ne),w)]}if("composite"===o.iconSizeData.kind){const{minZoom:K,maxZoom:ne}=o.iconSizeData;B.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new ln(K),w),z["icon-size"].possiblyEvaluate(new ln(ne),w)]}B.layoutTextSize=z["text-size"].possiblyEvaluate(new ln(E+1),w),B.layoutIconSize=z["icon-size"].possiblyEvaluate(new ln(E+1),w),B.textMaxSize=z["text-size"].possiblyEvaluate(new ln(18),w);const H="map"===R.get("text-rotation-alignment")&&"point"!==R.get("symbol-placement"),$=R.get("text-size");for(const K of o.features){const ne=R.get("text-font").evaluate(K,{},w).join(","),le=$.evaluate(K,{},w),be=B.layoutTextSize.evaluate(K,{},w),Se=(B.layoutIconSize.evaluate(K,{},w),{horizontal:{},vertical:void 0}),De=K.text;let Re,ke=[0,0];if(De){const Je=De.toString(),ht=24*R.get("text-letter-spacing").evaluate(K,{},w),We=24*R.get("text-line-height").evaluate(K,{},w),Qe=iu(Je)?ht:0,gt=R.get("text-anchor").evaluate(K,{},w),xt=R.get("text-variable-anchor");if(!xt){const mi=R.get("text-radial-offset").evaluate(K,{},w);ke=mi?E_(gt,[24*mi,pm]):R.get("text-offset").evaluate(K,{},w).map(Gt=>24*Gt)}let vt=H?"center":R.get("text-justify").evaluate(K,{},w);const bt=R.get("symbol-placement"),ai="point"===bt,xi="point"===bt?24*R.get("text-max-width").evaluate(K,{},w):0,ci=mi=>{o.allowVerticalPlacement&&$c(Je)&&(Se.vertical=am(De,i,a,p,ne,xi,We,gt,mi,Qe,ke,mn.vertical,!0,bt,be,le))};if(!H&&xt){const mi="auto"===vt?xt.map(kt=>ph(kt)):[vt];let Gt=!1;for(let kt=0;kt<mi.length;kt++){const Si=mi[kt];if(!Se.horizontal[Si])if(Gt)Se.horizontal[Si]=Se.horizontal[0];else{const Bi=am(De,i,a,p,ne,xi,We,"center",Si,Qe,ke,mn.horizontal,!1,bt,be,le);Bi&&(Se.horizontal[Si]=Bi,Gt=1===Bi.positionedLines.length)}}ci("left")}else{if("auto"===vt&&(vt=ph(gt)),ai||R.get("text-writing-mode").indexOf("horizontal")>=0||!$c(Je)){const mi=am(De,i,a,p,ne,xi,We,gt,vt,Qe,ke,mn.horizontal,!1,bt,be,le);mi&&(Se.horizontal[vt]=mi)}ci("point"===bt?"left":vt)}}let qe=!1;if(K.icon&&K.icon.name){const Je=c[K.icon.name];Je&&(Re=x_(p[K.icon.name],R.get("icon-offset").evaluate(K,{},w),R.get("icon-anchor").evaluate(K,{},w)),qe=Je.sdf,void 0===o.sdfIcons?o.sdfIcons=Je.sdf:o.sdfIcons!==Je.sdf&&nn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Je.pixelRatio!==o.pixelRatio||0!==R.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const $e=fm(Se.horizontal)||Se.vertical;o.iconsInText||(o.iconsInText=!!$e&&$e.iconsInText),($e||Re)&&mm(o,K,Se,Re,c,B,be,0,ke,qe,x,w,P)}_&&o.generateCollisionDebugBuffers(E,o.collisionBoxArray)}function ph(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mm(o,i,a,c,p,_,x,w,E,P,R,z,B){let H=_.textMaxSize.evaluate(i,{},z);void 0===H&&(H=x);const $=o.layers[0].layout,K=$.get("icon-offset").evaluate(i,{},z),ne=fm(a.horizontal)||a.vertical,le=x/24,be=o.tilePixelRatio*H/24,Se=(We=o.overscaling,o.zoom>18&&We>2&&(We>>=1),Math.max(hi/(512*We),1)*$.get("symbol-spacing")),De=$.get("text-padding")*o.tilePixelRatio,Re=$.get("icon-padding")*o.tilePixelRatio,ke=Ai($.get("text-max-angle")),qe="map"===$.get("text-rotation-alignment")&&"point"!==$.get("symbol-placement"),$e="map"===$.get("icon-rotation-alignment")&&"point"!==$.get("symbol-placement"),Je=$.get("symbol-placement"),ht=Se/2;var We;const Qe=$.get("icon-text-fit");let gt;c&&"none"!==Qe&&(o.allowVerticalPlacement&&a.vertical&&(gt=Lf(c,a.vertical,Qe,$.get("icon-text-fit-padding"),K,le)),ne&&(c=Lf(c,ne,Qe,$.get("icon-text-fit-padding"),K,le)));const xt=(vt,bt,ai)=>{if(bt.x<0||bt.x>=hi||bt.y<0||bt.y>=hi)return;const{x:xi,y:ci,z:mi}=B.projectTilePoint(bt.x,bt.y,ai),Gt=new rr(xi,ci,mi,0,void 0);!function(kt,Si,Bi,Wn,qi,Zn,Fi,Ei,Xi,xn,En,qn,Kn,Qn,is,Ki,Gr,Ws,Cn,er,Qi,en,Sr,Tr,zn){const Er=kt.addToLineVertexArray(Si,Wn);let sr,tr,ao,Ll,Ou,Na,op,On=0,og=0,Dm=0,N_=0,Bu=-1,ag=-1;const Va={};let vh=es(""),lg=0,Lm=0;if(void 0===Xi._unevaluatedLayout.getValue("text-radial-offset")?[lg,Lm]=Xi.layout.get("text-offset").evaluate(Qi,{},zn).map(ns=>24*ns):(lg=24*Xi.layout.get("text-radial-offset").evaluate(Qi,{},zn),Lm=pm),kt.allowVerticalPlacement&&qi.vertical){const ns=qi.vertical;if(is)Na=Ff(ns),Ei&&(op=Ff(Ei));else{const Ms=Xi.layout.get("text-rotate").evaluate(Qi,{},zn)+90;ao=gm(xn,Bi,Si,En,qn,Kn,ns,Qn,Ms,Ki),Ei&&(Ll=gm(xn,Bi,Si,En,qn,Kn,Ei,Ws,Ms))}}if(Zn){const ns=Xi.layout.get("icon-rotate").evaluate(Qi,{},zn),Ms="none"!==Xi.layout.get("icon-text-fit"),Fu=Of(Zn,ns,Sr,Ms),Rm=Ei?Of(Ei,ns,Sr,Ms):void 0;tr=gm(xn,Bi,Si,En,qn,Kn,Zn,Ws,ns),On=4*Fu.length;const cg=kt.iconSizeData;let xc=null;"source"===cg.kind?(xc=[Vs*Xi.layout.get("icon-size").evaluate(Qi,{},zn)],xc[0]>oa&&nn(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===cg.kind&&(xc=[Vs*en.compositeIconSizes[0].evaluate(Qi,{},zn),Vs*en.compositeIconSizes[1].evaluate(Qi,{},zn)],(xc[0]>oa||xc[1]>oa)&&nn(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),kt.addSymbols(kt.icon,Fu,xc,er,Cn,Qi,!1,Bi,Si,Er.lineStartIndex,Er.lineLength,-1,Tr,zn),Bu=kt.icon.placedSymbolArray.length-1,Rm&&(og=4*Rm.length,kt.addSymbols(kt.icon,Rm,xc,er,Cn,Qi,mn.vertical,Bi,Si,Er.lineStartIndex,Er.lineLength,-1,Tr,zn),ag=kt.icon.placedSymbolArray.length-1)}for(const ns in qi.horizontal){const Ms=qi.horizontal[ns];sr||(vh=es(Ms.text),is?Ou=Ff(Ms):sr=gm(xn,Bi,Si,En,qn,Kn,Ms,Qn,Xi.layout.get("text-rotate").evaluate(Qi,{},zn),Ki));const Fu=1===Ms.positionedLines.length;if(Dm+=Tu(kt,Bi,Si,Ms,Fi,Xi,is,Qi,Ki,Er,qi.vertical?mn.horizontal:mn.horizontalOnly,Fu?Object.keys(qi.horizontal):[ns],Va,Bu,en,Tr,zn),Fu)break}qi.vertical&&(N_+=Tu(kt,Bi,Si,qi.vertical,Fi,Xi,is,Qi,Ki,Er,mn.vertical,["vertical"],Va,ag,en,Tr,zn));let Ga=-1;const ap=(ns,Ms)=>ns?Math.max(ns,Ms):Ms;Ga=ap(Ou,Ga),Ga=ap(Na,Ga),Ga=ap(op,Ga);const V_=Ga>-1?1:0;kt.glyphOffsetArray.length>=Il.MAX_GLYPHS&&nn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Qi.sortKey&&kt.addToSortKeyRanges(kt.symbolInstances.length,Qi.sortKey),kt.symbolInstances.emplaceBack(Bi.x,Bi.y,Bi.z,Si.x,Si.y,Va.right>=0?Va.right:-1,Va.center>=0?Va.center:-1,Va.left>=0?Va.left:-1,Va.vertical>=0?Va.vertical:-1,Bu,ag,vh,void 0!==sr?sr:kt.collisionBoxArray.length,void 0!==sr?sr+1:kt.collisionBoxArray.length,void 0!==ao?ao:kt.collisionBoxArray.length,void 0!==ao?ao+1:kt.collisionBoxArray.length,void 0!==tr?tr:kt.collisionBoxArray.length,void 0!==tr?tr+1:kt.collisionBoxArray.length,Ll||kt.collisionBoxArray.length,Ll?Ll+1:kt.collisionBoxArray.length,En,Dm,N_,On,og,V_,0,lg,Lm,Ga)}(o,bt,Gt,vt,a,c,p,gt,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,De,qe,E,0,Re,$e,K,i,_,P,R,z)};if("line"===Je)for(const vt of zf(i.geometry,0,0,hi,hi)){const bt=Ny(vt,Se,ke,a.vertical||ne,c,24,be,o.overscaling,hi);for(const ai of bt){const xi=ne;xi&&Gy(o,xi.text,ht,ai)||xt(vt,ai,z)}}else if("line-center"===Je){for(const vt of i.geometry)if(vt.length>1){const bt=Uy(vt,ke,a.vertical||ne,c,24,be);bt&&xt(vt,bt,z)}}else if("Polygon"===i.type)for(const vt of nm(i.geometry,0)){const bt=S_(vt,16);xt(vt[0],new rr(bt.x,bt.y,0,0,void 0),z)}else if("LineString"===i.type)for(const vt of i.geometry)xt(vt,new rr(vt[0].x,vt[0].y,0,0,void 0),z);else if("Point"===i.type)for(const vt of i.geometry)for(const bt of vt)xt([bt],new rr(bt.x,bt.y,0,0,void 0),z)}const oa=32640;function Tu(o,i,a,c,p,_,x,w,E,P,R,z,B,H,$,K,ne){const le=function(De,Re,ke,qe,$e,Je,ht,We){const Qe=[];if(0===Re.positionedLines.length)return Qe;const gt=qe.layout.get("text-rotate").evaluate(Je,{})*Math.PI/180,xt=function(ci){const mi=ci[0],Gt=ci[1],kt=mi*Gt;return kt>0?[mi,-Gt]:kt<0?[-mi,Gt]:0===mi?[Gt,mi]:[Gt,-mi]}(ke);let vt=Math.abs(Re.top-Re.bottom);for(const ci of Re.positionedLines)vt-=ci.lineOffset;const bt=Re.positionedLines.length,ai=vt/bt;let xi=Re.top-ke[1];for(let ci=0;ci<bt;++ci){const mi=Re.positionedLines[ci];xi=M_(Re,ai,xi,ci);for(const Gt of mi.positionedGlyphs){if(!Gt.rect)continue;const kt=Gt.rect||{};let Si=4,Bi=!0,Wn=1,qi=0;if(Gt.imageName){const en=ht[Gt.imageName];if(!en)continue;if(en.sdf){nn("SDF images are not supported in formatted text and will be ignored.");continue}Bi=!1,Wn=en.pixelRatio,Si=1/Wn}const Zn=($e||We)&&Gt.vertical,Fi=Gt.metrics.advance*Gt.scale/2,Ei=Gt.metrics,Xi=Gt.rect;if(null===Xi)continue;We&&Re.verticalizable&&(qi=Gt.imageName?Fi-Gt.metrics.width*Gt.scale/2:0);const xn=$e?[Gt.x+Fi,Gt.y]:[0,0];let En=[0,0],qn=[0,0],Kn=!1;$e||(Zn?(qn=[Gt.x+Fi+xt[0],Gt.y+xt[1]-qi],Kn=!0):En=[Gt.x+Fi+ke[0],Gt.y+ke[1]-qi]);const Qn=Xi.w*Gt.scale/(Wn*(Gt.localGlyph?2:1)),is=Xi.h*Gt.scale/(Wn*(Gt.localGlyph?2:1));let Ki,Gr,Ws,Cn;if(Zn){const en=Gt.y-xi,Sr=new ct(-Fi,Fi-en),Tr=-Math.PI/2,zn=new ct(...qn);Ki=new ct(-Fi+En[0],En[1]),Ki._rotateAround(Tr,Sr)._add(zn),Ki.x+=-en+Fi,Ki.y-=(Ei.left-Si)*Gt.scale;const Er=Gt.imageName?Ei.advance*Gt.scale:24*Gt.scale,sr=String.fromCharCode(Gt.glyph);u_(sr)?Ki.x+=(1-Si)*Gt.scale:d_(sr)?Ki.x+=Er-Ei.height*Gt.scale+(-Si-1)*Gt.scale:Ki.x+=Gt.imageName||Ei.width+2*Si===Xi.w&&Ei.height+2*Si===Xi.h?(Er-is)/2:(Er-(Ei.height+2*Si)*Gt.scale)/2,Gr=new ct(Ki.x,Ki.y-Qn),Ws=new ct(Ki.x+is,Ki.y),Cn=new ct(Ki.x+is,Ki.y-Qn)}else{const en=(Ei.left-Si)*Gt.scale-Fi+En[0],Sr=(-Ei.top-Si)*Gt.scale+En[1],Tr=en+Qn,zn=Sr+is;Ki=new ct(en,Sr),Gr=new ct(Tr,Sr),Ws=new ct(en,zn),Cn=new ct(Tr,zn)}if(gt){let en;en=$e?new ct(0,0):Kn?new ct(xt[0],xt[1]):new ct(ke[0],ke[1]),Ki._rotateAround(gt,en),Gr._rotateAround(gt,en),Ws._rotateAround(gt,en),Cn._rotateAround(gt,en)}const er=new ct(0,0),Qi=new ct(0,0);Qe.push({tl:Ki,tr:Gr,bl:Ws,br:Cn,tex:kt,writingMode:Re.writingMode,glyphOffset:xn,sectionIndex:Gt.sectionIndex,isSDF:Bi,pixelOffsetTL:er,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,c,E,_,x,w,p,o.allowVerticalPlacement),be=o.textSizeData;let Se=null;"source"===be.kind?(Se=[Vs*_.layout.get("text-size").evaluate(w,{},ne)],Se[0]>oa&&nn(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===be.kind&&(Se=[Vs*$.compositeTextSizes[0].evaluate(w,{},ne),Vs*$.compositeTextSizes[1].evaluate(w,{},ne)],(Se[0]>oa||Se[1]>oa)&&nn(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,le,Se,E,x,w,R,i,a,P.lineStartIndex,P.lineLength,H,K,ne);for(const De of z)B[De]=o.text.placedSymbolArray.length-1;return 4*le.length}function fm(o){for(const i in o)return o[i];return null}function gm(o,i,a,c,p,_,x,w,E,P){let R=x.top,z=x.bottom,B=x.left,H=x.right;const $=x.collisionPadding;if($&&(B-=$[0],R-=$[1],H+=$[2],z+=$[3]),E){const K=new ct(B,R),ne=new ct(H,R),le=new ct(B,z),be=new ct(H,z),Se=Ai(E);let De=new ct(0,0);P&&(De=new ct(P[0],P[1])),K._rotateAround(Se,De),ne._rotateAround(Se,De),le._rotateAround(Se,De),be._rotateAround(Se,De),B=Math.min(K.x,ne.x,le.x,be.x),H=Math.max(K.x,ne.x,le.x,be.x),R=Math.min(K.y,ne.y,le.y,be.y),z=Math.max(K.y,ne.y,le.y,be.y)}return o.emplaceBack(i.x,i.y,i.z,a.x,a.y,B,R,H,z,w,c,p,_),o.length-1}function Ff(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const i=o.bottom-o.top;return i>0?Math.max(10,i):null}function Gy(o,i,a,c){const p=o.compareText;if(i in p){const _=p[i];for(let x=_.length-1;x>=0;x--)if(c.dist(_[x])<a)return!0}else p[i]=[];return p[i].push(c),!1}const C_=ch.VectorTileFeature.types,_m=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jd(o,i,a,c,p,_,x,w,E,P,R,z,B,H,$,K){const ne=R?Math.min(oa,Math.round(R[0])):0,le=R?Math.min(oa,Math.round(R[1])):0;o.emplaceBack(i,a,Math.round(32*x),Math.round(32*w),E,P,(ne<<1)+(z?1:0),le,16*B,16*H,256*$,256*K,c,p,_,0)}function Eu(o,i,a){o.emplaceBack(i.x,i.y,a),o.emplaceBack(i.x,i.y,a),o.emplaceBack(i.x,i.y,a),o.emplaceBack(i.x,i.y,a)}function A_(o){for(const i of o.sections)if(Bp(i.text))return!0;return!1}class Uf{constructor(i){this.layoutVertexArray=new Xe,this.indexArray=new je,this.programConfigurations=i,this.segments=new yn,this.dynamicLayoutVertexArray=new xe,this.opacityVertexArray=new St,this.placedSymbolArray=new Mo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,a,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,yf.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,bu.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,_m,!0),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Bt(Uf);class Nf{constructor(i,a,c){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new c,this.segments=new yn,this.collisionVertexArray=new Tt,this.collisionVertexArrayExt=new xe}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Ry.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,ky.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(Nf);class Il{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=na([]),this.placementViewportMatrix=na([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tl(this.zoom,a["text-size"]),this.iconSizeData=Tl(this.zoom,a["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(x=>mn[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new Uf(new Ia(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Uf(new Ia(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Oi,this.lineVertexArray=new kn,this.symbolInstances=new Rn}calculateGlyphDependencies(i,a,c,p,_){for(let x=0;x<i.length;x++)if(a[i.charCodeAt(x)]=!0,p&&_){const w=Gd[i.charAt(x)];w&&(a[w.charCodeAt(0)]=!0)}}populate(i,a,c,p){const _=this.layers[0],x=_.layout,w=x.get("text-font"),E=x.get("text-field"),P=x.get("icon-image"),R=("constant"!==E.value.kind||E.value.value instanceof cn&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==w.value.kind||w.value.value.length>0),z="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,B=x.get("symbol-sort-key");if(this.features=[],!R&&!z)return;const H=a.iconDependencies,$=a.glyphDependencies,K=a.availableImages,ne=new ln(this.zoom);for(const{feature:le,id:be,index:Se,sourceLayerIndex:De}of i){const Re=_._featureFilter.needGeometry,ke=eh(le,Re);if(!_._featureFilter.filter(ne,ke,c))continue;let qe,$e;if(Re||(ke.geometry=yl(le,c,p)),R){const ht=_.getValueAndResolveTokens("text-field",ke,c,K),We=cn.factory(ht);A_(We)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===su()||this.hasRTLText&&Bs.isParsed())&&(qe=vf(We,_,ke))}if(z){const ht=_.getValueAndResolveTokens("icon-image",ke,c,K);$e=ht instanceof Ar?ht:Ar.fromString(ht)}if(!qe&&!$e)continue;const Je=this.sortFeaturesByKey?B.evaluate(ke,{},c):void 0;if(this.features.push({id:be,text:qe,icon:$e,index:Se,sourceLayerIndex:De,geometry:ke.geometry,properties:le.properties,type:C_[le.type],sortKey:Je}),$e&&(H[$e.name]=!0),qe){const ht=w.evaluate(ke,{},c).join(","),We="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(mn.vertical)>=0;for(const Qe of qe.sections)if(Qe.image)H[Qe.image.name]=!0;else{const gt=$c(qe.toString()),xt=Qe.fontStack||ht,vt=$[xt]=$[xt]||{};this.calculateGlyphDependencies(Qe.text,vt,We,this.allowVerticalPlacement,gt)}}}"line"===x.get("symbol-placement")&&(this.features=function(le){const be={},Se={},De=[];let Re=0;function ke(ht){De.push(le[ht]),Re++}function qe(ht,We,Qe){const gt=Se[ht];return delete Se[ht],Se[We]=gt,De[gt].geometry[0].pop(),De[gt].geometry[0]=De[gt].geometry[0].concat(Qe[0]),gt}function $e(ht,We,Qe){const gt=be[We];return delete be[We],be[ht]=gt,De[gt].geometry[0].shift(),De[gt].geometry[0]=Qe[0].concat(De[gt].geometry[0]),gt}function Je(ht,We,Qe){const gt=Qe?We[0][We[0].length-1]:We[0][0];return`${ht}:${gt.x}:${gt.y}`}for(let ht=0;ht<le.length;ht++){const We=le[ht],Qe=We.geometry,gt=We.text?We.text.toString():null;if(!gt){ke(ht);continue}const xt=Je(gt,Qe),vt=Je(gt,Qe,!0);if(xt in Se&&vt in be&&Se[xt]!==be[vt]){const bt=$e(xt,vt,Qe),ai=qe(xt,vt,De[bt].geometry);delete be[xt],delete Se[vt],Se[Je(gt,De[ai].geometry,!0)]=ai,De[bt].geometry=null}else xt in Se?qe(xt,vt,Qe):vt in be?$e(xt,vt,Qe):(ke(ht),be[xt]=Re-1,Se[vt]=Re-1)}return De.filter(ht=>ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,be)=>le.sortKey-be.sortKey)}update(i,a,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,a,this.layers,c,p),this.icon.programConfigurations.updatePaintArrays(i,a,this.layers,c,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const c=this.lineVertexArray.length,p=i.segment;if(void 0!==p){let _=i.dist(a[p+1]),x=i.dist(a[p]);const w={};for(let E=p+1;E<a.length;E++)w[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:_},E<a.length-1&&(_+=a[E+1].dist(a[E]));for(let E=p||0;E>=0;E--)w[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:x},E>0&&(x+=a[E-1].dist(a[E]));for(let E=0;E<a.length;E++){const P=w[E];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(i,a,c,p,_,x,w,E,P,R,z,B,H,$){const K=i.indexArray,ne=i.layoutVertexArray,le=i.segments.prepareSegment(4*a.length,ne,K,this.canOverlap?x.sortKey:void 0),be=this.glyphOffsetArray.length,Se=le.vertexLength,De=this.allowVerticalPlacement&&w===mn.vertical?Math.PI/2:0,Re=x.text&&x.text.sections;for(let ke=0;ke<a.length;ke++){const{tl:qe,tr:$e,bl:Je,br:ht,tex:We,pixelOffsetTL:Qe,pixelOffsetBR:gt,minFontScaleX:xt,minFontScaleY:vt,glyphOffset:bt,isSDF:ai,sectionIndex:xi}=a[ke],ci=le.vertexLength,mi=bt[1];Jd(ne,E.x,E.y,E.z,P.x,P.y,qe.x,mi+qe.y,We.x,We.y,c,ai,Qe.x,Qe.y,xt,vt),Jd(ne,E.x,E.y,E.z,P.x,P.y,$e.x,mi+$e.y,We.x+We.w,We.y,c,ai,gt.x,Qe.y,xt,vt),Jd(ne,E.x,E.y,E.z,P.x,P.y,Je.x,mi+Je.y,We.x,We.y+We.h,c,ai,Qe.x,gt.y,xt,vt),Jd(ne,E.x,E.y,E.z,P.x,P.y,ht.x,mi+ht.y,We.x+We.w,We.y+We.h,c,ai,gt.x,gt.y,xt,vt),Eu(i.dynamicLayoutVertexArray,E,De),K.emplaceBack(ci,ci+1,ci+2),K.emplaceBack(ci+1,ci+2,ci+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bt[0]),ke!==a.length-1&&xi===a[ke+1].sectionIndex||i.programConfigurations.populatePaintArrays(ne.length,x,x.index,{},H,$,Re&&Re[xi])}i.placedSymbolArray.emplaceBack(E.x,E.y,E.z,P.x,P.y,be,this.glyphOffsetArray.length-be,Se,R,z,P.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],w,0,!1,0,B,0)}_commitLayoutVertex(i,a,c,p,_,x,w){i.emplaceBack(a,c,p,_,x,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(i,a,c,p,_,x,w){const E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),P=E.vertexLength,R=w.tileAnchorX,z=w.tileAnchorY;for(let H=0;H<4;H++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(a,-i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(a,i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(a,i.padding,i.padding),c.collisionVertexArrayExt.emplaceBack(a,-i.padding,i.padding),this._commitLayoutVertex(c.layoutVertexArray,p,_,x,R,z,new ct(i.x1,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,_,x,R,z,new ct(i.x2,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,_,x,R,z,new ct(i.x2,i.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,_,x,R,z,new ct(i.x1,i.y2)),E.vertexLength+=4;const B=c.indexArray;B.emplaceBack(P,P+1),B.emplaceBack(P+1,P+2),B.emplaceBack(P+2,P+3),B.emplaceBack(P+3,P),E.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,c,p,_,x){for(let w=p;w<_;w++){const E=c.get(w),P=this.getSymbolInstanceTextSize(i,x,a,w);this._addCollisionDebugVertices(E,P,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(i,a,c,p,_,x){for(let w=p;w<_;w++){const E=c.get(w),P=this.getSymbolInstanceIconSize(i,a,w);this._addCollisionDebugVertices(E,P,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,x)}}generateCollisionDebugBuffers(i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Nf(mt,c_.members,Vt),this.iconCollisionBox=new Nf(mt,c_.members,Vt);const c=wu(this.iconSizeData,i),p=wu(this.textSizeData,i);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(p,i,a,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(p,i,a,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,i,a,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,i,a,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(i,a,c,p){const _=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:p),x=om(this.textSizeData,i,_)/24;return this.tilePixelRatio*x}getSymbolInstanceIconSize(i,a,c){const p=this.icon.placedSymbolArray.get(c),_=om(this.iconSizeData,i,p);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(i,a,c){i.emplaceBack(a,-c,-c),i.emplaceBack(a,c,-c),i.emplaceBack(a,c,c),i.emplaceBack(a,-c,c)}_updateTextDebugCollisionBoxes(i,a,c,p,_,x){for(let w=p;w<_;w++){const E=c.get(w),P=this.getSymbolInstanceTextSize(i,x,a,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,E.padding)}}_updateIconDebugCollisionBoxes(i,a,c,p,_){for(let x=p;x<_;x++){const w=c.get(x),E=this.getSymbolInstanceIconSize(i,a,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(i,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=wu(this.iconSizeData,i),p=wu(this.textSizeData,i);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(p,i,a,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(p,i,a,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(c,i,a,x.iconBoxStartIndex,x.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,i,a,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,c,p,_,x,w,E,P){const R={};for(let z=a;z<c;z++){const B=i.get(z);R.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},R.textFeatureIndex=B.featureIndex;break}for(let z=p;z<_;z++){const B=i.get(z);R.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},R.verticalTextFeatureIndex=B.featureIndex;break}for(let z=x;z<w;z++){const B=i.get(z);R.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},R.iconFeatureIndex=B.featureIndex;break}for(let z=E;z<P;z++){const B=i.get(z);R.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},R.verticalIconFeatureIndex=B.featureIndex;break}return R}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const c=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,a){const c=i.placedSymbolArray.get(a),p=c.vertexStartIndex+4*c.numGlyphs;for(let _=c.vertexStartIndex;_<p;_+=4)i.indexArray.emplaceBack(_,_+1,_+2),i.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(i),c=Math.cos(i),p=[],_=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const E=this.symbolInstances.get(w);p.push(0|Math.round(a*E.tileAnchorX+c*E.tileAnchorY)),_.push(E.featureIndex)}return x.sort((w,E)=>p[w]-p[E]||_[E]-_[w]),x}addToSortKeyRanges(i,a){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===a?c.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const c=this.symbolInstances.get(a);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((p,_,x)=>{p>=0&&x.indexOf(p)===_&&this.addIndicesForPlacedSymbol(this.text,p)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt(Il,{omit:["layers","collisionBoxArray","features","compareText"]}),Il.MAX_GLYPHS=65535,Il.addDynamicAttributes=Eu;const Hy=new q({"symbol-placement":new A(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new A(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new A(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new L(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new A(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new A(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new A(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new A(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new A(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new L(Fe.layout_symbol["icon-size"]),"icon-text-fit":new A(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new A(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new L(Fe.layout_symbol["icon-image"]),"icon-rotate":new L(Fe.layout_symbol["icon-rotate"]),"icon-padding":new A(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new A(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new L(Fe.layout_symbol["icon-offset"]),"icon-anchor":new L(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new A(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new A(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new A(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new L(Fe.layout_symbol["text-field"]),"text-font":new L(Fe.layout_symbol["text-font"]),"text-size":new L(Fe.layout_symbol["text-size"]),"text-max-width":new L(Fe.layout_symbol["text-max-width"]),"text-line-height":new L(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new L(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new L(Fe.layout_symbol["text-justify"]),"text-radial-offset":new L(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new A(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new L(Fe.layout_symbol["text-anchor"]),"text-max-angle":new A(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new A(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new L(Fe.layout_symbol["text-rotate"]),"text-padding":new A(Fe.layout_symbol["text-padding"]),"text-keep-upright":new A(Fe.layout_symbol["text-keep-upright"]),"text-transform":new L(Fe.layout_symbol["text-transform"]),"text-offset":new L(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new A(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new A(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new A(Fe.layout_symbol["text-optional"])});var Cu={paint:new q({"icon-opacity":new L(Fe.paint_symbol["icon-opacity"]),"icon-color":new L(Fe.paint_symbol["icon-color"]),"icon-halo-color":new L(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new L(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new L(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new A(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new A(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new L(Fe.paint_symbol["text-opacity"]),"text-color":new L(Fe.paint_symbol["text-color"],{runtimeType:Is,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new L(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new L(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new L(Fe.paint_symbol["text-halo-blur"]),"text-translate":new A(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new A(Fe.paint_symbol["text-translate-anchor"])}),layout:Hy};class P_{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:mo,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(P_,{omit:["defaultValue"]});class ym extends Eo{constructor(i){super(i,Cu)}recalculate(i,a){super.recalculate(i,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const _ of c)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,a,c,p){const _=this.layout.get(i).evaluate(a,{},c,p),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||Dr(x.value)||!_?_:(w=a.properties,_.replace(/{([^{}]+)}/g,(P,R)=>R in w?String(w[R]):""));var w}createBucket(i){return new Il(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Cu.paint.overridableProperties){if(!ym.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),c=new P_(a),p=new Ht(c,a.property.specification);let _=null;_="constant"===a.value.kind||"source"===a.value.kind?new qu("source",p):new $u("composite",p,a.value.zoomStops,a.value._interpolationType),this.paint._values[i]=new M(a.property,_,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven())&&ym.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const c=i.get("text-field"),p=Cu.paint.properties[a];let _=!1;const x=w=>{for(const E of w)if(p.overrides&&p.overrides.hasOverride(E))return void(_=!0)};if("constant"===c.value.kind&&c.value.value instanceof cn)x(c.value.value.sections);else if("source"===c.value.kind){const w=P=>{_||(P instanceof eo&&In(P.value)===us?x(P.value.sections):P instanceof yr?x(P.sections):P.eachChild(w))},E=c.value;E._styleExpression&&w(E._styleExpression.expression)}return _}getProgramConfiguration(i){return new mr(this,i)}}var jy={paint:new q({"background-color":new A(Fe.paint_background["background-color"]),"background-pattern":new V(Fe.paint_background["background-pattern"]),"background-opacity":new A(Fe.paint_background["background-opacity"])})},Wy={paint:new q({"raster-opacity":new A(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new A(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new A(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new A(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new A(Fe.paint_raster["raster-saturation"]),"raster-contrast":new A(Fe.paint_raster["raster-contrast"]),"raster-resampling":new A(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new A(Fe.paint_raster["raster-fade-duration"])})};class Zy extends Eo{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var qy={paint:new q({"sky-type":new A(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new A(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new A(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new A(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new A(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new G(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new A(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new A(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new A(Fe.paint_sky["sky-opacity"])})};function vm(o,i,a){const c=[0,0,1],p=$g([]);return function(_,x,w){w*=.5;var E=x[0],P=x[1],R=x[2],z=x[3],B=Math.sin(w),H=Math.cos(w);_[0]=E*H-R*B,_[1]=P*H+z*B,_[2]=R*H+E*B,_[3]=z*H-P*B}(p,p,a?-Ai(o)+Math.PI:Ai(o)),Pd(p,p,-Ai(i)),ah(c,c,p),Ra(c,c)}const I_={circle:class extends Eo{constructor(o){super(o,jg)}createBucket(o){return new sc(o)}queryRadius(o){const i=o;return ih("circle-radius",this,i)+ih("circle-stroke-width",this,i)+Ed(this.paint.get("circle-translate"))}queryIntersectsFeature(o,i,a,c,p,_,x,w){const E=Hg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,o.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return rf(o,c,_,x,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,P)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new mr(this,o)}},heatmap:class extends Eo{createBucket(o){return new sf(o)}constructor(o){super(o,of),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return ih("heatmap-radius",this,o)}queryIntersectsFeature(o,i,a,c,p,_,x,w){const E=this.paint.get("heatmap-radius").evaluate(i,a);return rf(o,c,_,x,w,!0,!0,new ct(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new mr(this,o)}},hillshade:class extends Eo{constructor(o){super(o,em)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Eo{constructor(o){super(o,_y)}getProgramIds(){const o=this.paint.get("fill-pattern"),i=o&&o.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(o){return new mr(this,o)}recalculate(o,i){super.recalculate(o,i);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new rm(o)}queryRadius(){return Ed(this.paint.get("fill-translate"))}queryIntersectsFeature(o,i,a,c,p,_){return!o.queryGeometry.isAboveHorizon&&Td(nh(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Eo{constructor(o){super(o,Ey)}createBucket(o){return new Fd(o)}queryRadius(){return Ed(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new mr(this,o)}queryIntersectsFeature(o,i,a,c,p,_,x,w,E){const P=Hg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,o.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(i,a),z=this.paint.get("fill-extrusion-base").evaluate(i,a),B=[0,0],H=w&&_.elevation,$=_.elevation?_.elevation.exaggeration():1,K=o.tile.getBucket(this);if(H&&K instanceof Fd){const be=K.centroidVertexArray,Se=E+1;if(Se<be.length){const De=be.get(Se);B[0]=De.a_centroid_pos0,B[1]=De.a_centroid_pos1}}if(0===B[0]&&1===B[1])return!1;const ne=(be=c,Se=z,De=R,Re=P,ke=x,(qe=H?w:null)?function(We,Qe,gt,xt,vt,bt,ai,xi,ci){const mi=[],Gt=[],kt=[0,0,0,1];for(const Si of We){const Bi=[],Wn=[];for(const qi of Si){const Zn=qi.x+xt.x,Fi=qi.y+xt.y,Ei=Cy(Zn,Fi,Qe,gt,bt,ai,xi,ci);kt[0]=Zn,kt[1]=Fi,kt[2]=Ei.base,kt[3]=1,lc(kt,kt,vt),kt[3]=Math.max(kt[3],1e-5);const Xi=a_([kt[0]/kt[3],kt[1]/kt[3],kt[2]/kt[3]]);kt[0]=Zn,kt[1]=Fi,kt[2]=Ei.top,kt[3]=1,lc(kt,kt,vt),kt[3]=Math.max(kt[3],1e-5);const xn=a_([kt[0]/kt[3],kt[1]/kt[3],kt[2]/kt[3]]);Bi.push(Xi),Wn.push(xn)}mi.push(Bi),Gt.push(Wn)}return[mi,Gt]}(be,Se,De,Re,ke,qe,B,$,_.center.lat):function(We,Qe,gt,xt,vt){const bt=[],ai=[],xi=vt[8]*Qe,ci=vt[9]*Qe,mi=vt[10]*Qe,Gt=vt[11]*Qe,kt=vt[8]*gt,Si=vt[9]*gt,Bi=vt[10]*gt,Wn=vt[11]*gt;for(const qi of We){const Zn=[],Fi=[];for(const Ei of qi){const Xi=Ei.x+xt.x,xn=Ei.y+xt.y,En=vt[0]*Xi+vt[4]*xn+vt[12],qn=vt[1]*Xi+vt[5]*xn+vt[13],Kn=vt[2]*Xi+vt[6]*xn+vt[14],Qn=vt[3]*Xi+vt[7]*xn+vt[15],is=En+xi,Ki=qn+ci,Gr=Kn+mi,Ws=Math.max(Qn+Gt,1e-5),Cn=En+kt,er=qn+Si,Qi=Kn+Bi,en=Math.max(Qn+Wn,1e-5),Sr=new ct(is/Ws,Ki/Ws);Sr.z=Gr/Ws,Zn.push(Sr);const Tr=new ct(Cn/en,er/en);Tr.z=Qi/en,Fi.push(Tr)}bt.push(Zn),ai.push(Fi)}return[bt,ai]}(be,Se,De,Re,ke)),le=o.queryGeometry;var be,Se,De,Re,ke,qe;return function(be,Se,De){let Re=1/0;Td(De,Se)&&(Re=uc(De,Se[0]));for(let ke=0;ke<Se.length;ke++){const qe=Se[ke],$e=be[ke];for(let Je=0;Je<qe.length-1;Je++){const ht=qe[Je],We=[ht,qe[Je+1],$e[Je+1],$e[Je],ht];Vg(De,We)&&(Re=Math.min(Re,uc(De,We)))}}return Re!==1/0&&Re}(ne[0],ne[1],le.isPointQuery()?le.screenBounds:le.screenGeometry)}},line:class extends Eo{constructor(o){super(o,ff),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof rl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,i){super.recalculate(o,i),this.paint._values["line-floorwidth"]=gf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Nd(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new mr(this,o)}queryRadius(o){const i=o,a=_f(ih("line-width",this,i),ih("line-gap-width",this,i)),c=ih("line-offset",this,i);return a/2+Math.abs(c)+Ed(this.paint.get("line-translate"))}queryIntersectsFeature(o,i,a,c,p,_){if(o.queryGeometry.isAboveHorizon)return!1;const x=nh(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,o.pixelToTileUnitsFactor),w=o.pixelToTileUnitsFactor/2*_f(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),E=this.paint.get("line-offset").evaluate(i,a);return E&&(c=function(P,R){const z=[],B=new ct(0,0);for(let H=0;H<P.length;H++){const $=P[H],K=[];for(let ne=0;ne<$.length;ne++){const le=$[ne-1],be=$[ne],Se=$[ne+1],De=0===ne?B:be.sub(le)._unit()._perp(),Re=ne===$.length-1?B:Se.sub(be)._unit()._perp(),ke=De._add(Re)._unit();ke._mult(1/(ke.x*Re.x+ke.y*Re.y)),K.push(ke._mult(R)._add(be))}z.push(K)}return z}(c,E*o.pixelToTileUnitsFactor)),function(P,R,z){for(let B=0;B<R.length;B++){const H=R[B];if(P.length>=3)for(let $=0;$<H.length;$++)if(Da(P,H[$]))return!0;if(Gg(P,H,z))return!0}return!1}(x,c,w)}isTileClipped(){return!0}},symbol:ym,background:class extends Eo{constructor(o){super(o,jy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Eo{constructor(o){super(o,Wy)}getProgramIds(){return["raster"]}},sky:class extends Eo{constructor(o){super(o,qy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Qp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(o,i){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),p=!c,_=o.style.light,x=_.properties.get("position");return p&&"viewport"===_.properties.get("anchor")&&nn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?vm(x.azimuthal,90-x.polar,i):vm(c[0],90-c[1],i)}const a=this.paint.get("sky-gradient-center");return vm(a[0],90-a[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class pc{constructor(i,a,c,p){this.context=i,this.format=c,this.texture=i.gl.createTexture(),this.update(a,p)}update(i,a,c){const{width:p,height:_}=i,{context:x}=this,{gl:w}=x,{HTMLImageElement:E,HTMLCanvasElement:P,HTMLVideoElement:R,ImageData:z,ImageBitmap:B}=ti;if(w.bindTexture(w.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!a||!1!==a.premultiply)),c||this.size&&this.size[0]===p&&this.size[1]===_){const{x:H,y:$}=c||{x:0,y:0};i instanceof E||i instanceof P||i instanceof R||i instanceof z||B&&i instanceof B?w.texSubImage2D(w.TEXTURE_2D,0,H,$,w.RGBA,w.UNSIGNED_BYTE,i):w.texSubImage2D(w.TEXTURE_2D,0,H,$,p,_,w.RGBA,w.UNSIGNED_BYTE,i.data)}else this.size=[p,_],i instanceof E||i instanceof P||i instanceof R||i instanceof z||B&&i instanceof B?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,i):w.texImage2D(w.TEXTURE_2D,0,this.format,p,_,0,this.format,w.UNSIGNED_BYTE,i.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(i,a){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?i===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:i),this.filter=i),a!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Io{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new Ao({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const c=this.getKey(i,a);return this.positions[c]}trim(){const i=this.width,a=this.height=Ec(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,c){const p=[];let _=i.length%2==1?-i[i.length-1]*c:0,x=i[0]*c,w=!0;p.push({left:_,right:x,isDash:w,zeroLength:0===i[0]});let E=i[0];for(let P=1;P<i.length;P++){w=!w;const R=i[P];_=E*c,E+=R,x=E*c,p.push({left:_,right:x,isDash:w,zeroLength:0===R})}return p}addRoundDash(i,a,c){const p=a/2;for(let _=-c;_<=c;_++){const x=this.width*(this.nextRow+c+_);let w=0,E=i[w];for(let P=0;P<this.width;P++){P/E.right>1&&(E=i[++w]);const R=Math.abs(P-E.left),z=Math.abs(P-E.right),B=Math.min(R,z);let H;const $=_/c*(p+1);if(E.isDash){const K=p-Math.abs($);H=Math.sqrt(B*B+K*K)}else H=p-Math.sqrt(B*B+$*$);this.image.data[x+P]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(i,a){for(let E=i.length-1;E>=0;--E){const P=i[E],R=i[E+1];P.zeroLength?i.splice(E,1):R&&R.isDash===P.isDash&&(R.left=P.left,i.splice(E,1))}const c=i[0],p=i[i.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const _=this.width*this.nextRow;let x=0,w=i[x];for(let E=0;E<this.width;E++){E/w.right>1&&(w=i[++x]);const P=Math.abs(E-w.left),R=Math.abs(E-w.right),z=Math.min(P,R);this.image.data[_+E]=Math.max(0,Math.min(255,(w.isDash?z:-z)+a+128))}}addDash(i,a){const c=this.getKey(i,a);if(this.positions[c])return this.positions[c];const p="round"===a,_=p?7:0,x=2*_+1;if(this.nextRow+x>this.height)return nn("LineAtlas out of space"),null;0===i.length&&i.push(1);let w=0;for(let R=0;R<i.length;R++)i[R]<0&&(nn("Negative value is found in line dasharray, replacing values with 0"),i[R]=0),w+=i[R];if(0!==w){const R=this.width/w,z=this.getDashRanges(i,this.width,R);p?this.addRoundDash(z,R,_):this.addRegularDash(z,"square"===a?.5*R:0)}const E=this.nextRow+_;this.nextRow+=x;const P={tl:[E,_],br:[w,0]};return this.positions[c]=P,P}}Bt(Io);class xm{constructor(i){this._callback=i,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const $y=ti.performance;function D_(o){const i=o?o.url.toString():void 0;return $y.getEntriesByName(i)}class L_{constructor(){this.tasks={},this.taskQueue=[],$a(["process"],this),this.invoker=new xm(this.process),this.nextId=0}add(i,a){const c=this.nextId++,p=function({type:_,isSymbolTile:x,zoom:w}){return w=w||0,"message"===_?0:"maybePrepare"!==_||x?"parseTile"!==_||x?"parseTile"===_&&x?300-w:"maybePrepare"===_&&x?400-w:500:200-w:100-w}(a);if(0===p){Ys();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:i,metadata:a,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){Ys();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let p=0;p<this.taskQueue.length;p++){const _=this.tasks[this.taskQueue[p]];_.priority<a&&(a=_.priority,i=p)}if(null===i)return null;const c=this.taskQueue[i];return this.taskQueue.splice(i,1),c}remove(){this.invoker.remove()}}const R_=ge([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),k_=ge([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vf}=R_,Gf=ge([{name:"a_pos_3",components:3,type:"Int16"}]);var Au=ge([{name:"a_pos",type:"Int16",components:2}]);const mh=hi/Math.PI/2,xs=-mh,Mr=mh,bm=[new Ns([xs,xs,xs],[Mr,Mr,Mr]),new Ns([xs,xs,xs],[0,0,Mr]),new Ns([0,xs,xs],[Mr,0,Mr]),new Ns([xs,0,xs],[0,Mr,Mr]),new Ns([0,0,xs],[Mr,Mr,Mr])];class Xy{constructor(i,a,c){this.a=Br([],i,c),this.b=Br([],a,c),this.center=c;const p=Ra([],this.a),_=Ra([],this.b);this.angle=Math.acos(wl(p,_))}}function Hf(o,i){if(0===o.angle)return null;let a;return a=0===o.a[i]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[i]/o.a[i]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:function(c,p,_,x){const w=Math.sin(_);return c*(Math.sin((1-x)*_)/w)+p*(Math.sin(x*_)/w)}(o.a[i],o.b[i],o.angle,Pi(a,0,1))+o.center[i]}function Kd(o){if(o.z<=1)return bm[o.z+2*o.y+o.x];const[i,a]=jf(o),c=[za(i[0],i[1]),za(i[0],a[1]),za(a[0],i[1]),za(a[0],a[1])],p=[Mr,Mr,Mr],_=[xs,xs,xs];for(const x of c)p[0]=Math.min(p[0],x[0]),p[1]=Math.min(p[1],x[1]),p[2]=Math.min(p[2],x[2]),_[0]=Math.max(_[0],x[0]),_[1]=Math.max(_[1],x[1]),_[2]=Math.max(_[2],x[2]);return new Ns(p,_)}function jf(o){const i=1<<o.z,a=o.x/i,c=(o.x+1)/i,p=(o.y+1)/i;return[[br(o.y/i),ts(a)],[br(p),ts(c)]]}function Wf(o,i,a,c=mh){return a=Ai(a),[o*Math.sin(a)*c,-i*c,o*Math.cos(a)*c]}function za(o,i,a){return Wf(Math.cos(Ai(o)),Math.sin(Ai(o)),i,a)}function Qd(o,i,a){const c=Math.pow(2,a.z),p=(o/hi+a.x)/c;return za(br((i/hi+a.y)/c),ts(p))}function aa(o){return 16383/Math.max(...Br([],o.max,o.min))}function z_(o){const i=na(new Float64Array(16)),a=aa(o);var c,p;return xl(i,i,[a,a,a]),ac(i,i,((c=[])[0]=-(p=o.min)[0],c[1]=-p[1],c[2]=-p[2],c)),i}function Zf(o,i,a,c,p){const _=function(E){const P=hi/(2*Math.PI);return E/(2*Math.PI)/P}(a),x=[o,i,-a/(2*Math.PI)],w=na(new Float64Array(16));return ac(w,w,x),xl(w,w,[_,_,_]),Zp(w,w,Ai(-p)),qp(w,w,Ai(-c)),w}function qf(o){const{x:i,y:a}=o.point,{lng:c,lat:p}=o._center;return Zf(i,a,o.worldSize,c,p)}const $f=Ai(85),O_=Math.cos($f),B_=Math.sin($f);function Xf(o,i,a){var c=2*Math.PI*6378137/256/Math.pow(2,a);return[o*c-2*Math.PI*6378137/2,i*c-2*Math.PI*6378137/2]}class ep{constructor(i,a,c){this.z=i,this.x=a,this.y=c,this.key=Pu(0,i,i,a,c)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,a){const c=(x=this.y,w=this.z,E=Xf(256*(_=this.x),256*(x=Math.pow(2,w)-x-1),w),P=Xf(256*(_+1),256*(x+1),w),E[0]+","+E[1]+","+P[0]+","+P[1]),p=function(_,x,w){let E,P="";for(let R=_;R>0;R--)E=1<<R-1,P+=(x&E?1:0)+(w&E?2:0);return P}(this.z,this.x,this.y);var _,x,w,E,P;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yf{constructor(i,a){this.wrap=i,this.canonical=a,this.key=Pu(i,a.z,a.z,a.x,a.y)}}class Ur{constructor(i,a,c,p,_){this.overscaledZ=i,this.wrap=a,this.canonical=new ep(c,+p,+_),this.key=0===a&&i===c?this.canonical.key:Pu(a,i,c,p,_)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new Ur(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ur(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return Pu(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-i;return Pu(this.wrap*+a,i,i,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new Ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new Ur(a,this.wrap,a,c,p),new Ur(a,this.wrap,a,c+1,p),new Ur(a,this.wrap,a,c,p+1),new Ur(a,this.wrap,a,c+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Ur(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Pu(o,i,a,c,p){const _=1<<Math.min(a,22);let x=_*(p%_)+c%_;return o&&a<22&&(x+=_*_*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*x+a)+(i-a)}function mc(o,i){if(!i.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:i};const a=Math.pow(2,-o.z),c=o.x*a,p=(o.x+1)*a,_=o.y*a,x=(o.y+1)*a,w=ts(c),E=ts(p),P=br(_),R=br(x),z=i.project(w,P),B=i.project(E,P),H=i.project(E,R),$=i.project(w,R);let K=Math.min(z.x,B.x,H.x,$.x),ne=Math.min(z.y,B.y,H.y,$.y),le=Math.max(z.x,B.x,H.x,$.x),be=Math.max(z.y,B.y,H.y,$.y);const Se=a/16;function De(ke,qe,$e,Je,ht,We){const Qe=($e+ht)/2,gt=(Je+We)/2,xt=i.project(ts(Qe),br(gt)),vt=Math.max(0,K-xt.x,ne-xt.y,xt.x-le,xt.y-be);K=Math.min(K,xt.x),le=Math.max(le,xt.x),ne=Math.min(ne,xt.y),be=Math.max(be,xt.y),vt>Se&&(De(ke,xt,$e,Je,Qe,gt),De(xt,qe,Qe,gt,ht,We))}De(z,B,c,_,p,_),De(B,H,p,_,p,x),De(H,$,p,x,c,x),De($,z,c,x,c,_),K-=Se,ne-=Se,le+=Se,be+=Se;const Re=1/Math.max(le-K,be-ne);return{scale:Re,x:K*Re,y:ne*Re,x2:le*Re,y2:be*Re,projection:i}}Bt(ep),Bt(Ur,{omit:["projMatrix"]});class Jf{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const c=i[a];this._stringToNumber[c]=a,this._numberToString[a]=c}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const Kf=["tile","layer","source","sourceLayer","state"];class so{constructor(i,a,c,p,_){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=c,this._y=p,this.properties=i.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const a of Kf)void 0!==this[a]&&(i[a]=this[a]);return i}}const ca=new Uint16Array(8184);for(let o=0;o<2046;o++){let i=o+2,a=0,c=0,p=0,_=0,x=0,w=0;for(1&i?p=_=x=32:a=c=w=32;(i>>=1)>1;){const P=a+p>>1,R=c+_>>1;1&i?(p=a,_=c,a=x,c=w):(a=p,c=_,p=x,_=w),x=P,w=R}const E=4*o;ca[E+0]=a,ca[E+1]=c,ca[E+2]=p,ca[E+3]=_}const js=new Uint16Array(2178),Oa=new Uint8Array(1089),Ba=new Uint16Array(1089);function Qf(o){return 0===o?-.03125:32===o?.03125:0}var wm=ge([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Mm={type:2,extent:hi,loadGeometry:()=>[[new ct(0,0),new ct(8193,0),new ct(8193,8193),new ct(0,8193),new ct(0,0)]]};class fc{constructor(i,a,c,p,_){this.tileID=i,this.uid=lo(),this.uses=0,this.tileSize=a,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(i){const a=i+this.timeAdded;a<Zr.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=mc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,a,c){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(p,_){const x={};if(!_)return x;for(const w of p){const E=w.layerIds.map(P=>_.getLayer(P)).filter(Boolean);if(0!==E.length){w.layers=E,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(P=>E.filter(R=>R.id===P)[0]));for(const P of E)x[P.id]=w}}return x}(i.buckets,a.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof Il){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof Il&&_.hasRTLText){this.hasRTLText=!0,Bs.isLoading()||Bs.isLoaded()||"deferred"!==su()||fl();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(p).queryRadius(_))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Us}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(i)}const a=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pc(i,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pc(i,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new pc(i,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,a,c,p,_,x,w,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:w,transform:x,params:_,tileTransform:this.tileTransform},i,a,c):{}}querySourceFeatures(i,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),_=a?a.sourceLayer:"",x=p._geojsonTileLayer||p[_];if(!x)return;const w=Jo(a&&a.filter),{z:E,x:P,y:R}=this.tileID.canonical,z={z:E,x:P,y:R};for(let B=0;B<x.length;B++){const H=x.feature(B);if(w.needGeometry){const ne=eh(H,!0);if(!w.filter(new ln(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!w.filter(new ln(this.tileID.overscaledZ),H))continue;const $=c.getId(H,_),K=new so(H,E,P,R,$);K.tile=z,i.push(K)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const c=Bl(i.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{const _=this.expirationTime-a;_?this.expirationTime=c+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!a)return;const c=this.latestFeatureIndex.loadVTLayers(),p=a.style.listImages();for(const _ in this.buckets){if(!a.style.hasLayer(_))continue;const x=this.buckets[_],w=x.layers[0].sourceLayer||"_geojsonTileLayer",E=c[w],P=i[w];if(!E||!P||0===Object.keys(P).length)continue;if(x.update(P,E,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof Nd||x instanceof rm){const z=a.style._getSourceCache(x.layers[0].source);a._terrain&&a._terrain.enabled&&z&&x.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(z.id,this.tileID)}const R=a&&a.style&&a.style.getLayer(_);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Zr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=Zr.now()+i}setTexture(i,a){const c=a.context,p=c.gl;this.texture=a.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new pc(c,i,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(i,a){const c={};for(const p of a)c[p]=!0;this.dependencies[i]=c}hasDependency(i,a){for(const c of i){const p=this.dependencies[c];if(p)for(const _ of a)if(p[_])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const c=yl(Mm,this.tileID.canonical,this.tileTransform)[0],p=new pe,_=new oi;for(let x=0;x<c.length;x++){const{x:w,y:E}=c[x];p.emplaceBack(w,E),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(_),this._tileDebugBuffer=i.createVertexBuffer(p,Au.members),this._tileDebugSegments=yn.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(i,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const c=yl(Mm,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const x=function(w,E){const P=mc(w,E),R=Math.pow(2,w.z);for(let ne=0;ne<33;ne++)for(let le=0;le<33;le++){const be=ts((w.x+(le+Qf(le))/32)/R),Se=br((w.y+(ne+Qf(ne))/32)/R),De=E.project(be,Se),Re=33*ne+le;js[2*Re+0]=Math.round((De.x*P.scale-P.x)*hi),js[2*Re+1]=Math.round((De.y*P.scale-P.y)*hi)}Oa.fill(0),Ba.fill(0);for(let ne=2045;ne>=0;ne--){const le=4*ne,be=ca[le+0],Se=ca[le+1],De=ca[le+2],Re=ca[le+3],ke=be+De>>1,qe=Se+Re>>1,$e=ke+qe-Se,Je=qe+be-ke,ht=33*Se+be,We=33*Re+De,Qe=33*qe+ke,gt=Math.hypot((js[2*ht+0]+js[2*We+0])/2-js[2*Qe+0],(js[2*ht+1]+js[2*We+1])/2-js[2*Qe+1])>=16;if(Oa[Qe]=Oa[Qe]||(gt?1:0),ne<1022){const xt=33*(Se+Je>>1)+(be+$e>>1),vt=33*(Re+Je>>1)+(De+$e>>1);Oa[Qe]=Oa[Qe]||Oa[xt]||Oa[vt]}}const z=new ye,B=new je;let H=0;function $(ne,le){const be=33*le+ne;return 0===Ba[be]&&(z.emplaceBack(js[2*be+0],js[2*be+1],ne*hi/32,le*hi/32),Ba[be]=++H),Ba[be]-1}function K(ne,le,be,Se,De,Re){const ke=ne+be>>1,qe=le+Se>>1;if(Math.abs(ne-De)+Math.abs(le-Re)>1&&Oa[33*qe+ke])K(De,Re,ne,le,ke,qe),K(be,Se,De,Re,ke,qe);else{const $e=$(ne,le),Je=$(be,Se),ht=$(De,Re);B.emplaceBack($e,Je,ht)}}return K(0,0,32,32,32,0),K(32,32,0,0,0,32),{vertices:z,indices:B}}(this.tileID.canonical,a);p=x.vertices,_=x.indices}else{p=new ye,_=new je;for(const{x:w,y:E}of c)p.emplaceBack(w,E,0,0);const x=gu(p.int16,void 0,4);for(let w=0;w<x.length;w+=3)_.emplaceBack(x[w],x[w+1],x[w+2])}this._tileBoundsBuffer=i.createVertexBuffer(p,wm.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(_),this._tileBoundsSegments=yn.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(i,a){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!a||"globe"!==a.name)return;const c=this.tileID.canonical,p=z_(Kd(c));this._makeGlobeTileDebugBorderBuffer(i,c,p),this._makeGlobeTileDebugTextBuffer(i,c,p)}_makeGlobeTileDebugBorderBuffer(i,a,c){const p=new pe,_=new oi,x=new _e,w=(P,R,z,B,H)=>{const $=(z-P)/(H-1),K=(B-R)/(H-1),ne=p.length;for(let le=0;le<H;le++){const be=P+le*$,Se=R+le*K;p.emplaceBack(be,Se);const De=Qd(be,Se,a),Re=oh(De,De,c);x.emplaceBack(Re[0],Re[1],Re[2]),_.emplaceBack(ne+le)}},E=hi;w(0,0,E,0,16),w(E,0,E,E,16),w(E,E,0,E,16),w(0,E,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(_),this._tileDebugBuffer=i.createVertexBuffer(p,Au.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(x,Gf.members),this._tileDebugSegments=yn.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugTextBuffer(i,a,c){const p=new pe,_=new je,x=new _e,w=25;_.reserve(32),p.reserve(w),x.reserve(w);const E=(P,R)=>w*P+R;for(let P=0;P<w;P++){const R=2048*P;for(let z=0;z<w;z++){const B=2048*z;p.emplaceBack(B,R);const H=Qd(B,R,a),$=oh(H,H,c);x.emplaceBack($[0],$[1],$[2])}}for(let P=0;P<4;P++)for(let R=0;R<4;R++){const z=E(P,R),B=E(P,R+1),H=E(P+1,R),$=E(P+1,R+1);_.emplaceBack(z,B,H),_.emplaceBack(H,B,$)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(_),this._tileDebugTextBuffer=i.createVertexBuffer(p,Au.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(x,Gf.members),this._tileDebugTextSegments=yn.simpleSegment(0,0,w,32)}}class Sm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,c){const p=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},Pn(this.stateChanges[i][p],c),null===this.deletedStates[i]){this.deletedStates[i]={};for(const _ in this.state[i])_!==p&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][p]){this.deletedStates[i][p]={};for(const _ in this.state[i][p])c[_]||(this.deletedStates[i][p][_]=null)}else for(const _ in c)this.deletedStates[i]&&this.deletedStates[i][p]&&null===this.deletedStates[i][p][_]&&delete this.deletedStates[i][p][_]}removeFeatureState(i,a,c){if(null===this.deletedStates[i])return;const p=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},c&&void 0!==a)null!==this.deletedStates[i][p]&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][c]=null);else if(void 0!==a)if(this.stateChanges[i]&&this.stateChanges[i][p])for(c in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][c]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}getState(i,a){const c=String(a),p=Pn({},(this.state[i]||{})[c],(this.stateChanges[i]||{})[c]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const _=this.deletedStates[i][a];if(null===_)return{};for(const x in _)delete p[x]}return p}initializeTileState(i,a){i.setFeatureState(this.state,a)}coalesceChanges(i,a){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),Pn(this.state[p][x],this.stateChanges[p][x]),_[x]=this.state[p][x];c[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(null===this.deletedStates[p])for(const x in this.state[p])_[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(null===this.deletedStates[p][x])this.state[p][x]={};else for(const w of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][w];_[x]=this.state[p][x]}c[p]=c[p]||{},Pn(c[p],_)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const p in i)i[p].setFeatureState(c,a)}}class gc{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const c=this.toIdx(i,a);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function tp(o,i,a,c){let p=0,_=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(c[x])<1e-15){if(a[x]<o[x]||a[x]>i[x])return null}else{const w=1/c[x];let E=(o[x]-a[x])*w,P=(i[x]-a[x])*w;if(E>P){const R=E;E=P,P=R}if(E>p&&(p=E),P<_&&(_=P),p>_)return null}return p}function Iu(o,i,a,c,p,_,x,w,E,P,R){const z=c-o,B=p-i,H=_-a,$=x-o,K=w-i,ne=E-a,le=R[1]*ne-R[2]*K,be=R[2]*$-R[0]*ne,Se=R[0]*K-R[1]*$,De=z*le+B*be+H*Se;if(Math.abs(De)<1e-15)return null;const Re=1/De,ke=P[0]-o,qe=P[1]-i,$e=P[2]-a,Je=(ke*le+qe*be+$e*Se)*Re;if(Je<0||Je>1)return null;const ht=qe*H-$e*B,We=$e*z-ke*H,Qe=ke*B-qe*z,gt=(R[0]*ht+R[1]*We+R[2]*Qe)*Re;return gt<0||Je+gt>1?null:($*ht+K*We+ne*Qe)*Re}function Tm(o,i,a){return(o-i)/(a-i)}function Du(o,i,a,c,p,_,x,w,E){const P=1<<a,R=_-c,z=x-p,B=(o+1)/P*R+c,H=(i+0)/P*z+p,$=(i+1)/P*z+p;w[0]=(o+0)/P*R+c,w[1]=H,E[0]=B,E[1]=$}class Em{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(_){const x=Math.ceil(Math.log2(_.dim/8)),w=[];let E=Math.ceil(Math.pow(2,x));const P=1/E,R=(H,$,K,ne,le)=>{const be=ne?1:0,Se=(H+1)*K-be,De=$*K,Re=($+1)*K-be;le[0]=H*K,le[1]=De,le[2]=Se,le[3]=Re};let z=new gc(E);const B=[];for(let H=0;H<E*E;H++){R(H%E,Math.floor(H/E),P,!1,B);const $=Nr(B[0],B[1],_),K=Nr(B[2],B[1],_),ne=Nr(B[2],B[3],_),le=Nr(B[0],B[3],_);z.minimums.push(Math.min($,K,ne,le)),z.maximums.push(Math.max($,K,ne,le)),z.leaves.push(1)}for(w.push(z),E/=2;E>=1;E/=2){const H=w[w.length-1];z=new gc(E);for(let $=0;$<E*E;$++){R($%E,Math.floor($/E),2,!0,B);const K=H.getElevation(B[0],B[1]),ne=H.getElevation(B[2],B[1]),le=H.getElevation(B[2],B[3]),be=H.getElevation(B[0],B[3]),Se=H.isLeaf(B[0],B[1]),De=H.isLeaf(B[2],B[1]),Re=H.isLeaf(B[2],B[3]),ke=H.isLeaf(B[0],B[3]),qe=Math.min(K.min,ne.min,le.min,be.min),$e=Math.max(K.max,ne.max,le.max,be.max),Je=Se&&De&&Re&&ke;z.maximums.push($e),z.minimums.push(qe),z.leaves.push($e-qe<=5&&Je?1:0)}w.push(z)}return w}(this.dem),c=a.length-1,p=a[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(a,0,0,c,0)}raycastRoot(i,a,c,p,_,x,w=1){return tp([i,a,-100],[c,p,this.maximums[0]*w],_,x)}raycast(i,a,c,p,_,x,w=1){if(!this.nodeCount)return null;const E=this.raycastRoot(i,a,c,p,_,x,w);if(null==E)return null;const P=[],R=[],z=[],B=[],H=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:$,t:K,nodex:ne,nodey:le,depth:be}=H.pop();if(this.leaves[$]){Du(ne,le,be,i,a,c,p,z,B);const De=1<<be,Re=(ne+0)/De,ke=(ne+1)/De,qe=(le+0)/De,$e=(le+1)/De,Je=Nr(Re,qe,this.dem)*w,ht=Nr(ke,qe,this.dem)*w,We=Nr(ke,$e,this.dem)*w,Qe=Nr(Re,$e,this.dem)*w,gt=Iu(z[0],z[1],Je,B[0],z[1],ht,B[0],B[1],We,_,x),xt=Iu(B[0],B[1],We,z[0],B[1],Qe,z[0],z[1],Je,_,x),vt=Math.min(null!==gt?gt:Number.MAX_VALUE,null!==xt?xt:Number.MAX_VALUE);if(vt!==Number.MAX_VALUE)return vt;{const bt=bl([],_,x,K);if(Lu(Je,ht,Qe,We,Tm(bt[0],z[0],B[0]),Tm(bt[1],z[1],B[1]))>=bt[2])return K}continue}let Se=0;for(let De=0;De<this._siblingOffset.length;De++){Du((ne<<1)+this._siblingOffset[De][0],(le<<1)+this._siblingOffset[De][1],be+1,i,a,c,p,z,B),z[2]=-100,B[2]=this.maximums[this.childOffsets[$]+De]*w;const Re=tp(z,B,_,x);if(null!=Re){const ke=Re;P[De]=ke;let qe=!1;for(let $e=0;$e<Se&&!qe;$e++)ke>=P[R[$e]]&&(R.splice($e,0,De),qe=!0);qe||(R[Se]=De),Se++}}for(let De=0;De<Se;De++){const Re=R[De];H.push({idx:this.childOffsets[$]+Re,t:P[Re],nodex:(ne<<1)+this._siblingOffset[Re][0],nodey:(le<<1)+this._siblingOffset[Re][1],depth:be+1})}}return null}_addNode(i,a,c){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,c,p,_){if(1===i[p].isLeaf(a,c))return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const x=p-1,w=i[x];let E=0,P=0;for(let R=0;R<this._siblingOffset.length;R++){const z=2*a+this._siblingOffset[R][0],B=2*c+this._siblingOffset[R][1],H=w.getElevation(z,B),$=w.isLeaf(z,B),K=this._addNode(H.min,H.max,$);$&&(E|=1<<R),P||(P=K)}for(let R=0;R<this._siblingOffset.length;R++)E&1<<R||this._construct(i,2*a+this._siblingOffset[R][0],2*c+this._siblingOffset[R][1],x,P+R)}}function Lu(o,i,a,c,p,_){return Yt(Yt(o,a,_),Yt(i,c,_),p)}function Nr(o,i,a){const c=a.dim,p=Pi(o*c-.5,0,c-1),_=Pi(i*c-.5,0,c-1),x=Math.floor(p),w=Math.floor(_),E=Math.min(x+1,c-1),P=Math.min(w+1,c-1);return Lu(a.get(x,w),a.get(E,w),a.get(x,P),a.get(E,P),p-x,_-w)}const eg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class _c{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,c,p=!1,_=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return nn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const x=this.dim=a.height-2,w=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=c||"mapbox",this.borderReady=p,!p){for(let E=0;E<x;E++)w[this._idx(-1,E)]=w[this._idx(0,E)],w[this._idx(x,E)]=w[this._idx(x-1,E)],w[this._idx(E,-1)]=w[this._idx(E,0)],w[this._idx(E,x)]=w[this._idx(E,x-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(x,-1)]=w[this._idx(x-1,0)],w[this._idx(-1,x)]=w[this._idx(0,x-1)],w[this._idx(x,x)]=w[this._idx(x-1,x-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Em(this)}get(i,a,c=!1){c&&(i=Pi(i,-1,this.dim),a=Pi(a,-1,this.dim));const p=4*this._idx(i,a);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(i){return eg[i]}get unpackVector(){return eg[this.encoding]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}_unpackMapbox(i,a,c){return(256*i*256+256*a+c)/10-1e4}_unpackTerrarium(i,a,c){return 256*i+a+c/256-32768}static pack(i,a){const c=[0,0,0,0],p=_c.getUnpackVector(a);let _=Math.floor((i+p[3])/p[2]);return c[2]=_%256,_=Math.floor(_/256),c[1]=_%256,_=Math.floor(_/256),c[0]=_,c}getPixels(){return new ys({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,c){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=a*this.dim,_=a*this.dim+this.dim,x=c*this.dim,w=c*this.dim+this.dim;switch(a){case-1:p=_-1;break;case 1:_=p+1}switch(c){case-1:x=w-1;break;case 1:w=x+1}const E=-a*this.dim,P=-c*this.dim;for(let R=x;R<w;R++)for(let z=p;z<_;z++){const B=4*this._idx(z,R),H=4*this._idx(z+E,R+P);this.pixels[B+0]=i.pixels[H+0],this.pixels[B+1]=i.pixels[H+1],this.pixels[B+2]=i.pixels[H+2],this.pixels[B+3]=i.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Bt(_c),Bt(Em,{omit:["dem"]});class yc{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,c){const p=i.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const _={value:a,timeout:void 0};if(void 0!==c&&(_.timeout=setTimeout(()=>{this.remove(i,_)},c)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const c=i.wrapped().key,p=void 0===a?0:this.data[c].indexOf(a),_=this.data[c][p];return this.data[c].splice(p,1),_.timeout&&clearTimeout(_.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const c in this.data)for(const p of this.data[c])i(p.value)||a.push(p);for(const c of a)this.remove(c.value.tileID,c)}}class Dl{constructor(i,a,c){this.func=i,this.mask=a,this.range=c}}Dl.ReadOnly=!1,Dl.ReadWrite=!0,Dl.disabled=new Dl(519,Dl.ReadOnly,[0,1]);class Vr{constructor(i,a,c,p,_,x){this.test=i,this.ref=a,this.mask=c,this.fail=p,this.depthFail=_,this.pass=x}}Vr.disabled=new Vr({func:519,mask:0},0,0,7680,7680,7680);class gr{constructor(i,a,c){this.blendFunction=i,this.blendColor=a,this.mask=c}}gr.Replace=[1,0],gr.disabled=new gr(gr.Replace,Ii.transparent,[!1,!1,!1,!1]),gr.unblended=new gr(gr.Replace,Ii.transparent,[!0,!0,!0,!0]),gr.alphaBlended=new gr([1,771],Ii.transparent,[!0,!0,!0,!0]);class Vi{constructor(i,a,c){this.enable=i,this.mode=a,this.frontFace=c}}Vi.disabled=new Vi(!1,1029,2305),Vi.backCCW=new Vi(!0,1029,2305),Vi.backCW=new Vi(!0,1029,2304),Vi.frontCW=new Vi(!0,1028,2304),Vi.frontCCW=new Vi(!0,1028,2305);class Lo extends Rt{constructor(i,a,c){super(),this.id=i,this._onlySymbols=c,a.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new yc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Sm,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const a=this._tiles[i];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,a){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,a)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const a in this._tiles){const c=this._tiles[a];this._source.prepareTile(c)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,c.tileID),c.upload(i),c.prepare(this.map.style.imageManager)}else for(const a in this._tiles){const c=this._tiles[a];c.upload(i),c.prepare(this.map.style.imageManager)}}getIds(){return Sc(this._tiles).map(i=>i.tileID).sort(tg).map(i=>i.key)}getRenderableIds(i){const a=[];for(const c in this._tiles)this._isIdRenderable(+c,i)&&a.push(this._tiles[c]);return i?a.sort((c,p)=>{const _=c.tileID,x=p.tileID,w=new ct(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),E=new ct(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||E.y-w.y||E.x-w.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(tg).map(c=>c.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,a){const c=this._tiles[i];c&&("loading"!==c.state&&(c.state=a),this._loadTile(c,this._tileLoaded.bind(this,c,i,a)))}_tileLoaded(i,a,c,p){if(p)if(i.state="errored",404!==p.status)this._source.fire(new Dt(p,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=Zr.now(),"expired"===c&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Jt("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const a=this.getRenderableIds();for(let p=0;p<a.length;p++){const _=a[p];if(i.neighboringTiles&&i.neighboringTiles[_]){const x=this.getTileByID(_);c(i,x),c(x,i)}}function c(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-p.tileID.canonical.x;const w=_.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),P=_.tileID.key;0===x&&0===w||Math.abs(w)>1||(Math.abs(x)>1&&(1===Math.abs(x+E)?x+=E:1===Math.abs(x-E)&&(x-=E)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,x,w),p.neighboringTiles&&p.neighboringTiles[P]&&(p.neighboringTiles[P].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,c,p){for(const _ in this._tiles){let x=this._tiles[_];if(p[_]||!x.hasData()||x.tileID.overscaledZ<=a||x.tileID.overscaledZ>c)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>a+1;){const P=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[P.key],x&&x.hasData()&&(w=P)}let E=w;for(;E.overscaledZ>a;)if(E=E.scaledTo(E.overscaledZ-1),i[E.key]){p[w.key]=w;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const c=this._loadedParentTiles[i.key];return c&&c.tileID.overscaledZ>=a?c:null}for(let c=i.overscaledZ-1;c>=a;c--){const p=i.scaledTo(c),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,a){a=a||this._source.tileSize;const c=Math.ceil(i.width/a)+1,p=Math.ceil(i.height/a)+1,_=Math.floor(c*p*5),x="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,_):_,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(w)}handleWrapJump(i){const a=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,a){const c={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+a),c[_.tileID.key]=_}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(i,a,c){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;this.updateCacheSize(i,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new Ur(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(p=i.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(w=>this._source.hasTile(w)))):p=[];const _=this._updateRetainedTiles(p);if(ip(this._source.type)&&0!==p.length){const w={},E={},P=Object.keys(_);for(const z of P){const B=_[z],H=this._tiles[z];if(!H||H.fadeEndTime&&H.fadeEndTime<=Zr.now())continue;const $=this.findLoadedParent(B,Math.max(B.overscaledZ-Lo.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),w[$.tileID.key]=$.tileID),E[z]=B}const R=p[p.length-1].overscaledZ;for(const z in this._tiles){const B=this._tiles[z];if(_[z]||!B.hasData())continue;let H=B.tileID;for(;H.overscaledZ>R;){H=H.scaledTo(H.overscaledZ-1);const $=this._tiles[H.key];if($&&$.hasData()&&E[H.key]){_[z]=B.tileID;break}}}for(const z in w)_[z]||(this._coveredTiles[z]=!0,_[z]=w[z])}for(const w in _)this._tiles[w].clearFadeHold();const x=function(w,E){const P=[];for(const R in w)R in E||P.push(R);return P}(this._tiles,_);for(const w of x){const E=this._tiles[w];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const a={};if(0===i.length)return a;const c={},p=i.reduce((P,R)=>Math.min(P,R.overscaledZ),1/0),_=i[0].overscaledZ,x=Math.max(_-Lo.maxOverzooming,this._source.minzoom),w=Math.max(_+Lo.maxUnderzooming,this._source.minzoom),E={};for(const P of i){const R=this._addTile(P);a[P.key]=P,R.hasData()||p<this._source.maxzoom&&(E[P.key]=P)}this._retainLoadedChildren(E,p,w,a);for(const P of i){let R=this._tiles[P.key];if(R.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const B=P.children(this._source.maxzoom)[0],H=this.getTile(B);if(H&&H.hasData()){a[B.key]=B;continue}}else{const B=P.children(this._source.maxzoom);if(a[B[0].key]&&a[B[1].key]&&a[B[2].key]&&a[B[3].key])continue}let z=R.wasRequested();for(let B=P.overscaledZ-1;B>=x;--B){const H=P.scaledTo(B);if(c[H.key]||(c[H.key]=!0,R=this.getTile(H),!R&&z&&(R=this._addTile(H)),R&&(a[H.key]=H,z=R.wasRequested(),R.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let c,p=this._tiles[i].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}a.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;p=_}for(const _ of a)this._loadedParentTiles[_]=c}}_addTile(i){let a=this._tiles[i.key];if(a)return this._source.prepareTile&&this._source.prepareTile(a),a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const c=Boolean(a);if(!c){const p=this.map?this.map.painter:null;a=new fc(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._source.prepareTile&&this._source.prepareTile(a)||this._loadTile(a,this._tileLoaded.bind(this,a,i.key,a.state))}return a?(a.uses++,this._tiles[i.key]=a,c||this._source.fire(new Jt("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const c=a.getExpiryTimeout();c&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},c))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,a,c){const p=[],_=this.transform;if(!_)return p;for(const x in this._tiles){const w=this._tiles[x];if(c&&w.clearQueryDebugViz(),w.holdingForFade())continue;const E=i.containsTile(w,_,a);E&&p.push(E)}return p}getVisibleCoordinates(i){const a=this.getRenderableIds(i).map(c=>this._tiles[c].tileID);for(const c of a)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(ip(this._source.type))for(const i in this._tiles){const a=this._tiles[i];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=Zr.now())return!0}return!1}setFeatureState(i,a,c){this._state.updateState(i=i||"_geojsonTileLayer",a,c)}removeFeatureState(i,a,c){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,c)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,c){const p=this._tiles[i];p&&p.setDependencies(a,c)}reloadTilesForDependencies(i,a){for(const c in this._tiles)this._tiles[c].hasDependency(i,a)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(i,a))}_preloadTiles(i,a){const c=new Map,p=Array.isArray(i)?i:[i],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const w of p){const E=w.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of E)c.set(P.key,P);this.usedForTerrain&&w.updateElevation(!1)}qa(Array.from(c.values()),(w,E)=>{const P=new fc(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,R=>{"raster-dem"===this._source.type&&P.dem&&this._backfillDEM(P),E(R,P)})},a)}}function tg(o,i){const a=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*i.wrap)-+(i.wrap<0);return o.overscaledZ-i.overscaledZ||c-a||i.canonical.y-o.canonical.y||i.canonical.x-o.canonical.x}function ip(o){return"raster"===o||"image"===o||"video"===o}Lo.maxOverzooming=10,Lo.maxUnderzooming=3;class Fa{constructor(i,a,c){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=c}static create(i,a,c){const p=c||i.findDEMTileFor(a);if(!p||!p.dem)return;const _=p.dem,x=p.tileID,w=1<<a.canonical.z-x.canonical.z;return new Fa(p,p.tileSize/hi/w,[(a.canonical.x/w-x.canonical.x)*_.dim,(a.canonical.y/w-x.canonical.y)*_.dim])}tileCoordToPixel(i,a){const c=a*this._scale+this._offset[1],p=Math.floor(i*this._scale+this._offset[0]),_=Math.floor(c);return new ct(p,_)}getElevationAt(i,a,c,p){const _=i*this._scale+this._offset[0],x=a*this._scale+this._offset[1],w=Math.floor(_),E=Math.floor(x),P=this._dem;return p=!!p,c?Yt(Yt(P.get(w,E,p),P.get(w,E+1,p),x-E),Yt(P.get(w+1,E,p),P.get(w+1,E+1,p),x-E),_-w):P.get(w,E,p)}getElevationAtPixel(i,a,c){return this._dem.get(i,a,!!c)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*nc(1,i)*this._dem.stride}}class vc{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new hl(hi,16,0),this.featureIndexArray=new _n,this.promoteId=a}insert(i,a,c,p,_,x=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,_,x);const E=this.grid;for(let P=0;P<a.length;P++){const R=a[P],z=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){const H=R[B];z[0]=Math.min(z[0],H.x),z[1]=Math.min(z[1],H.y),z[2]=Math.max(z[2],H.x),z[3]=Math.max(z[3],H.y)}z[0]<hi&&z[1]<hi&&z[2]>=0&&z[3]>=0&&E.insert(w,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ch.VectorTile(new hh(this.rawTileData)).layers,this.sourceLayerCoder=new Jf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a,c,p){this.loadVTLayers();const _=i.params||{},x=Jo(_.filter),w=i.tileResult,E=i.transform,P=w.bufferedTilespaceBounds,R=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,($,K,ne,le)=>Hp(w.bufferedTilespaceGeometry,$,K,ne,le));R.sort(Cm);let z=null;E.elevation&&R.length>0&&(z=Fa.create(E.elevation,this.tileID));const B={};let H;for(let $=0;$<R.length;$++){const K=R[$];if(K===H)continue;H=K;const ne=this.featureIndexArray.get(K);let le=null;this.loadMatchingFeature(B,ne,x,_.layers,_.availableImages,a,c,p,(be,Se,De,Re=0)=>(le||(le=yl(be,this.tileID.canonical,i.tileTransform)),Se.queryIntersectsFeature(w,be,De,le,this.z,i.transform,i.pixelPosMatrix,z,Re)))}return B}loadMatchingFeature(i,a,c,p,_,x,w,E,P){const{featureIndex:R,bucketIndex:z,sourceLayerIndex:B,layoutVertexArrayOffset:H}=a,$=this.bucketLayerIDs[z];if(p&&!function(be,Se){for(let De=0;De<be.length;De++)if(Se.indexOf(be[De])>=0)return!0;return!1}(p,$))return;const K=this.sourceLayerCoder.decode(B),ne=this.vtLayers[K].feature(R);if(c.needGeometry){const be=eh(ne,!0);if(!c.filter(new ln(this.tileID.overscaledZ),be,this.tileID.canonical))return}else if(!c.filter(new ln(this.tileID.overscaledZ),ne))return;const le=this.getId(ne,K);for(let be=0;be<$.length;be++){const Se=$[be];if(p&&p.indexOf(Se)<0)continue;const De=x[Se];if(!De)continue;let Re={};void 0!==le&&E&&(Re=E.getState(De.sourceLayer||"_geojsonTileLayer",le));const ke=Pn({},w[Se]);ke.paint=gh(ke.paint,De.paint,ne,Re,_),ke.layout=gh(ke.layout,De.layout,ne,Re,_);const qe=!P||P(ne,De,Re,H);if(!qe)continue;const $e=new so(ne,this.z,this.x,this.y,le);$e.layer=ke;let Je=i[Se];void 0===Je&&(Je=i[Se]=[]),Je.push({featureIndex:R,feature:$e,intersectionZ:qe})}}lookupSymbolFeatures(i,a,c,p,_,x,w,E){const P={};this.loadVTLayers();const R=Jo(_);for(const z of i)this.loadMatchingFeature(P,{bucketIndex:c,sourceLayerIndex:p,featureIndex:z,layoutVertexArrayOffset:0},R,x,w,E,a);return P}loadFeature(i){const{featureIndex:a,sourceLayerIndex:c}=i;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),_=this.vtFeatures[p];if(_[a])return _[a];const x=this.vtLayers[p].feature(a);return _[a]=x,x}hasLayer(i){for(const a of this.bucketLayerIDs)for(const c of a)if(i===c)return!0;return!1}getId(i,a){let c=i.id;return this.promoteId&&(c=i.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[a]],"boolean"==typeof c&&(c=Number(c))),c}}function gh(o,i,a,c,p){return Oo(o,(_,x)=>{const w=i instanceof T?i.get(x):null;return w&&w.evaluate?w.evaluate(a,c,p):w})}function Cm(o,i){return i-o}Bt(vc,{omit:["rawTileData","sourceLayerCoder"]});class F_{constructor(i){const a={},c=[];for(const w in i){const E=i[w],P=a[w]={};for(const R in E.glyphs){const z=E.glyphs[+R];if(!z||0===z.bitmap.width||0===z.bitmap.height)continue;const B=z.metrics.localGlyph?2:1,H={x:0,y:0,w:z.bitmap.width+2*B,h:z.bitmap.height+2*B};c.push(H),P[R]=H}}const{w:p,h:_}=Cl(c),x=new Ao({width:p||1,height:_||1});for(const w in i){const E=i[w];for(const P in E.glyphs){const R=E.glyphs[+P];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const z=a[w][P],B=R.metrics.localGlyph?2:1;Ao.copy(R.bitmap,x,{x:0,y:0},{x:z.x+B,y:z.y+B},R.bitmap)}}this.image=x,this.positions=a}}Bt(F_);class Am{constructor(i){this.tileID=new Ur(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=mc(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,a,c,p,_){this.status="parsing",this.data=i,this.collisionBoxArray=new Us;const x=new Jf(Object.keys(i.layers).sort()),w=new vc(this.tileID,this.promoteId);w.bucketLayerIDs=[];const E={},P=new Io(256,256),R={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:P,availableImages:c},z=a.familiesBySource[this.source];for(const Re in z){const ke=i.layers[Re];if(!ke)continue;let qe=!1,$e=!1;for(const We of z[Re])"symbol"===We[0].type?qe=!0:$e=!0;if(!0===this.isSymbolTile&&!qe||!1===this.isSymbolTile&&!$e)continue;1===ke.version&&nn(`Vector tile source "${this.source}" layer "${Re}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Je=x.encode(Re),ht=[];for(let We=0;We<ke.length;We++){const Qe=ke.feature(We),gt=w.getId(Qe,Re);ht.push({feature:Qe,id:gt,index:We,sourceLayerIndex:Je})}for(const We of z[Re]){const Qe=We[0];void 0!==this.isSymbolTile&&"symbol"===Qe.type!==this.isSymbolTile||Qe.minzoom&&this.zoom<Math.floor(Qe.minzoom)||Qe.maxzoom&&this.zoom>=Qe.maxzoom||"none"!==Qe.visibility&&(np(We,this.zoom,c),(E[Qe.id]=Qe.createBucket({index:w.bucketLayerIDs.length,layers:We,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Je,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:c})).populate(ht,R,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(We.map(gt=>gt.id)))}}let B,H,$,K;P.trim();const ne={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},le=Oo(R.glyphDependencies,Re=>Object.keys(Re).map(Number));Object.keys(le).length?p.send("getGlyphs",{uid:this.uid,stacks:le},(Re,ke)=>{B||(B=Re,H=ke,De.call(this))},void 0,!1,ne):H={};const be=Object.keys(R.iconDependencies);be.length?p.send("getImages",{icons:be,source:this.source,tileID:this.tileID,type:"icons"},(Re,ke)=>{B||(B=Re,$=ke,De.call(this))},void 0,!1,ne):$={};const Se=Object.keys(R.patternDependencies);function De(){if(B)return _(B);if(H&&$&&K){const Re=new F_(H),ke=new Pf($,K);for(const qe in E){const $e=E[qe];$e instanceof Il?(np($e.layers,this.zoom,c),Yd($e,H,Re.positions,$,ke.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):$e.hasPattern&&($e instanceof Nd||$e instanceof rm||$e instanceof Fd)&&(np($e.layers,this.zoom,c),$e.addFeatures(R,this.tileID.canonical,ke.patternPositions,c,this.tileTransform))}this.status="done",_(null,{buckets:Sc(E).filter(qe=>!qe.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Re.image,lineAtlas:P,imageAtlas:ke,glyphMap:this.returnDependencies?H:null,iconMap:this.returnDependencies?$:null,glyphPositions:this.returnDependencies?Re.positions:null})}}Se.length?p.send("getImages",{icons:Se,source:this.source,tileID:this.tileID,type:"patterns"},(Re,ke)=>{B||(B=Re,K=ke,De.call(this))},void 0,!1,ne):K={},De.call(this)}}function np(o,i,a){const c=new ln(i);for(const p of o)p.recalculate(c,a)}class Pm{constructor(i){this.entries={},this.scheduler=i}request(i,a,c,p){const _=this.entries[i]=this.entries[i]||{callbacks:[]};if(_.result){const[x,w]=_.result;return this.scheduler?this.scheduler.add(()=>{p(x,w)},a):p(x,w),()=>{}}return _.callbacks.push(p),_.cancel||(_.cancel=c((x,w)=>{_.result=[x,w];for(const E of _.callbacks)this.scheduler?this.scheduler.add(()=>{E(x,w)},a):E(x,w);setTimeout(()=>delete this.entries[i],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(x=>x!==p),_.callbacks.length||(_.cancel(),delete this.entries[i]))}}}function Ua(o,i,a){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},p=>{const _=fe(o.request,(x,w,E,P)=>{x?p(x):w&&p(null,{vectorTile:a?void 0:new ch.VectorTile(new hh(w)),rawData:w,cacheControl:E,expires:P})});return()=>{_.cancel(),p()}},i)}const Jy=na(new Float32Array(16));class oo{constructor(i){this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new Wi(0,0)}projectTilePoint(i,a,c){return{x:i,y:a,z:0}}locationPoint(i,a){return i._coordinatePoint(i.locationCoordinate(a),!1)}pixelsPerMeter(i,a){return nc(1,i)*a}farthestPixelDistance(i){return function(a,c){const p=a.fovAboveCenter,_=a.elevation?a.elevation.getMinElevationBelowMSL()*c:0,x=(a._camera.position[2]*a.worldSize-_)/Math.cos(a._pitch),w=Math.sin(p)*x/Math.sin(Math.max(Math.PI/2-a._pitch-p,.01)),E=Math.sin(a._pitch)*w+x;return Math.min(1.01*E,x*(1/a._horizonShift))}(i,i.pixelsPerMeter)}pointCoordinate(i,a,c,p){const _=i.horizonLineFromTop(!1),x=new ct(a,Math.max(_,c));return i.rayIntersectionCoordinate(i.pointRayIntersection(x,p))}createInversionMatrix(i,a){return Jy}createTileMatrix(i,a,c){let p,_,x;const w=c.canonical,E=na(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=mc(w,this);p=1,_=P.x+c.wrap*P.scale,x=P.y,xl(E,E,[p/P.scale,p/P.scale,i.pixelsPerMeter/a])}else p=a/i.zoomScale(w.z),_=(w.x+Math.pow(2,w.z)*c.wrap)*p,x=w.y*p;return ac(E,E,[_,x,0]),xl(E,E,[p/hi,p/hi,1]),E}upVector(i,a,c){return[0,0,1]}upVectorScale(i,a,c){return{metersToTile:1,metersToLabelSpace:1}}}class ig extends oo{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:hu(i),y:uu(a),z:0}}unproject(i,a){const c=ts(i),p=br(a);return new Wi(c,p)}}class rp extends oo{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,c]=this.parallels=i.parallels||[29.5,45.5],p=Math.sin(Ai(a));this.n=(p+Math.sin(Ai(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:c,c:p,r0:_}=this,x=Ai(i-this.center[0]),w=Ai(a),E=Math.sqrt(p-2*c*Math.sin(w))/c;return{x:E*Math.sin(x*c),y:E*Math.cos(x*c)-_,z:0}}unproject(i,a){const{n:c,c:p,r0:_}=this,x=_+a;let w=Math.atan2(i,Math.abs(x))*Math.sign(x);x*c<0&&(w-=Math.PI*Math.sign(i)*Math.sign(x));const E=Ai(this.center[0])*c;w=Es(w,-Math.PI-E,Math.PI-E);const P=Fn(w/c)+this.center[0],R=Math.asin(Pi((p-(i*i+x*x)*c*c)/(2*c),-1,1)),z=Pi(Fn(R),-85.051129,Or);return new Wi(P,z)}}const _h=1.340264,Ru=-.081106,yh=893e-6,ku=.003796,sp=Math.sqrt(3)/2;class bs extends oo{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const c=Math.asin(sp*Math.sin(a)),p=c*c,_=p*p*p;return{x:.5*(i*Math.cos(c)/(sp*(_h+3*Ru*p+_*(7*yh+9*ku*p)))/Math.PI+.5),y:1-.5*(c*(_h+Ru*p+_*(yh+ku*p))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let c=a=(2*(1-a)-1)*Math.PI,p=c*c,_=p*p*p;for(let R,z,B,H=0;H<12&&(z=c*(_h+Ru*p+_*(yh+ku*p))-a,B=_h+3*Ru*p+_*(7*yh+9*ku*p),R=z/B,c=Pi(c-R,-Math.PI/3,Math.PI/3),p=c*c,_=p*p*p,!(Math.abs(R)<1e-12));++H);const x=sp*i*(_h+3*Ru*p+_*(7*yh+9*ku*p))/Math.cos(c),w=Math.asin(Math.sin(c)/sp),E=Pi(180*x/Math.PI,-180,180),P=Pi(180*w/Math.PI,-85.051129,Or);return new Wi(E,P)}}class ws extends oo{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const c=360*(i-.5),p=Pi(360*(.5-a),-85.051129,Or);return new Wi(c,p)}}const ha=Math.PI/2;function zu(o){return Math.tan((ha+o)/2)}class ng extends oo{constructor(i){super(i),this.center=i.center||[0,30];const[a,c]=this.parallels=i.parallels||[30,30],p=Ai(a),_=Ai(c),x=Math.cos(p);this.n=p===_?Math.sin(p):Math.log(x/Math.cos(_))/Math.log(zu(_)/zu(p)),this.f=x*Math.pow(zu(p),this.n)/this.n}project(i,a){a=Ai(a),i=Ai(i-this.center[0]);const c=1e-6,{n:p,f:_}=this;_>0?a<-ha+c&&(a=-ha+c):a>ha-c&&(a=ha-c);const x=_/Math.pow(zu(a),p),w=x*Math.sin(p*i),E=_-x*Math.cos(p*i);return{x:.5*(w/Math.PI+.5),y:1-.5*(E/Math.PI+.5),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,a=(2*(1-a)-.5)*Math.PI;const{n:c,f:p}=this,_=p-a,x=Math.sign(_),w=Math.sign(c)*Math.sqrt(i*i+_*_);let E=Math.atan2(i,Math.abs(_))*x;_*c<0&&(E-=Math.PI*Math.sign(i)*x);const P=Pi(Fn(E/c)+this.center[0],-180,180),R=Pi(Fn(2*Math.atan(Math.pow(p/w,1/c))-ha),-85.051129,Or);return new Wi(P,R)}}const rg=Ai(Or);class U_ extends oo{project(i,a){const c=(a=Ai(a))*a,p=c*c;return{x:.5*((i=Ai(i))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let c=a=(2*(1-a)-1)*Math.PI,p=25,_=0,x=c*c;do{x=c*c;const P=x*x;_=(c*(1.007226+x*(.015085+P*(.028874*x-.044475-.005916*P)))-a)/(1.007226+x*(.045255+P*(.259866*x-.311325-.005916*11*P))),c=Pi(c-_,-rg,rg)}while(Math.abs(_)>1e-6&&--p>0);x=c*c;const w=Pi(Fn(i/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),E=Fn(c);return new Wi(w,E)}}const sg=Ai(Or);class Ky extends oo{project(i,a){a=Ai(a),i=Ai(i);const c=Math.cos(a),p=2/Math.PI,_=Math.acos(c*Math.cos(i/2)),x=Math.sin(_)/_,w=.5*(i*p+2*c*Math.sin(i/2)/x)||0,E=.5*(a+Math.sin(a)/x)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(i,a){let c=i=(2*i-.5)*Math.PI,p=a=(2*(1-a)-1)*Math.PI,_=25;const x=1e-6;let w=0,E=0;do{const P=Math.cos(p),R=Math.sin(p),z=2*R*P,B=R*R,H=P*P,$=Math.cos(c/2),K=Math.sin(c/2),ne=2*$*K,le=K*K,be=1-H*$*$,Se=be?1/be:0,De=be?Math.acos(P*$)*Math.sqrt(1/be):0,Re=.5*(2*De*P*K+2*c/Math.PI)-i,ke=.5*(De*R+p)-a,qe=.5*Se*(H*le+De*P*$*B)+1/Math.PI,$e=Se*(ne*z/4-De*R*K),Je=.125*Se*(z*K-De*R*H*ne),ht=.5*Se*(B*$+De*le*P)+.5,We=$e*Je-ht*qe;w=(ke*$e-Re*ht)/We,E=(Re*Je-ke*qe)/We,c=Pi(c-w,-Math.PI,Math.PI),p=Pi(p-E,-sg,sg)}while((Math.abs(w)>x||Math.abs(E)>x)&&--_>0);return new Wi(Fn(c),Fn(p))}}class Im extends oo{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ai(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:c,cosPhi:p}=this;return{x:Ai(i)*p*c+.5,y:-Math.sin(Ai(a))/p*c+.5,z:0}}unproject(i,a){const{scale:c,cosPhi:p}=this,_=-(a-.5)/c,x=Pi(Fn((i-.5)/c)/p,-180,180),w=Math.asin(Pi(_*p,-1,1)),E=Pi(Fn(w),-85.051129,Or);return new Wi(x,E)}}m.ARRAY_TYPE=jn,m.AUTH_ERR_MSG=Fo,m.Aabb=Ns,m.Actor=class{constructor(o,i,a){this.target=o,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},$a(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ys()?o:ti,this.scheduler=new L_}send(o,i,a,c,p=!1,_){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=_,this.callbacks[x]=a);const w=ls(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:o,hasCallback:!!a,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:jc(i,w)},w),{cancel:()=>{a&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const i=o.data,a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(i.mustQueue||Ys()){const c=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,i),c&&c.metadata||{type:"message"})}else this.processTask(a,i)}processTask(o,i){if("<response>"===i.type){const a=this.callbacks[o];delete this.callbacks[o],a&&(i.error?a(Kl(i.error)):a(null,Kl(i.data)))}else{const a=ls(this.globalScope)?void 0:[],c=i.hasCallback?(_,x)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:_?jc(_):null,data:jc(x,a)},a)}:_=>{},p=Kl(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,c);else if(this.parent.getWorkerSource){const _=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,_[0],p.source)[_[1]](p,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},m.CanonicalTileID=ep,m.Color=Ii,m.ColorMode=gr,m.CullFaceMode=Vi,m.DEMData=_c,m.DataConstantProperty=A,m.DedupedRequest=Pm,m.DepthMode=Dl,m.EXTENT=hi,m.Elevation=class{isDataAvailableAtPoint(o){const i=this._source();if(!i||o.y<0||o.y>1)return!1;const a=i.getSource().maxzoom,c=1<<a,p=Math.floor(o.x),_=Math.floor((o.x-p)*c),x=Math.floor(o.y*c),w=this.findDEMTileFor(new Ur(a,p,a,_,x));return!(!w||!w.dem)}getAtPointOrZero(o,i=0){return this.getAtPoint(o,i)||0}getAtPoint(o,i,a=!0){null==i&&(i=null);const c=this._source();if(!c||o.y<0||o.y>1)return i;const p=c.getSource().maxzoom,_=1<<p,x=Math.floor(o.x),w=o.x-x,E=new Ur(p,x,p,Math.floor(w*_),Math.floor(o.y*_)),P=this.findDEMTileFor(E);if(!P||!P.dem)return i;const R=P.dem,z=1<<P.tileID.canonical.z,B=(w*z-P.tileID.canonical.x)*R.dim,H=(o.y*z-P.tileID.canonical.y)*R.dim,$=Math.floor(B),K=Math.floor(H);return(a?this.exaggeration():1)*Yt(Yt(R.get($,K),R.get($,K+1),H-K),Yt(R.get($+1,K),R.get($+1,K+1),H-K),B-$)}getAtTileOffset(o,i,a){const c=1<<o.canonical.z;return this.getAtPointOrZero(new rc(o.wrap+(o.canonical.x+i/hi)/c,(o.canonical.y+a/hi)/c))}getAtTileOffsetFunc(o,i,a,c){return p=>{const _=this.getAtTileOffset(o,p.x,p.y),x=c.upVector(o.canonical,p.x,p.y);return Cd(x,x,_*c.upVectorScale(o.canonical,i,a).metersToTile),x}}getForTilePoints(o,i,a,c){const p=Fa.create(this,o,c);return!!p&&(i.forEach(_=>{_[2]=this.exaggeration()*p.getElevationAt(_[0],_[1],a)}),!0)}getMinMaxForTile(o){const i=this.findDEMTileFor(o);if(!i||!i.dem)return null;const a=i.dem.tree,c=i.tileID,p=1<<o.canonical.z-c.canonical.z;let _=o.canonical.x/p-c.canonical.x,x=o.canonical.y/p-c.canonical.y,w=0;for(let E=0;E<o.canonical.z-c.canonical.z&&!a.leaves[w];E++){_*=2,x*=2;const P=2*Math.floor(x)+Math.floor(_);w=a.childOffsets[w]+P,_%=1,x%=1}return{min:this.exaggeration()*a.minimums[w],max:this.exaggeration()*a.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},m.ErrorEvent=Dt,m.EvaluationParameters=ln,m.Event=Jt,m.Evented=Rt,m.FillExtrusionBucket=Fd,m.Frustum=Co,m.GLOBE_RADIUS=mh,m.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o),this._createAtmosphere(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(o){const i=new pe,a=new je,c=65;for(let p=0;p<c;p++)for(let _=0;_<c;_++)i.emplaceBack(_,p);for(let p=0;p<64;p++)for(let _=0;_<64;_++){const x=p*c+_;a.emplaceBack(x+1,x,x+c),a.emplaceBack(x+c,x+c+1,x+1)}this._gridBuffer=o.createVertexBuffer(i,Au.members),this._gridIndexBuffer=o.createIndexBuffer(a,!0),this._gridSegments=yn.simpleSegment(0,0,4225,8192)}_createPoles(o){const i=new je;for(let p=0;p<=64;p++)i.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=o.createIndexBuffer(i,!0);const a=new Ot,c=new Ot;this._poleSegments=[];for(let p=0,_=0;p<5;p++){const x=1<<p,w=512*x/Math.PI/2,E=360/x;a.emplaceBack(0,-w,0,0,0,.5,0),c.emplaceBack(0,-w,0,0,0,.5,1);for(let P=0;P<=64;P++){const R=P/64,z=Yt(0,E,R),[B,H,$]=Wf(O_,B_,z,w);a.emplaceBack(B,H,$,0,0,R,0),c.emplaceBack(B,H,$,0,0,R,1)}this._poleSegments.push(yn.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,Vf,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,Vf,!1)}_createAtmosphere(o){const i=new Kt;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const a=new je;a.emplaceBack(0,1,2),a.emplaceBack(2,3,0),this.atmosphereVertexBuffer=o.createVertexBuffer(i,k_.members),this.atmosphereIndexBuffer=o.createIndexBuffer(a),this.atmosphereSegments=yn.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o){if(!this._wireframeSegments){const i=new Vt,a=64,c=a+1;for(let p=0;p<a;p++)for(let _=0;_<a;_++){const x=p*c+_;i.emplaceBack(x,x+1),i.emplaceBack(x,x+c),i.emplaceBack(x,x+c+1)}this._wireframeIndexBuffer=o.createIndexBuffer(i),this._wireframeSegments=yn.simpleSegment(0,0,a*a,i.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},m.GlyphManager=vs,m.ImagePosition=ka,m.LineAtlas=Io,m.LngLat=Wi,m.LngLatBounds=_l,m.LocalGlyphMode=hm,m.MAX_MERCATOR_LATITUDE=Or,m.MercatorCoordinate=rc,m.ONE_EM=24,m.OverscaledTileID=Ur,m.Properties=q,m.RGBAImage=ys,m.Ray=class{constructor(o,i){this.pos=o,this.dir=i}intersectsPlane(o,i,a){const c=wl(i,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((o[0]-this.pos[0])*i[0]+(o[1]-this.pos[1])*i[1]+(o[2]-this.pos[2])*i[2])/c;return a[0]=this.pos[0]+this.dir[0]*p,a[1]=this.pos[1]+this.dir[1]*p,a[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(o,i,a){if($=(B=this.pos)[0],K=B[1],ne=B[2],le=(H=o)[0],be=H[1],Se=H[2],Math.abs($-le)<=jp*Math.max(1,Math.abs($),Math.abs(le))&&Math.abs(K-be)<=jp*Math.max(1,Math.abs(K),Math.abs(be))&&Math.abs(ne-Se)<=jp*Math.max(1,Math.abs(ne),Math.abs(Se))||0===i)return a[0]=a[1]=a[2]=0,!1;var B,H,$,K,ne,le,be,Se;const[c,p,_]=this.dir,x=this.pos[0]-o[0],w=this.pos[1]-o[1],E=this.pos[2]-o[2],P=c*c+p*p+_*_,R=2*(x*c+w*p+E*_),z=R*R-4*P*(x*x+w*w+E*E-i*i);if(z<0){const B=Math.max(-R/2,0),H=x+c*B,$=w+p*B,K=E+_*B,ne=Math.hypot(H,$,K);return a[0]=H*i/ne,a[1]=$*i/ne,a[2]=K*i/ne,!1}{const B=(-R-Math.sqrt(z))/(2*P);if(B<0){const H=Math.hypot(x,w,E);return a[0]=x*i/H,a[1]=w*i/H,a[2]=E*i/H,!1}return a[0]=x+c*B,a[1]=w+p*B,a[2]=E+_*B,!0}}},m.RequestManager=class{constructor(o,i,a){this._transformRequestFn=o,this._customAccessToken=i,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const o=function(){let i="";for(let a=0;a<10;a++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qa,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,i){return this._transformRequestFn&&this._transformRequestFn(o,i)||{url:o}}normalizeStyleURL(o,i){if(!As(o))return o;const a=cs(o);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeGlyphsURL(o,i){if(!As(o))return o;const a=cs(o);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeSourceURL(o,i){if(!As(o))return o;const a=cs(o);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||i)}normalizeSpriteURL(o,i,a,c){const p=cs(o);return As(o)?(p.path=`/styles/v1${p.path}/sprite${i}${a}`,this._makeAPIURL(p,this._customAccessToken||c)):(p.path+=`${i}${a}`,Uo(p))}normalizeTileURL(o,i,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!As(o))return o;const c=cs(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||a&&"raster"!==c.authority&&512===a?"@2x":""}${Js.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${zi.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${zi.TILE_URL_VERSION}${c.path}`);const p=this._customAccessToken||function(_){for(const x of _){const w=x.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(c.params)||zi.ACCESS_TOKEN;return zi.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,p)}canonicalizeTileURL(o,i){const a=cs(o);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return o;let c="mapbox://";a.path.match(/^\/raster\/v1\//)?c+=`raster/${a.path.replace(`/${zi.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${a.path.replace(`/${zi.TILE_URL_VERSION}/`,"")}`;let p=a.params;return i&&(p=p.filter(_=>!_.match(/^access_token=/))),p.length&&(c+=`?${p.join("&")}`),c}canonicalizeTileset(o,i){const a=!!i&&As(i),c=[];for(const p of o.tiles||[])el(p)?c.push(this.canonicalizeTileURL(p,a)):c.push(p);return c}_makeAPIURL(o,i){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=cs(zi.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,"http"===o.protocol){const p=o.params.indexOf("secure");p>=0&&o.params.splice(p,1)}if("/"!==c.path&&(o.path=`${c.path}${o.path}`),!zi.REQUIRE_ACCESS_TOKEN)return Uo(o);if(i=i||zi.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return o.params=o.params.filter(p=>-1===p.indexOf("access_token")),o.params.push(`access_token=${i||""}`),Uo(o)}},m.ResourceType=se,m.SegmentVector=yn,m.SourceCache=Lo,m.StencilMode=Vr,m.StructArrayLayout1ui2=oi,m.StructArrayLayout2f1f2i16=ft,m.StructArrayLayout2i4=pe,m.StructArrayLayout2ui4=Vt,m.StructArrayLayout3f12=xe,m.StructArrayLayout3ui6=je,m.StructArrayLayout4i8=ye,m.Texture=pc,m.Tile=fc,m.Transitionable=g,m.Uniform1f=xd,m.Uniform1i=class extends So{constructor(o,i){super(o,i),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},m.Uniform2f=class extends So{constructor(o,i){super(o,i),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},m.Uniform3f=class extends So{constructor(o,i){super(o,i),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},m.Uniform4f=qm,m.UniformColor=bd,m.UniformMatrix2f=class extends So{constructor(o,i){super(o,i),this.current=Bg}set(o){for(let i=0;i<4;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},m.UniformMatrix3f=class extends So{constructor(o,i){super(o,i),this.current=Fp}set(o){for(let i=0;i<9;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},m.UniformMatrix4f=class extends So{constructor(o,i){super(o,i),this.current=Og}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let i=1;i<16;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},m.UnwrappedTileID=Yf,m.ValidationError=It,m.VectorTileWorkerSource=class extends Rt{constructor(o,i,a,c,p){super(),this.actor=o,this.layerIndex=i,this.availableImages=a,this.loadVectorData=p||Ua,this.loading={},this.loaded={},this.deduped=new Pm(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,i){const a=o.uid,c=o&&o.request,p=c&&c.collectResourceTiming,_=this.loading[a]=new Am(o);_.abort=this.loadVectorData(o,(x,w)=>{const E=!this.loading[a];if(delete this.loading[a],E||x||!w)return _.status="done",E||(this.loaded[a]=_),i(x);const P=w.rawData,R={};w.expires&&(R.expires=w.expires),w.cacheControl&&(R.cacheControl=w.cacheControl),_.vectorTile=w.vectorTile||new ch.VectorTile(new hh(P));const z=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(B,H)=>{if(B||!H)return i(B);const $={};if(p){const K=D_(c);K.length>0&&($.resourceTiming=JSON.parse(JSON.stringify(K)))}i(null,Pn({rawTileData:P.slice(0)},H,R,$))})};this.isSpriteLoaded?z():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(z,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):z()}),this.loaded=this.loaded||{},this.loaded[a]=_})}reloadTile(o,i){const a=this.loaded,c=o.uid,p=this;if(a&&a[c]){const _=a[c];_.showCollisionBoxes=o.showCollisionBoxes,_.enableTerrain=!!o.enableTerrain,_.projection=o.projection,_.tileTransform=mc(o.tileID.canonical,o.projection);const x=(w,E)=>{const P=_.reloadCallback;P&&(delete _.reloadCallback,_.parse(_.vectorTile,p.layerIndex,this.availableImages,p.actor,P)),i(w,E)};"parsing"===_.status?_.reloadCallback=x:"done"===_.status&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(o,i){const a=o.uid,c=this.loading[a];c&&(c.abort&&c.abort(),delete this.loading[a]),i()}removeTile(o,i){const a=this.loaded,c=o.uid;a&&a[c]&&delete a[c],i()}},m.WritingMode=mn,m.ZoomHistory=ld,m.add=Zg,m.addDynamicAttributes=Eu,m.adjoint=function(o,i){var a=i[0],c=i[1],p=i[2],_=i[3],x=i[4],w=i[5],E=i[6],P=i[7],R=i[8];return o[0]=x*R-w*P,o[1]=p*P-c*R,o[2]=c*w-p*x,o[3]=w*E-_*R,o[4]=a*R-p*E,o[5]=p*_-a*w,o[6]=_*P-x*E,o[7]=c*E-a*P,o[8]=a*x-c*_,o},m.asyncAll=qa,m.bezier=fa,m.bindAll=$a,m.boundsAttributes=wm,m.bufferConvexPolygon=function(o,i){const a=[];for(let c=0;c<o.length;c++){const p=Es(c-1,-1,o.length-1),_=Es(c+1,-1,o.length-1),x=o[c],w=o[_],E=o[p].sub(x).unit(),P=w.sub(x).unit(),R=P.angleWithSep(E.x,E.y),z=E.add(P).unit().mult(-1*i/Math.sin(R/2));a.push(x.add(z))}return a},m.cacheEntryPossiblyAdded=function(o){Mt++,Mt>ba&&(o.getActor().send("enforceCacheSizeLimit",No),Mt=0)},m.calculateGlobeLabelMatrix=function(o,i){const{lng:a,lat:c}=o._center,p=Zf(0,0,o.worldSize/o._projectionScaler,a,c);return Wp(p,p,function(_){const x=na(new Float64Array(16)),w=1/aa(_);return ac(x,x,_.min),xl(x,x,[w,w,w]),x}(Kd(i)))},m.calculateGlobeMatrix=qf,m.calculateGlobeMercatorMatrix=function(o){const i=o.worldSize,a=o.point,c=nc(1,o.center.lat)*i,p=o.pixelsPerMeter,_=i/(c/o.pixelsPerMeter),x=na(new Float64Array(16));return ac(x,x,[a.x,a.y,0]),xl(x,x,[_,_,p]),Float32Array.from(x)},m.circumferenceAtLatitude=Sd,m.clamp=Pi,m.clearTileCache=function(o){const i=ti.caches.delete(ar);o&&i.catch(o).then(()=>o())},m.clipLine=zf,m.clone=function(o){var i=new jn(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},m.clone$1=Wr,m.collisionCircleLayout=zy,m.config=zi,m.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o},m.create=function(){var o=new jn(16);return jn!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},m.create$1=vl,m.createExpression=Uc,m.createLayout=ge,m.createStyleLayer=function(o){return"custom"===o.type?new Zy(o):new I_[o.type](o)},m.cross=Xp,m.degToRad=Ai,m.div=function(o,i,a){return o[0]=i[0]/a[0],o[1]=i[1]/a[1],o[2]=i[2]/a[2],o},m.dot=wl,m.earthRadius=cu,m.ease=Xs,m.easeCubicInOut=ma,m.emitValidationErrors=wp,m.endsWith=co,m.enforceCacheSizeLimit=function(o){Vo(),hs&&hs.then(i=>{i.keys().then(a=>{for(let c=0;c<a.length-o;c++)i.delete(a[c])})})},m.evaluateSizeForFeature=om,m.evaluateSizeForZoom=wu,m.evaluateVariableOffset=E_,m.evented=gd,m.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},m.exactEquals$1=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]},m.exported=Zr,m.exported$1=Js,m.extend=Pn,m.extend$1=Di,m.filterObject=Xa,m.fromMat4=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[4],o[4]=i[5],o[5]=i[6],o[6]=i[8],o[7]=i[9],o[8]=i[10],o},m.fromQuat=function(o,i){var a=i[0],c=i[1],p=i[2],_=i[3],x=a+a,w=c+c,E=p+p,P=a*x,R=c*x,z=c*w,B=p*x,H=p*w,$=p*E,K=_*x,ne=_*w,le=_*E;return o[0]=1-z-$,o[1]=R+le,o[2]=B-ne,o[3]=0,o[4]=R-le,o[5]=1-P-$,o[6]=H+K,o[7]=0,o[8]=B+ne,o[9]=H-K,o[10]=1-P-z,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},m.fromRotation=function(o,i){var a=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=a,o[2]=0,o[3]=-a,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},m.fromScaling=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},m.furthestTileCorner=function(o){const i=Math.round((o+45+360)%360/90)%4;return Mc[i]},m.getAABBPointSquareDist=function(o,i,a){let c=0;for(let p=0;p<2;++p){const _=a?a[p]:0;o[p]>_&&(c+=(o[p]-_)*(o[p]-_)),i[p]<_&&(c+=(_-i[p])*(_-i[p]))}return c},m.getAnchorAlignment=Al,m.getAnchorJustification=ph,m.getBounds=function(o){let i=1/0,a=1/0,c=-1/0,p=-1/0;for(const _ of o)i=Math.min(i,_.x),a=Math.min(a,_.y),c=Math.max(c,_.x),p=Math.max(p,_.y);return{min:new ct(i,a),max:new ct(c,p)}},m.getColumn=function(o,i){return[o[4*i],o[4*i+1],o[4*i+2],o[4*i+3]]},m.getGridMatrix=function(o,i){const[a,c]=i,p=.015625;return[0,(c[1]-a[1])*p,1<<o.z,(c[0]-a[0])*p,0,o.y,a[0],a[1],p]},m.getImage=At,m.getJSON=function(o,i){return ae(Pn(o,{type:"json"}),i)},m.getMapSessionAPI=xa,m.getPerformanceMeasurement=D_,m.getProjection=function(o){const i=o.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(o.name){case"mercator":return new ig(o);case"equirectangular":return new ws(o);case"naturalEarth":return new U_(o);case"equalEarth":return new bs(o);case"winkelTripel":return new Ky(o);case"albers":return a?new Im(o):new rp(o);case"lambertConformalConic":return a?new Im(o):new ng(o)}throw new Error(`Invalid projection name: ${o.name}`)},m.getRTLTextPluginStatus=su,m.getReferrer=X,m.getTilePoint=function(o,{x:i,y:a},c=0){return new ct(((i-c)*o.scale-o.x)*hi,(a*o.scale-o.y)*hi)},m.getTileVec3=function(o,i,a=0){return mu(((i.x-a)*o.scale-o.x)*hi,(i.y*o.scale-o.y)*hi,Jm(i.z,i.y))},m.getVideo=function(o,i){const a=ti.document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let c=0;c<o.length;c++){const p=ti.document.createElement("source");Be(o[c])||(a.crossOrigin="Anonymous"),p.src=o[c],a.appendChild(p)}return{cancel:()=>{}}},m.globeECEFOrigin=function(o,i){const a=[0,0,0];return oh(a,a,z_(Kd(i.canonical))),oh(a,a,o),a},m.globePixelsToTileUnits=function(o,i){return hi/(512*Math.pow(2,o))*aa(Kd(i))},m.globePoleMatrixForTile=function(o,i,a){const c=na(new Float64Array(16)),p=1<<o,_=360*(i/p-.5),x=a.point,w=a.worldSize/(a.tileSize*p);return ac(c,c,[x.x,x.y,-a.worldSize/Math.PI/2]),xl(c,c,[w,w,w]),Zp(c,c,Ai(-a._center.lat)),qp(c,c,Ai(-a._center.lng+_)),Float32Array.from(c)},m.globeTileLatLngCorners=jf,m.globeToMercatorTransition=function(o){return Ts(5,6,o)},m.identity=na,m.identity$1=$g,m.invert=function(o,i){var a=i[0],c=i[1],p=i[2],_=i[3],x=i[4],w=i[5],E=i[6],P=i[7],R=i[8],z=i[9],B=i[10],H=i[11],$=i[12],K=i[13],ne=i[14],le=i[15],be=a*w-c*x,Se=a*E-p*x,De=a*P-_*x,Re=c*E-p*w,ke=c*P-_*w,qe=p*P-_*E,$e=R*K-z*$,Je=R*ne-B*$,ht=R*le-H*$,We=z*ne-B*K,Qe=z*le-H*K,gt=B*le-H*ne,xt=be*gt-Se*Qe+De*We+Re*ht-ke*Je+qe*$e;return xt?(o[0]=(w*gt-E*Qe+P*We)*(xt=1/xt),o[1]=(p*Qe-c*gt-_*We)*xt,o[2]=(K*qe-ne*ke+le*Re)*xt,o[3]=(B*ke-z*qe-H*Re)*xt,o[4]=(E*ht-x*gt-P*Je)*xt,o[5]=(a*gt-p*ht+_*Je)*xt,o[6]=(ne*De-$*qe-le*Se)*xt,o[7]=(R*qe-B*De+H*Se)*xt,o[8]=(x*Qe-w*ht+P*$e)*xt,o[9]=(c*ht-a*Qe-_*$e)*xt,o[10]=($*ke-K*De+le*be)*xt,o[11]=(z*De-R*ke-H*be)*xt,o[12]=(w*Je-x*We-E*$e)*xt,o[13]=(a*We-c*Je+p*$e)*xt,o[14]=(K*Se-$*Re-ne*be)*xt,o[15]=(R*Re-z*Se+B*be)*xt,o):null},m.isMapAuthenticated=function(o){return or.has(o)},m.isMapboxURL=As,m.isSafariWithAntialiasingBug=function(o){const i=o.navigator?o.navigator.userAgent:null;return!!ls(o)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},m.latFromMercatorY=br,m.len=Sl,m.length=Wg,m.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},m.loadVectorTile=Ua,m.makeRequest=ae,m.mercatorXfromLng=hu,m.mercatorYfromLat=uu,m.mercatorZfromAltitude=nc,m.mul=ay,m.mul$1=Ml,m.multiply=function(o,i,a){var c=i[0],p=i[1],_=i[2],x=i[3],w=i[4],E=i[5],P=i[6],R=i[7],z=i[8],B=a[0],H=a[1],$=a[2],K=a[3],ne=a[4],le=a[5],be=a[6],Se=a[7],De=a[8];return o[0]=B*c+H*x+$*P,o[1]=B*p+H*w+$*R,o[2]=B*_+H*E+$*z,o[3]=K*c+ne*x+le*P,o[4]=K*p+ne*w+le*R,o[5]=K*_+ne*E+le*z,o[6]=be*c+Se*x+De*P,o[7]=be*p+Se*w+De*R,o[8]=be*_+Se*E+De*z,o},m.multiply$1=Wp,m.multiply$2=rh,m.nextPowerOfTwo=Ec,m.normalize=Ra,m.normalize$1=function(o,i){var a=i[0],c=i[1],p=i[2],_=i[3],x=a*a+c*c+p*p+_*_;return x>0&&(x=1/Math.sqrt(x)),o[0]=a*x,o[1]=c*x,o[2]=p*x,o[3]=_*x,o},m.number=Yt,m.ortho=function(o,i,a,c,p,_,x){var w=1/(i-a),E=1/(c-p),P=1/(_-x);return o[0]=-2*w,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*P,o[11]=0,o[12]=(i+a)*w,o[13]=(p+c)*E,o[14]=(x+_)*P,o[15]=1,o},m.pbf=hh,m.perspective=function(o,i,a,c,p){var _,x=1/Math.tan(i/2);return o[0]=x/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=x,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=p&&p!==1/0?(o[10]=(p+c)*(_=1/(c-p)),o[14]=2*p*c*_):(o[10]=-1,o[14]=-2*c),o},m.pick=function(o,i){const a={};for(let c=0;c<i.length;c++){const p=i[c];p in o&&(a[p]=o[p])}return a},m.plugin=Bs,m.pointGeometry=ct,m.polygonIntersectsBox=Hp,m.polygonIntersectsPolygon=Vg,m.polygonizeBounds=function(o,i,a=0,c=!0){const p=new ct(a,a),_=o.sub(p),x=i.add(p),w=[_,new ct(x.x,_.y),x,new ct(_.x,x.y)];return c&&w.push(_),w},m.posAttributes=Au,m.postMapLoadEvent=tl,m.postTurnstileEvent=qr,m.potpack=Cl,m.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},m.radToDeg=Fn,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.registerForPluginStateChange=function(o){return o({pluginStatus:Lr,pluginURL:gs}),gd.on("pluginStateChange",o),o},m.removeAuthState=function(o){or.delete(o)},m.renderColorRamp=Qp,m.rotateX=Zp,m.rotateX$1=Pd,m.rotateY=qp,m.rotateZ=function(o,i,a){var c=Math.sin(a),p=Math.cos(a),_=i[0],x=i[1],w=i[2],E=i[3],P=i[4],R=i[5],z=i[6],B=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=_*p+P*c,o[1]=x*p+R*c,o[2]=w*p+z*c,o[3]=E*p+B*c,o[4]=P*p-_*c,o[5]=R*p-x*c,o[6]=z*p-w*c,o[7]=B*p-E*c,o},m.rotateZ$1=function(o,i,a){a*=.5;var c=i[0],p=i[1],_=i[2],x=i[3],w=Math.sin(a),E=Math.cos(a);return o[0]=c*E+p*w,o[1]=p*E-c*w,o[2]=_*E+x*w,o[3]=x*E-_*w,o},m.scale=xl,m.scale$1=function(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o[3]=i[3]*a,o},m.scale$2=Cd,m.scaleAndAdd=bl,m.setCacheLimits=function(o,i){No=o,ba=i},m.setColumn=function(o,i,a){o[4*i+0]=a[0],o[4*i+1]=a[1],o[4*i+2]=a[2],o[4*i+3]=a[3]},m.setRTLTextPlugin=function(o,i,a=!1){if(Lr===fd||Lr===Yc||Lr===dl)throw new Error("setRTLTextPlugin cannot be called multiple times.");gs=Zr.resolveURL(o),Lr=fd,ru=i,ml(),a||fl()},m.smoothstep=Ts,m.spec=Fe,m.storeAuthState=function(o,i){i?or.add(o):or.delete(o)},m.sub=Br,m.subtract=ra,m.symbolSize=h_,m.tileAABB=function(o,i,a,c,p,_,x,w,E){if("globe"===E.name)return function Yy(o,i,a){const c=i/o.worldSize,p=(Qe,gt)=>{Cd(Qe,Qe,c),Cd(gt,gt,c)},_=Number.MAX_VALUE,x=[-_,-_,-_],w=[_,_,_],E=qf(o);if(a.z<=1){const Qe=Kd(a).getCorners();for(let gt=0;gt<Qe.length;gt++)oh(Qe[gt],Qe[gt],E),$p(w,w,Qe[gt]),sh(x,x,Qe[gt]);return p(w,x),new Ns(w,x)}const[P,R]=jf(a),z=new _l;z.setSouthWest([P[1],R[0]]),z.setNorthEast([R[1],P[0]]);const B=[za(z.getSouth(),z.getWest()),za(z.getSouth(),z.getEast()),za(z.getNorth(),z.getEast()),za(z.getNorth(),z.getWest())];for(let Qe=0;Qe<B.length;Qe++)oh(B[Qe],B[Qe],E),$p(w,w,B[Qe]),sh(x,x,B[Qe]);if(z.contains(o.center))return x[2]=0,p(w,x),new Ns(w,x);const H=[E[12],E[13],E[14]],$=o.center.lng,K=Pi(o.center.lat,-85.051129,Or),ne=[hu($),uu(K)],le=z.getCenter().lng,be=Pi(z.getCenter().lat,-85.051129,Or),Se=[hu(le),uu(be)];let De=new Array(3),Re=0;const ke=ne[0]-Se[0],qe=ne[1]-Se[1];if(Math.abs(ke)>Math.abs(qe))Re=ke>=0?1:3,De=H;else{Re=qe>=0?0:2;const Qe=[E[4],E[5],E[6]];let gt;gt=qe>=0?-Math.sin(Ai(z.getSouth()))*mh:-Math.sin(Ai(z.getNorth()))*mh,De=bl(De,H,Qe,gt)}const $e=B[Re],Je=B[(Re+1)%4],ht=new Xy($e,Je,De),We=[Hf(ht,0)||$e[0],Hf(ht,1)||$e[1],Hf(ht,2)||$e[2]];return w[2]=Math.min($e[2],Je[2]),$p(w,w,We),sh(x,x,We),p(w,x),new Ns(w,x)}(o,i,new ep(a,c,p));const P=mc({z:a,x:c,y:p},E);return new Ns([(_+P.x/P.scale)*i,i*(P.y/P.scale),x],[(_+P.x2/P.scale)*i,i*(P.y2/P.scale),w])},m.tileTransform=mc,m.transformMat3=function(o,i,a){var c=i[0],p=i[1],_=i[2];return o[0]=c*a[0]+p*a[3]+_*a[6],o[1]=c*a[1]+p*a[4]+_*a[7],o[2]=c*a[2]+p*a[5]+_*a[8],o},m.transformMat4=oh,m.transformMat4$1=lc,m.transformQuat=ah,m.translate=ac,m.transpose=function(o,i){if(o===i){var a=i[1],c=i[2],p=i[5];o[1]=i[3],o[2]=i[6],o[3]=a,o[5]=i[7],o[6]=c,o[7]=p}else o[0]=i[0],o[1]=i[3],o[2]=i[6],o[3]=i[1],o[4]=i[4],o[5]=i[7],o[6]=i[2],o[7]=i[5],o[8]=i[8];return o},m.triggerPluginCompletionEvent=pl,m.uniqueId=lo,m.validateCustomStyleLayer=function(o){const i=[],a=o.id;return void 0===a&&i.push({message:`layers.${a}: missing required property "id"`}),void 0===o.render&&i.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},m.validateFilter=o=>Qo(vo(o)),m.validateFog=o=>Qo(ad(o)),m.validateLayer=o=>Qo(id(o)),m.validateLight=o=>Qo(sd(o)),m.validateSource=o=>Qo(rd(o)),m.validateStyle=Ca,m.validateTerrain=o=>Qo(od(o)),m.values=Sc,m.vectorTile=ch,m.version=k,m.warnOnce=nn,m.window=ti,m.wrap=Es}),Za(0,function(m){function k(se){if("number"==typeof se||"boolean"==typeof se||"string"==typeof se||null==se)return JSON.stringify(se);if(Array.isArray(se)){let X="[";for(const ae of se)X+=`${k(ae)},`;return`${X}]`}let W="{";for(const X of Object.keys(se).sort())W+=`${X}:${k(se[X])},`;return`${W}}`}function as(se){let W="";for(const X of m.refProperties)W+=`/${k(se[X])}`;return W}class ur{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const fe of W)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=m.createStyleLayer(fe)).compileFilter(),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(const fe of X)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const ae=function(fe,Me){const Ue={};for(let Ae=0;Ae<fe.length;Ae++){const we=Me&&Me[fe[Ae].id]||as(fe[Ae]);Me&&(Me[fe[Ae].id]=we);let rt=Ue[we];rt||(rt=Ue[we]=[]),rt.push(fe[Ae])}const Be=[];for(const Ae in Ue)Be.push(Ue[Ae]);return Be}(m.values(this._layerConfigs),this.keyCache);for(const fe of ae){const Me=fe.map(At=>this._layers[At.id]),Ue=Me[0];if("none"===Ue.visibility)continue;const Be=Ue.source||"";let Ae=this.familiesBySource[Be];Ae||(Ae=this.familiesBySource[Be]={});const we=Ue.sourceLayer||"_geojsonTileLayer";let rt=Ae[we];rt||(rt=Ae[we]=[]),rt.push(Me)}}}class ct{loadTile(W,X){const{uid:ae,encoding:fe,rawImageData:Me,padding:Ue,buildQuadTree:Be}=W,Ae=m.window.ImageBitmap&&Me instanceof m.window.ImageBitmap?this.getImageData(Me,Ue):Me;X(null,new m.DEMData(ae,Ae,fe,Ue<1,Be))}getImageData(W,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const ae=this.offscreenCanvasContext.getImageData(-X,-X,W.width+2*X,W.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ae}}var yi=function se(W,X){var ae,fe=W&&W.type;if("FeatureCollection"===fe)for(ae=0;ae<W.features.length;ae++)se(W.features[ae],X);else if("GeometryCollection"===fe)for(ae=0;ae<W.geometries.length;ae++)se(W.geometries[ae],X);else if("Feature"===fe)se(W.geometry,X);else if("Polygon"===fe)ti(W.coordinates,X);else if("MultiPolygon"===fe)for(ae=0;ae<W.coordinates.length;ae++)ti(W.coordinates[ae],X);return W};function ti(se,W){if(0!==se.length){$s(se[0],W);for(var X=1;X<se.length;X++)$s(se[X],!W)}}function $s(se,W){for(var X=0,ae=0,fe=0,Me=se.length,Ue=Me-1;fe<Me;Ue=fe++){var Be=(se[fe][0]-se[Ue][0])*(se[Ue][1]+se[fe][1]),Ae=X+Be;ae+=Math.abs(X)>=Math.abs(Be)?X-Ae+Be:Be-Ae+X,X=Ae}X+ae>=0!=!!W&&se.reverse()}const pa=m.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ai{constructor(W){this._feature=W,this.extent=m.EXTENT,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(1===this._feature.type){const W=[];for(const X of this._feature.geometry)W.push([new m.pointGeometry(X[0],X[1])]);return W}{const W=[];for(const X of this._feature.geometry){const ae=[];for(const fe of X)ae.push(new m.pointGeometry(fe[0],fe[1]));W.push(ae)}return W}}toGeoJSON(W,X,ae){return pa.call(this,W,X,ae)}}class Fn{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=W.length,this._features=W}feature(W){return new Ai(this._features[W])}}var Mc=m.vectorTile.VectorTileFeature,ma=fa;function fa(se,W){this.options=W||{},this.features=se,this.length=se.length}function Xs(se,W){this.id="number"==typeof se.id?se.id:void 0,this.type=se.type,this.rawGeometry=1===se.type?[se.geometry]:se.geometry,this.properties=se.tags,this.extent=W||4096}fa.prototype.feature=function(se){return new Xs(this.features[se],this.options.extent)},Xs.prototype.loadGeometry=function(){var se=this.rawGeometry;this.geometry=[];for(var W=0;W<se.length;W++){for(var X=se[W],ae=[],fe=0;fe<X.length;fe++)ae.push(new m.pointGeometry(X[fe][0],X[fe][1]));this.geometry.push(ae)}return this.geometry},Xs.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var se=this.geometry,W=1/0,X=-1/0,ae=1/0,fe=-1/0,Me=0;Me<se.length;Me++)for(var Ue=se[Me],Be=0;Be<Ue.length;Be++){var Ae=Ue[Be];W=Math.min(W,Ae.x),X=Math.max(X,Ae.x),ae=Math.min(ae,Ae.y),fe=Math.max(fe,Ae.y)}return[W,ae,X,fe]},Xs.prototype.toGeoJSON=Mc.prototype.toGeoJSON;var Pi=Es,Ts=ma;function Es(se){var W=new m.pbf;return function(X,ae){for(var fe in X.layers)ae.writeMessage(3,qa,X.layers[fe])}(se,W),W.finish()}function qa(se,W){var X;W.writeVarintField(15,se.version||1),W.writeStringField(1,se.name||""),W.writeVarintField(5,se.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<se.length;X++)ae.feature=se.feature(X),W.writeMessage(2,Sc,ae);var fe=ae.keys;for(X=0;X<fe.length;X++)W.writeStringField(3,fe[X]);var Me=ae.values;for(X=0;X<Me.length;X++)W.writeMessage(4,Ec,Me[X])}function Sc(se,W){var X=se.feature;void 0!==X.id&&W.writeVarintField(1,X.id),W.writeMessage(2,Pn,se),W.writeVarintField(3,X.type),W.writeMessage(4,jr,X)}function Pn(se,W){var X=se.feature,ae=se.keys,fe=se.values,Me=se.keycache,Ue=se.valuecache;for(var Be in X.properties){var Ae=X.properties[Be],we=Me[Be];if(null!==Ae){void 0===we&&(ae.push(Be),Me[Be]=we=ae.length-1),W.writeVarint(we);var rt=typeof Ae;"string"!==rt&&"boolean"!==rt&&"number"!==rt&&(Ae=JSON.stringify(Ae));var At=rt+":"+Ae,ut=Ue[At];void 0===ut&&(fe.push(Ae),Ue[At]=ut=fe.length-1),W.writeVarint(ut)}}}function Tc(se,W){return(W<<3)+(7&se)}function lo(se){return se<<1^se>>31}function jr(se,W){for(var X=se.loadGeometry(),ae=se.type,fe=0,Me=0,Ue=X.length,Be=0;Be<Ue;Be++){var Ae=X[Be],we=1;1===ae&&(we=Ae.length),W.writeVarint(Tc(1,we));for(var rt=3===ae?Ae.length-1:Ae.length,At=0;At<rt;At++){1===At&&1!==ae&&W.writeVarint(Tc(2,rt-1));var ut=Ae[At].x-fe,Qt=Ae[At].y-Me;W.writeVarint(lo(ut)),W.writeVarint(lo(Qt)),fe+=ut,Me+=Qt}3===ae&&W.writeVarint(Tc(7,1))}}function Ec(se,W){var X=typeof se;"string"===X?W.writeStringField(1,se):"boolean"===X?W.writeBooleanField(7,se):"number"===X&&(se%1!=0?W.writeDoubleField(3,se):se<0?W.writeSVarintField(6,se):W.writeVarintField(5,se))}function zo(se,W,X,ae,fe,Me){if(fe-ae<=X)return;const Ue=ae+fe>>1;$a(se,W,Ue,ae,fe,Me%2),zo(se,W,X,ae,Ue-1,Me+1),zo(se,W,X,Ue+1,fe,Me+1)}function $a(se,W,X,ae,fe,Me){for(;fe>ae;){if(fe-ae>600){const we=fe-ae+1,rt=X-ae+1,At=Math.log(we),ut=.5*Math.exp(2*At/3),Qt=.5*Math.sqrt(At*ut*(we-ut)/we)*(rt-we/2<0?-1:1);$a(se,W,X,Math.max(ae,Math.floor(X-rt*ut/we+Qt)),Math.min(fe,Math.floor(X+(we-rt)*ut/we+Qt)),Me)}const Ue=W[2*X+Me];let Be=ae,Ae=fe;for(co(se,W,ae,X),W[2*fe+Me]>Ue&&co(se,W,ae,fe);Be<Ae;){for(co(se,W,Be,Ae),Be++,Ae--;W[2*Be+Me]<Ue;)Be++;for(;W[2*Ae+Me]>Ue;)Ae--}W[2*ae+Me]===Ue?co(se,W,ae,Ae):(Ae++,co(se,W,Ae,fe)),Ae<=X&&(ae=Ae+1),X<=Ae&&(fe=Ae-1)}}function co(se,W,X,ae){Oo(se,X,ae),Oo(W,2*X,2*ae),Oo(W,2*X+1,2*ae+1)}function Oo(se,W,X){const ae=se[W];se[W]=se[X],se[X]=ae}function Xa(se,W,X,ae){const fe=se-X,Me=W-ae;return fe*fe+Me*Me}Pi.fromVectorTileJs=Es,Pi.fromGeojsonVt=function(se,W){W=W||{};var X={};for(var ae in se)X[ae]=new ma(se[ae].features,W),X[ae].name=ae,X[ae].version=W.version,X[ae].extent=W.extent;return Es({layers:X})},Pi.GeoJSONWrapper=Ts;const Wr=se=>se[0],Cc=se=>se[1];class nn{constructor(W,X=Wr,ae=Cc,fe=64,Me=Float64Array){this.nodeSize=fe,this.points=W;const Ue=W.length<65536?Uint16Array:Uint32Array,Be=this.ids=new Ue(W.length),Ae=this.coords=new Me(2*W.length);for(let we=0;we<W.length;we++)Be[we]=we,Ae[2*we]=X(W[we]),Ae[2*we+1]=ae(W[we]);zo(Be,Ae,fe,0,Be.length-1,0)}range(W,X,ae,fe){return function(Me,Ue,Be,Ae,we,rt,At){const ut=[0,Me.length-1,0],Qt=[];let Jt,Dt;for(;ut.length;){const Rt=ut.pop(),Fe=ut.pop(),Di=ut.pop();if(Fe-Di<=At){for(let me=Di;me<=Fe;me++)Jt=Ue[2*me],Dt=Ue[2*me+1],Jt>=Be&&Jt<=we&&Dt>=Ae&&Dt<=rt&&Qt.push(Me[me]);continue}const Ut=Math.floor((Di+Fe)/2);Jt=Ue[2*Ut],Dt=Ue[2*Ut+1],Jt>=Be&&Jt<=we&&Dt>=Ae&&Dt<=rt&&Qt.push(Me[Ut]);const ui=(Rt+1)%2;(0===Rt?Be<=Jt:Ae<=Dt)&&(ut.push(Di),ut.push(Ut-1),ut.push(ui)),(0===Rt?we>=Jt:rt>=Dt)&&(ut.push(Ut+1),ut.push(Fe),ut.push(ui))}return Qt}(this.ids,this.coords,W,X,ae,fe,this.nodeSize)}within(W,X,ae){return function(fe,Me,Ue,Be,Ae,we){const rt=[0,fe.length-1,0],At=[],ut=Ae*Ae;for(;rt.length;){const Qt=rt.pop(),Jt=rt.pop(),Dt=rt.pop();if(Jt-Dt<=we){for(let ui=Dt;ui<=Jt;ui++)Xa(Me[2*ui],Me[2*ui+1],Ue,Be)<=ut&&At.push(fe[ui]);continue}const Rt=Math.floor((Dt+Jt)/2),Fe=Me[2*Rt],Di=Me[2*Rt+1];Xa(Fe,Di,Ue,Be)<=ut&&At.push(fe[Rt]);const Ut=(Qt+1)%2;(0===Qt?Ue-Ae<=Fe:Be-Ae<=Di)&&(rt.push(Dt),rt.push(Rt-1),rt.push(Ut)),(0===Qt?Ue+Ae>=Fe:Be+Ae>=Di)&&(rt.push(Rt+1),rt.push(Jt),rt.push(Ut))}return At}(this.ids,this.coords,W,X,ae,this.nodeSize)}}const ir={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:se=>se},ga=Math.fround||(Ys=new Float32Array(1),se=>(Ys[0]=+se,Ys[0]));var Ys;class Bl{constructor(W){this.options=Zr(Object.create(ir),W),this.trees=new Array(this.options.maxZoom+1)}load(W){const{log:X,minZoom:ae,maxZoom:fe,nodeSize:Me}=this.options;X&&console.time("total time");const Ue=`prepare ${W.length} points`;X&&console.time(Ue),this.points=W;let Be=[];for(let Ae=0;Ae<W.length;Ae++)W[Ae].geometry&&Be.push(Ac(W[Ae],Ae));this.trees[fe+1]=new nn(Be,uo,zi,Me,Float32Array),X&&console.timeEnd(Ue);for(let Ae=fe;Ae>=ae;Ae--){const we=+Date.now();Be=this._cluster(Be,Ae),this.trees[Ae]=new nn(Be,uo,zi,Me,Float32Array),X&&console.log("z%d: %d clusters in %dms",Ae,Be.length,+Date.now()-we)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let ae=((W[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,W[1]));let Me=180===W[2]?180:((W[2]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ae=-180,Me=180;else if(ae>Me){const rt=this.getClusters([ae,fe,180,Ue],X),At=this.getClusters([-180,fe,Me,Ue],X);return rt.concat(At)}const Be=this.trees[this._limitZoom(X)],Ae=Be.range(vi(ae),ls(Ue),vi(Me),ls(fe)),we=[];for(const rt of Ae){const At=Be.points[rt];we.push(At.numPoints?Ya(At):this.points[At.index])}return we}getChildren(W){const X=this._getOriginId(W),ae=this._getOriginZoom(W),fe="No cluster with the specified id.",Me=this.trees[ae];if(!Me)throw new Error(fe);const Ue=Me.points[X];if(!Ue)throw new Error(fe);const Be=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),Ae=Me.within(Ue.x,Ue.y,Be),we=[];for(const rt of Ae){const At=Me.points[rt];At.parentId===W&&we.push(At.numPoints?Ya(At):this.points[At.index])}if(0===we.length)throw new Error(fe);return we}getLeaves(W,X,ae){const fe=[];return this._appendLeaves(fe,W,X=X||10,ae=ae||0,0),fe}getTile(W,X,ae){const fe=this.trees[this._limitZoom(W)],Me=Math.pow(2,W),{extent:Ue,radius:Be}=this.options,Ae=Be/Ue,we=(ae-Ae)/Me,rt=(ae+1+Ae)/Me,At={features:[]};return this._addTileFeatures(fe.range((X-Ae)/Me,we,(X+1+Ae)/Me,rt),fe.points,X,ae,Me,At),0===X&&this._addTileFeatures(fe.range(1-Ae/Me,we,1,rt),fe.points,Me,ae,Me,At),X===Me-1&&this._addTileFeatures(fe.range(0,we,Ae/Me,rt),fe.points,-1,ae,Me,At),At.features.length?At:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const ae=this.getChildren(W);if(X++,1!==ae.length)break;W=ae[0].properties.cluster_id}return X}_appendLeaves(W,X,ae,fe,Me){const Ue=this.getChildren(X);for(const Be of Ue){const Ae=Be.properties;if(Ae&&Ae.cluster?Me+Ae.point_count<=fe?Me+=Ae.point_count:Me=this._appendLeaves(W,Ae.cluster_id,ae,fe,Me):Me<fe?Me++:W.push(Be),W.length===ae)break}return Me}_addTileFeatures(W,X,ae,fe,Me,Ue){for(const Be of W){const Ae=X[Be],we=Ae.numPoints;let rt,At,ut;if(we)rt=ho(Ae),At=Ae.x,ut=Ae.y;else{const Dt=this.points[Ae.index];rt=Dt.properties,At=vi(Dt.geometry.coordinates[0]),ut=ls(Dt.geometry.coordinates[1])}const Qt={type:1,geometry:[[Math.round(this.options.extent*(At*Me-ae)),Math.round(this.options.extent*(ut*Me-fe))]],tags:rt};let Jt;we?Jt=Ae.id:this.options.generateId?Jt=Ae.index:this.points[Ae.index].id&&(Jt=this.points[Ae.index].id),void 0!==Jt&&(Qt.id=Jt),Ue.features.push(Qt)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(+W,this.options.maxZoom+1))}_cluster(W,X){const ae=[],{radius:fe,extent:Me,reduce:Ue,minPoints:Be}=this.options,Ae=fe/(Me*Math.pow(2,X));for(let we=0;we<W.length;we++){const rt=W[we];if(rt.zoom<=X)continue;rt.zoom=X;const At=this.trees[X+1],ut=At.within(rt.x,rt.y,Ae),Qt=rt.numPoints||1;let Jt=Qt;for(const Dt of ut){const Rt=At.points[Dt];Rt.zoom>X&&(Jt+=Rt.numPoints||1)}if(Jt>Qt&&Jt>=Be){let Dt=rt.x*Qt,Rt=rt.y*Qt,Fe=Ue&&Qt>1?this._map(rt,!0):null;const Di=(we<<5)+(X+1)+this.points.length;for(const Ut of ut){const ui=At.points[Ut];if(ui.zoom<=X)continue;ui.zoom=X;const me=ui.numPoints||1;Dt+=ui.x*me,Rt+=ui.y*me,ui.parentId=Di,Ue&&(Fe||(Fe=this._map(rt,!0)),Ue(Fe,this._map(ui)))}rt.parentId=Di,ae.push(Bo(Dt/Jt,Rt/Jt,Di,Jt,Fe))}else if(ae.push(rt),Jt>1)for(const Dt of ut){const Rt=At.points[Dt];Rt.zoom<=X||(Rt.zoom=X,ae.push(Rt))}}return ae}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X){if(W.numPoints)return X?Zr({},W.properties):W.properties;const ae=this.points[W.index].properties,fe=this.options.map(ae);return X&&fe===ae?Zr({},fe):fe}}function Bo(se,W,X,ae,fe){return{x:ga(se),y:ga(W),zoom:1/0,id:X,parentId:-1,numPoints:ae,properties:fe}}function Ac(se,W){const[X,ae]=se.geometry.coordinates;return{x:ga(vi(X)),y:ga(ls(ae)),zoom:1/0,index:W,parentId:-1}}function Ya(se){return{type:"Feature",id:se.id,properties:ho(se),geometry:{type:"Point",coordinates:[(W=se.x,360*(W-.5)),Pc(se.y)]}};var W}function ho(se){const W=se.numPoints,X=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W;return Zr(Zr({},se.properties),{cluster:!0,cluster_id:se.id,point_count:W,point_count_abbreviated:X})}function vi(se){return se/360+.5}function ls(se){const W=Math.sin(se*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function Pc(se){const W=(180-360*se)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Zr(se,W){for(const X in W)se[X]=W[X];return se}function uo(se){return se.x}function zi(se){return se.y}function Js(se,W,X,ae){for(var fe,Me=ae,Ue=X-W>>1,Be=X-W,Ae=se[W],we=se[W+1],rt=se[X],At=se[X+1],ut=W+3;ut<X;ut+=3){var Qt=Ja(se[ut],se[ut+1],Ae,we,rt,At);if(Qt>Me)fe=ut,Me=Qt;else if(Qt===Me){var Jt=Math.abs(ut-Ue);Jt<Be&&(fe=ut,Be=Jt)}}Me>ae&&(fe-W>3&&Js(se,W,fe,ae),se[fe+2]=Me,X-fe>3&&Js(se,fe,X,ae))}function Ja(se,W,X,ae,fe,Me){var Ue=fe-X,Be=Me-ae;if(0!==Ue||0!==Be){var Ae=((se-X)*Ue+(W-ae)*Be)/(Ue*Ue+Be*Be);Ae>1?(X=fe,ae=Me):Ae>0&&(X+=Ue*Ae,ae+=Be*Ae)}return(Ue=se-X)*Ue+(Be=W-ae)*Be}function Cs(se,W,X,ae){var fe={id:void 0===se?null:se,type:W,geometry:X,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Me){var Ue=Me.geometry,Be=Me.type;if("Point"===Be||"MultiPoint"===Be||"LineString"===Be)_a(Me,Ue);else if("Polygon"===Be||"MultiLineString"===Be)for(var Ae=0;Ae<Ue.length;Ae++)_a(Me,Ue[Ae]);else if("MultiPolygon"===Be)for(Ae=0;Ae<Ue.length;Ae++)for(var we=0;we<Ue[Ae].length;we++)_a(Me,Ue[Ae][we])}(fe),fe}function _a(se,W){for(var X=0;X<W.length;X+=3)se.minX=Math.min(se.minX,W[X]),se.minY=Math.min(se.minY,W[X+1]),se.maxX=Math.max(se.maxX,W[X]),se.maxY=Math.max(se.maxY,W[X+1])}function Fl(se,W,X,ae){if(W.geometry){var fe=W.geometry.coordinates,Me=W.geometry.type,Ue=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Be=[],Ae=W.id;if(X.promoteId?Ae=W.properties[X.promoteId]:X.generateId&&(Ae=ae||0),"Point"===Me)Ka(fe,Be);else if("MultiPoint"===Me)for(var we=0;we<fe.length;we++)Ka(fe[we],Be);else if("LineString"===Me)Qa(fe,Be,Ue,!1);else if("MultiLineString"===Me){if(X.lineMetrics){for(we=0;we<fe.length;we++)Qa(fe[we],Be=[],Ue,!1),se.push(Cs(Ae,"LineString",Be,W.properties));return}Fo(fe,Be,Ue,!1)}else if("Polygon"===Me)Fo(fe,Be,Ue,!0);else{if("MultiPolygon"!==Me){if("GeometryCollection"===Me){for(we=0;we<W.geometry.geometries.length;we++)Fl(se,{id:Ae,geometry:W.geometry.geometries[we],properties:W.properties},X,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(we=0;we<fe.length;we++){var rt=[];Fo(fe[we],rt,Ue,!0),Be.push(rt)}}se.push(Cs(Ae,Me,Be,W.properties))}}function Ka(se,W){W.push(As(se[0])),W.push(el(se[1])),W.push(0)}function Qa(se,W,X,ae){for(var fe,Me,Ue=0,Be=0;Be<se.length;Be++){var Ae=As(se[Be][0]),we=el(se[Be][1]);W.push(Ae),W.push(we),W.push(0),Be>0&&(Ue+=ae?(fe*we-Ae*Me)/2:Math.sqrt(Math.pow(Ae-fe,2)+Math.pow(we-Me,2))),fe=Ae,Me=we}var rt=W.length-3;W[2]=1,Js(W,0,rt,X),W[rt+2]=1,W.size=Math.abs(Ue),W.start=0,W.end=W.size}function Fo(se,W,X,ae){for(var fe=0;fe<se.length;fe++){var Me=[];Qa(se[fe],Me,X,ae),W.push(Me)}}function As(se){return se/360+.5}function el(se){var W=Math.sin(se*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function si(se,W,X,ae,fe,Me,Ue,Be){if(ae/=W,Me>=(X/=W)&&Ue<ae)return se;if(Ue<X||Me>=ae)return null;for(var Ae=[],we=0;we<se.length;we++){var rt=se[we],At=rt.geometry,ut=rt.type,Qt=0===fe?rt.minX:rt.minY,Jt=0===fe?rt.maxX:rt.maxY;if(Qt>=X&&Jt<ae)Ae.push(rt);else if(!(Jt<X||Qt>=ae)){var Dt=[];if("Point"===ut||"MultiPoint"===ut)cs(At,Dt,X,ae,fe);else if("LineString"===ut)Uo(At,Dt,X,ae,fe,!1,Be.lineMetrics);else if("MultiLineString"===ut)ya(At,Dt,X,ae,fe,!1);else if("Polygon"===ut)ya(At,Dt,X,ae,fe,!0);else if("MultiPolygon"===ut)for(var Rt=0;Rt<At.length;Rt++){var Fe=[];ya(At[Rt],Fe,X,ae,fe,!0),Fe.length&&Dt.push(Fe)}if(Dt.length){if(Be.lineMetrics&&"LineString"===ut){for(Rt=0;Rt<Dt.length;Rt++)Ae.push(Cs(rt.id,ut,Dt[Rt],rt.tags));continue}"LineString"!==ut&&"MultiLineString"!==ut||(1===Dt.length?(ut="LineString",Dt=Dt[0]):ut="MultiLineString"),"Point"!==ut&&"MultiPoint"!==ut||(ut=3===Dt.length?"Point":"MultiPoint"),Ae.push(Cs(rt.id,ut,Dt,rt.tags))}}}return Ae.length?Ae:null}function cs(se,W,X,ae,fe){for(var Me=0;Me<se.length;Me+=3){var Ue=se[Me+fe];Ue>=X&&Ue<=ae&&(W.push(se[Me]),W.push(se[Me+1]),W.push(se[Me+2]))}}function Uo(se,W,X,ae,fe,Me,Ue){for(var Be,Ae,we=Ic(se),rt=0===fe?qr:Jn,At=se.start,ut=0;ut<se.length-3;ut+=3){var Qt=se[ut],Jt=se[ut+1],Dt=se[ut+2],Rt=se[ut+3],Fe=se[ut+4],Di=0===fe?Qt:Jt,Ut=0===fe?Rt:Fe,ui=!1;Ue&&(Be=Math.sqrt(Math.pow(Qt-Rt,2)+Math.pow(Jt-Fe,2))),Di<X?Ut>X&&(Ae=rt(we,Qt,Jt,Rt,Fe,X),Ue&&(we.start=At+Be*Ae)):Di>ae?Ut<ae&&(Ae=rt(we,Qt,Jt,Rt,Fe,ae),Ue&&(we.start=At+Be*Ae)):va(we,Qt,Jt,Dt),Ut<X&&Di>=X&&(Ae=rt(we,Qt,Jt,Rt,Fe,X),ui=!0),Ut>ae&&Di<=ae&&(Ae=rt(we,Qt,Jt,Rt,Fe,ae),ui=!0),!Me&&ui&&(Ue&&(we.end=At+Be*Ae),W.push(we),we=Ic(se)),Ue&&(At+=Be)}var me=se.length-3;Qt=se[me],Jt=se[me+1],Dt=se[me+2],(Di=0===fe?Qt:Jt)>=X&&Di<=ae&&va(we,Qt,Jt,Dt),me=we.length-3,Me&&me>=3&&(we[me]!==we[0]||we[me+1]!==we[1])&&va(we,we[0],we[1],we[2]),we.length&&W.push(we)}function Ic(se){var W=[];return W.size=se.size,W.start=se.start,W.end=se.end,W}function ya(se,W,X,ae,fe,Me){for(var Ue=0;Ue<se.length;Ue++)Uo(se[Ue],W,X,ae,fe,Me,!1)}function va(se,W,X,ae){se.push(W),se.push(X),se.push(ae)}function qr(se,W,X,ae,fe,Me){var Ue=(Me-W)/(ae-W);return se.push(Me),se.push(X+(fe-X)*Ue),se.push(1),Ue}function Jn(se,W,X,ae,fe,Me){var Ue=(Me-X)/(fe-X);return se.push(W+(ae-W)*Ue),se.push(Me),se.push(1),Ue}function tl(se,W){for(var X=[],ae=0;ae<se.length;ae++){var fe,Me=se[ae],Ue=Me.type;if("Point"===Ue||"MultiPoint"===Ue||"LineString"===Ue)fe=po(Me.geometry,W);else if("MultiLineString"===Ue||"Polygon"===Ue){fe=[];for(var Be=0;Be<Me.geometry.length;Be++)fe.push(po(Me.geometry[Be],W))}else if("MultiPolygon"===Ue)for(fe=[],Be=0;Be<Me.geometry.length;Be++){for(var Ae=[],we=0;we<Me.geometry[Be].length;we++)Ae.push(po(Me.geometry[Be][we],W));fe.push(Ae)}X.push(Cs(Me.id,Ue,fe,Me.tags))}return X}function po(se,W){var X=[];X.size=se.size,void 0!==se.start&&(X.start=se.start,X.end=se.end);for(var ae=0;ae<se.length;ae+=3)X.push(se[ae]+W,se[ae+1],se[ae+2]);return X}function xa(se,W){if(se.transformed)return se;var X,ae,fe,Me=1<<se.z,Ue=se.x,Be=se.y;for(X=0;X<se.features.length;X++){var Ae=se.features[X],we=Ae.geometry,rt=Ae.type;if(Ae.geometry=[],1===rt)for(ae=0;ae<we.length;ae+=2)Ae.geometry.push(or(we[ae],we[ae+1],W,Me,Ue,Be));else for(ae=0;ae<we.length;ae++){var At=[];for(fe=0;fe<we[ae].length;fe+=2)At.push(or(we[ae][fe],we[ae][fe+1],W,Me,Ue,Be));Ae.geometry.push(At)}}return se.transformed=!0,se}function or(se,W,X,ae,fe,Me){return[Math.round(X*(se*ae-fe)),Math.round(X*(W*ae-Me))]}function ar(se,W,X,ae,fe){for(var Me=W===fe.maxZoom?0:fe.tolerance/((1<<W)*fe.extent),Ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:ae,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<se.length;Be++){Ue.numFeatures++,hs(Ue,se[Be],Me,fe);var Ae=se[Be].minX,we=se[Be].minY,rt=se[Be].maxX,At=se[Be].maxY;Ae<Ue.minX&&(Ue.minX=Ae),we<Ue.minY&&(Ue.minY=we),rt>Ue.maxX&&(Ue.maxX=rt),At>Ue.maxY&&(Ue.maxY=At)}return Ue}function hs(se,W,X,ae){var fe=W.geometry,Me=W.type,Ue=[];if("Point"===Me||"MultiPoint"===Me)for(var Be=0;Be<fe.length;Be+=3)Ue.push(fe[Be]),Ue.push(fe[Be+1]),se.numPoints++,se.numSimplified++;else if("LineString"===Me)Ps(Ue,fe,se,X,!1,!1);else if("MultiLineString"===Me||"Polygon"===Me)for(Be=0;Be<fe.length;Be++)Ps(Ue,fe[Be],se,X,"Polygon"===Me,0===Be);else if("MultiPolygon"===Me)for(var Ae=0;Ae<fe.length;Ae++){var we=fe[Ae];for(Be=0;Be<we.length;Be++)Ps(Ue,we[Be],se,X,!0,0===Be)}if(Ue.length){var rt=W.tags||null;if("LineString"===Me&&ae.lineMetrics){for(var At in rt={},W.tags)rt[At]=W.tags[At];rt.mapbox_clip_start=fe.start/fe.size,rt.mapbox_clip_end=fe.end/fe.size}var ut={geometry:Ue,type:"Polygon"===Me||"MultiPolygon"===Me?3:"LineString"===Me||"MultiLineString"===Me?2:1,tags:rt};null!==W.id&&(ut.id=W.id),se.features.push(ut)}}function Ps(se,W,X,ae,fe,Me){var Ue=ae*ae;if(ae>0&&W.size<(fe?Ue:ae))X.numPoints+=W.length/3;else{for(var Be=[],Ae=0;Ae<W.length;Ae+=3)(0===ae||W[Ae+2]>Ue)&&(X.numSimplified++,Be.push(W[Ae]),Be.push(W[Ae+1])),X.numPoints++;fe&&function(we,rt){for(var At=0,ut=0,Qt=we.length,Jt=Qt-2;ut<Qt;Jt=ut,ut+=2)At+=(we[ut]-we[Jt])*(we[ut+1]+we[Jt+1]);if(At>0===rt)for(ut=0,Qt=we.length;ut<Qt/2;ut+=2){var Dt=we[ut],Rt=we[ut+1];we[ut]=we[Qt-2-ut],we[ut+1]=we[Qt-1-ut],we[Qt-2-ut]=Dt,we[Qt-1-ut]=Rt}}(Be,Me),se.push(Be)}}function No(se,W){var X=(W=this.options=function(fe,Me){for(var Ue in Me)fe[Ue]=Me[Ue];return fe}(Object.create(this.options),W)).debug;if(X&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var fe,Me,Ue,Be,Ae,we,ae=function(fe,Me){var Ue=[];if("FeatureCollection"===fe.type)for(var Be=0;Be<fe.features.length;Be++)Fl(Ue,fe.features[Be],Me,Be);else Fl(Ue,"Feature"===fe.type?fe:{geometry:fe},Me);return Ue}(se,W);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(fe=ae,Me=W,Ue=Me.buffer/Me.extent,Be=fe,Ae=si(fe,1,-1-Ue,Ue,0,-1,2,Me),we=si(fe,1,1-Ue,2+Ue,0,-1,2,Me),(Ae||we)&&(Be=si(fe,1,-Ue,1+Ue,0,-1,2,Me)||[],Ae&&(Be=tl(Ae,1).concat(Be)),we&&(Be=Be.concat(tl(we,-1)))),ae=Be).length&&this.splitTile(ae,0,0,0),X&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ba(se,W,X){return 32*((1<<se)*X+W)+se}function Vo(se,W){const X=se.tileID.canonical;if(!this._geoJSONIndex)return W(null,null);const ae=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!ae)return W(null,null);const fe=new Fn(ae.features);let Me=Pi(fe);0===Me.byteOffset&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),W(null,{vectorTile:fe,rawData:Me.buffer})}No.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},No.prototype.splitTile=function(se,W,X,ae,fe,Me,Ue){for(var Be=[se,W,X,ae],Ae=this.options,we=Ae.debug;Be.length;){ae=Be.pop(),X=Be.pop(),W=Be.pop(),se=Be.pop();var rt=1<<W,At=ba(W,X,ae),ut=this.tiles[At];if(!ut&&(we>1&&console.time("creation"),ut=this.tiles[At]=ar(se,W,X,ae,Ae),this.tileCoords.push({z:W,x:X,y:ae}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,X,ae,ut.numFeatures,ut.numPoints,ut.numSimplified),console.timeEnd("creation"));var Qt="z"+W;this.stats[Qt]=(this.stats[Qt]||0)+1,this.total++}if(ut.source=se,fe){if(W===Ae.maxZoom||W===fe)continue;var Jt=1<<fe-W;if(X!==Math.floor(Me/Jt)||ae!==Math.floor(Ue/Jt))continue}else if(W===Ae.indexMaxZoom||ut.numPoints<=Ae.indexMaxPoints)continue;if(ut.source=null,0!==se.length){we>1&&console.time("clipping");var Dt,Rt,Fe,Di,Ut,ui,me=.5*Ae.buffer/Ae.extent,Go=.5-me,mo=.5+me,yt=1+me;Dt=Rt=Fe=Di=null,Ut=si(se,rt,X-me,X+mo,0,ut.minX,ut.maxX,Ae),ui=si(se,rt,X+Go,X+yt,0,ut.minX,ut.maxX,Ae),se=null,Ut&&(Dt=si(Ut,rt,ae-me,ae+mo,1,ut.minY,ut.maxY,Ae),Rt=si(Ut,rt,ae+Go,ae+yt,1,ut.minY,ut.maxY,Ae),Ut=null),ui&&(Fe=si(ui,rt,ae-me,ae+mo,1,ut.minY,ut.maxY,Ae),Di=si(ui,rt,ae+Go,ae+yt,1,ut.minY,ut.maxY,Ae),ui=null),we>1&&console.timeEnd("clipping"),Be.push(Dt||[],W+1,2*X,2*ae),Be.push(Rt||[],W+1,2*X,2*ae+1),Be.push(Fe||[],W+1,2*X+1,2*ae),Be.push(Di||[],W+1,2*X+1,2*ae+1)}}},No.prototype.getTile=function(se,W,X){var ae=this.options,fe=ae.extent,Me=ae.debug;if(se<0||se>24)return null;var Ue=1<<se,Be=ba(se,W=(W%Ue+Ue)%Ue,X);if(this.tiles[Be])return xa(this.tiles[Be],fe);Me>1&&console.log("drilling down to z%d-%d-%d",se,W,X);for(var Ae,we=se,rt=W,At=X;!Ae&&we>0;)we--,rt=Math.floor(rt/2),At=Math.floor(At/2),Ae=this.tiles[ba(we,rt,At)];return Ae&&Ae.source?(Me>1&&console.log("found parent tile z%d-%d-%d",we,rt,At),Me>1&&console.time("drilling down"),this.splitTile(Ae.source,we,rt,At,se,W,X),Me>1&&console.timeEnd("drilling down"),this.tiles[Be]?xa(this.tiles[Be],fe):null):null};class Ul extends m.VectorTileWorkerSource{constructor(W,X,ae,fe,Me){super(W,X,ae,fe,Vo),Me&&(this.loadGeoJSON=Me)}loadData(W,X){const ae=W&&W.request,fe=ae&&ae.collectResourceTiming;this.loadGeoJSON(W,(Me,Ue)=>{if(Me||!Ue)return X(Me);if("object"!=typeof Ue)return X(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{yi(Ue,!0);try{if(W.filter){const Ae=m.createExpression(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ae.result)throw new Error(Ae.value.map(rt=>`${rt.key}: ${rt.message}`).join(", "));const we=Ue.features.filter(rt=>Ae.value.evaluate({zoom:0},rt));Ue={type:"FeatureCollection",features:we}}this._geoJSONIndex=W.cluster?new Bl(function({superclusterOptions:Ae,clusterProperties:we}){if(!we||!Ae)return Ae;const rt={},At={},ut={accumulated:null,zoom:0},Qt={properties:null},Jt=Object.keys(we);for(const Dt of Jt){const[Rt,Fe]=we[Dt],Di=m.createExpression(Fe),Ut=m.createExpression("string"==typeof Rt?[Rt,["accumulated"],["get",Dt]]:Rt);rt[Dt]=Di.value,At[Dt]=Ut.value}return Ae.map=Dt=>{Qt.properties=Dt;const Rt={};for(const Fe of Jt)Rt[Fe]=rt[Fe].evaluate(ut,Qt);return Rt},Ae.reduce=(Dt,Rt)=>{Qt.properties=Rt;for(const Fe of Jt)ut.accumulated=Dt[Fe],Dt[Fe]=At[Fe].evaluate(ut,Qt)},Ae}(W)).load(Ue.features):new No(Ae=Ue,W.geojsonVtOptions)}catch(Ae){return X(Ae)}this.loaded={};const Be={};if(fe){const Ae=m.getPerformanceMeasurement(ae);Ae&&(Be.resourceTiming={},Be.resourceTiming[W.source]=JSON.parse(JSON.stringify(Ae)))}X(null,Be)}var Ae})}reloadTile(W,X){const ae=this.loaded;return ae&&ae[W.uid]?super.reloadTile(W,X):this.loadTile(W,X)}loadGeoJSON(W,X){if(W.request)m.getJSON(W.request,X);else{if("string"!=typeof W.data)return X(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));try{return X(null,JSON.parse(W.data))}catch(ae){return X(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(W,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(ae){X(ae)}}getClusterChildren(W,X){try{X(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(ae){X(ae)}}getClusterLeaves(W,X){try{X(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(ae){X(ae)}}}class Mt{constructor(W){this.self=W,this.actor=new m.Actor(W,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=m.getProjection({name:"mercator"}),this.workerSourceTypes={vector:m.VectorTileWorkerSource,geojson:Ul},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(X,ae)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=ae},this.self.registerRTLTextPlugin=X=>{if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=X.applyArabicShaping,m.plugin.processBidirectionalText=X.processBidirectionalText,m.plugin.processStyledBidirectionalText=X.processStyledBidirectionalText}}clearCaches(W,X,ae){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],ae()}checkIfReady(W,X,ae){ae()}setReferrer(W,X){this.referrer=X}spriteLoaded(W,X){this.isSpriteLoaded[W]=X;for(const ae in this.workerSources[W]){const fe=this.workerSources[W][ae];for(const Me in fe)fe[Me]instanceof m.VectorTileWorkerSource&&(fe[Me].isSpriteLoaded=X,fe[Me].fire(new m.Event("isSpriteLoaded")))}}setImages(W,X,ae){this.availableImages[W]=X;for(const fe in this.workerSources[W]){const Me=this.workerSources[W][fe];for(const Ue in Me)Me[Ue].availableImages=X}ae()}enableTerrain(W,X,ae){this.terrain=X,ae()}setProjection(W,X){this.projections[W]=m.getProjection(X)}setLayers(W,X,ae){this.getLayerIndex(W).replace(X),ae()}updateLayers(W,X,ae){this.getLayerIndex(W).update(X.layers,X.removedIds),ae()}loadTile(W,X,ae){const fe=this.enableTerrain?m.extend({enableTerrain:this.terrain},X):X;fe.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,X.type,X.source).loadTile(fe,ae)}loadDEMTile(W,X,ae){const fe=this.enableTerrain?m.extend({buildQuadTree:this.terrain},X):X;this.getDEMWorkerSource(W,X.source).loadTile(fe,ae)}reloadTile(W,X,ae){const fe=this.enableTerrain?m.extend({enableTerrain:this.terrain},X):X;fe.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,X.type,X.source).reloadTile(fe,ae)}abortTile(W,X,ae){this.getWorkerSource(W,X.type,X.source).abortTile(X,ae)}removeTile(W,X,ae){this.getWorkerSource(W,X.type,X.source).removeTile(X,ae)}removeSource(W,X,ae){if(!this.workerSources[W]||!this.workerSources[W][X.type]||!this.workerSources[W][X.type][X.source])return;const fe=this.workerSources[W][X.type][X.source];delete this.workerSources[W][X.type][X.source],void 0!==fe.removeSource?fe.removeSource(X,ae):ae()}loadWorkerSource(W,X,ae){try{this.self.importScripts(X.url),ae()}catch(fe){ae(fe.toString())}}syncRTLPluginState(W,X,ae){try{m.plugin.setState(X);const fe=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&null!=fe){this.self.importScripts(fe);const Me=m.plugin.isParsed();ae(Me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${fe}`),Me)}}catch(fe){ae(fe.toString())}}getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new ur),X}getWorkerSource(W,X,ae){return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),this.workerSources[W][X][ae]||(this.workerSources[W][X][ae]=new this.workerSourceTypes[X]({send:(fe,Me,Ue,Be,Ae,we)=>{this.actor.send(fe,Me,Ue,W,Ae,we)},scheduler:this.actor.scheduler},this.getLayerIndex(W),this.getAvailableImages(W),this.isSpriteLoaded[W])),this.workerSources[W][X][ae]}getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new ct),this.demWorkerSources[W][X]}enforceCacheSizeLimit(W,X){m.enforceCacheSizeLimit(X)}getWorkerPerformanceMetrics(W,X,ae){ae(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Mt(self)),Mt}),Za(0,function(m){var k=as;function as(g){return r=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,M,T=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(T);try{M=new Worker(A),y=!0}catch(L){y=!1}return M&&M.terminate(),URL.revokeObjectURL(A),y}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var y=document.createElement("canvas");y.width=y.height=1;var M=y.getContext("2d");if(!M)return!1;var T=M.getImageData(0,0,1,1);return T&&T.width===y.width}()||(void 0===ur[d=r&&r.failIfMajorPerformanceCaveat]&&(ur[d]=function(y){var M,A,L,F,T=(A=y,L=document.createElement("canvas"),(F=Object.create(as.webGLContextAttributes)).failIfMajorPerformanceCaveat=A,L.getContext("webgl",F)||L.getContext("experimental-webgl",F));if(!T)return!1;try{M=T.createShader(T.VERTEX_SHADER)}catch(A){return!1}return!(!M||T.isContextLost())&&(T.shaderSource(M,"void main() {}"),T.compileShader(M),!0===T.getShaderParameter(M,T.COMPILE_STATUS))}(d)),!ur[d]||document.documentMode));var r,d}var ur={};function ct(g,r){if(Array.isArray(g)){if(!Array.isArray(r)||g.length!==r.length)return!1;for(let d=0;d<g.length;d++)if(!ct(g[d],r[d]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==r){if("object"!=typeof r||Object.keys(g).length!==Object.keys(r).length)return!1;for(const d in g)if(!ct(g[d],r[d]))return!1;return!0}return g===r}function yi(g,r,d){const y=m.window.document.createElement(g);return void 0!==r&&(y.className=r),d&&d.appendChild(y),y}function ti(g,r,d){const y=m.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const M of Object.keys(r))y.setAttributeNS(null,M,r[M]);return d&&d.appendChild(y),y}as.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const $s=m.window.document&&m.window.document.documentElement.style,pa=$s&&void 0!==$s.userSelect?"userSelect":"WebkitUserSelect";let Ai;function Fn(){$s&&pa&&(Ai=$s[pa],$s[pa]="none")}function Mc(){$s&&pa&&($s[pa]=Ai)}function ma(g){g.preventDefault(),g.stopPropagation(),m.window.removeEventListener("click",ma,!0)}function fa(){m.window.addEventListener("click",ma,!0),m.window.setTimeout(()=>{m.window.removeEventListener("click",ma,!0)},0)}function Xs(g,r){const d=g.getBoundingClientRect();return Es(g,d,r)}function Pi(g,r){const d=g.getBoundingClientRect(),y=[];for(let M=0;M<r.length;M++)y.push(Es(g,d,r[M]));return y}function Ts(g){return void 0!==m.window.InstallTrigger&&2===g.button&&g.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function Es(g,r,d){const y=g.offsetWidth===r.width?1:g.offsetWidth/r.width;return new m.pointGeometry((d.clientX-r.left)*y,(d.clientY-r.top)*y)}function qa(g,r){var d=r[0],y=r[1],M=r[2],T=r[3],A=d*T-M*y;return A?(g[0]=T*(A=1/A),g[1]=-y*A,g[2]=-M*A,g[3]=d*A,g):null}function Sc(g){const{userImage:r}=g;return!!(r&&r.render&&r.render())&&(g.data.replace(new Uint8Array(r.data.buffer)),!0)}class Pn extends m.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:d,callback:y}of this.requestors)this._notify(d,y);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,d){this._validate(r,d)&&(this.images[r]=d)}_validate(r,d){let y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),y=!1),y}_validateStretch(r,d){if(!r)return!0;let y=0;for(const M of r){if(M[0]<y||M[1]<M[0]||d<M[1])return!1;y=M[1]}return!0}_validateContent(r,d){return!(r&&(4!==r.length||r[0]<0||d.data.width<r[0]||r[1]<0||d.data.height<r[1]||r[2]<0||d.data.width<r[2]||r[3]<0||d.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,d){d.version=this.images[r].version+1,this.images[r]=d,this.updatedImages[r]=!0}removeImage(r){const d=this.images[r];delete this.images[r],delete this.patterns[r],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,d){let y=!0;if(!this.isLoaded())for(const M of r)this.images[M]||(y=!1);this.isLoaded()||y?this._notify(r,d):this.requestors.push({ids:r,callback:d})}_notify(r,d){const y={};for(const M of r){this.images[M]||this.fire(new m.Event("styleimagemissing",{id:M}));const T=this.images[M];T?y[M]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:Boolean(T.userImage&&T.userImage.render)}:m.warnOnce(`Image "${M}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,y)}getPixelSize(){const{width:r,height:d}=this.atlasImage;return{width:r,height:d}}getPattern(r){const d=this.patterns[r],y=this.getImage(r);if(!y)return null;if(d&&d.position.version===y.version)return d.position;if(d)d.position.version=y.version;else{const M={w:y.data.width+2,h:y.data.height+2,x:0,y:0},T=new m.ImagePosition(M,y);this.patterns[r]={bin:M,position:T}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const d=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(r,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const T in this.patterns)r.push(this.patterns[T].bin);const{w:d,h:y}=m.potpack(r),M=this.atlasImage;M.resize({width:d||1,height:y||1});for(const T in this.patterns){const{bin:A}=this.patterns[T],L=A.x+1,F=A.y+1,V=this.images[T].data,G=V.width,q=V.height;m.RGBAImage.copy(V,M,{x:0,y:0},{x:L,y:F},{width:G,height:q}),m.RGBAImage.copy(V,M,{x:0,y:q-1},{x:L,y:F-1},{width:G,height:1}),m.RGBAImage.copy(V,M,{x:0,y:0},{x:L,y:F+q},{width:G,height:1}),m.RGBAImage.copy(V,M,{x:G-1,y:0},{x:L-1,y:F},{width:1,height:q}),m.RGBAImage.copy(V,M,{x:0,y:0},{x:L+G,y:F},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const d of r){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const y=this.images[d];Sc(y)&&this.updateImage(d,y)}}}const Tc=new m.Properties({anchor:new m.DataConstantProperty(m.spec.light.anchor),position:new class{constructor(){this.specification=m.spec.light.position}possiblyEvaluate(g,r){return function([d,y,M]){const T=m.degToRad(y+90),A=m.degToRad(M);return{x:d*Math.cos(T)*Math.sin(A),y:d*Math.sin(T)*Math.sin(A),z:d*Math.cos(A),azimuthal:y,polar:M}}(g.expression.evaluate(r))}interpolate(g,r,d){return{x:m.number(g.x,r.x,d),y:m.number(g.y,r.y,d),z:m.number(g.z,r.z,d),azimuthal:m.number(g.azimuthal,r.azimuthal,d),polar:m.number(g.polar,r.polar,d)}}},color:new m.DataConstantProperty(m.spec.light.color),intensity:new m.DataConstantProperty(m.spec.light.intensity)}),lo="-transition";class jr extends m.Evented{constructor(r){super(),this._transitionable=new m.Transitionable(Tc),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,d={}){if(!this._validate(m.validateLight,r,d))for(const y in r){const M=r[y];m.endsWith(y,lo)?this._transitionable.setTransition(y.slice(0,-lo.length),M):this._transitionable.setValue(y,M)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,d,y){return(!y||!1!==y.validate)&&m.emitValidationErrors(this,r.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}const Ec=new m.Properties({source:new m.DataConstantProperty(m.spec.terrain.source),exaggeration:new m.DataConstantProperty(m.spec.terrain.exaggeration)}),zo="-transition";class $a extends m.Evented{constructor(r,d){super(),this._transitionable=new m.Transitionable(Ec),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d}get(){return this._transitionable.serialize()}set(r){for(const d in r){const y=r[d];m.endsWith(d,zo)?this._transitionable.setTransition(d.slice(0,-zo.length),y):this._transitionable.setValue(d,y)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function co(g,r,d,y){const M=m.smoothstep(45,65,d),[T,A]=Oo(g,y),L=m.length(r);let F=1-Math.min(1,Math.exp((L-T)/(A-T)*-6));return F*=F*F,F=Math.min(1,1.00747*F),F*M*g.alpha}function Oo(g,r){const d=.5/Math.tan(.5*r);return[g.range[0]+d,g.range[1]+d]}const Xa=new m.Properties({range:new m.DataConstantProperty(m.spec.fog.range),color:new m.DataConstantProperty(m.spec.fog.color),"horizon-blend":new m.DataConstantProperty(m.spec.fog["horizon-blend"])}),Wr="-transition";class Cc extends m.Evented{constructor(r,d){super(),this._transitionable=new m.Transitionable(Xa),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,d={}){if(!this._validate(m.validateFog,r,d))for(const y in r){const M=r[y];m.endsWith(y,Wr)?this._transitionable.setTransition(y.slice(0,-Wr.length),M):this._transitionable.setValue(y,M)}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return m.smoothstep(45,65,r)*d.a}getOpacityAtLatLng(r,d){return this._transform.projection.supportsFog?function(y,M,T){const A=m.MercatorCoordinate.fromLngLat(M),L=T.elevation?T.elevation.getAtPointOrZero(A):0,F=[A.x,A.y,L];return m.transformMat4(F,F,T.mercatorFogMatrix),co(y,F,T.pitch,T._fov)}(this.state,r,d):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Oo(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,d,y){return(!y||!1!==y.validate)&&m.emitValidationErrors(this,r.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}class nn{constructor(r,d){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=m.uniqueId();const y=this.workerPool.acquire(this.id);for(let M=0;M<y.length;M++){const T=new nn.Actor(y[M],d,this.id);T.name=`Worker ${M}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,d,y){m.asyncAll(this.actors,(M,T)=>{M.send(r,d,T)},y=y||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ir(g,r,d){return r*(m.EXTENT/(g.tileSize*Math.pow(2,d-g.tileID.overscaledZ)))}nn.Actor=m.Actor;class ga{constructor(r,d,y,M){this.screenBounds=r,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(T=>M.pointCoordinate3D(T)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(r,d){let y,M;if(r instanceof m.pointGeometry||"number"==typeof r[0]){const T=m.pointGeometry.convert(r);y=[m.pointGeometry.convert(r)],M=d.isPointAboveHorizon(T)}else{const T=m.pointGeometry.convert(r[0]),A=m.pointGeometry.convert(r[1]);y=[T,A],M=m.polygonizeBounds(T,A).every(L=>d.isPointAboveHorizon(L))}return new ga(y,d.getCameraPoint(),M,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return m.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const d=this.screenBounds[0],y=1===this.screenBounds.length?this.screenBounds[0].add(new m.pointGeometry(1,1)):this.screenBounds[1],M=m.polygonizeBounds(d,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<y.x?M.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?M[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(M[3]=this.cameraPoint)),m.bufferConvexPolygon(M,r)}containsTile(r,d,y){const M=r.queryPadding+1,T=r.tileID.wrap,A=y?this._bufferedCameraMercator(M,d).map(ie=>m.getTilePoint(r.tileTransform,ie,T)):this._bufferedScreenMercator(M,d).map(ie=>m.getTilePoint(r.tileTransform,ie,T)),L=this.screenGeometryMercator.map(ie=>m.getTileVec3(r.tileTransform,ie,T)),F=L.map(ie=>new m.pointGeometry(ie[0],ie[1])),V=d.getFreeCameraOptions().position||new m.MercatorCoordinate(0,0,0),G=m.getTileVec3(r.tileTransform,V,T),q=L.map(ie=>{const J=m.sub(ie,ie,G);return m.normalize(J,J),new m.Ray(G,J)}),ee=ir(r,1,d.zoom);if(m.polygonIntersectsBox(A,0,0,m.EXTENT,m.EXTENT))return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:q,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(re=m.getBounds(A),re.min.x=m.clamp(re.min.x,0,m.EXTENT),re.min.y=m.clamp(re.min.y,0,m.EXTENT),re.max.x=m.clamp(re.max.x,0,m.EXTENT),re.max.y=m.clamp(re.max.y,0,m.EXTENT),re),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:ee};var re}_bufferedScreenMercator(r,d){const y=Ys(r);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{const M=this.bufferedScreenGeometry(r).map(T=>d.pointCoordinate3D(T));return this._screenRaycastCache[y]=M,M}}_bufferedCameraMercator(r,d){const y=Ys(r);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{const M=this.bufferedCameraGeometry(r).map(T=>d.pointCoordinate3D(T));return this._cameraRaycastCache[y]=M,M}}}function Ys(g){return 100*g|0}function Bl(g,r,d){const y=function(M,T){if(M)return d(M);if(T){const A=m.pick(m.extend(T,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(A.vectorLayers=T.vector_layers,A.vectorLayerIds=A.vectorLayers.map(L=>L.id)),A.tiles=r.canonicalizeTileset(A,g.url),d(null,A)}};return g.url?m.getJSON(r.transformRequest(r.normalizeSourceURL(g.url),m.ResourceType.Source),y):m.exported.frame(()=>y(null,g))}class Bo{constructor(r,d,y){this.bounds=m.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const d=Math.pow(2,r.z),y=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*d),M=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*d),T=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*d),A=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*d);return r.x>=y&&r.x<T&&r.y>=M&&r.y<A}}class Ac{constructor(r,d,y){this.context=r;const M=r.gl;this.buffer=M.createBuffer(),this.dynamicDraw=Boolean(y),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ya={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ho{constructor(r,d,y,M){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=M,this.context=r;const T=r.gl;this.buffer=T.createBuffer(),r.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,d){for(let y=0;y<this.attributes.length;y++){const M=d.attributes[this.attributes[y].name];void 0!==M&&r.enableVertexAttribArray(M)}}setVertexAttribPointers(r,d,y){for(let M=0;M<this.attributes.length;M++){const T=this.attributes[M],A=d.attributes[T.name];void 0!==A&&r.vertexAttribPointer(A,T.components,r[Ya[T.type]],!1,this.itemSize,T.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ls extends vi{getDefault(){return m.Color.transparent}set(r){const d=this.current;(r.r!==d.r||r.g!==d.g||r.b!==d.b||r.a!==d.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Pc extends vi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Zr extends vi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class uo extends vi{getDefault(){return[!0,!0,!0,!0]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||r[3]!==d[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class zi extends vi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Js extends vi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Ja extends vi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const d=this.current;(r.func!==d.func||r.ref!==d.ref||r.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Cs extends vi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class _a extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=r,this.dirty=!1}}class Fl extends vi{getDefault(){return[0,1]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ka extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=r,this.dirty=!1}}class Qa extends vi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Fo extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.BLEND):d.disable(d.BLEND),this.current=r,this.dirty=!1}}class As extends vi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class el extends vi{getDefault(){return m.Color.transparent}set(r){const d=this.current;(r.r!==d.r||r.g!==d.g||r.b!==d.b||r.a!==d.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class si extends vi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class cs extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=r,this.dirty=!1}}class Uo extends vi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Ic extends vi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class ya extends vi{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class va extends vi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class qr extends vi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||r[3]!==d[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Jn extends vi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class tl extends vi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class po extends vi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class xa extends vi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class or extends vi{getDefault(){return null}set(r){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ar extends vi{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class hs extends vi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Ps extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class No extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class ba extends vi{constructor(r,d){super(r),this.context=r,this.parent=d}getDefault(){return null}}class Vo extends ba{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Ul extends ba{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Mt extends Ul{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class se{constructor(r,d,y,M){this.context=r,this.width=d,this.height=y;const T=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Vo(r,T),M&&(this.depthAttachment=new Ul(r,T))}destroy(){const r=this.context.gl,d=this.colorAttachment.get();if(d&&r.deleteTexture(d),this.depthAttachment){const y=this.depthAttachment.get();y&&r.deleteRenderbuffer(y)}r.deleteFramebuffer(this.framebuffer)}}class W{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ls(this),this.clearDepth=new Pc(this),this.clearStencil=new Zr(this),this.colorMask=new uo(this),this.depthMask=new zi(this),this.stencilMask=new Js(this),this.stencilFunc=new Ja(this),this.stencilOp=new Cs(this),this.stencilTest=new _a(this),this.depthRange=new Fl(this),this.depthTest=new Ka(this),this.depthFunc=new Qa(this),this.blend=new Fo(this),this.blendFunc=new As(this),this.blendColor=new el(this),this.blendEquation=new si(this),this.cullFace=new cs(this),this.cullFaceSide=new Uo(this),this.frontFace=new Ic(this),this.program=new ya(this),this.activeTexture=new va(this),this.viewport=new qr(this),this.bindFramebuffer=new Jn(this),this.bindRenderbuffer=new tl(this),this.bindTexture=new po(this),this.bindVertexBuffer=new xa(this),this.bindElementBuffer=new or(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ar(this),this.pixelStoreUnpack=new hs(this),this.pixelStoreUnpackPremultiplyAlpha=new Ps(this),this.pixelStoreUnpackFlipY=new No(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,d){return new Ac(this,r,d)}createVertexBuffer(r,d,y){return new ho(this,r,d,y)}createRenderbuffer(r,d,y){const M=this.gl,T=M.createRenderbuffer();return this.bindRenderbuffer.set(T),M.renderbufferStorage(M.RENDERBUFFER,r,d,y),this.bindRenderbuffer.set(null),T}createFramebuffer(r,d,y){return new se(this,r,d,y)}clear({color:r,depth:d,stencil:y}){const M=this.gl;let T=0;r&&(T|=M.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(T|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==y&&(T|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),M.clear(T)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){ct(r.blendFunction,m.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class X extends m.Evented{constructor(r,d,y,M){super(),this.id=r,this.dispatcher=y,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bl(this._options,this.map._requestManager,(r,d)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new m.ErrorEvent(r)):d&&(m.extend(this,d),d.bounds&&(this.tileBounds=new Bo(d.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(d.tiles),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return m.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,d){const y=m.exported.devicePixelRatio>=2,M=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);r.request=m.getImage(this.map._requestManager.transformRequest(M,m.ResourceType.Tile),(T,A,L,F)=>(delete r.request,r.aborted?(r.state="unloaded",d(null)):T?(r.state="errored",d(T)):A?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:L,expires:F}),r.setTexture(A,this.map.painter),r.state="loaded",m.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(r,d,y){r.setTexture(d,y)}static unloadTileData(r,d){r.texture&&d.saveTileTexture(r.texture)}abortTile(r,d){r.request&&(r.request.cancel(),delete r.request),d()}unloadTile(r,d){r.texture&&this.map.painter.saveTileTexture(r.texture),d()}hasTransition(){return!1}}let ae;function fe(g,r,d,y,M,T,A,L){const F=[g,d,M,r,y,T,1,1,1],V=[A,L,1],G=m.adjoint([],F),[q,ee,re]=m.transformMat3(V,V,m.transpose(G,G));return m.multiply(F,[q,0,0,0,ee,0,0,0,re],F)}class Me extends m.Evented{constructor(r,d,y,M){super(),this.id=r,this.dispatcher=y,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=d}load(r){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),(d,y)=>{if(this._loaded=!0,d)this.fire(new m.ErrorEvent(d));else if(y){const{HTMLImageElement:M}=m.window;this.image=y instanceof M?m.exported.getImageData(y):y,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const d=r.map(m.MercatorCoordinate.fromLngLat);return this.tileID=function(y){let M=1/0,T=1/0,A=-1/0,L=-1/0;for(const q of y)M=Math.min(M,q.x),T=Math.min(T,q.y),A=Math.max(A,q.x),L=Math.max(L,q.y);const F=Math.max(A-M,L-T),V=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),G=Math.pow(2,V);return new m.CanonicalTileID(V,Math.floor((M+A)/2*G),Math.floor((T+L)/2*G))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const F in this.tiles){const V=this.tiles[F];"loaded"!==V.state&&(V.state="loaded",V.texture=this.texture)}if(this._boundsArray)return;const d=m.tileTransform(this.tileID,this.map.transform.projection),[y,M,T,A]=this.coordinates.map(F=>{const V=d.projection.project(F[0],F[1]);return m.getTilePoint(d,V)._round()});this.perspectiveTransform=function(F,V,G,q,ee,re,ie,J,ge,ce){const pe=fe(0,0,F,0,0,V,F,V),_e=fe(G,q,ee,re,ie,J,ge,ce);return m.multiply(_e,m.adjoint(pe,pe),_e),[_e[6]/_e[8]*F/m.EXTENT,_e[7]/_e[8]*V/m.EXTENT]}(this.width,this.height,y.x,y.y,M.x,M.y,A.x,A.y,T.x,T.y);const L=this._boundsArray=new m.StructArrayLayout4i8;L.emplaceBack(y.x,y.y,0,0),L.emplaceBack(M.x,M.y,m.EXTENT,0),L.emplaceBack(A.x,A.y,0,m.EXTENT),L.emplaceBack(T.x,T.y,m.EXTENT,m.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(L,m.boundsAttributes.members),this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,d=r.gl;this.texture?this.texture.update(this.image):(this.texture=new m.Texture(r,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._prepareData(r)}loadTile(r,d){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},d(null)):(r.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ue={vector:class extends m.Evented{constructor(g,r,d,y){if(super(),this.id=g,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(r,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new m.DedupedRequest}load(){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bl(this._options,this.map._requestManager,(g,r)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new m.ErrorEvent(g)):r&&(m.extend(this,r),r.bounds&&(this.tileBounds=new Bo(r.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(r.tiles,this.map._requestManager._customAccessToken),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}setSourceProperty(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g();const r=this.map.style._getSourceCaches(this.id);for(const d of r)d.clearTiles();this.load()}setTiles(g){return this.setSourceProperty(()=>{this._options.tiles=g}),this}setUrl(g){return this.setSourceProperty(()=>{this.url=g,this._options.url=g}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return m.extend({},this._options)}loadTile(g,r){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(d,m.ResourceType.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:g.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,g.actor&&"expired"!==g.state)"loading"===g.state?g.reloadCallback=r:g.request=g.actor.send("reloadTile",y,M.bind(this));else if(g.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)g.request=g.actor.send("loadTile",y,M.bind(this),void 0,!0);else{const T=m.loadVectorTile.call({deduped:this._deduped},y,(A,L)=>{A||!L?M.call(this,A):(y.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},g.actor&&g.actor.send("loadTile",y,M.bind(this),void 0,!0))},!0);g.request={cancel:T}}function M(T,A){return delete g.request,g.aborted?r(null):T&&404!==T.status?r(T):(A&&A.resourceTiming&&(g.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&g.setExpiryData(A),g.loadVectorData(A,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id})}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:X,"raster-dem":class extends X{constructor(g,r,d,y){super(g,r,d,y),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(g,r){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(M,T){M&&(g.state="errored",r(M)),T&&(g.dem=T,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",r(null))}g.request=m.getImage(this.map._requestManager.transformRequest(d,m.ResourceType.Tile),function(M,T,A,L){if(delete g.request,g.aborted)g.state="unloaded",r(null);else if(M)g.state="errored",r(M);else if(T){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:A,expires:L});const F=m.window.ImageBitmap&&T instanceof m.window.ImageBitmap&&(null==ae&&(ae=m.window.OffscreenCanvas&&new m.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof m.window.createImageBitmap),ae),V=1-(T.width-m.prevPowerOfTwo(T.width))/2;V<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const G=F?T:m.exported.getImageData(T,V),q={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:G,encoding:this.encoding,padding:V};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",q,y.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const r=g.canonical,d=Math.pow(2,r.z),y=(r.x-1+d)%d,M=0===r.x?g.wrap-1:g.wrap,T=(r.x+1+d)%d,A=r.x+1===d?g.wrap+1:g.wrap,L={};return L[new m.OverscaledTileID(g.overscaledZ,M,r.z,y,r.y).key]={backfilled:!1},L[new m.OverscaledTileID(g.overscaledZ,A,r.z,T,r.y).key]={backfilled:!1},r.y>0&&(L[new m.OverscaledTileID(g.overscaledZ,M,r.z,y,r.y-1).key]={backfilled:!1},L[new m.OverscaledTileID(g.overscaledZ,g.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},L[new m.OverscaledTileID(g.overscaledZ,A,r.z,T,r.y-1).key]={backfilled:!1}),r.y+1<d&&(L[new m.OverscaledTileID(g.overscaledZ,M,r.z,y,r.y+1).key]={backfilled:!1},L[new m.OverscaledTileID(g.overscaledZ,g.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},L[new m.OverscaledTileID(g.overscaledZ,A,r.z,T,r.y+1).key]={backfilled:!1}),L}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends m.Evented{constructor(g,r,d,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(y),this._data=r.data,this._options=m.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const M=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*M,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*M,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:m.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*M,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},r),this}getClusterChildren(g,r){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},r),this}getClusterLeaves(g,r,d,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:r,offset:d},y),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new m.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=m.extend({},this.workerOptions),r=this._data;"string"==typeof r?(g.request=this.map._requestManager.transformRequest(m.exported.resolveURL(r),m.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new m.ErrorEvent(d));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(M.resourceTiming=y.resourceTiming[this.id]),this.fire(new m.Event("data",M)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,r){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(d,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(y,M)=>(delete g.request,g.unloadVectorData(),g.aborted?r(null):y?r(y):(g.loadVectorData(M,this.map.painter,"reloadTile"===d),r(null))),void 0,"loadTile"===d)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return m.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Me{constructor(g,r,d,y){super(g,r,d,y),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const r of g.urls)this.urls.push(this.map._requestManager.transformRequest(r,m.ResourceType.Source).url);m.getVideo(this.urls,(r,d)=>{this._loaded=!0,r?this.fire(new m.ErrorEvent(r)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const r=this.video.seekable;g<r.start(0)||g>r.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,r=g.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(g,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Me,canvas:class extends Me{constructor(g,r,d,y){super(g,r,d,y),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(M=>!Array.isArray(M)||2!==M.length||M.some(T=>"number"!=typeof T))||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends m.Evented{constructor(g,r,d,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=r,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new m.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new m.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bo(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.coveringTiles=this._coveringTiles.bind(this),m.extend(this,m.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return m.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:r,y:d,z:y}=g.canonical;return this._implementation.hasTile({x:r,y:d,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,r){const{x:d,y,z:M}=g.tileID.canonical,T=new m.window.AbortController,A=this._implementation.loadTile({x:d,y,z:M},{signal:T.signal});if(!A)return this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",r(null);A.cancel=()=>T.abort(),g.request=A.then(function(L){return delete g.request,g.aborted?(g.state="unloaded",r(null)):L?(F=L)instanceof m.window.ImageData||F instanceof m.window.ImageBitmap||F instanceof m.window.HTMLCanvasElement?(this.loadTileData(g,L),g.state="loaded",void r(null)):(g.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",r(null));var F}.bind(this)).catch(L=>{20!==L.code&&(g.state="errored",r(L))})}loadTileData(g,r){X.loadTileData(g,r,this._map.painter)}unloadTileData(g){X.unloadTileData(g,this._map.painter)}prepareTile(g){if(!this._implementation.prepareTile)return null;const{x:r,y:d,z:y}=g.tileID.canonical,M=this._implementation.prepareTile({x:r,y:d,z:y});return M?(this.loadTileData(g,M),g.state="loaded",M):null}unloadTile(g,r){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:d,y,z:M}=g.tileID.canonical;this._implementation.unloadTile({x:d,y,z:M})}r()}abortTile(g,r){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_update(){this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Be=function(g,r,d,y){const M=new Ue[r.type](g,r,d,y);if(M.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${M.id}`);return m.bindAll(["load","abort","unload","serialize","prepare"],M),M};function Ae(g,r){const d=m.identity([]);return m.scale(d,d,[.5*g.width,.5*-g.height,1]),m.translate(d,d,[1,-1,0]),m.multiply$1(d,d,g.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(d)}function we(g,r,d,y,M,T,A,L=!1){const F=g.tilesIn(y,A,L);F.sort(At);const V=[];for(const q of F)V.push({wrappedTileID:q.tile.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(r,d,g._state,q,M,T,Ae(g.transform,q.tile.tileID),L)});const G=function(q){const ee={},re={};for(const ie of q){const J=ie.queryResults,ge=ie.wrappedTileID,ce=re[ge]=re[ge]||{};for(const pe in J){const _e=J[pe],ye=ce[pe]=ce[pe]||{},ue=ee[pe]=ee[pe]||[];for(const xe of _e)ye[xe.featureIndex]||(ye[xe.featureIndex]=!0,ue.push(xe))}}return ee}(V);for(const q in G)G[q].forEach(ee=>{const re=ee.feature,ie=re.layer;ie&&"background"!==ie.type&&"sky"!==ie.type&&(re.source=ie.source,ie["source-layer"]&&(re.sourceLayer=ie["source-layer"]),re.state=void 0!==re.id?g.getFeatureState(ie["source-layer"],re.id):{})});return G}function rt(g,r){const d=g.getRenderableIds().map(T=>g.getTileByID(T)),y=[],M={};for(let T=0;T<d.length;T++){const A=d[T],L=A.tileID.canonical.key;M[L]||(M[L]=!0,A.querySourceFeatures(y,r))}return y}function At(g,r){const d=g.tileID,y=r.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}function ut(){return null!=tc.workerClass?new tc.workerClass:new m.window.Worker(tc.workerUrl)}const Qt="mapboxgl_preloaded_worker_pool";class Jt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Jt.workerCount;)this.workers.push(new ut);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Qt]}numActive(){return Object.keys(this.active).length}}let Dt;function Rt(){return Dt||(Dt=new Jt),Dt}function Fe(g,r){const d={};for(const y in g)"ref"!==y&&(d[y]=g[y]);return m.refProperties.forEach(y=>{y in r&&(d[y]=r[y])}),d}function Di(g){g=g.slice();const r=Object.create(null);for(let d=0;d<g.length;d++)r[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=Fe(g[d],r[g[d].ref]));return g}Jt.workerCount=2;const Ut={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ui(g,r,d){d.push({command:Ut.addSource,args:[g,r[g]]})}function me(g,r,d){r.push({command:Ut.removeSource,args:[g]}),d[g]=!0}function Go(g,r,d,y){me(g,d,y),ui(g,r,d)}function mo(g,r,d){let y;for(y in g[d])if(g[d].hasOwnProperty(y)&&"data"!==y&&!ct(g[d][y],r[d][y]))return!1;for(y in r[d])if(r[d].hasOwnProperty(y)&&"data"!==y&&!ct(g[d][y],r[d][y]))return!1;return!0}function yt(g,r,d,y,M,T){let A;for(A in r=r||{},g=g||{})g.hasOwnProperty(A)&&(ct(g[A],r[A])||d.push({command:T,args:[y,A,r[A],M]}));for(A in r)r.hasOwnProperty(A)&&!g.hasOwnProperty(A)&&(ct(g[A],r[A])||d.push({command:T,args:[y,A,r[A],M]}))}function fi(g){return g.id}function pi(g,r){return g[r.id]=r,g}class Is{constructor(r,d){this.reset(r,d)}reset(r,d){this.points=r||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=m.clamp(r,0,1);let d=1,y=this._distances[d];const M=r*this.paddedLength+this.padding;for(;y<M&&d<this._distances.length;)y=this._distances[++d];const T=d-1,A=this._distances[T],L=y-A,F=L>0?(M-A)/L:0;return this.points[T].mult(1-F).add(this.points[d].mult(F))}}class Ds{constructor(r,d,y){const M=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(r/y),this.yCellCount=Math.ceil(d/y);for(let A=0;A<this.xCellCount*this.yCellCount;A++)M.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=d,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,d,y,M,T){this._forEachCell(d,y,M,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(M),this.bboxes.push(T)}insertCircle(r,d,y,M){this._forEachCell(d-M,y-M,d+M,y+M,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(d),this.circles.push(y),this.circles.push(M)}_insertBoxCell(r,d,y,M,T,A){this.boxCells[T].push(A)}_insertCircleCell(r,d,y,M,T,A){this.circleCells[T].push(A)}_query(r,d,y,M,T,A){if(y<0||r>this.width||M<0||d>this.height)return!T&&[];const L=[];if(r<=0&&d<=0&&this.width<=y&&this.height<=M){if(T)return!0;for(let F=0;F<this.boxKeys.length;F++)L.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],G=this.circles[3*F+1],q=this.circles[3*F+2];L.push({key:this.circleKeys[F],x1:V-q,y1:G-q,x2:V+q,y2:G+q})}return A?L.filter(A):L}return this._forEachCell(r,d,y,M,this._queryCell,L,{hitTest:T,seenUids:{box:{},circle:{}}},A),T?L.length>0:L}_queryCircle(r,d,y,M,T){const A=r-y,L=r+y,F=d-y,V=d+y;if(L<0||A>this.width||V<0||F>this.height)return!M&&[];const G=[];return this._forEachCell(A,F,L,V,this._queryCellCircle,G,{hitTest:M,circle:{x:r,y:d,radius:y},seenUids:{box:{},circle:{}}},T),M?G.length>0:G}query(r,d,y,M,T){return this._query(r,d,y,M,!1,T)}hitTest(r,d,y,M,T){return this._query(r,d,y,M,!0,T)}hitTestCircle(r,d,y,M){return this._queryCircle(r,d,y,!0,M)}_queryCell(r,d,y,M,T,A,L,F){const V=L.seenUids,G=this.boxCells[T];if(null!==G){const ee=this.bboxes;for(const re of G)if(!V.box[re]){V.box[re]=!0;const ie=4*re;if(r<=ee[ie+2]&&d<=ee[ie+3]&&y>=ee[ie+0]&&M>=ee[ie+1]&&(!F||F(this.boxKeys[re]))){if(L.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[re],x1:ee[ie],y1:ee[ie+1],x2:ee[ie+2],y2:ee[ie+3]})}}}const q=this.circleCells[T];if(null!==q){const ee=this.circles;for(const re of q)if(!V.circle[re]){V.circle[re]=!0;const ie=3*re;if(this._circleAndRectCollide(ee[ie],ee[ie+1],ee[ie+2],r,d,y,M)&&(!F||F(this.circleKeys[re]))){if(L.hitTest)return A.push(!0),!0;{const J=ee[ie],ge=ee[ie+1],ce=ee[ie+2];A.push({key:this.circleKeys[re],x1:J-ce,y1:ge-ce,x2:J+ce,y2:ge+ce})}}}}}_queryCellCircle(r,d,y,M,T,A,L,F){const V=L.circle,G=L.seenUids,q=this.boxCells[T];if(null!==q){const re=this.bboxes;for(const ie of q)if(!G.box[ie]){G.box[ie]=!0;const J=4*ie;if(this._circleAndRectCollide(V.x,V.y,V.radius,re[J+0],re[J+1],re[J+2],re[J+3])&&(!F||F(this.boxKeys[ie])))return A.push(!0),!0}}const ee=this.circleCells[T];if(null!==ee){const re=this.circles;for(const ie of ee)if(!G.circle[ie]){G.circle[ie]=!0;const J=3*ie;if(this._circlesCollide(re[J],re[J+1],re[J+2],V.x,V.y,V.radius)&&(!F||F(this.circleKeys[ie])))return A.push(!0),!0}}}_forEachCell(r,d,y,M,T,A,L,F){const V=this._convertToXCellCoord(r),G=this._convertToYCellCoord(d),q=this._convertToXCellCoord(y),ee=this._convertToYCellCoord(M);for(let re=V;re<=q;re++)for(let ie=G;ie<=ee;ie++)if(T.call(this,r,d,y,M,this.xCellCount*ie+re,A,L,F))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,d,y,M,T,A){const L=M-r,F=T-d,V=y+A;return V*V>L*L+F*F}_circleAndRectCollide(r,d,y,M,T,A,L){const F=(A-M)/2,V=Math.abs(r-(M+F));if(V>F+y)return!1;const G=(L-T)/2,q=Math.abs(d-(T+G));if(q>G+y)return!1;if(V<=F||q<=G)return!0;const ee=V-F,re=q-G;return ee*ee+re*re<=y*y}}const gi=Math.tan(85*Math.PI/180);function Ls(g,r,d,y,M,T){const A=m.create();if(d){if("globe"===M.projection.name)m.multiply$1(A,A,m.calculateGlobeLabelMatrix(M,r));else{const L=qa([],T);A[0]=L[0],A[1]=L[1],A[4]=L[2],A[5]=L[3]}y||m.rotateZ(A,A,M.angle)}else m.multiply$1(A,M.labelPlaneMatrix,g);return A}function us(g,r,d,y,M,T){if(d){if("globe"===M.projection.name){const A=Ls(g,r,d,y,M,T);return m.invert(A,A),m.multiply$1(A,g,A),A}{const A=m.clone(g),L=m.identity([]);return L[0]=T[0],L[1]=T[1],L[4]=T[2],L[5]=T[3],m.multiply$1(A,A,L),y||m.rotateZ(A,A,-M.angle),A}}return M.glCoordMatrix}function Un(g,r,d=0){const y=[g.x,g.y,d,1];d?m.transformMat4$1(y,y,r):Ar(y,y,r);const M=y[3];return{point:new m.pointGeometry(y[0]/M,y[1]/M),signedDistanceFromCamera:M}}function lr(g,r){const d=[g[0],g[1],g[2],1];m.transformMat4$1(d,d,r);const y=d[3];return{point:new m.pointGeometry(d[0]/y,d[1]/y),signedDistanceFromCamera:y}}function on(g,r){return Math.min(.5+g/r*.5,1.5)}function Lh(g,r){const d=g[0]/g[3],y=g[1]/g[3];return d>=-r[0]&&d<=r[0]&&y>=-r[1]&&y<=r[1]}function wa(g,r,d,y,M,T,A,L,F,V){const G=d.transform,q=y?g.textSizeData:g.iconSizeData,ee=m.evaluateSizeForZoom(q,d.transform.zoom),re=[256/d.width*2+1,256/d.height*2+1],ie=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ie.clear();const J=g.lineVertexArray,ge=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,ce=d.transform.width/d.transform.height;let pe=!1;for(let _e=0;_e<ge.length;_e++){const ye=ge.get(_e);if(ye.writingMode!==m.WritingMode.vertical||pe||0!==_e&&ge.get(_e-1).writingMode===m.WritingMode.horizontal||(pe=!0),(ye.hidden||ye.writingMode===m.WritingMode.vertical)&&!pe){cn(ye.numGlyphs,ie);continue}pe=!1;const ue=new m.pointGeometry(ye.tileAnchorX,ye.tileAnchorY),xe=F?F(ue):[0,0,0],Ne=G.projection.projectTilePoint(ue.x,ue.y,V.canonical),He=[Ne.x+xe[0],Ne.y+xe[1],Ne.z+xe[2]],Ye=[...He,1];if(m.transformMat4$1(Ye,Ye,r),!Lh(Ye,re)){cn(ye.numGlyphs,ie);continue}const Xe=on(d.transform.cameraToCenterDistance,Ye[3]),St=m.evaluateSizeForFeature(q,ee,ye),Ie=A?St/Xe:St*Xe,mt=Un(new m.pointGeometry(He[0],He[1]),M,He[2]);if(mt.signedDistanceFromCamera<=0){cn(ye.numGlyphs,ie);continue}let ft={};const Tt=A?null:F,je=Rh(ye,Ie,!1,L,r,M,T,g.glyphOffsetArray,J,ie,mt.point,ue,ft,ce,Tt,G.projection,V);pe=je.useVertical,Tt&&je.needsFlipping&&(ft={}),(je.notEnoughRoom||pe||je.needsFlipping&&Rh(ye,Ie,!0,L,r,M,T,g.glyphOffsetArray,J,ie,mt.point,ue,ft,ce,Tt,G.projection,V).notEnoughRoom)&&cn(ye.numGlyphs,ie)}y?g.text.dynamicLayoutVertexBuffer.updateData(ie):g.icon.dynamicLayoutVertexBuffer.updateData(ie)}function fo(g,r,d,y,M,T,A,L,F,V,G,q,ee,re,ie){const J=L.glyphStartIndex+L.numGlyphs,ge=L.lineStartIndex,ce=L.lineStartIndex+L.lineLength,pe=r.getoffsetX(L.glyphStartIndex),_e=r.getoffsetX(J-1),ye=Sa(g*pe,d,y,M,T,A,L.segment,ge,ce,F,V,G,q,ee,!0,re,ie);if(!ye)return null;const ue=Sa(g*_e,d,y,M,T,A,L.segment,ge,ce,F,V,G,q,ee,!0,re,ie);return ue?{first:ye,last:ue}:null}function Ma(g,r,d,y){return g.writingMode===m.WritingMode.horizontal&&Math.abs(d.y-r.y)>Math.abs(d.x-r.x)*y?{useVertical:!0}:g.writingMode===m.WritingMode.vertical?r.y<d.y?{needsFlipping:!0}:null:0!==g.flipState&&function(M,T,A){const L=(T.x-M.x)*A;return 0===L||Math.abs((T.y-M.y)/L)>gi}(r,d,y)?1===g.flipState?{needsFlipping:!0}:null:r.x>d.x?{needsFlipping:!0}:null}function Rh(g,r,d,y,M,T,A,L,F,V,G,q,ee,re,ie,J,ge){const ce=r/24,pe=g.lineOffsetX*ce,_e=g.lineOffsetY*ce;let ye;if(g.numGlyphs>1){const ue=g.glyphStartIndex+g.numGlyphs,xe=g.lineStartIndex,Ne=g.lineStartIndex+g.lineLength,He=fo(ce,L,pe,_e,d,G,q,g,F,T,ee,ie,!1,J,ge);if(!He)return{notEnoughRoom:!0};const Ye=Un(He.first.point,A).point,Xe=Un(He.last.point,A).point;if(y&&!d){const St=Ma(g,Ye,Xe,re);if(g.flipState=St&&St.needsFlipping?1:2,St)return St}ye=[He.first];for(let St=g.glyphStartIndex+1;St<ue-1;St++)ye.push(Sa(ce*L.getoffsetX(St),pe,_e,d,G,q,g.segment,xe,Ne,F,T,ee,ie,!1,!1,J,ge));ye.push(He.last)}else{if(y&&!d){const xe=Un(q,M).point,Ne=g.lineStartIndex+g.segment+1,He=new m.pointGeometry(F.getx(Ne),F.gety(Ne)),Ye=Un(He,M),Xe=Ma(g,xe,Ye.signedDistanceFromCamera>0?Ye.point:Ii(q,He,xe,1,M,void 0,J,ge.canonical),re);if(g.flipState=Xe&&Xe.needsFlipping?1:2,Xe)return Xe}const ue=Sa(ce*L.getoffsetX(g.glyphStartIndex),pe,_e,d,G,q,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,F,T,ee,ie,!1,!1,J,ge);if(!ue)return{notEnoughRoom:!0};ye=[ue]}for(const ue of ye)m.addDynamicAttributes(V,ue.point,ue.angle);return{}}function kh(g,r,d,y,M){const T=y.projectTilePoint(g.x,g.y,r);if(!M)return Un(T,d,T.z);const A=M(g);return Un(new m.pointGeometry(T.x+A[0],T.y+A[1]),d,T.z+A[2])}function Ii(g,r,d,y,M,T,A,L){const F=kh(g.add(g.sub(r)._unit()),L,M,A,T).point,V=d.sub(F);return d.add(V._mult(y/V.mag()))}function Sa(g,r,d,y,M,T,A,L,F,V,G,q,ee,re,ie,J,ge){const ce=y?g-r:g+r;let pe=ce>0?1:-1,_e=0;y&&(pe*=-1,_e=Math.PI),pe<0&&(_e+=Math.PI);let ye=pe>0?L+A:L+A+1,ue=M,xe=M,Ne=0,He=0;const Ye=Math.abs(ce),Xe=[],St=[];let Ie=T;const mt=()=>{const zt=ye-pe;return 0===Ne?T:new m.pointGeometry(V.getx(zt),V.gety(zt))},ft=()=>Ii(mt(),Ie,xe,Ye-Ne+1,G,ee,J,ge.canonical);for(;Ne+He<=Ye;){if(ye+=pe,ye<L||ye>=F)return null;if(xe=ue,Xe.push(ue),re&&St.push(Ie||mt()),ue=q[ye],void 0===ue){Ie=new m.pointGeometry(V.getx(ye),V.gety(ye));const zt=kh(Ie,ge.canonical,G,J,ee);ue=zt.signedDistanceFromCamera>0?q[ye]=zt.point:ft()}else Ie=null;Ne+=He,He=xe.dist(ue)}ie&&ee&&(Ie=Ie||new m.pointGeometry(V.getx(ye),V.gety(ye)),q[ye]=ue=void 0===q[ye]?ue:ft(),He=xe.dist(ue));const Tt=(Ye-Ne)/He,je=ue.sub(xe),$t=je.mult(Tt)._add(xe);d&&$t._add(je._unit()._perp()._mult(d*pe));const Wt=_e+Math.atan2(ue.y-xe.y,ue.x-xe.x);return Xe.push($t),re&&(Ie=Ie||new m.pointGeometry(V.getx(ye),V.gety(ye)),St.push(function(zt,Ot,Kt){const li=1-Kt;return new m.pointGeometry(zt.x*li+Ot.x*Kt,zt.y*li+Ot.y*Kt)}(St.length>0?St[St.length-1]:Ie,Ie,Tt))),{point:$t,angle:Wt,path:Xe,tilePath:St}}const Ks=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function cn(g,r){for(let d=0;d<g;d++){const y=r.length;r.resize(y+4),r.float32.set(Ks,3*y)}}function Ar(g,r,d){const y=r[0],M=r[1];return g[0]=d[0]*y+d[4]*M+d[12],g[1]=d[1]*y+d[5]*M+d[13],g[3]=d[3]*y+d[7]*M+d[15],g}const $r=100;class Qs{constructor(r,d,y=new Ds(r.width+200,r.height+200,25),M=new Ds(r.width+200,r.height+200,25)){this.transform=r,this.grid=y,this.ignoredGrid=M,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+$r,this.screenBottomBoundary=r.height+$r,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=d}placeCollisionBox(r,d,y,M,T,A,L){let F=d.projectedAnchorX,V=d.projectedAnchorY,G=d.projectedAnchorZ;const q=d.elevation,ee=d.tileID;if(q&&ee){const ye=this.transform.projection.upVector(ee.canonical,d.tileAnchorX,d.tileAnchorY),ue=this.transform.projection.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=ye[0]*q*ue,V+=ye[1]*q*ue,G+=ye[2]*q*ue}const re=this.projectAndGetPerspectiveRatio(A,[F,V,G],d.tileID,"globe"===this.transform.projection.name||!!q||this.transform.pitch>0),ie=T*re.perspectiveRatio,J=(d.x1*r+y.x-d.padding)*ie+re.point.x,ge=(d.y1*r+y.y-d.padding)*ie+re.point.y,ce=(d.x2*r+y.x+d.padding)*ie+re.point.x,pe=(d.y2*r+y.y+d.padding)*ie+re.point.y,_e=re.perspectiveRatio<=.55||re.occluded;return!this.isInsideGrid(J,ge,ce,pe)||!M&&this.grid.hitTest(J,ge,ce,pe,L)||_e?{box:[],offscreen:!1,occluded:re.occluded}:{box:[J,ge,ce,pe],offscreen:this.isOffscreen(J,ge,ce,pe),occluded:!1}}placeCollisionCircles(r,d,y,M,T,A,L,F,V,G,q,ee,re,ie){const J=[],ge=this.transform.elevation,ce=ge?ge.getAtTileOffsetFunc(ie,this.transform.center.lat,this.transform.worldSize,this.transform.projection):ft=>[0,0,0],pe=new m.pointGeometry(d.tileAnchorX,d.tileAnchorY),_e=this.transform.projection.projectTilePoint(d.tileAnchorX,d.tileAnchorY,ie.canonical),ye=ce(pe),ue=[_e.x+ye[0],_e.y+ye[1],_e.z+ye[2]],xe=this.projectAndGetPerspectiveRatio(A,[ue[0],ue[1],ue[2]],ie,"globe"===this.transform.projection.name||!!ge||this.transform.pitch>0),{perspectiveRatio:Ne}=xe,He=(G?T/Ne:T*Ne)/m.ONE_EM,Ye=Un(new m.pointGeometry(ue[0],ue[1]),L,ue[2]).point,Xe=xe.signedDistanceFromCamera>0?fo(He,M,d.lineOffsetX*He,d.lineOffsetY*He,!1,Ye,pe,d,y,L,{},ge&&!G?ce:null,G&&!!ge,this.transform.projection,ie):null;let St=!1,Ie=!1,mt=!0;if(Xe&&!xe.occluded){const ft=.5*ee*Ne+re,Tt=new m.pointGeometry(-100,-100),je=new m.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),$t=new Is,Wt=Xe.first,zt=Xe.last;let Ot=[];for(let Vt=Wt.path.length-1;Vt>=1;Vt--)Ot.push(Wt.path[Vt]);for(let Vt=1;Vt<zt.path.length;Vt++)Ot.push(zt.path[Vt]);const Kt=2.5*ft;if(F){const Vt=Ot.map(ge?(oi,Mi)=>{const pn=ce(Mi<Wt.path.length-1?Wt.tilePath[Wt.path.length-1-Mi]:zt.tilePath[Mi-Wt.path.length+2]);return Un(oi,F,pn[2])}:oi=>Un(oi,F));Ot=Vt.some(oi=>oi.signedDistanceFromCamera<=0)?[]:Vt.map(oi=>oi.point)}let li=[];if(Ot.length>0){const Vt=Ot[0].clone(),oi=Ot[0].clone();for(let Mi=1;Mi<Ot.length;Mi++)Vt.x=Math.min(Vt.x,Ot[Mi].x),Vt.y=Math.min(Vt.y,Ot[Mi].y),oi.x=Math.max(oi.x,Ot[Mi].x),oi.y=Math.max(oi.y,Ot[Mi].y);li=Vt.x>=Tt.x&&oi.x<=je.x&&Vt.y>=Tt.y&&oi.y<=je.y?[Ot]:oi.x<Tt.x||Vt.x>je.x||oi.y<Tt.y||Vt.y>je.y?[]:m.clipLine([Ot],Tt.x,Tt.y,je.x,je.y)}for(const Vt of li){$t.reset(Vt,.25*ft);let oi=0;oi=$t.length<=.5*ft?1:Math.ceil($t.paddedLength/Kt)+1;for(let Mi=0;Mi<oi;Mi++){const pn=Mi/Math.max(oi-1,1),nr=$t.lerp(pn),pr=nr.x+$r,Rr=nr.y+$r;J.push(pr,Rr,ft,0);const Fs=pr-ft,Us=Rr-ft,ea=pr+ft,Mo=Rr+ft;if(mt=mt&&this.isOffscreen(Fs,Us,ea,Mo),Ie=Ie||this.isInsideGrid(Fs,Us,ea,Mo),!r&&this.grid.hitTestCircle(pr,Rr,ft,q)&&(St=!0,!V))return{circles:[],offscreen:!1,collisionDetected:St,occluded:!1}}}}return{circles:!V&&St||!Ie?[]:J,offscreen:mt,collisionDetected:St,occluded:xe.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let y=1/0,M=1/0,T=-1/0,A=-1/0;for(const G of r){const q=new m.pointGeometry(G.x+$r,G.y+$r);y=Math.min(y,q.x),M=Math.min(M,q.y),T=Math.max(T,q.x),A=Math.max(A,q.y),d.push(q)}const L=this.grid.query(y,M,T,A).concat(this.ignoredGrid.query(y,M,T,A)),F={},V={};for(const G of L){const q=G.key;if(void 0===F[q.bucketInstanceId]&&(F[q.bucketInstanceId]={}),F[q.bucketInstanceId][q.featureIndex])continue;const ee=[new m.pointGeometry(G.x1,G.y1),new m.pointGeometry(G.x2,G.y1),new m.pointGeometry(G.x2,G.y2),new m.pointGeometry(G.x1,G.y2)];m.polygonIntersectsPolygon(d,ee)&&(F[q.bucketInstanceId][q.featureIndex]=!0,void 0===V[q.bucketInstanceId]&&(V[q.bucketInstanceId]=[]),V[q.bucketInstanceId].push(q.featureIndex))}return V}insertCollisionBox(r,d,y,M,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:M,collisionGroupID:T},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,d,y,M,T){const A=d?this.ignoredGrid:this.grid,L={bucketInstanceId:y,featureIndex:M,collisionGroupID:T};for(let F=0;F<r.length;F+=4)A.insertCircle(L,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,d,y,M){const T=[d[0],d[1],d[2],1];let A=!1;return d[2]||this.transform.pitch>0?(m.transformMat4$1(T,T,r),this.fogState&&y&&(A=function(L,F,V,G,q,ee){const re=ee.calculateFogTileMatrix(q),ie=[F,V,G];return m.transformMat4(ie,ie,re),co(L,ie,ee.pitch,ee._fov)}(this.fogState,d[0],d[1],d[2],y.toUnwrapped(),this.transform)>.9)):Ar(T,T,r),{point:new m.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+$r,(-T[1]/T[3]+1)/2*this.transform.height+$r),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/T[3]*.5,1.5),signedDistanceFromCamera:T[3],occluded:M&&T[2]>T[3]||A}}isOffscreen(r,d,y,M){return y<$r||r>=this.screenRightBoundary||M<$r||d>this.screenBottomBoundary}isInsideGrid(r,d,y,M){return y>=0&&r<this.gridRightBoundary&&M>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const r=m.identity([]);return m.translate(r,r,[-100,-100,0]),r}}class In{constructor(r,d,y,M){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?d:-d))):M&&y?1:0,this.placed=y}isHidden(){return 0===this.opacity&&!this.placed}}class Rs{constructor(r,d,y,M,T,A=!1){this.text=new In(r?r.text:null,d,y,T),this.icon=new In(r?r.icon:null,d,M,T),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class eo{constructor(r,d,y,M=!1){this.text=r,this.icon=d,this.skipFade=y,this.clipped=M}}class Dn{constructor(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]}}class ii{constructor(r,d,y,M,T){this.bucketInstanceId=r,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=M,this.tileID=T}}class _r{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const d=++this.maxGroupID;this.collisionGroups[r]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[r]}}function yr(g,r,d,y,M){const{horizontalAlign:T,verticalAlign:A}=m.getAnchorAlignment(g),L=-(T-.5)*r,F=-(A-.5)*d,V=m.evaluateVariableOffset(g,y);return new m.pointGeometry(L+V[0]*M,F+V[1]*M)}function Nl(g,r,d,y,M){const T=new m.pointGeometry(g,r);return d&&T._rotate(y?M:-M),T}class Nm{constructor(r,d,y,M,T){this.transform=r.clone(),this.collisionIndex=new Qs(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new _r(y),this.collisionCircleArrays={},this.prevPlacement=M,M&&(M.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,d,y,M){const T=y.getBucket(d),A=y.latestFeatureIndex;if(!T||!A||d.id!==T.layerIds[0])return;const L=T.layers[0].layout,F=y.collisionBoxArray,V=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),G=y.tileSize/m.EXTENT,q=y.tileID.toUnwrapped(),ee=this.transform.calculateProjMatrix(q),re="map"===L.get("text-pitch-alignment"),ie="map"===L.get("text-rotation-alignment");d.compileFilter();const J=d.dynamicFilter(),ge=d.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(y),pe=Ls(ee,y.tileID.canonical,re,ie,this.transform,ce);let _e=null;if(re){const xe=us(ee,y.tileID.canonical,re,ie,this.transform,ce);_e=m.multiply$1([],this.transform.labelPlaneMatrix,xe)}let ye=null;J&&y.latestFeatureIndex&&(ye={unwrappedTileID:q,dynamicFilter:J,dynamicFilterNeedsFeature:ge,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new ii(T.bucketInstanceId,A,T.sourceLayerIndex,T.index,y.tileID);const ue={bucket:T,layout:L,posMatrix:ee,textLabelPlaneMatrix:pe,labelToScreenMatrix:_e,clippingData:ye,scale:V,textPixelRatio:G,holdingForFade:y.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:m.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(M)for(const xe of T.sortKeyRanges){const{sortKey:Ne,symbolInstanceStart:He,symbolInstanceEnd:Ye}=xe;r.push({sortKey:Ne,symbolInstanceStart:He,symbolInstanceEnd:Ye,parameters:ue})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(r,d,y,M,T,A,L,F,V,G,q,ee,re,ie,J,ge,ce,pe){const _e=[ee.textOffset0,ee.textOffset1],ye=yr(r,y,M,_e,T),ue=this.collisionIndex.placeCollisionBox(T,d,Nl(ye.x,ye.y,A,L,this.transform.angle),q,F,V,G.predicate);if((!ge||0!==this.collisionIndex.placeCollisionBox(ie.getSymbolInstanceIconSize(pe,this.transform.zoom,re),ge,Nl(ye.x,ye.y,A,L,this.transform.angle),q,F,V,G.predicate).box.length)&&ue.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID].text&&(xe=this.prevPlacement.variableOffsets[ee.crossTileID].anchor),this.variableOffsets[ee.crossTileID]={textOffset:_e,width:y,height:M,anchor:r,textScale:T,prevAnchor:xe},this.markUsedJustification(ie,r,ee,J),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,J,ee),this.placedOrientations[ee.crossTileID]=J),{shift:ye,placedGlyphBoxes:ue}}}placeLayerBucketPart(r,d,y,M){const{bucket:T,layout:A,posMatrix:L,textLabelPlaneMatrix:F,labelToScreenMatrix:V,clippingData:G,textPixelRatio:q,holdingForFade:ee,collisionBoxArray:re,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:J,collisionGroup:ge}=r.parameters,ce=A.get("text-optional"),pe=A.get("icon-optional"),_e=A.get("text-allow-overlap"),ye=A.get("icon-allow-overlap"),ue="map"===A.get("text-rotation-alignment"),xe="map"===A.get("text-pitch-alignment"),Ne="none"!==A.get("icon-text-fit"),He="viewport-y"===A.get("symbol-z-order");let Ye=_e&&(ye||!T.hasIconData()||pe),Xe=ye&&(_e||!T.hasTextData()||ce);!T.collisionArrays&&re&&T.deserializeCollisionBoxes(re),y&&M&&T.updateCollisionDebugBuffers(this.transform.zoom,re);const St=(Ie,mt,ft)=>{if(G){const wn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Rn=null;if(G.dynamicFilterNeedsFeature){const Oi=this.retainedQueryData[T.bucketInstanceId];Rn=G.featureIndex.loadFeature({featureIndex:Ie.featureIndex,bucketIndex:Oi.bucketIndex,sourceLayerIndex:Oi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,G.dynamicFilter)(wn,Rn,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new m.pointGeometry(Ie.tileAnchorX,Ie.tileAnchorY),this.transform.calculateDistanceTileData(G.unwrappedTileID)))return this.placements[Ie.crossTileID]=new eo(!1,!1,!1,!0),void(d[Ie.crossTileID]=!0)}if(d[Ie.crossTileID])return;if(ee)return void(this.placements[Ie.crossTileID]=new eo(!1,!1,!1));let Tt=!1,je=!1,$t=!0,Wt=!1,zt=!1,Ot=null,Kt={box:null,offscreen:null,occluded:null},li={box:null,offscreen:null,occluded:null},Vt=null,oi=null,Mi=null,pn=0,nr=0,pr=0;ft.textFeatureIndex?pn=ft.textFeatureIndex:Ie.useRuntimeCollisionCircles&&(pn=Ie.featureIndex),ft.verticalTextFeatureIndex&&(nr=ft.verticalTextFeatureIndex);const Rr=wn=>{wn.tileID=this.retainedQueryData[T.bucketInstanceId].tileID,(this.transform.elevation||wn.elevation)&&(wn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[T.bucketInstanceId].tileID,wn.tileAnchorX,wn.tileAnchorY):0)},Fs=ft.textBox;if(Fs){Rr(Fs);const wn=Oi=>{let kn=m.WritingMode.horizontal;if(T.allowVerticalPlacement&&!Oi&&this.prevPlacement){const kr=this.prevPlacement.placedOrientations[Ie.crossTileID];kr&&(this.placedOrientations[Ie.crossTileID]=kr,kn=kr,this.markUsedOrientation(T,kn,Ie))}return kn},Rn=(Oi,kn)=>{if(T.allowVerticalPlacement&&Ie.numVerticalGlyphVertices>0&&ft.verticalTextBox){for(const kr of T.writingModes)if(kr===m.WritingMode.vertical?(Kt=kn(),li=Kt):Kt=Oi(),Kt&&Kt.box&&Kt.box.length)break}else Kt=Oi()};if(A.get("text-variable-anchor")){let Oi=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ie.crossTileID]){const _n=this.prevPlacement.variableOffsets[Ie.crossTileID];Oi.indexOf(_n.anchor)>0&&(Oi=Oi.filter(_s=>_s!==_n.anchor),Oi.unshift(_n.anchor))}const kn=(_n,_s,Jc)=>{const zr=T.getSymbolInstanceTextSize(ie,Ie,this.transform.zoom,mt),ta=(_n.x2-_n.x1)*zr+2*_n.padding,_d=(_n.y2-_n.y1)*zr+2*_n.padding,ou=Ne&&!ye?_s:null;ou&&Rr(ou);let ia={box:[],offscreen:!1,occluded:!1};const Kc=_e?2*Oi.length:Oi.length;for(let es=0;es<Kc;++es){const au=this.attemptAnchorPlacement(Oi[es%Oi.length],_n,ta,_d,zr,ue,xe,q,L,ge,es>=Oi.length,Ie,mt,T,Jc,ou,ie,J);if(au&&(ia=au.placedGlyphBoxes,ia&&ia.box&&ia.box.length)){Tt=!0,Ot=au.shift;break}}return ia};Rn(()=>kn(Fs,ft.iconBox,m.WritingMode.horizontal),()=>{const _n=ft.verticalTextBox;return _n&&Rr(_n),T.allowVerticalPlacement&&!(Kt&&Kt.box&&Kt.box.length)&&Ie.numVerticalGlyphVertices>0&&_n?kn(_n,ft.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Kt&&(Tt=Kt.box,$t=Kt.offscreen,Wt=Kt.occluded);const kr=wn(Kt&&Kt.box);if(!Tt&&this.prevPlacement){const _n=this.prevPlacement.variableOffsets[Ie.crossTileID];_n&&(this.variableOffsets[Ie.crossTileID]=_n,this.markUsedJustification(T,_n.anchor,Ie,kr))}}else{const Oi=(kn,kr)=>{const _n=T.getSymbolInstanceTextSize(ie,Ie,this.transform.zoom,mt),_s=this.collisionIndex.placeCollisionBox(_n,kn,new m.pointGeometry(0,0),_e,q,L,ge.predicate);return _s&&_s.box&&_s.box.length&&(this.markUsedOrientation(T,kr,Ie),this.placedOrientations[Ie.crossTileID]=kr),_s};Rn(()=>Oi(Fs,m.WritingMode.horizontal),()=>{const kn=ft.verticalTextBox;return T.allowVerticalPlacement&&Ie.numVerticalGlyphVertices>0&&kn?(Rr(kn),Oi(kn,m.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),wn(Kt&&Kt.box&&Kt.box.length)}}if(Vt=Kt,Tt=Vt&&Vt.box&&Vt.box.length>0,$t=Vt&&Vt.offscreen,Wt=Vt&&Vt.occluded,Ie.useRuntimeCollisionCircles){const wn=T.text.placedSymbolArray.get(Ie.centerJustifiedTextSymbolIndex>=0?Ie.centerJustifiedTextSymbolIndex:Ie.verticalPlacedTextSymbolIndex),Rn=m.evaluateSizeForFeature(T.textSizeData,ie,wn),Oi=A.get("text-padding");oi=this.collisionIndex.placeCollisionCircles(_e,wn,T.lineVertexArray,T.glyphOffsetArray,Rn,L,F,V,y,xe,ge.predicate,Ie.collisionCircleDiameter*Rn/m.ONE_EM,Oi,this.retainedQueryData[T.bucketInstanceId].tileID),Tt=_e||oi.circles.length>0&&!oi.collisionDetected,$t=$t&&oi.offscreen,Wt=oi.occluded}if(ft.iconFeatureIndex&&(pr=ft.iconFeatureIndex),ft.iconBox){const wn=Rn=>{Rr(Rn);const Oi=Ne&&Ot?Nl(Ot.x,Ot.y,ue,xe,this.transform.angle):new m.pointGeometry(0,0),kn=T.getSymbolInstanceIconSize(J,this.transform.zoom,mt);return this.collisionIndex.placeCollisionBox(kn,Rn,Oi,ye,q,L,ge.predicate)};li&&li.box&&li.box.length&&ft.verticalIconBox?(Mi=wn(ft.verticalIconBox),je=Mi.box.length>0):(Mi=wn(ft.iconBox),je=Mi.box.length>0),$t=$t&&Mi.offscreen,zt=Mi.occluded}const Us=ce||0===Ie.numHorizontalGlyphVertices&&0===Ie.numVerticalGlyphVertices,ea=pe||0===Ie.numIconVertices;if(Us||ea?ea?Us||(je=je&&Tt):Tt=je&&Tt:je=Tt=je&&Tt,Tt&&Vt&&Vt.box&&this.collisionIndex.insertCollisionBox(Vt.box,A.get("text-ignore-placement"),T.bucketInstanceId,li&&li.box&&nr?nr:pn,ge.ID),je&&Mi&&this.collisionIndex.insertCollisionBox(Mi.box,A.get("icon-ignore-placement"),T.bucketInstanceId,pr,ge.ID),oi&&(Tt&&this.collisionIndex.insertCollisionCircles(oi.circles,A.get("text-ignore-placement"),T.bucketInstanceId,pn,ge.ID),y)){const wn=T.bucketInstanceId;let Rn=this.collisionCircleArrays[wn];void 0===Rn&&(Rn=this.collisionCircleArrays[wn]=new Dn);for(let Oi=0;Oi<oi.circles.length;Oi+=4)Rn.circles.push(oi.circles[Oi+0]),Rn.circles.push(oi.circles[Oi+1]),Rn.circles.push(oi.circles[Oi+2]),Rn.circles.push(oi.collisionDetected?1:0)}const Mo="globe"!==this.transform.projection.name;Ye=Ye&&(Mo||!Wt),Xe=Xe&&(Mo||!zt),this.placements[Ie.crossTileID]=new eo(Tt||Ye,je||Xe,$t||T.justReloaded),d[Ie.crossTileID]=!0};if(He){const Ie=T.getSortedSymbolIndexes(this.transform.angle);for(let mt=Ie.length-1;mt>=0;--mt){const ft=Ie[mt];St(T.symbolInstances.get(ft),ft,T.collisionArrays[ft])}}else for(let Ie=r.symbolInstanceStart;Ie<r.symbolInstanceEnd;Ie++)St(T.symbolInstances.get(Ie),Ie,T.collisionArrays[Ie]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const Ie=this.collisionCircleArrays[T.bucketInstanceId];m.invert(Ie.invProjMatrix,L),Ie.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(r,d,y,M){let T;T=M===m.WritingMode.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(d)];const A=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const L of A)L>=0&&(r.text.placedSymbolArray.get(L).crossTileID=T>=0&&L!==T?0:y.crossTileID)}markUsedOrientation(r,d,y){const M=d===m.WritingMode.horizontal||d===m.WritingMode.horizontalOnly?d:0,T=d===m.WritingMode.vertical?d:0,A=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const L of A)r.text.placedSymbolArray.get(L).placedOrientation=M;y.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const M=d?d.symbolFadeChange(r):1,T=d?d.opacities:{},A=d?d.variableOffsets:{},L=d?d.placedOrientations:{};for(const F in this.placements){const V=this.placements[F],G=T[F];G?(this.opacities[F]=new Rs(G,M,V.text,V.icon,null,V.clipped),y=y||V.text!==G.text.placed||V.icon!==G.icon.placed):(this.opacities[F]=new Rs(null,M,V.text,V.icon,V.skipFade,V.clipped),y=y||V.text||V.icon)}for(const F in T){const V=T[F];if(!this.opacities[F]){const G=new Rs(V,M,!1,!1);G.isHidden()||(this.opacities[F]=G,y=y||V.text.placed||V.icon.placed)}}for(const F in A)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=A[F]);for(const F in L)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=L[F]);y?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:r)}updateLayerOpacities(r,d){const y={};for(const M of d){const T=M.getBucket(r);T&&M.latestFeatureIndex&&r.id===T.layerIds[0]&&this.updateBucketOpacities(T,y,M.collisionBoxArray)}}updateBucketOpacities(r,d,y){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const M=r.layers[0].layout,T=!!r.layers[0].dynamicFilter(),A=new Rs(null,0,!1,!1,!0),L=M.get("text-allow-overlap"),F=M.get("icon-allow-overlap"),V=M.get("text-variable-anchor"),G="map"===M.get("text-rotation-alignment"),q="map"===M.get("text-pitch-alignment"),ee="none"!==M.get("icon-text-fit"),re=new Rs(null,0,L&&(F||!r.hasIconData()||M.get("icon-optional")),F&&(L||!r.hasTextData()||M.get("text-optional")),!0);!r.collisionArrays&&y&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(y);const ie=(ge,ce,pe)=>{for(let _e=0;_e<ce/4;_e++)ge.opacityVertexArray.emplaceBack(pe)};let J=0;for(let ge=0;ge<r.symbolInstances.length;ge++){const ce=r.symbolInstances.get(ge),{numHorizontalGlyphVertices:pe,numVerticalGlyphVertices:_e,crossTileID:ye}=ce;let ue=this.opacities[ye];d[ye]?ue=A:ue||(ue=re,this.opacities[ye]=ue),d[ye]=!0;const xe=pe>0||_e>0,Ne=ce.numIconVertices>0,He=this.placedOrientations[ce.crossTileID],Ye=He===m.WritingMode.vertical,Xe=He===m.WritingMode.horizontal||He===m.WritingMode.horizontalOnly;if(!xe&&!Ne||ue.isHidden()||J++,xe){const St=Gu(ue.text);ie(r.text,pe,Ye?Ho:St),ie(r.text,_e,Xe?Ho:St);const Ie=ue.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(Tt=>{Tt>=0&&(r.text.placedSymbolArray.get(Tt).hidden=Ie||Ye?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=Ie||Xe?1:0);const mt=this.variableOffsets[ce.crossTileID];mt&&this.markUsedJustification(r,mt.anchor,ce,He);const ft=this.placedOrientations[ce.crossTileID];ft&&(this.markUsedJustification(r,"left",ce,ft),this.markUsedOrientation(r,ft,ce))}if(Ne){const St=Gu(ue.icon);ce.placedIconSymbolIndex>=0&&(ie(r.icon,ce.numIconVertices,Ye?Ho:St),r.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=ue.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(ie(r.icon,ce.numVerticalIconVertices,Xe?Ho:St),r.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=ue.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const St=r.collisionArrays[ge];if(St){let Ie=new m.pointGeometry(0,0),mt=!0;if(St.textBox||St.verticalTextBox){if(V){const Tt=this.variableOffsets[ye];Tt?(Ie=yr(Tt.anchor,Tt.width,Tt.height,Tt.textOffset,Tt.textScale),G&&Ie._rotate(q?this.transform.angle:-this.transform.angle)):mt=!1}T&&(mt=!ue.clipped),St.textBox&&cr(r.textCollisionBox.collisionVertexArray,ue.text.placed,!mt||Ye,Ie.x,Ie.y),St.verticalTextBox&&cr(r.textCollisionBox.collisionVertexArray,ue.text.placed,!mt||Xe,Ie.x,Ie.y)}const ft=mt&&Boolean(!Xe&&St.verticalIconBox);St.iconBox&&cr(r.iconCollisionBox.collisionVertexArray,ue.icon.placed,ft,ee?Ie.x:0,ee?Ie.y:0),St.verticalIconBox&&cr(r.iconCollisionBox.collisionVertexArray,ue.icon.placed,!ft,ee?Ie.x:0,ee?Ie.y:0)}}}if(r.fullyClipped=0===J,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ge.invProjMatrix,r.placementViewportMatrix=ge.viewportMatrix,r.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>r}setStale(){this.stale=!0}}function cr(g,r,d,y,M){g.emplaceBack(r?1:0,d?1:0,y||0,M||0),g.emplaceBack(r?1:0,d?1:0,y||0,M||0),g.emplaceBack(r?1:0,d?1:0,y||0,M||0),g.emplaceBack(r?1:0,d?1:0,y||0,M||0)}const zh=Math.pow(2,25),Xr=Math.pow(2,24),Yr=Math.pow(2,17),Dc=Math.pow(2,16),vr=Math.pow(2,9),Lc=Math.pow(2,8),Oh=Math.pow(2,1);function Gu(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const r=g.placed?1:0,d=Math.floor(127*g.opacity);return d*zh+r*Xr+d*Yr+r*Dc+d*vr+r*Lc+d*Oh+r}const Ho=0;class to{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,d,y,M,T){const A=this._bucketParts;for(;this._currentTileIndex<r.length;)if(d.getBucketParts(A,M,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((L,F)=>L.sortKey-F.sortKey));this._currentPartIndex<A.length;){const L=A[this._currentPartIndex];if(d.placeLayerBucketPart(L,this._seenCrossTileIDs,y,0===L.symbolInstanceStart),this._currentPartIndex++,T())return!0}return!1}}class Bh{constructor(r,d,y,M,T,A,L,F){this.placement=new Nm(r,T,A,L,F),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=M,this._done=!1}isDone(){return this._done}continuePlacement(r,d,y){const M=m.exported.now(),T=()=>{const A=m.exported.now()-M;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=d[r[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if("symbol"===A.type&&(!A.minzoom||A.minzoom<=L)&&(!A.maxzoom||A.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new to(A)),this._inProgressLayer.continuePlacement(y[A.source],this.placement,this._showCollisionBoxes,A,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Vl=512/m.EXTENT/2;class Vm{constructor(r,d,y){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=y;for(let M=0;M<d.length;M++){const T=d.get(M),A=T.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:T.crossTileID,coord:this.getScaledCoordinates(T,r)})}}getScaledCoordinates(r,d){const y=Vl/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*m.EXTENT+r.tileAnchorX)*y),y:Math.floor((d.canonical.y*m.EXTENT+r.tileAnchorY)*y)}}findMatches(r,d,y){const M=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let T=0;T<r.length;T++){const A=r.get(T);if(A.crossTileID)continue;const L=this.indexedSymbolInstances[A.key];if(!L)continue;const F=this.getScaledCoordinates(A,d);for(const V of L)if(Math.abs(V.coord.x-F.x)<=M&&Math.abs(V.coord.y-F.y)<=M&&!y[V.crossTileID]){y[V.crossTileID]=!0,A.crossTileID=V.crossTileID;break}}}}class gp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _p{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const d=Math.round((r-this.lng)/360);if(0!==d)for(const y in this.indexes){const M=this.indexes[y],T={};for(const A in M){const L=M[A];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+d),T[L.tileID.key]=L}this.indexes[y]=T}this.lng=r}addBucket(r,d,y){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const M=this.usedCrossTileIDs[r.overscaledZ];for(const T in this.indexes){const A=this.indexes[T];if(Number(T)>r.overscaledZ)for(const L in A){const F=A[L];F.tileID.isChildOf(r)&&F.findMatches(d.symbolInstances,r,M)}else{const L=A[r.scaledTo(Number(T)).key];L&&L.findMatches(d.symbolInstances,r,M)}}for(let T=0;T<d.symbolInstances.length;T++){const A=d.symbolInstances.get(T);A.crossTileID||(A.crossTileID=y.generate(),M[A.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Vm(r,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(r,d){for(const y in d.indexedSymbolInstances)for(const M of d.indexedSymbolInstances[y])delete this.usedCrossTileIDs[r][M.crossTileID]}removeStaleBuckets(r){let d=!1;for(const y in this.indexes){const M=this.indexes[y];for(const T in M)r[M[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,M[T]),delete M[T],d=!0)}return d}}class Rc{constructor(){this.layerIndexes={},this.crossTileIDs=new gp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,d,y,M){let T=this.layerIndexes[r.id];void 0===T&&(T=this.layerIndexes[r.id]=new _p);let A=!1;const L={};"globe"!==M.name&&T.handleWrapJump(y);for(const F of d){const V=F.getBucket(r);V&&r.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(F.tileID,V,this.crossTileIDs)&&(A=!0),L[V.bucketInstanceId]=!0)}return T.removeStaleBuckets(L)&&(A=!0),A}pruneUnusedLayers(r){const d={};r.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const Gl=(g,r)=>m.emitValidationErrors(g,r&&r.filter(d=>"source.canvas"!==d.identifier)),yp=m.pick(Ut,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Hu=m.pick(Ut,["setCenter","setZoom","setBearing","setPitch"]),Ni={version:8,layers:[],sources:{}},dr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Nn extends m.Evented{constructor(r,d={}){super(),this.map=r,this.dispatcher=new nn(Rt(),this),this.imageManager=new Pn,this.imageManager.setEventedParent(this),this.glyphManager=new m.GlyphManager(r._requestManager,d.localFontFamily?m.LocalGlyphMode.all:d.localIdeographFontFamily?m.LocalGlyphMode.ideographs:m.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.lineAtlas=new m.LineAtlas(256,512),this.crossTileSymbolIndex=new Rc,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());const y=this;this._rtlTextPluginCallback=Nn.registerForPluginStateChange(M=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},(T,A)=>{if(m.triggerPluginCompletionEvent(T),A&&A.every(L=>L))for(const L in y._sourceCaches){const F=y._sourceCaches[L],V=F.getSource().type;"vector"!==V&&"geojson"!==V||F.reload()}})}),this.on("data",M=>{if("source"!==M.dataType||"metadata"!==M.sourceDataType)return;const T=this.getSource(M.sourceId);if(T&&T.vectorLayerIds)for(const A in this._layers){const L=this._layers[A];L.source===T.id&&this._validateLayer(L)}})}loadURL(r,d={}){this.fire(new m.Event("dataloading",{dataType:"style"}));const y="boolean"==typeof d.validate?d.validate:!m.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,d.accessToken);const M=this.map._requestManager.transformRequest(r,m.ResourceType.Style);this._request=m.getJSON(M,(T,A)=>{this._request=null,T?this.fire(new m.ErrorEvent(T)):A&&this._load(A,y)})}loadJSON(r,d={}){this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.exported.frame(()=>{this._request=null,this._load(r,!1!==d.validate)})}loadEmpty(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(Ni,!1)}_updateLayerCount(r,d){const y=d?1:-1;r.is3D()&&(this._num3DLayers+=y),"circle"===r.type&&(this._numCircleLayers+=y),"symbol"===r.type&&(this._numSymbolLayers+=y)}_load(r,d){if(d&&Gl(this,m.validateStyle(r)))return;this._loaded=!0,this.stylesheet=r,this._updateMapProjection();for(const M in r.sources)this.addSource(M,r.sources[M],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const y=Di(this.stylesheet.layers);this._order=y.map(M=>M.id),this._layers={},this._serializedLayers={};for(let M of y)M=m.createStyleLayer(M),M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M,this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new jr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(r){this._spriteRequest=function(d,y,M){let T,A,L;const F=m.exported.devicePixelRatio>1?"@2x":"";let V=m.getJSON(y.transformRequest(y.normalizeSpriteURL(d,F,".json"),m.ResourceType.SpriteJSON),(ee,re)=>{V=null,L||(L=ee,T=re,q())}),G=m.getImage(y.transformRequest(y.normalizeSpriteURL(d,F,".png"),m.ResourceType.SpriteImage),(ee,re)=>{G=null,L||(L=ee,A=re,q())});function q(){if(L)M(L);else if(T&&A){const ee=m.exported.getImageData(A),re={};for(const ie in T){const{width:J,height:ge,x:ce,y:pe,sdf:_e,pixelRatio:ye,stretchX:ue,stretchY:xe,content:Ne}=T[ie],He=new m.RGBAImage({width:J,height:ge});m.RGBAImage.copy(ee,He,{x:ce,y:pe},{x:0,y:0},{width:J,height:ge}),re[ie]={data:He,pixelRatio:ye,sdf:_e,stretchX:ue,stretchY:xe,content:Ne}}M(null,re)}}return{cancel(){V&&(V.cancel(),V=null),G&&(G.cancel(),G=null)}}}(r,this.map._requestManager,(d,y)=>{if(this._spriteRequest=null,d)this.fire(new m.ErrorEvent(d));else if(y)for(const M in y)this.imageManager.addImage(M,y[M]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new m.Event("data",{dataType:"style"}))})}_validateLayer(r){const d=this.getSource(r.source);if(!d)return;const y=r.sourceLayer;y&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(y))&&this.fire(new m.ErrorEvent(new Error(`Source layer "${y}" does not exist on source "${d.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const d=[];for(const y of r){const M=this._layers[y];"custom"!==M.type&&d.push(M.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&dr[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const d=this._changed;if(this._changed){const M=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(M.length||T.length)&&this._updateWorkerLayers(M,T);for(const A in this._updatedSources){const L=this._updatedSources[A];"reload"===L?this._reloadSource(A):"clear"===L&&this._clearSource(A)}this._updateTilesForChangedImages();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const y={};for(const M in this._sourceCaches){const T=this._sourceCaches[M];y[M]=T.used,T.used=!1}for(const M of this._order){const T=this._layers[M];if(T.recalculate(r,this._availableImages),!T.isHidden(r.zoom)){const L=this._getLayerSourceCache(T);L&&(L.used=!0)}const A=this.map.painter;if(A){const L=T.getProgramIds();if(!L)continue;const F=T.getProgramConfiguration(r.zoom);for(const V of L)A.useProgram(V,F)}}for(const M in y){const T=this._sourceCaches[M];y[M]!==T.used&&T.getSource().fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new m.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Gl(this,m.validateStyle(r)))return!1;(r=m.clone$1(r)).layers=Di(r.layers);const d=function(M,T){if(!M)return[{command:Ut.setStyle,args:[T]}];let A=[];try{if(!ct(M.version,T.version))return[{command:Ut.setStyle,args:[T]}];ct(M.center,T.center)||A.push({command:Ut.setCenter,args:[T.center]}),ct(M.zoom,T.zoom)||A.push({command:Ut.setZoom,args:[T.zoom]}),ct(M.bearing,T.bearing)||A.push({command:Ut.setBearing,args:[T.bearing]}),ct(M.pitch,T.pitch)||A.push({command:Ut.setPitch,args:[T.pitch]}),ct(M.sprite,T.sprite)||A.push({command:Ut.setSprite,args:[T.sprite]}),ct(M.glyphs,T.glyphs)||A.push({command:Ut.setGlyphs,args:[T.glyphs]}),ct(M.transition,T.transition)||A.push({command:Ut.setTransition,args:[T.transition]}),ct(M.light,T.light)||A.push({command:Ut.setLight,args:[T.light]}),ct(M.fog,T.fog)||A.push({command:Ut.setFog,args:[T.fog]}),ct(M.projection,T.projection)||A.push({command:Ut.setProjection,args:[T.projection]});const L={},F=[];!function(q,ee,re,ie){let J;for(J in ee=ee||{},q=q||{})q.hasOwnProperty(J)&&(ee.hasOwnProperty(J)||me(J,re,ie));for(J in ee)ee.hasOwnProperty(J)&&(q.hasOwnProperty(J)?ct(q[J],ee[J])||("geojson"===q[J].type&&"geojson"===ee[J].type&&mo(q,ee,J)?re.push({command:Ut.setGeoJSONSourceData,args:[J,ee[J].data]}):Go(J,ee,re,ie)):ui(J,ee,re))}(M.sources,T.sources,F,L);const V=[];M.layers&&M.layers.forEach(q=>{q.source&&L[q.source]?A.push({command:Ut.removeLayer,args:[q.id]}):V.push(q)});let G=M.terrain;G&&L[G.source]&&(A.push({command:Ut.setTerrain,args:[void 0]}),G=void 0),A=A.concat(F),ct(G,T.terrain)||A.push({command:Ut.setTerrain,args:[T.terrain]}),function(q,ee,re){ee=ee||[];const ie=(q=q||[]).map(fi),J=ee.map(fi),ge=q.reduce(pi,{}),ce=ee.reduce(pi,{}),pe=ie.slice(),_e=Object.create(null);let ye,ue,xe,Ne,He,Ye,Xe;for(ye=0,ue=0;ye<ie.length;ye++)xe=ie[ye],ce.hasOwnProperty(xe)?ue++:(re.push({command:Ut.removeLayer,args:[xe]}),pe.splice(pe.indexOf(xe,ue),1));for(ye=0,ue=0;ye<J.length;ye++)xe=J[J.length-1-ye],pe[pe.length-1-ye]!==xe&&(ge.hasOwnProperty(xe)?(re.push({command:Ut.removeLayer,args:[xe]}),pe.splice(pe.lastIndexOf(xe,pe.length-ue),1)):ue++,Ye=pe[pe.length-ye],re.push({command:Ut.addLayer,args:[ce[xe],Ye]}),pe.splice(pe.length-ye,0,xe),_e[xe]=!0);for(ye=0;ye<J.length;ye++)if(xe=J[ye],Ne=ge[xe],He=ce[xe],!_e[xe]&&!ct(Ne,He))if(ct(Ne.source,He.source)&&ct(Ne["source-layer"],He["source-layer"])&&ct(Ne.type,He.type)){for(Xe in yt(Ne.layout,He.layout,re,xe,null,Ut.setLayoutProperty),yt(Ne.paint,He.paint,re,xe,null,Ut.setPaintProperty),ct(Ne.filter,He.filter)||re.push({command:Ut.setFilter,args:[xe,He.filter]}),ct(Ne.minzoom,He.minzoom)&&ct(Ne.maxzoom,He.maxzoom)||re.push({command:Ut.setLayerZoomRange,args:[xe,He.minzoom,He.maxzoom]}),Ne)Ne.hasOwnProperty(Xe)&&"layout"!==Xe&&"paint"!==Xe&&"filter"!==Xe&&"metadata"!==Xe&&"minzoom"!==Xe&&"maxzoom"!==Xe&&(0===Xe.indexOf("paint.")?yt(Ne[Xe],He[Xe],re,xe,Xe.slice(6),Ut.setPaintProperty):ct(Ne[Xe],He[Xe])||re.push({command:Ut.setLayerProperty,args:[xe,Xe,He[Xe]]}));for(Xe in He)He.hasOwnProperty(Xe)&&!Ne.hasOwnProperty(Xe)&&"layout"!==Xe&&"paint"!==Xe&&"filter"!==Xe&&"metadata"!==Xe&&"minzoom"!==Xe&&"maxzoom"!==Xe&&(0===Xe.indexOf("paint.")?yt(Ne[Xe],He[Xe],re,xe,Xe.slice(6),Ut.setPaintProperty):ct(Ne[Xe],He[Xe])||re.push({command:Ut.setLayerProperty,args:[xe,Xe,He[Xe]]}))}else re.push({command:Ut.removeLayer,args:[xe]}),Ye=pe[pe.lastIndexOf(xe)+1],re.push({command:Ut.addLayer,args:[He,Ye]})}(V,T.layers,A)}catch(L){console.warn("Unable to compute style diff:",L),A=[{command:Ut.setStyle,args:[T]}]}return A}(this.serialize(),r).filter(M=>!(M.command in Hu));if(0===d.length)return!1;const y=d.filter(M=>!(M.command in yp));if(y.length>0)throw new Error(`Unimplemented: ${y.map(M=>M.command).join(", ")}.`);return d.forEach(M=>{"setTransition"!==M.command&&this[M.command].apply(this,M.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,d){return this.getImage(r)?this.fire(new m.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,d),this._afterImageUpdated(r),this)}updateImage(r,d){this.imageManager.updateImage(r,d)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new m.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,d,y={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateSource,`sources.${r}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const M=Be(r,d,this.dispatcher,this);M.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:M.serialize(),sourceId:r}));const T=A=>{const L=(A?"symbol:":"other:")+r,F=this._sourceCaches[L]=new m.SourceCache(L,M,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[r]=F,F.style=this,F.onAdd(this.map)};T(!1),"vector"!==d.type&&"geojson"!==d.type||T(!0),M.onAdd&&M.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const d=this.getSource(r);if(!d)throw new Error("There is no source with this ID");for(const M in this._layers)if(this._layers[M].source===r)return this.fire(new m.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${M}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new m.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const y=this._getSourceCaches(r);for(const M of y)delete this._sourceCaches[M.id],delete this._updatedSources[M.id],M.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:M.getSource().id})),M.setEventedParent(null),M.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,d){this._checkLoaded(),this.getSource(r).setData(d),this._changed=!0}getSource(r){const d=this._getSourceCache(r);return d&&d.getSource()}addLayer(r,d,y={}){this._checkLoaded();const M=r.id;if(this.getLayer(M))return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${M}" already exists on this map`)));let T;if("custom"===r.type){if(Gl(this,m.validateCustomStyleLayer(r)))return;T=m.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(M,r.source),r=m.clone$1(r),r=m.extend(r,{source:M})),this._validate(m.validateLayer,`layers.${M}`,r,{arrayIndex:-1},y))return;T=m.createStyleLayer(r),this._validateLayer(T),T.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const A=d?this._order.indexOf(d):this._order.length;if(d&&-1===A)return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(A,0,M),this._layerOrderChanged=!0,this._layers[M]=T;const L=this._getLayerSourceCache(T);if(this._removedLayers[M]&&T.source&&L&&"custom"!==T.type){const F=this._removedLayers[M];delete this._removedLayers[M],F.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",L.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,d){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new m.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===d)return;const y=this._order.indexOf(r);this._order.splice(y,1);const M=d?this._order.indexOf(d):this._order.length;d&&-1===M?this.fire(new m.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(M,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const d=this._layers[r];if(!d)return void this.fire(new m.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const y=this._order.indexOf(r);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=d,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const d in this._layers)if(this._layers[d].type===r)return!0;return!1}setLayerZoomRange(r,d,y){this._checkLoaded();const M=this.getLayer(r);M?M.minzoom===d&&M.maxzoom===y||(null!=d&&(M.minzoom=d),null!=y&&(M.maxzoom=y),this._updateLayer(M)):this.fire(new m.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,d,y={}){this._checkLoaded();const M=this.getLayer(r);if(M){if(!ct(M.filter,d))return null==d?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(m.validateFilter,`layers.${M.id}.filter`,d,{layerType:M.type},y)||(M.filter=m.clone$1(d),this._updateLayer(M)))}else this.fire(new m.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const d=this.getLayer(r);return d&&m.clone$1(d.filter)}setLayoutProperty(r,d,y,M={}){this._checkLoaded();const T=this.getLayer(r);T?ct(T.getLayoutProperty(d),y)||(T.setLayoutProperty(d,y,M),this._updateLayer(T)):this.fire(new m.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,d){const y=this.getLayer(r);if(y)return y.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,d,y,M={}){this._checkLoaded();const T=this.getLayer(r);T?ct(T.getPaintProperty(d),y)||(T.setPaintProperty(d,y,M)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new m.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,d){const y=this.getLayer(r);return y&&y.getPaintProperty(d)}setFeatureState(r,d){this._checkLoaded();const y=r.source,M=r.sourceLayer,T=this.getSource(y);if(!T)return void this.fire(new m.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const A=T.type;if("geojson"===A&&M)return void this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===A&&!M)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided.")));const L=this._getSourceCaches(y);for(const F of L)F.setFeatureState(M,r.id,d)}removeFeatureState(r,d){this._checkLoaded();const y=r.source,M=this.getSource(y);if(!M)return void this.fire(new m.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const T=M.type,A="vector"===T?r.sourceLayer:void 0;if("vector"===T&&!A)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const L=this._getSourceCaches(y);for(const F of L)F.removeFeatureState(A,r.id,d)}getFeatureState(r){this._checkLoaded();const d=r.source,y=r.sourceLayer,M=this.getSource(d);if(M){if("vector"!==M.type||y)return void 0===r.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(y,r.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const d in this._sourceCaches){const y=this._sourceCaches[d].getSource();r[y.id]||(r[y.id]=y.serialize())}return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(r){this._updatedLayers[r.id]=!0;const d=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[r.source]="reload",d.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const d=A=>"fill-extrusion"===this._layers[A].type,y={},M=[];for(let A=this._order.length-1;A>=0;A--){const L=this._order[A];if(d(L)){y[L]=A;for(const F of r){const V=F[L];if(V)for(const G of V)M.push(G)}}}M.sort((A,L)=>L.intersectionZ-A.intersectionZ);const T=[];for(let A=this._order.length-1;A>=0;A--){const L=this._order[A];if(d(L))for(let F=M.length-1;F>=0;F--){const V=M[F].feature;if(y[V.layer.id]<A)break;T.push(V),M.pop()}else for(const F of r){const V=F[L];if(V)for(const G of V)T.push(G.feature)}}return T}queryRenderedFeatures(r,d,y){d&&d.filter&&this._validate(m.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const M={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const F of d.layers){const V=this._layers[F];if(!V)return this.fire(new m.ErrorEvent(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];M[V.source]=!0}}const T=[];d.availableImages=this._availableImages;const A=d&&d.layers?d.layers.some(F=>{const V=this.getLayer(F);return V&&V.is3D()}):this.has3DLayers(),L=ga.createFromScreenPoints(r,y);for(const F in this._sourceCaches){const V=this._sourceCaches[F].getSource().id;d.layers&&!M[V]||T.push(we(this._sourceCaches[F],this._layers,this._serializedLayers,L,d,y,A,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(F,V,G,q,ee,re,ie){const J={},ge=re.queryRenderedSymbols(q),ce=[];for(const pe of Object.keys(ge).map(Number))ce.push(ie[pe]);ce.sort(At);for(const pe of ce){const _e=pe.featureIndex.lookupSymbolFeatures(ge[pe.bucketInstanceId],V,pe.bucketIndex,pe.sourceLayerIndex,ee.filter,ee.layers,ee.availableImages,F);for(const ye in _e){const ue=J[ye]=J[ye]||[],xe=_e[ye];xe.sort((Ne,He)=>{const Ye=pe.featureSortOrder;if(Ye){const Xe=Ye.indexOf(Ne.featureIndex);return Ye.indexOf(He.featureIndex)-Xe}return He.featureIndex-Ne.featureIndex});for(const Ne of xe)ue.push(Ne)}}for(const pe in J)J[pe].forEach(_e=>{const ye=_e.feature,ue=G(F[pe]).getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=ue});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),L.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(r,d){d&&d.filter&&this._validate(m.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const y=this._getSourceCaches(r);let M=[];for(const T of y)M=M.concat(rt(T,d));return M}addSourceType(r,d,y){return Nn.getSourceType(r)?y(new Error(`A source type called "${r}" already exists.`)):(Nn.setSourceType(r,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:d.workerSourceURL},y):y(null,null))}getLight(){return this.light.getLight()}setLight(r,d={}){this._checkLoaded();const y=this.light.getLight();let M=!1;for(const A in r)if(!ct(r[A],y[A])){M=!0;break}if(!M)return;const T={now:m.exported.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,d),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,d=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===d){if("object"==typeof r.source){const y="terrain-dem-src";this.addSource(y,r.source),r=m.clone$1(r),r=m.extend(r,{source:y})}if(this._validate(m.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode)this._createTerrain(r,d);else{const y=this.terrain,M=y.get();for(const T in r)if(!ct(r[T],M[T])){y.set(r),this.stylesheet.terrain=r;const A={now:m.exported.now(),transition:m.extend({duration:0},this.stylesheet.transition)};y.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const d=this.fog=new Cc(r,this.map.transform);this.stylesheet.fog=r;const y={now:m.exported.now(),transition:m.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(y)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,y=d.get();for(const M in r)if(!ct(r[M],y[M])){d.set(r),this.stylesheet.fog=r;const T={now:m.exported.now(),transition:m.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(T);break}}else this._createFog(r);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(y=>this.isLayerDraped(this._layers[y])),d=this._order.filter(y=>!this.isLayerDraped(this._layers[y]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...d)}_createTerrain(r,d){const y=this.terrain=new $a(r,d);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const M={now:m.exported.now(),transition:m.extend({duration:0},this.stylesheet.transition)};y.updateTransitions(M)}_force3DLayerUpdate(){for(const r in this._layers){const d=this._layers[r];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const d=this._layers[r];"symbol"===d.type&&this._updateLayer(d)}}_validate(r,d,y,M,T={}){return(!T||!1!==T.validate)&&Gl(this,r.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:y,styleSpec:m.spec},M)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const d=this._getSourceCaches(r);for(const y of d)y.clearTiles()}_reloadSource(r){const d=this._getSourceCaches(r);for(const y of d)y.resume(),y.reload()}_updateSources(r){for(const d in this._sourceCaches)this._sourceCaches[d].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const d=this._sourceCaches[r];d.resume(),d.reload()}}_updatePlacement(r,d,y,M,T=!1){let A=!1,L=!1;const F={};for(const V of this._order){const G=this._layers[V];if("symbol"!==G.type)continue;if(!F[G.source]){const ee=this._getLayerSourceCache(G);if(!ee)continue;F[G.source]=ee.getRenderableIds(!0).map(re=>ee.getTileByID(re)).sort((re,ie)=>ie.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ie.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(G,F[G.source],r.center.lng,r.projection);A=A||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||0===y,this._layerOrderChanged&&this.fire(new m.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.exported.now(),r.zoom))&&(this.pauseablePlacement=new Bh(r,this._order,T,d,y,M,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.exported.now()),L=!0),A&&this.pauseablePlacement.placement.setStale()),L||A)for(const V of this._order){const G=this._layers[V];"symbol"===G.type&&this.placement.updateLayerOpacities(G,F[G.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,d,y){this.imageManager.getImages(d.icons,y),this._updateTilesForChangedImages();const M=T=>{T&&T.setDependencies(d.tileID.key,d.type,d.icons)};M(this._otherSourceCaches[d.source]),M(this._symbolSourceCaches[d.source])}getGlyphs(r,d,y){this.glyphManager.getGlyphs(d.stacks,y)}getResource(r,d,y){return m.makeRequest(d,y)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const d=[];return this._otherSourceCaches[r]&&d.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&d.push(this._symbolSourceCaches[r]),d}_isSourceCacheLoaded(r){const d=this._getSourceCaches(r);return 0===d.length?(this.fire(new m.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):d.every(y=>y.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Nn.getSourceType=function(g){return Ue[g]},Nn.setSourceType=function(g,r){Ue[g]=r},Nn.registerForPluginStateChange=m.registerForPluginStateChange;var il="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",ds="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ks={},ps={};ks=Yt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),ps=Yt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const kc=Yt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),nl=il;var rl={background:Yt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Yt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Yt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Yt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Yt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Yt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Yt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Yt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Yt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Yt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Yt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Yt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Yt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Yt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Yt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Yt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Yt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Yt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Yt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Yt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Yt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Yt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Yt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ds),skyboxGradient:Yt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ds),skyboxCapture:Yt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Yt("uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)\ndiscard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function Yt(g,r,d){const y=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,M=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,T=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),A=g.match(M),L=r.match(M),F=il.match(M);let V=L?L.concat(A):A;d||(ks.staticUniforms&&(V=ks.staticUniforms.concat(V)),ps.staticUniforms&&(V=ps.staticUniforms.concat(V))),V&&(V=V.concat(F));const G={};return{fragmentSource:g=g.replace(y,(q,ee,re,ie,J)=>(G[J]=!0,"define"===ee?`\n#ifndef HAS_UNIFORM_u_${J}\nvarying ${re} ${ie} ${J};\n#else\nuniform ${re} ${ie} u_${J};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${J}\n    ${re} ${ie} ${J} = u_${J};\n#endif\n`)),vertexSource:r=r.replace(y,(q,ee,re,ie,J)=>{const ge="float"===ie?"vec2":"vec4",ce=J.match(/color/)?"color":ge;return G[J]?"define"===ee?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nattribute ${re} ${ge} a_${J};\nvarying ${re} ${ie} ${J};\n#else\nuniform ${re} ${ie} u_${J};\n#endif\n`:"vec4"===ce?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = a_${J};\n#else\n    ${re} ${ie} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = unpack_mix_${ce}(a_${J}, u_${J}_t);\n#else\n    ${re} ${ie} ${J} = u_${J};\n#endif\n`:"define"===ee?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nattribute ${re} ${ge} a_${J};\n#else\nuniform ${re} ${ie} u_${J};\n#endif\n`:"vec4"===ce?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${re} ${ie} ${J} = a_${J};\n#else\n    ${re} ${ie} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${re} ${ie} ${J} = unpack_mix_${ce}(a_${J}, u_${J}_t);\n#else\n    ${re} ${ie} ${J} = u_${J};\n#endif\n`}),staticAttributes:T,staticUniforms:V}}class Ln{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,d,y,M,T,A,L,F){this.context=r;let V=this.boundPaintVertexBuffers.length!==M.length;for(let G=0;!V&&G<M.length;G++)this.boundPaintVertexBuffers[G]!==M[G]&&(V=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===y&&!V&&this.boundIndexBuffer===T&&this.boundVertexOffset===A&&this.boundDynamicVertexBuffer===L&&this.boundDynamicVertexBuffer2===F?(r.bindVertexArrayOES.set(this.vao),L&&L.bind(),T&&T.dynamicDraw&&T.bind(),F&&F.bind()):this.freshBind(d,y,M,T,A,L,F)}freshBind(r,d,y,M,T,A,L){let F;const V=r.numAttributes,G=this.context,q=G.gl;if(G.extVertexArrayObject)this.vao&&this.destroy(),this.vao=G.extVertexArrayObject.createVertexArrayOES(),G.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=r,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=M,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=L;else{F=G.currentNumAttributes||0;for(let ee=V;ee<F;ee++)q.disableVertexAttribArray(ee)}d.enableAttributes(q,r);for(const ee of y)ee.enableAttributes(q,r);A&&A.enableAttributes(q,r),L&&L.enableAttributes(q,r),d.bind(),d.setVertexAttribPointers(q,r,T);for(const ee of y)ee.bind(),ee.setVertexAttribPointers(q,r,T);A&&(A.bind(),A.setVertexAttribPointers(q,r,T)),M&&M.bind(),L&&(L.bind(),L.setVertexAttribPointers(q,r,T)),G.currentNumAttributes=V}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function vp(g,r){const d=Math.pow(2,r.canonical.z),y=r.canonical.y;return[new m.MercatorCoordinate(0,y/d).toLngLat().lat,new m.MercatorCoordinate(0,(y+1)/d).toLngLat().lat]}function Mn(g,r,d,y,M,T,A){const L=g.context,F=L.gl,V=d.fbo;if(!V)return;g.prepareDrawTile();const G=g.useProgram("hillshade");L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,V.colorAttachment.get());const q=((J,ge,ce,pe)=>{const _e=ce.paint.get("hillshade-shadow-color"),ye=ce.paint.get("hillshade-highlight-color"),ue=ce.paint.get("hillshade-accent-color");let xe=ce.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ce.paint.get("hillshade-illumination-anchor")&&(xe-=J.transform.angle);const Ne=!J.options.moving;return{u_matrix:pe||J.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),Ne),u_image:0,u_latrange:vp(0,ge.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),xe],u_shadow:_e,u_highlight:ye,u_accent:ue}})(g,d,y,g.terrain?r.projMatrix:null);g.prepareDrawProgram(L,G,r.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:re,tileBoundsSegments:ie}=g.getTileBoundsBuffers(d);G.draw(L,F.TRIANGLES,M,T,A,m.CullFaceMode.disabled,q,y.id,ee,re,ie)}function Pr(g,r,d){if(!r.needsDEMTextureUpload)return;const y=g.context,M=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||g.getTileTexture(d.stride);const T=d.getPixels();r.demTexture?r.demTexture.update(T,{premultiply:!1}):r.demTexture=new m.Texture(y,T,M.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function hn(g,r,d,y,M,T){const A=g.context,L=A.gl;if(!r.dem)return;const F=r.dem;if(A.activeTexture.set(L.TEXTURE1),Pr(g,r,F),!r.demTexture)return;r.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);const V=F.dim;A.activeTexture.set(L.TEXTURE0);let G=r.fbo;if(!G){const ie=new m.Texture(A,{width:V,height:V,data:null},L.RGBA);ie.bind(L.LINEAR,L.CLAMP_TO_EDGE),G=r.fbo=A.createFramebuffer(V,V,!0),G.colorAttachment.set(ie.texture)}A.bindFramebuffer.set(G.framebuffer),A.viewport.set([0,0,V,V]);const{tileBoundsBuffer:q,tileBoundsIndexBuffer:ee,tileBoundsSegments:re}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(A,L.TRIANGLES,y,M,T,m.CullFaceMode.disabled,((ie,J)=>{const ge=J.stride,ce=m.create();return m.ortho(ce,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(ce,ce,[0,-m.EXTENT,0]),{u_matrix:ce,u_image:1,u_dimension:[ge,ge],u_zoom:ie.overscaledZ,u_unpack:J.unpackVector}})(r.tileID,F),d.id,q,ee,re),r.needsHillshadePrepare=!1}const Hl=(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_image0:new m.Uniform1i(g,r.u_image0),u_skirt_height:new m.Uniform1f(g,r.u_skirt_height)}),un=(g,r)=>({u_matrix:g,u_image0:0,u_skirt_height:r}),ju=(g,r,d,y,M,T)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:r,u_merc_matrix:d,u_zoom_transition:y,u_merc_center:M,u_image0:0,u_grid_matrix:T?Float32Array.from(T):new Float32Array(9)});function zc(g,r){return null!=g&&null!=r&&!(!g.hasData()||!r.hasData())&&null!=g.demTexture&&null!=r.demTexture&&g.tileID.key!==r.tileID.key}const vn=new class{constructor(){this.operations={}}newMorphing(g,r,d,y,M){if(g in this.operations){const T=this.operations[g];T.to.tileID.key!==d.tileID.key&&(T.queued=d)}else this.operations[g]={startTime:y,phase:0,duration:M,from:r,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const r=this.operations[g];return{from:r.from,to:r.to,phase:r.phase}}update(g){for(const r in this.operations){const d=this.operations[r];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[r];break}}}_nextOp(g,r){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=r,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},jl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Jr(g,r){const d=1<<g.z;return!r&&(0===g.x||g.x===d-1)||0===g.y||g.y===d-1}const Wl=g=>({u_matrix:g});function Ta(g,r,d,y,M){if(M>0){const T=m.exported.now(),A=(T-g.timeAdded)/M,L=r?(T-r.timeAdded)/M:-1,F=d.getSource(),V=y.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),G=!r||Math.abs(r.tileID.overscaledZ-V)>Math.abs(g.tileID.overscaledZ-V),q=G&&g.refreshedUponExpiration?1:m.clamp(G?A:1-L,0,1);return g.refreshedUponExpiration&&A>=1&&(g.refreshedUponExpiration=!1),r?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}const ms=2*m.mercatorZfromAltitude(1,0)*m.GLOBE_RADIUS*Math.PI;class jo extends m.SourceCache{constructor(r){const d={type:"raster-dem",maxzoom:r.transform.maxZoom},y=new nn(Rt(),null),M=Be("mock-dem",d,y,r.style);super("mock-dem",M,!1),M.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,d){r.state="loaded",d(null)}}class Vn extends m.SourceCache{constructor(r){const d=Be("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new nn(Rt(),null),r.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,d,y){if(r.freezeTileCoverage)return;this.transform=r;const M=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,A)=>{if(T[A.key]="",!this._tiles[A.key]){const L=new m.Tile(A,this._source.tileSize*A.overscaleFactor(),r.tileZoom);L.state="loaded",this._tiles[A.key]=L}return T},{});for(const T in this._tiles)T in M||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(r){const d=this.proxyCachedFBO[r];if(void 0!==d){const y=Object.values(d);this.renderCachePool.push(...y),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class an extends m.OverscaledTileID{constructor(r,d,y){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=d,this.projMatrix=y}}class Kr extends m.Elevation{constructor(r,d){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,M,T]=function(F){const V=new m.StructArrayLayout4i8,G=new m.StructArrayLayout3ui6,q=131;V.reserve(17161),G.reserve(33800);const ee=m.EXTENT/128,re=m.EXTENT+ee/2,ie=re+ee;for(let ge=-ee;ge<ie;ge+=ee)for(let ce=-ee;ce<ie;ce+=ee){const pe=ce<0||ce>re||ge<0||ge>re?24575:0,_e=m.clamp(Math.round(ce),0,m.EXTENT),ye=m.clamp(Math.round(ge),0,m.EXTENT);V.emplaceBack(_e+pe,ye,_e,ye)}const J=(ge,ce)=>{const pe=ce*q+ge;G.emplaceBack(pe+1,pe,pe+q),G.emplaceBack(pe+q,pe+q+1,pe+1)};for(let ge=1;ge<129;ge++)for(let ce=1;ce<129;ce++)J(ce,ge);return[0,129].forEach(ge=>{for(let ce=0;ce<130;ce++)J(ce,ge),J(ge,ce)}),[V,G,32768]}(),A=r.context;this.gridBuffer=A.createVertexBuffer(y,m.boundsAttributes.members),this.gridIndexBuffer=A.createIndexBuffer(M),this.gridSegments=m.SegmentVector.simpleSegment(0,0,y.length,M.length),this.gridNoSkirtSegments=m.SegmentVector.simpleSegment(0,0,y.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Vn(d.map),this.orthoMatrix=m.create(),m.ortho(this.orthoMatrix,0,m.EXTENT,0,m.EXTENT,0,1);const L=A.gl;this._overlapStencilMode=new m.StencilMode({func:L.GEQUAL,mask:255},0,255,L.KEEP,L.KEEP,L.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new jo(d.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,d,y){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const M=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(M.get("source")),this._exaggeration=M.get("exaggeration");const T=()=>{this.sourceCache.used&&m.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const A=this.getScaledDemTileSize();this.sourceCache.update(d,A,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),d.updateElevation(!y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&m.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=0===y._centerAltitude&&-1===this.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(y.center),-1),this._emptyDEMTextureDirty=!this._initializing);const M=this.proxyCoords=d.getIds().map(F=>{const V=d.getTileByID(F).tileID;return V.projMatrix=y.calculateProjMatrix(V.toUnwrapped()),V});(function(F,V){const G=V.transform.pointCoordinate(V.transform.getCameraPoint()),q=new m.pointGeometry(G.x,G.y);F.sort((ee,re)=>{if(re.overscaledZ-ee.overscaledZ)return re.overscaledZ-ee.overscaledZ;const ie=new m.pointGeometry(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),J=new m.pointGeometry(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),ge=q.mult(1<<ee.canonical.z);return ge.x-=.5,ge.y-=.5,ge.distSqr(ie)-ge.distSqr(J)})})(M,this.painter),this._previousZoom=y.zoom;const T=this.proxyToSource||{};this.proxyToSource={},M.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const A=this._style._sourceCaches;for(const F in A){const V=A[F];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,r[F],T),V.usedForTerrain))continue;const G=r[F];V.getSource().reparseOverscaled&&this._assignTerrainTiles(G)}this.proxiedCoords[d.id]=M.map(F=>new an(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(M),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=m.exported.now();const L={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const V=this.terrainTileForTile[F.key];if(!V)continue;const G=V.tileID.key;G in L||(this._visibleDemTiles.push(V),L[G]=G)}}_assignTerrainTiles(r){this._initializing||r.forEach(d=>{if(this.terrainTileForTile[d.key])return;const y=this._findTileCoveringTileID(d,this.sourceCache);y&&(this.terrainTileForTile[d.key]=y)})}_prepareDEMTextures(){const r=this.painter.context,d=r.gl;for(const y in this.terrainTileForTile){const M=this.terrainTileForTile[y],T=M.dem;!T||M.demTexture&&!M.needsDEMTextureUpload||(r.activeTexture.set(d.TEXTURE1),Pr(this.painter,M,T))}}_prepareDemTileUniforms(r,d,y,M){if(!d||null==d.demTexture)return!1;const T=r.tileID.canonical,A=Math.pow(2,d.tileID.canonical.z-T.z),L=M||"";return y[`u_dem_tl${L}`]=[T.x*A%1,T.y*A%1],y[`u_dem_scale${L}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,d=r.gl;if(!this._emptyDepthBufferTexture){const y=new m.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new m.Texture(r,y,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const d=this._visibleDemTiles.reduce((y,M)=>{if(!M.dem)return y;const T=M.dem.tree.minimums[0];return T>0&&r++,y+T},0);return r?d/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,d=r.gl;r.activeTexture.set(d.TEXTURE2);const y=this._getLoadedAreaMinimum(),M=new m.RGBAImage({width:1,height:1},new Uint8Array(m.DEMData.pack(y,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(M,{premultiply:!1}):T=this._emptyDEMTexture=new m.Texture(r,M,d.RGBA,{premultiply:!1}),T}setupElevationDraw(r,d,y){const M=this.painter.context,T=M.gl,A=(L=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:m.DEMData.getUnpackVector(L),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var L;A.u_dem_size=this.sourceCache.getSource().tileSize,A.u_exaggeration=this.exaggeration();const F=this.painter.transform,V=F.projection,G=r.tileID.canonical;A.u_tile_tl_up=V.upVector(G,0,0),A.u_tile_tr_up=V.upVector(G,m.EXTENT,0),A.u_tile_br_up=V.upVector(G,m.EXTENT,m.EXTENT),A.u_tile_bl_up=V.upVector(G,0,m.EXTENT),A.u_tile_up_scale=y&&y.useDenormalizedUpVectorScale?ms:V.upVectorScale(G,F.center.lat,F.worldSize).metersToTile;let q=null,ee=null,re=1;if(y&&y.morphing&&this._useVertexMorphing){const ie=y.morphing.srcDemTile,J=y.morphing.dstDemTile;re=y.morphing.phase,ie&&J&&(this._prepareDemTileUniforms(r,ie,A,"_prev")&&(ee=ie),this._prepareDemTileUniforms(r,J,A)&&(q=J))}if(ee&&q?(M.activeTexture.set(T.TEXTURE2),q.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),M.activeTexture.set(T.TEXTURE4),ee.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),A.u_dem_lerp=re):(q=this.terrainTileForTile[r.tileID.key],M.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(r,q,A)?q.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),M.activeTexture.set(T.TEXTURE3),y&&y.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),y&&y.useMeterToDem&&q){const ie=(1<<q.tileID.canonical.z)*m.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=ie}y&&y.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),d.setTerrainUniformValues(M,A)}renderToBackBuffer(r){const d=this.painter,y=this.painter.context;0!==r.length&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),this.renderingToTexture=!1,function(M,T,A,L,F){if("globe"===M.transform.projection.name)!function(V,G,q,ee,re){const ie=V.context,J=ie.gl;let ge,ce;const pe=V.options.showTerrainWireframe?2:0,_e=(Xe,St)=>{if(ce===Xe)return;const Ie=[jl[Xe],"PROJECTION_GLOBE_VIEW"];St&&Ie.push(jl[pe]),ge=V.useProgram("globeRaster",null,Ie),ce=Xe},ye=V.colorModeForRenderPass(),ue=new m.DepthMode(J.LEQUAL,m.DepthMode.ReadWrite,V.depthRangeFor3D);vn.update(re);const xe=V.transform,Ne=m.calculateGlobeMercatorMatrix(xe),He=[m.mercatorXfromLng(xe.center.lng),m.mercatorYfromLat(xe.center.lat)],Ye=V.globeSharedBuffers;if((pe?[!1,!0]:[!1]).forEach(Xe=>{ce=-1;const St=Xe?J.LINES:J.TRIANGLES;for(const Ie of ee){const mt=q.getTile(Ie),ft=m.StencilMode.disabled,Tt=G.prevTerrainTileForTile[Ie.key],je=G.terrainTileForTile[Ie.key];zc(Tt,je)&&vn.newMorphing(Ie.key,Tt,je,re,250),ie.activeTexture.set(J.TEXTURE0),mt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const $t=vn.getMorphValuesForProxy(Ie.key),Wt=$t?1:0,zt={useDenormalizedUpVectorScale:!0};$t&&m.extend$1(zt,{morphing:{srcDemTile:$t.from,dstDemTile:$t.to,phase:m.easeCubicInOut($t.phase)}});const Ot=Float32Array.from(xe.globeMatrix),Kt=m.globeTileLatLngCorners(Ie.canonical),li=m.getGridMatrix(Ie.canonical,Kt),Vt=ju(xe.projMatrix,Ot,Ne,m.globeToMercatorTransition(xe.zoom),He,li);if(_e(Wt,Xe),G.setupElevationDraw(mt,ge,zt),V.prepareDrawProgram(ie,ge,Ie.toUnwrapped()),Ye){const[oi,Mi,pn]=Xe?Ye.getWirefameBuffers(V.context):Ye.getGridBuffers();ge.draw(ie,St,ue,ft,ye,m.CullFaceMode.backCCW,Vt,"globe_raster",oi,Mi,pn)}}}),Ye){ge=V.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const Xe of ee){const{x:St,y:Ie,z:mt}=Xe.canonical,ft=0===Ie,Tt=Ie===(1<<mt)-1,[je,$t,Wt,zt]=Ye.getPoleBuffers(mt);if(zt&&(ft||Tt)){const Ot=q.getTile(Xe);ie.activeTexture.set(J.TEXTURE0),Ot.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Kt=m.globePoleMatrixForTile(mt,St,xe);const li=(Vt,oi)=>Vt.draw(ie,J.TRIANGLES,ue,m.StencilMode.disabled,ye,m.CullFaceMode.disabled,ju(xe.projMatrix,Kt,Kt,0,He),"globe_pole_raster",oi,Wt,zt);G.setupElevationDraw(Ot,ge,{}),V.prepareDrawProgram(ie,ge,Xe.toUnwrapped()),ft&&li(ge,je),Tt&&(Kt=m.scale(m.create(),Kt,[1,-1,1]),li(ge,$t))}}}}(M,T,A,L,F);else{const V=M.context,G=V.gl;let q,ee;const re=M.options.showTerrainWireframe?2:0,ie=(_e,ye)=>{if(ee===_e)return;const ue=[jl[_e]];ye&&ue.push(jl[re]),q=M.useProgram("terrainRaster",null,ue),ee=_e},J=M.colorModeForRenderPass(),ge=new m.DepthMode(G.LEQUAL,m.DepthMode.ReadWrite,M.depthRangeFor3D);vn.update(F);const ce=M.transform,pe=6*Math.pow(1.5,22-ce.zoom)*T.exaggeration();(re?[!1,!0]:[!1]).forEach(_e=>{ee=-1;const ye=_e?G.LINES:G.TRIANGLES,[ue,xe]=_e?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const Ne of L){const He=A.getTile(Ne),Ye=m.StencilMode.disabled,Xe=T.prevTerrainTileForTile[Ne.key],St=T.terrainTileForTile[Ne.key];zc(Xe,St)&&vn.newMorphing(Ne.key,Xe,St,F,250),V.activeTexture.set(G.TEXTURE0),He.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST);const Ie=vn.getMorphValuesForProxy(Ne.key),mt=Ie?1:0;let ft;Ie&&(ft={morphing:{srcDemTile:Ie.from,dstDemTile:Ie.to,phase:m.easeCubicInOut(Ie.phase)}});const Tt=un(Ne.projMatrix,Jr(Ne.canonical,ce.renderWorldCopies)?pe/10:pe);ie(mt,_e),T.setupElevationDraw(He,q,ft),M.prepareDrawProgram(V,q,Ne.toUnwrapped()),q.draw(V,ye,ge,Ye,J,m.CullFaceMode.backCCW,Tt,"terrain_raster",T.gridBuffer,ue,xe)}})}}(d,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const d=this.painter,y=this.painter.context,M=this.proxySourceCache,T=this.proxiedCoords[M.id],A=this._drapedRenderBatches.shift(),L=[],F=d.style.order;let V=0;for(const G of T){const q=M.getTileByID(G.proxyTileKey),ee=M.proxyCachedFBO[G.key]?M.proxyCachedFBO[G.key][r]:void 0,re=void 0!==ee?M.renderCache[ee]:this.pool[V++],ie=void 0!==ee;if(q.texture=re.tex,ie&&!re.dirty){L.push(q.tileID);continue}let J;y.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(y.clear({color:m.Color.transparent,stencil:0}),re.dirty=!1);for(let ge=A.start;ge<=A.end;++ge){const ce=d.style._layers[F[ge]];if(ce.isHidden(d.transform.zoom))continue;const pe=d.style._getLayerSourceCache(ce),_e=pe?this.proxyToSource[G.key][pe.id]:[G];if(!_e)continue;const ye=_e;y.viewport.set([0,0,re.fb.width,re.fb.height]),J!==(pe?pe.id:null)&&(this._setupStencil(re,_e,ce,pe),J=pe?pe.id:null),d.renderLayer(d,pe,ce,ye)}this.renderedToTile?(re.dirty=!0,L.push(q.tileID)):ie||--V,5===V&&(V=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),A.end+1}postRender(){}renderCacheEfficiency(r){const d=r.order.length;if(0===d)return{efficiency:100};let y,M=0,T=0,A=!1;for(let L=0;L<d;++L){const F=r._layers[r.order[L]];this._style.isLayerDraped(F)?(A&&++M,++T):A||(A=!0,y=F.id)}return 0===T?{efficiency:100}:{efficiency:100*(1-M/T),firstUndrapedLayer:y}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{r=Math.min(r,d.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,d,y){if(!this._visibleDemTiles)return null;const M=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const A=T.tileID,L=Math.pow(2,A.overscaledZ),{x:F,y:V}=A.canonical,G=F/L,q=(F+1)/L,ee=V/L,re=(V+1)/L;return{minx:G,miny:ee,maxx:q,maxy:re,t:T.dem.tree.raycastRoot(G,ee,q,re,r,d,y),tile:T}});M.sort((T,A)=>(null!==T.t?T.t:Number.MAX_VALUE)-(null!==A.t?A.t:Number.MAX_VALUE));for(const T of M){if(null==T.t)return null;const A=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,r,d,y);if(null!=A)return A}return null}_createFBO(){const r=this.painter.context,d=r.gl,y=this.drapeBufferSize;r.activeTexture.set(d.TEXTURE0);const M=new m.Texture(r,{width:y[0],height:y[1],data:null},d.RGBA);M.bind(d.LINEAR,d.CLAMP_TO_EDGE);const T=r.createFramebuffer(y[0],y[1],!1);return T.colorAttachment.set(M.texture),T.depthAttachment=new Mt(r,T.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:T,tex:M,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const d=this._style._layers[r],y=d.isHidden(this.painter.transform.zoom),M=d.getCrossfadeParameters(),T=!!M&&1!==M.t,A=d.hasTransition();return"custom"!==d.type&&!y&&(T||A)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof X){r=!0;break}if(r)for(let d=0;d<this._style.order.length;++d){const y=this._style._layers[this._style.order[d]],M=y.isHidden(this.painter.transform.zoom),T=this._style._getLayerSourceCache(y);if("raster"!==y.type||M||!T)continue;const A=y.paint.get("raster-fade-duration");for(const L of this.proxyCoords){const F=this.proxyToSource[L.key][T.id];if(F)for(const V of F){const G=Ta(T.getTile(V),T.findLoadedParent(V,0),T,this.painter.transform,A);(1!==G.opacity||0!==G.mix)&&this._clearRenderCacheForTile(T.id,V)}}}}_setupDrapedRenderBatches(){const r=this._style.order,d=r.length;if(0===d)return;const y=[];let M,T=0,A=this._style._layers[r[T]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++T<d;)A=this._style._layers[r[T]];for(;T<d;++T){const L=this._style._layers[r[T]];L.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(L)?void 0===M&&(M=T):void 0!==M&&(y.push({start:M,end:T-1}),M=void 0))}void 0!==M&&y.push({start:M,end:T-1}),this._drapedRenderBatches=y}_setupRenderCache(r){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const A=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let L=0;L<A.length;++L){const F=Object.values(A[L]);d.renderCachePool.push(...F)}}return}this._clearRasterFadeFromRenderCache();const y=this.proxyCoords,M=this._tilesDirty;for(let A=y.length-1;A>=0;A--){const L=y[A];if(d.getTileByID(L.key),void 0!==d.proxyCachedFBO[L.key]){const F=r[L.key],V=this.proxyToSource[L.key];let G=0;for(const q in V){const ee=V[q],re=F[q];if(!re||re.length!==ee.length||ee.some((ie,J)=>ie!==re[J]||M[q]&&M[q].hasOwnProperty(ie.key))){G=-1;break}++G}for(const q in d.proxyCachedFBO[L.key])d.renderCache[d.proxyCachedFBO[L.key][q]].dirty=G<0||G!==Object.values(F).length}}const T=[...this._drapedRenderBatches];T.sort((A,L)=>L.end-L.start-(A.end-A.start));for(const A of T)for(const L of y){if(d.proxyCachedFBO[L.key])continue;let F=d.renderCachePool.pop();void 0===F&&d.renderCache.length<50&&(F=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==F&&(d.proxyCachedFBO[L.key]={},d.proxyCachedFBO[L.key][A.start]=F,d.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(r,d,y,M){if(!M||!this._sourceTilesOverlap[M.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,A=T.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let L;if(y.isTileClipped())L=d.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);L=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+L>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=L,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(r.key)||0),this._overlapStencilMode):m.StencilMode.disabled}_renderTileClippingMasks(r,d){const y=this.painter,M=this.painter.context,T=M.gl;y._tileClippingMaskIDs.clear(),M.setColorMode(m.ColorMode.disabled),M.setDepthMode(m.DepthMode.disabled);const A=y.useProgram("clippingMask");for(const L of r){const F=--d;y._tileClippingMaskIDs.set(L.key,F),A.draw(M,T.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:T.ALWAYS,mask:0},F,255,T.KEEP,T.KEEP,T.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,Wl(L.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(r){const d=this.painter.transform;if(r.x<0||r.x>d.width||r.y<0||r.y>d.height)return null;const y=[r.x,r.y,1,1];m.transformMat4$1(y,y,d.pixelMatrixInverse),m.scale$1(y,y,1/y[3]),y[0]/=d.worldSize,y[1]/=d.worldSize;const M=d._camera.position,T=m.mercatorZfromAltitude(1,d.center.lat),A=[M[0],M[1],M[2]/T,0],L=m.subtract([],y.slice(0,3),A);m.normalize(L,L);const F=this.raycast(A,L,this._exaggeration);return null!==F&&F?(m.scaleAndAdd(A,A,L,F),A[3]=A[2],A[2]*=T,A):null}drawDepth(){const r=this.painter,d=r.context,y=this.proxySourceCache,M=Math.ceil(r.width),T=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===M&&this._depthFBO.height===T||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=d.gl,L=d.createFramebuffer(M,T,!0);d.activeTexture.set(A.TEXTURE0);const F=new m.Texture(d,{width:M,height:T,data:null},A.RGBA);F.bind(A.NEAREST,A.CLAMP_TO_EDGE),L.colorAttachment.set(F.texture);const V=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,M,T);L.depthAttachment.set(V),this._depthFBO=L,this._depthTexture=F}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,M,T]),function(A,L,F,V){if("globe"===A.transform.projection.name)return;const G=A.context,q=G.gl;G.clear({depth:1});const ee=A.useProgram("terrainDepth"),re=new m.DepthMode(q.LESS,m.DepthMode.ReadWrite,A.depthRangeFor3D);for(const ie of V){const J=F.getTile(ie),ge=un(ie.projMatrix,0);L.setupElevationDraw(J,ee),ee.draw(G,q.TRIANGLES,re,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.backCCW,ge,"terrain_depth",L.gridBuffer,L.gridIndexBuffer,L.gridNoSkirtSegments)}}(r,this,y,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,d,y){if(r.getSource()instanceof Me)return this._setupProxiedCoordsForImageSource(r,d,y);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const M=this.proxiedCoords[r.id]=[],T=this.proxyCoords;for(let L=0;L<T.length;L++){const F=T[L],V=this._findTileCoveringTileID(F,r);if(V){const G=this._createProxiedId(F,V,y[F.key]&&y[F.key][r.id]);M.push(G),this.proxyToSource[F.key][r.id]=[G]}}let A=!1;for(let L=0;L<d.length;L++){const F=r.getTile(d[L]);if(!F||!F.hasData())continue;const V=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if(V&&V.tileID.canonical.z!==F.tileID.canonical.z){const G=this.proxyToSource[V.tileID.key][r.id],q=this._createProxiedId(V.tileID,F,y[V.tileID.key]&&y[V.tileID.key][r.id]);G?G.splice(G.length-1,0,q):this.proxyToSource[V.tileID.key][r.id]=[q],M.push(q),A=!0}}this._sourceTilesOverlap[r.id]=A}_setupProxiedCoordsForImageSource(r,d,y){if(!r.getSource().loaded())return;const M=this.proxiedCoords[r.id]=[],T=this.proxyCoords,A=r.getSource(),L=new m.pointGeometry(A.tileID.x,A.tileID.y)._div(1<<A.tileID.z),F=A.coordinates.map(m.MercatorCoordinate.fromLngLat).reduce((G,q)=>(G.min.x=Math.min(G.min.x,q.x-L.x),G.min.y=Math.min(G.min.y,q.y-L.y),G.max.x=Math.max(G.max.x,q.x-L.x),G.max.y=Math.max(G.max.y,q.y-L.y),G),{min:new m.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new m.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),V=(G,q)=>{const ee=G.wrap+G.canonical.x/(1<<G.canonical.z),re=G.canonical.y/(1<<G.canonical.z),ie=m.EXTENT/(1<<G.canonical.z),J=q.wrap+q.canonical.x/(1<<q.canonical.z),ge=q.canonical.y/(1<<q.canonical.z);return ee+ie<J+F.min.x||ee>J+F.max.x||re+ie<ge+F.min.y||re>ge+F.max.y};for(let G=0;G<T.length;G++){const q=T[G];for(let ee=0;ee<d.length;ee++){const re=r.getTile(d[ee]);if(!re||!re.hasData()||V(q,re.tileID))continue;const ie=this._createProxiedId(q,re,y[q.key]&&y[q.key][r.id]),J=this.proxyToSource[q.key][r.id];J?J.push(ie):this.proxyToSource[q.key][r.id]=[ie],M.push(ie)}}}_createProxiedId(r,d,y){let M=this.orthoMatrix;if(y){const T=y.find(A=>A.key===d.tileID.key);if(T)return T}if(d.tileID.key!==r.key){const T=r.canonical.z-d.tileID.canonical.z;let A,L,F;M=m.create();const V=d.tileID.wrap-r.wrap<<r.overscaledZ;T>0?(A=m.EXTENT>>T,L=A*((d.tileID.canonical.x<<T)-r.canonical.x+V),F=A*((d.tileID.canonical.y<<T)-r.canonical.y)):(A=m.EXTENT<<-T,L=m.EXTENT*(d.tileID.canonical.x-(r.canonical.x+V<<-T)),F=m.EXTENT*(d.tileID.canonical.y-(r.canonical.y<<-T))),m.ortho(M,0,A,0,A,0,1),m.translate(M,M,[L,F,0])}return new an(d.tileID,r.key,M)}_findTileCoveringTileID(r,d){let y=d.getTile(r);if(y&&y.hasData())return y;const M=this._findCoveringTileCache[d.id],T=M[r.key];if(y=T?d.getTileByID(T):null,y&&y.hasData()||null===T)return y;let A=y?y.tileID:r,L=A.overscaledZ;const F=d.getSource().minzoom,V=[];if(!T){const q=d.getSource().maxzoom;if(r.canonical.z>=q){const ee=r.canonical.z-q;d.getSource().reparseOverscaled?(L=Math.max(r.canonical.z+2,d.transform.tileZoom),A=new m.OverscaledTileID(L,r.wrap,q,r.canonical.x>>ee,r.canonical.y>>ee)):0!==ee&&(L=q,A=new m.OverscaledTileID(L,r.wrap,q,r.canonical.x>>ee,r.canonical.y>>ee))}A.key!==r.key&&(V.push(A.key),y=d.getTile(A))}const G=q=>{V.forEach(ee=>{M[ee]=q}),V.length=0};for(L-=1;L>=F&&(!y||!y.hasData());L--){y&&G(y.tileID.key);const q=A.calculateScaledKey(L);if(y=d.getTileByID(q),y&&y.hasData())break;const ee=M[q];if(null===ee)break;void 0===ee?V.push(q):y=d.getTileByID(ee)}return G(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,d){let y=this._tilesDirty[r];y||(y=this._tilesDirty[r]={}),y[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(d){let y=0;const M=new m.StructArrayLayout2ui4,T=131;for(let A=1;A<129;A++){for(let L=1;L<129;L++)y=A*T+L,M.emplaceBack(y,y+1),M.emplaceBack(y,y+T),M.emplaceBack(y+1,y+T),128===A&&M.emplaceBack(y+T,y+T+1);M.emplaceBack(y+1,y+1+T)}return M}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=m.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Wo(g){const r=[];for(let d=0;d<g.length;d++){if(null===g[d])continue;const y=g[d].split(" ");r.push(y.pop())}return r}class sl{static cacheKey(r,d,y){let M=`${r}${y?y.cacheKey:""}`;for(const T of d)M+=`/${T}`;return M}constructor(r,d,y,M,T,A){const L=r.gl;this.program=L.createProgram();const F=Wo(y.staticAttributes),V=M?M.getBinderAttributes():[],G=F.concat(V),q=y.staticUniforms?Wo(y.staticUniforms):[],ee=M?M.getBinderUniforms():[],re=q.concat(ee),ie=[];for(const ue of re)ie.indexOf(ue)<0&&ie.push(ue);let J=M?M.defines():[];J=J.concat(A.map(ue=>`#define ${ue}`));const ge=J.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",nl,kc.fragmentSource,ps.fragmentSource,y.fragmentSource).join("\n"),ce=J.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",nl,kc.vertexSource,ps.vertexSource,ks.vertexSource,y.vertexSource).join("\n"),pe=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(pe,ge),L.compileShader(pe),L.attachShader(this.program,pe);const _e=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(_e,ce),L.compileShader(_e),L.attachShader(this.program,_e),this.attributes={};const ye={};this.numAttributes=G.length;for(let ue=0;ue<this.numAttributes;ue++)G[ue]&&(L.bindAttribLocation(this.program,ue,G[ue]),this.attributes[G[ue]]=ue);L.linkProgram(this.program),L.deleteShader(_e),L.deleteShader(pe);for(let ue=0;ue<ie.length;ue++){const xe=ie[ue];if(xe&&!ye[xe]){const Ne=L.getUniformLocation(this.program,xe);Ne&&(ye[xe]=Ne)}}var ue,xe;this.fixedUniforms=T(r,ye),this.binderUniforms=M?M.getUniforms(r,ye):[],-1!==A.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new m.Uniform1i(ue=r,(xe=ye).u_dem),u_dem_prev:new m.Uniform1i(ue,xe.u_dem_prev),u_dem_unpack:new m.Uniform4f(ue,xe.u_dem_unpack),u_dem_tl:new m.Uniform2f(ue,xe.u_dem_tl),u_dem_scale:new m.Uniform1f(ue,xe.u_dem_scale),u_dem_tl_prev:new m.Uniform2f(ue,xe.u_dem_tl_prev),u_dem_scale_prev:new m.Uniform1f(ue,xe.u_dem_scale_prev),u_dem_size:new m.Uniform1f(ue,xe.u_dem_size),u_dem_lerp:new m.Uniform1f(ue,xe.u_dem_lerp),u_exaggeration:new m.Uniform1f(ue,xe.u_exaggeration),u_depth:new m.Uniform1i(ue,xe.u_depth),u_depth_size_inv:new m.Uniform2f(ue,xe.u_depth_size_inv),u_meter_to_dem:new m.Uniform1f(ue,xe.u_meter_to_dem),u_label_plane_matrix_inv:new m.UniformMatrix4f(ue,xe.u_label_plane_matrix_inv),u_tile_tl_up:new m.Uniform3f(ue,xe.u_tile_tl_up),u_tile_tr_up:new m.Uniform3f(ue,xe.u_tile_tr_up),u_tile_br_up:new m.Uniform3f(ue,xe.u_tile_br_up),u_tile_bl_up:new m.Uniform3f(ue,xe.u_tile_bl_up),u_tile_up_scale:new m.Uniform1f(ue,xe.u_tile_up_scale)}),-1!==A.indexOf("FOG")&&(this.fogUniforms=((ue,xe)=>({u_fog_matrix:new m.UniformMatrix4f(ue,xe.u_fog_matrix),u_fog_range:new m.Uniform2f(ue,xe.u_fog_range),u_fog_color:new m.Uniform4f(ue,xe.u_fog_color),u_fog_horizon_blend:new m.Uniform1f(ue,xe.u_fog_horizon_blend),u_fog_temporal_offset:new m.Uniform1f(ue,xe.u_fog_temporal_offset)}))(r,ye))}setTerrainUniformValues(r,d){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const M in d)y[M].set(d[M])}}setFogUniformValues(r,d){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const M in d)y[M].location&&y[M].set(d[M])}}draw(r,d,y,M,T,A,L,F,V,G,q,ee,re,ie,J,ge){const ce=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(y),r.setStencilMode(M),r.setColorMode(T),r.setCullFace(A);for(const _e of Object.keys(this.fixedUniforms))this.fixedUniforms[_e].set(L[_e]);ie&&ie.setUniforms(r,this.binderUniforms,ee,{zoom:re});const pe={[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[d];for(const _e of q.get()){const ye=_e.vaos||(_e.vaos={});(ye[F]||(ye[F]=new Ln)).bind(r,this,V,ie?ie.getPaintVertexBuffers():[],G,_e.vertexOffset,J,ge),ce.drawElements(d,_e.primitiveLength*pe,ce.UNSIGNED_SHORT,_e.primitiveOffset*pe*2)}}}function zs(g,r,d){const y=1/ir(d,1,r.transform.tileZoom),M=Math.pow(2,d.tileID.overscaledZ),T=d.tileSize*Math.pow(2,r.transform.tileZoom)/M,A=T*(d.tileID.canonical.x+d.tileID.wrap*M),L=T*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[y,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[A>>16,L>>16],u_pixel_coord_lower:[65535&A,65535&L]}}const go=m.create(),io=(g,r,d,y,M,T,A,L,F)=>{const V=r.style.light,G=V.properties.get("position"),q=[G.x,G.y,G.z],ee=m.create$1();"viewport"===V.properties.get("anchor")&&(m.fromRotation(ee,-r.transform.angle),m.transformMat3(q,q,ee));const re=V.properties.get("color"),ie=r.transform,J={u_matrix:g,u_lightpos:q,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_vertical_gradient:+d,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:go,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===ie.projection.name&&(J.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],J.u_zoom_transition=A,J.u_inv_rot_matrix=F,J.u_merc_center=L,J.u_up_dir=ie.projection.upVector(new m.CanonicalTileID(0,0,0),L[0]*m.EXTENT,L[1]*m.EXTENT),J.u_height_lift=T),J},Zl=(g,r,d,y,M,T,A,L,F,V,G)=>{const q=io(g,r,d,y,M,L,F,V,G),ee={u_height_factor:-Math.pow(2,M.overscaledZ)/A.tileSize/8};return m.extend(q,zs(T,r,A),ee)},ql=g=>({u_matrix:g}),$l=(g,r,d,y)=>m.extend(ql(g),zs(d,r,y)),ol=(g,r)=>({u_matrix:g,u_world:r}),Oc=(g,r,d,y,M)=>m.extend($l(g,r,d,y),{u_world:M}),Bc=m.create(),Zo=(g,r,d,y,M,T)=>{const A=g.transform,L="globe"===A.projection.name;let F;if("map"===T.paint.get("circle-pitch-alignment"))if(L){const G=m.globePixelsToTileUnits(A.zoom,r.canonical);F=Float32Array.from([G,0,0,G])}else F=A.calculatePixelsToTileUnitsMatrix(d);else F=new Float32Array([A.pixelsToGLUnits[0],0,0,A.pixelsToGLUnits[1]]);const V={u_camera_to_center_distance:A.cameraToCenterDistance,u_matrix:g.translatePosMatrix(r.projMatrix,d,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_device_pixel_ratio:m.exported.devicePixelRatio,u_extrude_scale:F,u_inv_rot_matrix:Bc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return L&&(V.u_inv_rot_matrix=y,V.u_merc_center=M,V.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],V.u_zoom_transition=m.globeToMercatorTransition(A.zoom),V.u_up_dir=A.projection.upVector(r.canonical,M[0],M[1])),V},Fh=g=>{const r=[];return"map"===g.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},Uh=(g,r,d)=>{const y=m.EXTENT/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:r.cameraToCenterDistance,u_extrude_scale:[r.pixelsToGLUnits[0]/y,r.pixelsToGLUnits[1]/y]}},Nh=(g,r,d=1)=>({u_matrix:g,u_color:r,u_overlay:0,u_overlay_scale:d}),Vh=m.create(),di=(g,r,d,y,M,T,A)=>{const L=g.transform,F="globe"===L.projection.name,V=F?m.globePixelsToTileUnits(L.zoom,r.canonical):ir(d,1,T),G={u_matrix:r.projMatrix,u_extrude_scale:V,u_intensity:A,u_inv_rot_matrix:Vh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return F&&(G.u_inv_rot_matrix=y,G.u_merc_center=M,G.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],G.u_zoom_transition=m.globeToMercatorTransition(L.zoom),G.u_up_dir=L.projection.upVector(r.canonical,M[0],M[1])),G},Gh=(g,r,d,y,M,T,A)=>{const L=g.transform,F=L.calculatePixelsToTileUnitsMatrix(r),V={u_matrix:Gn(g,r,d,M),u_pixels_to_tile_units:F,u_device_pixel_ratio:A,u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:T,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Wu(d)){const G=qo(r,g.transform);V.u_texsize=r.lineAtlasTexture.size,V.u_scale=[G,y.fromScale,y.toScale],V.u_mix=y.t}return V},_o=(g,r,d,y,M,T)=>{const A=g.transform,L=qo(r,A);return{u_matrix:Gn(g,r,d,M),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:T,u_image:0,u_scale:[L,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function qo(g,r){return 1/ir(g,1,r.tileZoom)}function Gn(g,r,d,y){return g.translatePosMatrix(y||r.tileID.projMatrix,r,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function Wu(g){const r=g.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const xr=(g,r,d,y,M,T)=>{return{u_matrix:g,u_tl_parent:r,u_scale_parent:d,u_fade_t:y.mix,u_opacity:y.opacity*M.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:M.paint.get("raster-brightness-min"),u_brightness_high:M.paint.get("raster-brightness-max"),u_saturation_factor:(L=M.paint.get("raster-saturation"),L>0?1-1/(1.001-L):-L),u_contrast_factor:(A=M.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:Fc(M.paint.get("raster-hue-rotate")),u_perspective_transform:T};var A,L};function Fc(g){g*=Math.PI/180;const r=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*r-d+1)/3,(Math.sqrt(3)*r-d+1)/3]}const bn=m.create(),al=(g,r,d,y,M,T,A,L,F,V,G,q,ee,re)=>{const ie=M.transform,J={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:ie.width/ie.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:A,u_coord_matrix:L,u_is_text:+F,u_pitch_with_map:+y,u_texsize:V,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:bn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:bn};return"globe"===ie.projection.name&&(J.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],J.u_zoom_transition=q,J.u_inv_rot_matrix=re,J.u_merc_center=ee,J.u_camera_forward=ie._camera.forward(),J.u_ecef_origin=m.globeECEFOrigin(ie.globeMatrix,G.toUnwrapped()),J.u_tile_matrix=Float32Array.from(ie.globeMatrix)),J},yo=(g,r,d,y,M,T,A,L,F,V,G,q,ee,re,ie)=>{const{cameraToCenterDistance:J,_pitch:ge}=M.transform;return m.extend(al(g,r,d,y,M,T,A,L,F,V,q,ee,re,ie),{u_gamma_scale:y?J*Math.cos(M.terrain?0:ge):1,u_device_pixel_ratio:m.exported.devicePixelRatio,u_is_halo:+G})},$o=(g,r,d,y,M,T,A,L,F,V,G,q,ee,re)=>m.extend(yo(g,r,d,y,M,T,A,L,!0,F,!0,G,q,ee,re),{u_texsize_icon:V,u_texture_icon:1}),Hh=(g,r,d)=>({u_matrix:g,u_opacity:r,u_color:d}),Zu=(g,r,d,y,M,T)=>m.extend(function(A,L,F,V){const G=F.imageManager.getPattern(A.from.toString()),q=F.imageManager.getPattern(A.to.toString()),{width:ee,height:re}=F.imageManager.getPixelSize(),ie=Math.pow(2,V.tileID.overscaledZ),J=V.tileSize*Math.pow(2,F.transform.tileZoom)/ie,ge=J*(V.tileID.canonical.x+V.tileID.wrap*ie),ce=J*V.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:G.tl,u_pattern_br_a:G.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[ee,re],u_mix:L.t,u_pattern_size_a:G.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/ir(V,1,F.transform.tileZoom),u_pixel_coord_upper:[ge>>16,ce>>16],u_pixel_coord_lower:[65535&ge,65535&ce]}}(y,T,d,M),{u_matrix:g,u_opacity:r}),Hi={fillExtrusion:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_lightpos:new m.Uniform3f(g,r.u_lightpos),u_lightintensity:new m.Uniform1f(g,r.u_lightintensity),u_lightcolor:new m.Uniform3f(g,r.u_lightcolor),u_vertical_gradient:new m.Uniform1f(g,r.u_vertical_gradient),u_opacity:new m.Uniform1f(g,r.u_opacity),u_tile_id:new m.Uniform3f(g,r.u_tile_id),u_zoom_transition:new m.Uniform1f(g,r.u_zoom_transition),u_inv_rot_matrix:new m.UniformMatrix4f(g,r.u_inv_rot_matrix),u_merc_center:new m.Uniform2f(g,r.u_merc_center),u_up_dir:new m.Uniform3f(g,r.u_up_dir),u_height_lift:new m.Uniform1f(g,r.u_height_lift)}),fillExtrusionPattern:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_lightpos:new m.Uniform3f(g,r.u_lightpos),u_lightintensity:new m.Uniform1f(g,r.u_lightintensity),u_lightcolor:new m.Uniform3f(g,r.u_lightcolor),u_vertical_gradient:new m.Uniform1f(g,r.u_vertical_gradient),u_height_factor:new m.Uniform1f(g,r.u_height_factor),u_tile_id:new m.Uniform3f(g,r.u_tile_id),u_zoom_transition:new m.Uniform1f(g,r.u_zoom_transition),u_inv_rot_matrix:new m.UniformMatrix4f(g,r.u_inv_rot_matrix),u_merc_center:new m.Uniform2f(g,r.u_merc_center),u_up_dir:new m.Uniform3f(g,r.u_up_dir),u_height_lift:new m.Uniform1f(g,r.u_height_lift),u_image:new m.Uniform1i(g,r.u_image),u_texsize:new m.Uniform2f(g,r.u_texsize),u_pixel_coord_upper:new m.Uniform2f(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(g,r.u_pixel_coord_lower),u_scale:new m.Uniform3f(g,r.u_scale),u_fade:new m.Uniform1f(g,r.u_fade),u_opacity:new m.Uniform1f(g,r.u_opacity)}),fill:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix)}),fillPattern:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_image:new m.Uniform1i(g,r.u_image),u_texsize:new m.Uniform2f(g,r.u_texsize),u_pixel_coord_upper:new m.Uniform2f(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(g,r.u_pixel_coord_lower),u_scale:new m.Uniform3f(g,r.u_scale),u_fade:new m.Uniform1f(g,r.u_fade)}),fillOutline:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_world:new m.Uniform2f(g,r.u_world)}),fillOutlinePattern:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_world:new m.Uniform2f(g,r.u_world),u_image:new m.Uniform1i(g,r.u_image),u_texsize:new m.Uniform2f(g,r.u_texsize),u_pixel_coord_upper:new m.Uniform2f(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(g,r.u_pixel_coord_lower),u_scale:new m.Uniform3f(g,r.u_scale),u_fade:new m.Uniform1f(g,r.u_fade)}),circle:(g,r)=>({u_camera_to_center_distance:new m.Uniform1f(g,r.u_camera_to_center_distance),u_extrude_scale:new m.UniformMatrix2f(g,r.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(g,r.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_inv_rot_matrix:new m.UniformMatrix4f(g,r.u_inv_rot_matrix),u_merc_center:new m.Uniform2f(g,r.u_merc_center),u_tile_id:new m.Uniform3f(g,r.u_tile_id),u_zoom_transition:new m.Uniform1f(g,r.u_zoom_transition),u_up_dir:new m.Uniform3f(g,r.u_up_dir)}),collisionBox:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_camera_to_center_distance:new m.Uniform1f(g,r.u_camera_to_center_distance),u_extrude_scale:new m.Uniform2f(g,r.u_extrude_scale)}),collisionCircle:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_inv_matrix:new m.UniformMatrix4f(g,r.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(g,r.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(g,r.u_viewport_size)}),debug:(g,r)=>({u_color:new m.UniformColor(g,r.u_color),u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_overlay:new m.Uniform1i(g,r.u_overlay),u_overlay_scale:new m.Uniform1f(g,r.u_overlay_scale)}),clippingMask:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix)}),heatmap:(g,r)=>({u_extrude_scale:new m.Uniform1f(g,r.u_extrude_scale),u_intensity:new m.Uniform1f(g,r.u_intensity),u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_inv_rot_matrix:new m.UniformMatrix4f(g,r.u_inv_rot_matrix),u_merc_center:new m.Uniform2f(g,r.u_merc_center),u_tile_id:new m.Uniform3f(g,r.u_tile_id),u_zoom_transition:new m.Uniform1f(g,r.u_zoom_transition),u_up_dir:new m.Uniform3f(g,r.u_up_dir)}),heatmapTexture:(g,r)=>({u_image:new m.Uniform1i(g,r.u_image),u_color_ramp:new m.Uniform1i(g,r.u_color_ramp),u_opacity:new m.Uniform1f(g,r.u_opacity)}),hillshade:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_image:new m.Uniform1i(g,r.u_image),u_latrange:new m.Uniform2f(g,r.u_latrange),u_light:new m.Uniform2f(g,r.u_light),u_shadow:new m.UniformColor(g,r.u_shadow),u_highlight:new m.UniformColor(g,r.u_highlight),u_accent:new m.UniformColor(g,r.u_accent)}),hillshadePrepare:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_image:new m.Uniform1i(g,r.u_image),u_dimension:new m.Uniform2f(g,r.u_dimension),u_zoom:new m.Uniform1f(g,r.u_zoom),u_unpack:new m.Uniform4f(g,r.u_unpack)}),line:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_pixels_to_tile_units:new m.UniformMatrix2f(g,r.u_pixels_to_tile_units),u_device_pixel_ratio:new m.Uniform1f(g,r.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(g,r.u_units_to_pixels),u_dash_image:new m.Uniform1i(g,r.u_dash_image),u_gradient_image:new m.Uniform1i(g,r.u_gradient_image),u_image_height:new m.Uniform1f(g,r.u_image_height),u_texsize:new m.Uniform2f(g,r.u_texsize),u_scale:new m.Uniform3f(g,r.u_scale),u_mix:new m.Uniform1f(g,r.u_mix),u_alpha_discard_threshold:new m.Uniform1f(g,r.u_alpha_discard_threshold)}),linePattern:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_texsize:new m.Uniform2f(g,r.u_texsize),u_pixels_to_tile_units:new m.UniformMatrix2f(g,r.u_pixels_to_tile_units),u_device_pixel_ratio:new m.Uniform1f(g,r.u_device_pixel_ratio),u_image:new m.Uniform1i(g,r.u_image),u_units_to_pixels:new m.Uniform2f(g,r.u_units_to_pixels),u_scale:new m.Uniform3f(g,r.u_scale),u_fade:new m.Uniform1f(g,r.u_fade),u_alpha_discard_threshold:new m.Uniform1f(g,r.u_alpha_discard_threshold)}),raster:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_tl_parent:new m.Uniform2f(g,r.u_tl_parent),u_scale_parent:new m.Uniform1f(g,r.u_scale_parent),u_fade_t:new m.Uniform1f(g,r.u_fade_t),u_opacity:new m.Uniform1f(g,r.u_opacity),u_image0:new m.Uniform1i(g,r.u_image0),u_image1:new m.Uniform1i(g,r.u_image1),u_brightness_low:new m.Uniform1f(g,r.u_brightness_low),u_brightness_high:new m.Uniform1f(g,r.u_brightness_high),u_saturation_factor:new m.Uniform1f(g,r.u_saturation_factor),u_contrast_factor:new m.Uniform1f(g,r.u_contrast_factor),u_spin_weights:new m.Uniform3f(g,r.u_spin_weights),u_perspective_transform:new m.Uniform2f(g,r.u_perspective_transform)}),symbolIcon:(g,r)=>({u_is_size_zoom_constant:new m.Uniform1i(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(g,r.u_is_size_feature_constant),u_size_t:new m.Uniform1f(g,r.u_size_t),u_size:new m.Uniform1f(g,r.u_size),u_camera_to_center_distance:new m.Uniform1f(g,r.u_camera_to_center_distance),u_rotate_symbol:new m.Uniform1i(g,r.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(g,r.u_aspect_ratio),u_fade_change:new m.Uniform1f(g,r.u_fade_change),u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(g,r.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(g,r.u_coord_matrix),u_is_text:new m.Uniform1i(g,r.u_is_text),u_pitch_with_map:new m.Uniform1i(g,r.u_pitch_with_map),u_texsize:new m.Uniform2f(g,r.u_texsize),u_tile_id:new m.Uniform3f(g,r.u_tile_id),u_zoom_transition:new m.Uniform1f(g,r.u_zoom_transition),u_inv_rot_matrix:new m.UniformMatrix4f(g,r.u_inv_rot_matrix),u_merc_center:new m.Uniform2f(g,r.u_merc_center),u_camera_forward:new m.Uniform3f(g,r.u_camera_forward),u_tile_matrix:new m.UniformMatrix4f(g,r.u_tile_matrix),u_ecef_origin:new m.Uniform3f(g,r.u_ecef_origin),u_texture:new m.Uniform1i(g,r.u_texture)}),symbolSDF:(g,r)=>({u_is_size_zoom_constant:new m.Uniform1i(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(g,r.u_is_size_feature_constant),u_size_t:new m.Uniform1f(g,r.u_size_t),u_size:new m.Uniform1f(g,r.u_size),u_camera_to_center_distance:new m.Uniform1f(g,r.u_camera_to_center_distance),u_rotate_symbol:new m.Uniform1i(g,r.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(g,r.u_aspect_ratio),u_fade_change:new m.Uniform1f(g,r.u_fade_change),u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(g,r.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(g,r.u_coord_matrix),u_is_text:new m.Uniform1i(g,r.u_is_text),u_pitch_with_map:new m.Uniform1i(g,r.u_pitch_with_map),u_texsize:new m.Uniform2f(g,r.u_texsize),u_texture:new m.Uniform1i(g,r.u_texture),u_gamma_scale:new m.Uniform1f(g,r.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(g,r.u_device_pixel_ratio),u_tile_id:new m.Uniform3f(g,r.u_tile_id),u_zoom_transition:new m.Uniform1f(g,r.u_zoom_transition),u_inv_rot_matrix:new m.UniformMatrix4f(g,r.u_inv_rot_matrix),u_merc_center:new m.Uniform2f(g,r.u_merc_center),u_camera_forward:new m.Uniform3f(g,r.u_camera_forward),u_tile_matrix:new m.UniformMatrix4f(g,r.u_tile_matrix),u_ecef_origin:new m.Uniform3f(g,r.u_ecef_origin),u_is_halo:new m.Uniform1i(g,r.u_is_halo)}),symbolTextAndIcon:(g,r)=>({u_is_size_zoom_constant:new m.Uniform1i(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(g,r.u_is_size_feature_constant),u_size_t:new m.Uniform1f(g,r.u_size_t),u_size:new m.Uniform1f(g,r.u_size),u_camera_to_center_distance:new m.Uniform1f(g,r.u_camera_to_center_distance),u_rotate_symbol:new m.Uniform1i(g,r.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(g,r.u_aspect_ratio),u_fade_change:new m.Uniform1f(g,r.u_fade_change),u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(g,r.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(g,r.u_coord_matrix),u_is_text:new m.Uniform1i(g,r.u_is_text),u_pitch_with_map:new m.Uniform1i(g,r.u_pitch_with_map),u_texsize:new m.Uniform2f(g,r.u_texsize),u_texsize_icon:new m.Uniform2f(g,r.u_texsize_icon),u_texture:new m.Uniform1i(g,r.u_texture),u_texture_icon:new m.Uniform1i(g,r.u_texture_icon),u_gamma_scale:new m.Uniform1f(g,r.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(g,r.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(g,r.u_is_halo)}),background:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_opacity:new m.Uniform1f(g,r.u_opacity),u_color:new m.UniformColor(g,r.u_color)}),backgroundPattern:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_opacity:new m.Uniform1f(g,r.u_opacity),u_image:new m.Uniform1i(g,r.u_image),u_pattern_tl_a:new m.Uniform2f(g,r.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(g,r.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(g,r.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(g,r.u_pattern_br_b),u_texsize:new m.Uniform2f(g,r.u_texsize),u_mix:new m.Uniform1f(g,r.u_mix),u_pattern_size_a:new m.Uniform2f(g,r.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(g,r.u_pattern_size_b),u_scale_a:new m.Uniform1f(g,r.u_scale_a),u_scale_b:new m.Uniform1f(g,r.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(g,r.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(g,r.u_tile_units_to_pixels)}),terrainRaster:Hl,terrainDepth:Hl,skybox:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_sun_direction:new m.Uniform3f(g,r.u_sun_direction),u_cubemap:new m.Uniform1i(g,r.u_cubemap),u_opacity:new m.Uniform1f(g,r.u_opacity),u_temporal_offset:new m.Uniform1f(g,r.u_temporal_offset)}),skyboxGradient:(g,r)=>({u_matrix:new m.UniformMatrix4f(g,r.u_matrix),u_color_ramp:new m.Uniform1i(g,r.u_color_ramp),u_center_direction:new m.Uniform3f(g,r.u_center_direction),u_radius:new m.Uniform1f(g,r.u_radius),u_opacity:new m.Uniform1f(g,r.u_opacity),u_temporal_offset:new m.Uniform1f(g,r.u_temporal_offset)}),skyboxCapture:(g,r)=>({u_matrix_3f:new m.UniformMatrix3f(g,r.u_matrix_3f),u_sun_direction:new m.Uniform3f(g,r.u_sun_direction),u_sun_intensity:new m.Uniform1f(g,r.u_sun_intensity),u_color_tint_r:new m.Uniform4f(g,r.u_color_tint_r),u_color_tint_m:new m.Uniform4f(g,r.u_color_tint_m),u_luminance:new m.Uniform1f(g,r.u_luminance)}),globeRaster:(g,r)=>({u_proj_matrix:new m.UniformMatrix4f(g,r.u_proj_matrix),u_globe_matrix:new m.UniformMatrix4f(g,r.u_globe_matrix),u_merc_matrix:new m.UniformMatrix4f(g,r.u_merc_matrix),u_zoom_transition:new m.Uniform1f(g,r.u_zoom_transition),u_merc_center:new m.Uniform2f(g,r.u_merc_center),u_image0:new m.Uniform1i(g,r.u_image0),u_grid_matrix:new m.UniformMatrix3f(g,r.u_grid_matrix)}),globeAtmosphere:(g,r)=>({u_frustum_tl:new m.Uniform3f(g,r.u_frustum_tl),u_frustum_tr:new m.Uniform3f(g,r.u_frustum_tr),u_frustum_br:new m.Uniform3f(g,r.u_frustum_br),u_frustum_bl:new m.Uniform3f(g,r.u_frustum_bl),u_globe_pos:new m.Uniform3f(g,r.u_globe_pos),u_globe_radius:new m.Uniform1f(g,r.u_globe_radius),u_opacity:new m.Uniform1f(g,r.u_opacity),u_fadeout_range:new m.Uniform1f(g,r.u_fadeout_range),u_start_color:new m.Uniform3f(g,r.u_start_color),u_end_color:new m.Uniform3f(g,r.u_end_color)})};let Ir;function ll(g,r,d,y,M,T,A){const L=g.context,F=L.gl,V=g.useProgram("collisionBox"),G=[];let q=0,ee=0;for(let _e=0;_e<y.length;_e++){const ye=y[_e],ue=r.getTile(ye),xe=ue.getBucket(d);if(!xe)continue;let Ne=ye.projMatrix;0===M[0]&&0===M[1]||(Ne=g.translatePosMatrix(ye.projMatrix,ue,M,T));const He=A?xe.textCollisionBox:xe.iconCollisionBox,Ye=xe.collisionCircleArray;if(Ye.length>0){const Xe=m.create(),St=Ne;m.mul(Xe,xe.placementInvProjMatrix,g.transform.glCoordMatrix),m.mul(Xe,Xe,xe.placementViewportMatrix),G.push({circleArray:Ye,circleOffset:ee,transform:St,invTransform:Xe}),q+=Ye.length/4,ee=q}He&&(g.terrain&&g.terrain.setupElevationDraw(ue,V),V.draw(L,F.LINES,m.DepthMode.disabled,m.StencilMode.disabled,g.colorModeForRenderPass(),m.CullFaceMode.disabled,Uh(Ne,g.transform,ue),d.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,g.transform.zoom,null,He.collisionVertexBuffer,He.collisionVertexBufferExt))}if(!A||!G.length)return;const re=g.useProgram("collisionCircle"),ie=new m.StructArrayLayout2f1f2i16;ie.resize(4*q),ie._trim();let J=0;for(const _e of G)for(let ye=0;ye<_e.circleArray.length/4;ye++){const ue=4*ye,xe=_e.circleArray[ue+0],Ne=_e.circleArray[ue+1],He=_e.circleArray[ue+2],Ye=_e.circleArray[ue+3];ie.emplace(J++,xe,Ne,He,Ye,0),ie.emplace(J++,xe,Ne,He,Ye,1),ie.emplace(J++,xe,Ne,He,Ye,2),ie.emplace(J++,xe,Ne,He,Ye,3)}(!Ir||Ir.length<2*q)&&(Ir=function(_e){const ye=2*_e,ue=new m.StructArrayLayout3ui6;ue.resize(ye),ue._trim();for(let xe=0;xe<ye;xe++){const Ne=6*xe;ue.uint16[Ne+0]=4*xe+0,ue.uint16[Ne+1]=4*xe+1,ue.uint16[Ne+2]=4*xe+2,ue.uint16[Ne+3]=4*xe+2,ue.uint16[Ne+4]=4*xe+3,ue.uint16[Ne+5]=4*xe+0}return ue}(q));const ge=L.createIndexBuffer(Ir,!0),ce=L.createVertexBuffer(ie,m.collisionCircleLayout.members,!0);for(const _e of G){const ye={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(pe=g.transform).cameraToCenterDistance,u_viewport_size:[pe.width,pe.height]};re.draw(L,F.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,g.colorModeForRenderPass(),m.CullFaceMode.disabled,ye,d.id,ce,ge,m.SegmentVector.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,g.transform.zoom,null,null,null)}var pe;ce.destroy(),ge.destroy()}const Xl=m.create();function Ea(g,r,d,y,M,T){const{horizontalAlign:A,verticalAlign:L}=m.getAnchorAlignment(g),F=-(A-.5)*r,V=-(L-.5)*d,G=m.evaluateVariableOffset(g,y);return new m.pointGeometry((F/M+G[0])*T,(V/M+G[1])*T)}function xp(g,r,d,y,M,T,A,L,F,V,G,q){const ee=g.text.placedSymbolArray,re=g.text.dynamicLayoutVertexArray,ie=g.icon.dynamicLayoutVertexArray,J={},ge=L.projMatrix,ce=T.elevation,pe=q.upVectorScale(L.canonical,T.center.lat,T.worldSize);re.clear();for(let _e=0;_e<ee.length;_e++){const ye=ee.get(_e),ue=g.allowVerticalPlacement&&!ye.placedOrientation,xe=ye.hidden||!ye.crossTileID||ue?null:y[ye.crossTileID];if(xe){const Ne=new m.pointGeometry(ye.tileAnchorX,ye.tileAnchorY),He=q.upVector(L.canonical,Ne.x,Ne.y),Ye=ce?ce.getAtTileOffset(L,Ne.x,Ne.y):0,Xe=lr([ye.projectedAnchorX+Ye*He[0]*pe.metersToTile,ye.projectedAnchorY+Ye*He[1]*pe.metersToTile,ye.projectedAnchorZ+Ye*He[2]*pe.metersToTile],d?ge:A),St=on(T.cameraToCenterDistance,Xe.signedDistanceFromCamera);let Ie=M.evaluateSizeForFeature(g.textSizeData,V,ye)*St/m.ONE_EM;d&&(Ie*=g.tilePixelRatio/F);const{width:mt,height:ft,anchor:Tt,textOffset:je,textScale:$t}=xe,Wt=Ea(Tt,mt,ft,je,$t,Ie),zt=d?Un(Ne.add(Wt),A,Ye*pe.metersToLabelSpace).point:Xe.point.add(r?Wt.rotate(-T.angle):Wt),Ot=g.allowVerticalPlacement&&ye.placedOrientation===m.WritingMode.vertical?Math.PI/2:0;for(let Kt=0;Kt<ye.numGlyphs;Kt++)m.addDynamicAttributes(re,zt,Ot);G&&ye.associatedIconIndex>=0&&(J[ye.associatedIconIndex]={shiftedAnchor:zt,angle:Ot})}else cn(ye.numGlyphs,re)}if(G){ie.clear();const _e=g.icon.placedSymbolArray;for(let ye=0;ye<_e.length;ye++){const ue=_e.get(ye);if(ue.hidden)cn(ue.numGlyphs,ie);else{const xe=J[ye];if(xe)for(let Ne=0;Ne<ue.numGlyphs;Ne++)m.addDynamicAttributes(ie,xe.shiftedAnchor,xe.angle);else cn(ue.numGlyphs,ie)}}g.icon.dynamicLayoutVertexBuffer.updateData(ie)}g.text.dynamicLayoutVertexBuffer.updateData(re)}function Gm(g,r,d){return d.iconsInText&&r?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Xo(g,r,d,y,M,T,A,L,F,V,G,q){const ee=g.context,re=ee.gl,ie=g.transform,J="map"===L,ge="map"===F,ce=J&&"point"!==d.layout.get("symbol-placement"),pe=J&&!ge&&!ce,_e=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let ye=!1;const ue=g.depthModeForSublayer(0,m.DepthMode.ReadOnly),xe=[m.mercatorXfromLng(ie.center.lng),m.mercatorYfromLat(ie.center.lat)],Ne=d.layout.get("text-variable-anchor"),He="globe"===ie.projection.name,Ye=He?m.globeToMercatorTransition(ie.zoom):0,Xe=[],St=[];g.terrain&&ge&&St.push("PITCH_WITH_MAP_TERRAIN"),He&&St.push("PROJECTION_GLOBE_VIEW");for(const Ie of y){const mt=r.getTile(Ie),ft=mt.getBucket(d);if(!ft||ft.projection!==ie.projection.name)continue;const Tt=M?ft.text:ft.icon;if(!Tt||ft.fullyClipped||!Tt.segments.get().length)continue;const je=Tt.programConfigurations.get(d.id),$t=M||ft.sdfIcons,Wt=M?ft.textSizeData:ft.iconSizeData,zt=ge||0!==ie.pitch,Ot=m.evaluateSizeForZoom(Wt,ie.zoom);let Kt,li,Vt,oi,Mi=[0,0],pn=null;if(M){if(li=mt.glyphAtlasTexture,Vt=re.LINEAR,Kt=mt.glyphAtlasTexture.size,ft.iconsInText){Mi=mt.imageAtlasTexture.size,pn=mt.imageAtlasTexture;const zr="composite"===Wt.kind||"camera"===Wt.kind;oi=zt||g.options.rotating||g.options.zooming||zr?re.LINEAR:re.NEAREST}}else{const zr=1!==d.layout.get("icon-size").constantOr(0)||ft.iconsNeedLinear;li=mt.imageAtlasTexture,Vt=$t||g.options.rotating||g.options.zooming||zr||zt?re.LINEAR:re.NEAREST,Kt=mt.imageAtlasTexture.size}const nr=g.transform.calculatePixelsToTileUnitsMatrix(mt),pr=Ls(Ie.projMatrix,mt.tileID.canonical,ge,J,g.transform,nr),Rr=g.terrain&&ge&&ce?m.invert(m.create(),pr):Xl,Fs=us(Ie.projMatrix,mt.tileID.canonical,ge,J,g.transform,nr),Us=Ne&&ft.hasTextData(),ea="none"!==d.layout.get("icon-text-fit")&&Us&&ft.hasIconData();if(ce){const zr=ie.elevation,ta=zr?zr.getAtTileOffsetFunc(Ie,ie.center.lat,ie.worldSize,ie.projection):_d=>[0,0,0];wa(ft,Ie.projMatrix,g,M,pr,Fs,ge,V,ta,Ie)}const Mo=ce||M&&Ne||ea,wn=g.translatePosMatrix(Ie.projMatrix,mt,T,A),Rn=Mo?Xl:pr,Oi=g.translatePosMatrix(Fs,mt,T,A,!0),kn=ie.projection.createInversionMatrix(ie,Ie.canonical),kr=Mo?St.concat(["PROJECTED_POS_ON_VIEWPORT"]):St,_n=$t&&0!==d.paint.get(M?"text-halo-width":"icon-halo-width").constantOr(1);let _s;_s=$t?ft.iconsInText?$o(Wt.kind,Ot,pe,ge,g,wn,Rn,Oi,Kt,Mi,Ie,Ye,xe,kn):yo(Wt.kind,Ot,pe,ge,g,wn,Rn,Oi,M,Kt,!0,Ie,Ye,xe,kn):al(Wt.kind,Ot,pe,ge,g,wn,Rn,Oi,M,Kt,Ie,Ye,xe,kn);const Jc={program:g.useProgram(Gm($t,M,ft),je,kr),buffers:Tt,uniformValues:_s,atlasTexture:li,atlasTextureIcon:pn,atlasInterpolation:Vt,atlasInterpolationIcon:oi,isSDF:$t,hasHalo:_n,tile:mt,labelPlaneMatrixInv:Rr};if(_e&&ft.canOverlap){ye=!0;const zr=Tt.segments.get();for(const ta of zr)Xe.push({segments:new m.SegmentVector([ta]),sortKey:ta.sortKey,state:Jc})}else Xe.push({segments:Tt.segments,sortKey:0,state:Jc})}ye&&Xe.sort((Ie,mt)=>Ie.sortKey-mt.sortKey);for(const Ie of Xe){const mt=Ie.state;if(g.terrain&&g.terrain.setupElevationDraw(mt.tile,mt.program,{useDepthForOcclusion:!He,labelPlaneMatrixInv:mt.labelPlaneMatrixInv}),ee.activeTexture.set(re.TEXTURE0),mt.atlasTexture.bind(mt.atlasInterpolation,re.CLAMP_TO_EDGE),mt.atlasTextureIcon&&(ee.activeTexture.set(re.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),mt.isSDF){const ft=mt.uniformValues;mt.hasHalo&&(ft.u_is_halo=1,Li(mt.buffers,Ie.segments,d,g,mt.program,ue,G,q,ft)),ft.u_is_halo=0}Li(mt.buffers,Ie.segments,d,g,mt.program,ue,G,q,mt.uniformValues)}}function Li(g,r,d,y,M,T,A,L,F){const V=y.context;M.draw(V,V.gl.TRIANGLES,T,A,L,m.CullFaceMode.disabled,F,d.id,g.layoutVertexBuffer,g.indexBuffer,r,d.paint,y.transform.zoom,g.programConfigurations.get(d.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Ht(g,r,d,y,M,T,A){const L=g.context.gl,F=d.paint.get("fill-pattern"),V=F&&F.constantOr(1),G=d.getCrossfadeParameters();let q,ee,re,ie,J;A?(ee=V&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=L.LINES):(ee=V?"fillPattern":"fill",q=L.TRIANGLES);for(const ge of y){const ce=r.getTile(ge);if(V&&!ce.patternsLoaded())continue;const pe=ce.getBucket(d);if(!pe)continue;g.prepareDrawTile();const _e=pe.programConfigurations.get(d.id),ye=g.useProgram(ee,_e);V&&(g.context.activeTexture.set(L.TEXTURE0),ce.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),_e.updatePaintBuffers(G));const ue=F.constantOr(null);if(ue&&ce.imageAtlas){const Ne=ce.imageAtlas,He=Ne.patternPositions[ue.to.toString()],Ye=Ne.patternPositions[ue.from.toString()];He&&Ye&&_e.setConstantPatternPositions(He,Ye)}const xe=g.translatePosMatrix(ge.projMatrix,ce,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(A){ie=pe.indexBuffer2,J=pe.segments2;const Ne=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[L.drawingBufferWidth,L.drawingBufferHeight];re="fillOutlinePattern"===ee&&V?Oc(xe,g,G,ce,Ne):ol(xe,Ne)}else ie=pe.indexBuffer,J=pe.segments,re=V?$l(xe,g,G,ce):ql(xe);g.prepareDrawProgram(g.context,ye,ge.toUnwrapped()),ye.draw(g.context,q,M,g.stencilModeForClipping(ge),T,m.CullFaceMode.disabled,re,d.id,pe.layoutVertexBuffer,ie,J,d.paint,g.transform.zoom,_e)}}function Dr(g,r,d,y,M,T,A){const L=g.context,F=L.gl,V=g.transform,G=d.paint.get("fill-extrusion-pattern"),q=G.constantOr(1),ee=d.getCrossfadeParameters(),re=d.paint.get("fill-extrusion-opacity"),ie=function(_e){if("globe"!==_e.projection.name)return 0;const ye=Math.PI/32,ue=Math.tan(ye),xe=m.earthRadius;return xe*Math.sqrt(1+2*ue*ue)-xe}(V),J="globe"===V.projection.name,ge=J?m.globeToMercatorTransition(V.zoom):0,ce=[m.mercatorXfromLng(V.center.lng),m.mercatorYfromLat(V.center.lat)],pe=[];J&&pe.push("PROJECTION_GLOBE_VIEW");for(const _e of y){const ye=r.getTile(_e),ue=ye.getBucket(d);if(!ue||ue.projection!==V.projection.name)continue;const xe=ue.programConfigurations.get(d.id),Ne=g.useProgram(q?"fillExtrusionPattern":"fillExtrusion",xe,pe);if(g.terrain){const mt=g.terrain;if(g.style.terrainSetForDrapingOnly())mt.setupElevationDraw(ye,Ne,{useMeterToDem:!0});else{if(!ue.enableTerrain)continue;if(mt.setupElevationDraw(ye,Ne,{useMeterToDem:!0}),Uc(L,r,_e,ue,d,mt),!ue.centroidVertexBuffer){const ft=Ne.attributes.a_centroid_pos;void 0!==ft&&F.vertexAttrib2f(ft,0,0)}}}q&&(g.context.activeTexture.set(F.TEXTURE0),ye.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),xe.updatePaintBuffers(ee));const He=G.constantOr(null);if(He&&ye.imageAtlas){const mt=ye.imageAtlas,ft=mt.patternPositions[He.to.toString()],Tt=mt.patternPositions[He.from.toString()];ft&&Tt&&xe.setConstantPatternPositions(ft,Tt)}const Ye=g.translatePosMatrix(_e.projMatrix,ye,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Xe=V.projection.createInversionMatrix(V,_e.canonical),St=d.paint.get("fill-extrusion-vertical-gradient"),Ie=q?Zl(Ye,g,St,re,_e,ee,ye,ie,ge,ce,Xe):io(Ye,g,St,re,_e,ie,ge,ce,Xe);g.prepareDrawProgram(L,Ne,_e.toUnwrapped()),Ne.draw(L,L.gl.TRIANGLES,M,T,A,m.CullFaceMode.backCCW,Ie,d.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,d.paint,g.transform.zoom,xe,g.terrain?ue.centroidVertexBuffer:null,J?ue.layoutVertexExtBuffer:null)}}function Uc(g,r,d,y,M,T){const A=[ce=>{let pe=ce.canonical.x-1,_e=ce.wrap;return pe<0&&(pe=(1<<ce.canonical.z)-1,_e--),new m.OverscaledTileID(ce.overscaledZ,_e,ce.canonical.z,pe,ce.canonical.y)},ce=>{let pe=ce.canonical.x+1,_e=ce.wrap;return pe===1<<ce.canonical.z&&(pe=0,_e++),new m.OverscaledTileID(ce.overscaledZ,_e,ce.canonical.z,pe,ce.canonical.y)},ce=>new m.OverscaledTileID(ce.overscaledZ,ce.wrap,ce.canonical.z,ce.canonical.x,(0===ce.canonical.y?1<<ce.canonical.z:ce.canonical.y)-1),ce=>new m.OverscaledTileID(ce.overscaledZ,ce.wrap,ce.canonical.z,ce.canonical.x,ce.canonical.y===(1<<ce.canonical.z)-1?0:ce.canonical.y+1)],L=ce=>{const pe=r.getSource().minzoom,_e=ue=>{const xe=r.getTileByID(ue);if(xe&&xe.hasData())return xe.getBucket(M)},ye=[0,-1,1];for(const ue of ye){if(ce.overscaledZ+ue<pe)continue;const xe=_e(ce.calculateScaledKey(ce.overscaledZ+ue));if(xe)return xe}},F=[0,0,0],V=(ce,pe)=>(F[0]=Math.min(ce.min.y,pe.min.y),F[1]=Math.max(ce.max.y,pe.max.y),F[2]=m.EXTENT-pe.min.x>ce.max.x?pe.min.x-m.EXTENT:ce.max.x,F),G=(ce,pe)=>(F[0]=Math.min(ce.min.x,pe.min.x),F[1]=Math.max(ce.max.x,pe.max.x),F[2]=m.EXTENT-pe.min.y>ce.max.y?pe.min.y-m.EXTENT:ce.max.y,F),q=[(ce,pe)=>V(ce,pe),(ce,pe)=>V(pe,ce),(ce,pe)=>G(ce,pe),(ce,pe)=>G(pe,ce)],ee=new m.pointGeometry(0,0);let re,ie,J;const ge=(ce,pe,_e,ye,ue)=>{const xe=[[ye?_e:ce,ye?ce:_e,0],[ye?_e:pe,ye?pe:_e,0]],Ne=ue<0?m.EXTENT+ue:ue,He=[ye?Ne:(ce+pe)/2,ye?(ce+pe)/2:Ne,0];return 0===_e&&ue<0||0!==_e&&ue>0?T.getForTilePoints(J,[He],!0,ie):xe.push(He),T.getForTilePoints(d,xe,!0,re),Math.max(xe[0][2],xe[1][2],He[2])/T.exaggeration()};for(let ce=0;ce<4;ce++){const pe=(ce<2?1:5)-ce,_e=y.borders[ce];if(0===_e.length)continue;const ye=J=A[ce](d),ue=L(ye);if(!(ue&&ue instanceof m.FillExtrusionBucket&&ue.enableTerrain)||y.borderDoneWithNeighborZ[ce]===ue.canonical.z&&ue.borderDoneWithNeighborZ[pe]===y.canonical.z||(ie=T.findDEMTileFor(ye),!ie||!ie.dem))continue;if(!re){const Ye=T.findDEMTileFor(d);if(!Ye||!Ye.dem)return;re=Ye}const xe=ue.borders[pe];let Ne=0;const He=ue.borderDoneWithNeighborZ[pe]!==y.canonical.z;if(y.canonical.z===ue.canonical.z){for(let Ye=0;Ye<_e.length;Ye++){const Xe=y.featuresOnBorder[_e[Ye]],St=Xe.borders[ce];let Ie;for(;Ne<xe.length&&(Ie=ue.featuresOnBorder[xe[Ne]],!(Ie.borders[pe][1]>St[0]+3));)He&&ue.encodeCentroid(void 0,Ie,!1),Ne++;if(Ie&&Ne<xe.length){const mt=Ne;let ft=0;for(;!(Ie.borders[pe][0]>St[1]-3)&&(ft++,++Ne!==xe.length);)Ie=ue.featuresOnBorder[xe[Ne]];if(Ie=ue.featuresOnBorder[xe[mt]],Xe.intersectsCount()>1||Ie.intersectsCount()>1||1!==ft){1!==ft&&(Ne=mt),y.encodeCentroid(void 0,Xe,!1),He&&ue.encodeCentroid(void 0,Ie,!1);continue}const Tt=q[ce](Xe,Ie),je=ce%2?m.EXTENT-1:0;ee.x=ge(Tt[0],Math.min(m.EXTENT-1,Tt[1]),je,ce<2,Tt[2]),ee.y=0,y.encodeCentroid(ee,Xe,!1),He&&ue.encodeCentroid(ee,Ie,!1)}else y.encodeCentroid(void 0,Xe,!1)}y.borderDoneWithNeighborZ[ce]=ue.canonical.z,y.needsCentroidUpdate=!0,He&&(ue.borderDoneWithNeighborZ[pe]=y.canonical.z,ue.needsCentroidUpdate=!0)}else{for(const Ye of _e)y.encodeCentroid(void 0,y.featuresOnBorder[Ye],!1);if(He){for(const Ye of xe)ue.encodeCentroid(void 0,ue.featuresOnBorder[Ye],!1);ue.borderDoneWithNeighborZ[pe]=y.canonical.z,ue.needsCentroidUpdate=!0}y.borderDoneWithNeighborZ[ce]=ue.canonical.z,y.needsCentroidUpdate=!0}}(y.needsCentroidUpdate||!y.centroidVertexBuffer&&0!==y.centroidVertexArray.length)&&y.uploadCentroid(g)}const qu=new m.Color(1,0,0,1),$u=new m.Color(0,1,0,1),bp=new m.Color(0,0,1,1),jh=new m.Color(1,0,1,1),Wh=new m.Color(0,1,1,1);function It(g,r,d,y){cl(g,0,r+d/2,g.transform.width,d,y)}function fs(g,r,d,y){cl(g,r-d/2,0,d,g.transform.height,y)}function cl(g,r,d,y,M,T){const A=g.context,L=A.gl;L.enable(L.SCISSOR_TEST),L.scissor(r*m.exported.devicePixelRatio,d*m.exported.devicePixelRatio,y*m.exported.devicePixelRatio,M*m.exported.devicePixelRatio),A.clear({color:T}),L.disable(L.SCISSOR_TEST)}function Xu(g,r,d){const y=g.context,M=y.gl,T="globe"===g.transform.projection.name,A=d.projMatrix,L=g.useProgram("debug",null,T?["PROJECTION_GLOBE_VIEW"]:null),F=r.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(F,L);const V=m.DepthMode.disabled,G=m.StencilMode.disabled,q=g.colorModeForRenderPass();y.activeTexture.set(M.TEXTURE0),g.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),T?F._makeGlobeTileDebugBuffers(g.context,g.transform.projection):F._makeDebugTileBoundsBuffers(g.context,g.transform.projection);const re=F._tileDebugBuffer||g.debugBuffer,ie=F._tileDebugIndexBuffer||g.debugIndexBuffer,J=F._tileDebugSegments||g.debugSegments;L.draw(y,M.LINE_STRIP,V,G,q,m.CullFaceMode.disabled,Nh(A,m.Color.red),"$debug",re,ie,J,null,null,null,F._globeTileDebugBorderBuffer);const ge=F.latestRawTileData,ce=Math.floor((ge&&ge.byteLength||0)/1024),pe=r.getTile(d).tileSize,_e=512/Math.min(pe,512)*(d.overscaledZ/g.transform.zoom)*.5;let ye=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ye+=` => ${d.overscaledZ}`),function(He,Ye){He.initDebugOverlayCanvas();const Xe=He.debugOverlayCanvas,St=He.context.gl,Ie=He.debugOverlayCanvas.getContext("2d");Ie.clearRect(0,0,Xe.width,Xe.height),Ie.shadowColor="white",Ie.shadowBlur=2,Ie.lineWidth=1.5,Ie.strokeStyle="white",Ie.textBaseline="top",Ie.font="bold 36px Open Sans, sans-serif",Ie.fillText(Ye,5,5),Ie.strokeText(Ye,5,5),He.debugOverlayTexture.update(Xe),He.debugOverlayTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE)}(g,`${ye} ${ce}kb`);const ue=F._tileDebugTextBuffer||g.debugBuffer,xe=F._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Ne=F._tileDebugTextSegments||g.debugSegments;L.draw(y,M.TRIANGLES,V,G,m.ColorMode.alphaBlended,m.CullFaceMode.disabled,Nh(A,m.Color.transparent,_e),"$debug",ue,xe,Ne,null,null,null,F._globeTileDebugTextBuffer)}const Zh=m.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Os}=Zh;function Qr(g,r,d,y){g.emplaceBack(r,d,y)}class Yl{constructor(r){this.vertexArray=new m.StructArrayLayout3f12,this.indices=new m.StructArrayLayout3ui6,Qr(this.vertexArray,-1,-1,1),Qr(this.vertexArray,1,-1,1),Qr(this.vertexArray,-1,1,1),Qr(this.vertexArray,1,1,1),Qr(this.vertexArray,-1,-1,-1),Qr(this.vertexArray,1,-1,-1),Qr(this.vertexArray,-1,1,-1),Qr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Os),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=m.SegmentVector.simpleSegment(0,0,36,12)}}function Yo(g,r,d,y,M,T){const A=g.gl,L=r.paint.get("sky-atmosphere-color"),F=r.paint.get("sky-atmosphere-halo-color"),V=r.paint.get("sky-atmosphere-sun-intensity"),G={u_matrix_3f:m.fromMat4(m.create$1(),y),u_sun_direction:M,u_sun_intensity:V,u_color_tint_r:[(ie=L).r,ie.g,ie.b,ie.a],u_color_tint_m:[(J=F).r,J.g,J.b,J.a],u_luminance:5e-5};var ie,J;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+T,r.skyboxTexture,0),d.draw(g,A.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.frontCW,G,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}function Jo(g,r){return m.transformMat4(g,g,r)}const Jl={symbol:function(g,r,d,y,M){if("translucent"!==g.renderPass)return;const T=m.StencilMode.disabled,A=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(L,F,V,G,q,ee,re){const ie=F.transform,J="map"===q,ge="map"===ee;for(const ce of L){const pe=G.getTile(ce),_e=pe.getBucket(V);if(!_e||_e.projection!==ie.projection.name||!_e.text||!_e.text.segments.get().length)continue;const ye=m.evaluateSizeForZoom(_e.textSizeData,ie.zoom),ue=F.transform.calculatePixelsToTileUnitsMatrix(pe),xe=Ls(ce.projMatrix,pe.tileID.canonical,ge,J,F.transform,ue),Ne="none"!==V.layout.get("icon-text-fit")&&_e.hasIconData();if(ye){const He=Math.pow(2,ie.zoom-pe.tileID.overscaledZ);xp(_e,J,ge,re,m.symbolSize,ie,xe,ce,He,ye,Ne,ie.projection)}}}(y,g,d,r,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),M),0!==d.paint.get("icon-opacity").constantOr(1)&&Xo(g,r,d,y,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),T,A),0!==d.paint.get("text-opacity").constantOr(1)&&Xo(g,r,d,y,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),T,A),r.map.showCollisionBoxes&&(ll(g,r,d,y,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),ll(g,r,d,y,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,r,d,y){if("translucent"!==g.renderPass)return;const M=d.paint.get("circle-opacity"),T=d.paint.get("circle-stroke-width"),A=d.paint.get("circle-stroke-opacity"),L=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===M.constantOr(1)&&(0===T.constantOr(1)||0===A.constantOr(1)))return;const F=g.context,V=F.gl,G=g.transform,q=g.depthModeForSublayer(0,m.DepthMode.ReadOnly),ee=m.StencilMode.disabled,re=g.colorModeForRenderPass(),ie="globe"===G.projection.name,J=[m.mercatorXfromLng(G.center.lng),m.mercatorYfromLat(G.center.lat)],ge=[];for(let pe=0;pe<y.length;pe++){const _e=y[pe],ye=r.getTile(_e),ue=ye.getBucket(d);if(!ue)continue;const xe=ue.programConfigurations.get(d.id),Ne=Fh(d);ie&&Ne.push("PROJECTION_GLOBE_VIEW");const He=g.useProgram("circle",xe,Ne),Ye=ue.layoutVertexBuffer,Xe=ue.globeExtVertexBuffer,St=ue.indexBuffer,Ie=G.projection.createInversionMatrix(G,_e.canonical),mt={programConfiguration:xe,program:He,layoutVertexBuffer:Ye,globeExtVertexBuffer:Xe,indexBuffer:St,uniformValues:Zo(g,_e,ye,Ie,J,d),tile:ye};if(L){const ft=ue.segments.get();for(const Tt of ft)ge.push({segments:new m.SegmentVector([Tt]),sortKey:Tt.sortKey,state:mt})}else ge.push({segments:ue.segments,sortKey:0,state:mt})}L&&ge.sort((pe,_e)=>pe.sortKey-_e.sortKey);const ce={useDepthForOcclusion:!ie};for(const pe of ge){const{programConfiguration:_e,program:ye,layoutVertexBuffer:ue,globeExtVertexBuffer:xe,indexBuffer:Ne,uniformValues:He,tile:Ye}=pe.state,Xe=pe.segments;g.terrain&&g.terrain.setupElevationDraw(Ye,ye,ce),g.prepareDrawProgram(F,ye,Ye.tileID.toUnwrapped()),ye.draw(F,V.TRIANGLES,q,ee,re,m.CullFaceMode.disabled,He,d.id,ue,Ne,Xe,d.paint,G.zoom,_e,ie?xe:null)}},heatmap:function(g,r,d,y){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const M=g.context,T=M.gl,A=m.StencilMode.disabled,L=new m.ColorMode([T.ONE,T.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(ee,re,ie){const J=ee.gl;ee.activeTexture.set(J.TEXTURE1),ee.viewport.set([0,0,re.width/4,re.height/4]);let ge=ie.heatmapFbo;if(ge)J.bindTexture(J.TEXTURE_2D,ge.colorAttachment.get()),ee.bindFramebuffer.set(ge.framebuffer);else{const ce=J.createTexture();J.bindTexture(J.TEXTURE_2D,ce),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),ge=ie.heatmapFbo=ee.createFramebuffer(re.width/4,re.height/4,!1),function(pe,_e,ye,ue){const xe=pe.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,_e.width/4,_e.height/4,0,xe.RGBA,pe.extRenderToTextureHalfFloat?pe.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),ue.colorAttachment.set(ye)}(ee,re,ce,ge)}})(M,g,d),M.clear({color:m.Color.transparent});const F=g.transform,V="globe"===F.projection.name,G=V?["PROJECTION_GLOBE_VIEW"]:null,q=[m.mercatorXfromLng(F.center.lng),m.mercatorYfromLat(F.center.lat)];for(let ee=0;ee<y.length;ee++){const re=y[ee];if(r.hasRenderableParent(re))continue;const ie=r.getTile(re),J=ie.getBucket(d);if(!J)continue;const ge=J.programConfigurations.get(d.id),ce=g.useProgram("heatmap",ge,G),{zoom:pe}=g.transform;g.terrain&&g.terrain.setupElevationDraw(ie,ce),g.prepareDrawProgram(M,ce,re.toUnwrapped());const _e=F.projection.createInversionMatrix(F,re.canonical);ce.draw(M,T.TRIANGLES,m.DepthMode.disabled,A,L,m.CullFaceMode.disabled,di(g,re,ie,_e,q,pe,d.paint.get("heatmap-intensity")),d.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,d.paint,g.transform.zoom,ge,V?J.globeExtVertexBuffer:null)}M.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(M,T){const A=M.context,L=A.gl,F=T.heatmapFbo;if(!F)return;A.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,F.colorAttachment.get()),A.activeTexture.set(L.TEXTURE1);let V=T.colorRampTexture;V||(V=T.colorRampTexture=new m.Texture(A,T.colorRamp,L.RGBA)),V.bind(L.LINEAR,L.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(A,L.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,M.colorModeForRenderPass(),m.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:T.paint.get("heatmap-opacity")},T.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,T.paint,M.transform.zoom)}(g,d))},line:function(g,r,d,y){if("translucent"!==g.renderPass)return;const M=d.paint.get("line-opacity"),T=d.paint.get("line-width");if(0===M.constantOr(1)||0===T.constantOr(1))return;const A=g.depthModeForSublayer(0,m.DepthMode.ReadOnly),L=g.colorModeForRenderPass(),F=g.terrain&&g.terrain.renderingToTexture?1:m.exported.devicePixelRatio,V=d.paint.get("line-dasharray"),G=V.constantOr(1),q=d.layout.get("line-cap"),ee=d.paint.get("line-pattern"),re=ee.constantOr(1),ie=d.paint.get("line-gradient"),J=d.getCrossfadeParameters(),ge=re?"linePattern":"line",ce=g.context,pe=ce.gl,_e=(ue=>{const xe=[];Wu(ue)&&xe.push("RENDER_LINE_DASH"),ue.paint.get("line-gradient")&&xe.push("RENDER_LINE_GRADIENT");const Ne=ue.paint.get("line-pattern").constantOr(1),He=1!==ue.paint.get("line-opacity").constantOr(1);return!Ne&&He&&xe.push("RENDER_LINE_ALPHA_DISCARD"),xe})(d);let ye=_e.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(ye=!1);for(const ue of y){const xe=r.getTile(ue);if(re&&!xe.patternsLoaded())continue;const Ne=xe.getBucket(d);if(!Ne)continue;g.prepareDrawTile();const He=Ne.programConfigurations.get(d.id),Ye=g.useProgram(ge,He,_e),Xe=ee.constantOr(null);if(Xe&&xe.imageAtlas){const je=xe.imageAtlas,$t=je.patternPositions[Xe.to.toString()],Wt=je.patternPositions[Xe.from.toString()];$t&&Wt&&He.setConstantPatternPositions($t,Wt)}const St=V.constantOr(null),Ie=q.constantOr(null);if(!re&&St&&Ie&&xe.lineAtlas){const je=xe.lineAtlas,$t=je.getDash(St.to,Ie),Wt=je.getDash(St.from,Ie);$t&&Wt&&He.setConstantPatternPositions($t,Wt)}const mt=g.terrain?ue.projMatrix:null,ft=re?_o(g,xe,d,J,mt,F):Gh(g,xe,d,J,mt,Ne.lineClipsArray.length,F);if(ie){const je=Ne.gradients[d.id];let $t=je.texture;if(d.gradientVersion!==je.version){let Wt=256;if(d.stepInterpolant){const zt=r.getSource().maxzoom,Ot=ue.canonical.z===zt?Math.ceil(1<<g.transform.maxZoom-ue.canonical.z):1;Wt=m.clamp(m.nextPowerOfTwo(Ne.maxLineLength/m.EXTENT*1024*Ot),256,ce.maxTextureSize)}je.gradient=m.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Wt,image:je.gradient||void 0,clips:Ne.lineClipsArray}),je.texture?je.texture.update(je.gradient):je.texture=new m.Texture(ce,je.gradient,pe.RGBA),je.version=d.gradientVersion,$t=je.texture}ce.activeTexture.set(pe.TEXTURE1),$t.bind(d.stepInterpolant?pe.NEAREST:pe.LINEAR,pe.CLAMP_TO_EDGE)}G&&(ce.activeTexture.set(pe.TEXTURE0),xe.lineAtlasTexture.bind(pe.LINEAR,pe.REPEAT),He.updatePaintBuffers(J)),re&&(ce.activeTexture.set(pe.TEXTURE0),xe.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),He.updatePaintBuffers(J)),g.prepareDrawProgram(ce,Ye,ue.toUnwrapped());const Tt=je=>{Ye.draw(ce,pe.TRIANGLES,A,je,L,m.CullFaceMode.disabled,ft,d.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,d.paint,g.transform.zoom,He,Ne.layoutVertexBuffer2)};if(ye){const je=g.stencilModeForClipping(ue).ref;0===je&&g.terrain&&ce.clear({stencil:0});const $t={func:pe.EQUAL,mask:255};ft.u_alpha_discard_threshold=.8,Tt(new m.StencilMode($t,je,255,pe.KEEP,pe.KEEP,pe.INVERT)),ft.u_alpha_discard_threshold=0,Tt(new m.StencilMode($t,je,255,pe.KEEP,pe.KEEP,pe.KEEP))}else Tt(g.stencilModeForClipping(ue))}ye&&(g.resetStencilClippingMasks(),g.terrain&&ce.clear({stencil:0}))},fill:function(g,r,d,y){const M=d.paint.get("fill-color"),T=d.paint.get("fill-opacity");if(0===T.constantOr(1))return;const A=g.colorModeForRenderPass(),L=d.paint.get("fill-pattern"),F=g.opaquePassEnabledForLayer()&&!L.constantOr(1)&&1===M.constantOr(m.Color.transparent).a&&1===T.constantOr(0)?"opaque":"translucent";if(g.renderPass===F){const V=g.depthModeForSublayer(1,"opaque"===g.renderPass?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly);Ht(g,r,d,y,V,A,!1)}if("translucent"===g.renderPass&&d.paint.get("fill-antialias")){const V=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,m.DepthMode.ReadOnly);Ht(g,r,d,y,V,A,!0)}},"fill-extrusion":function(g,r,d,y){const M=d.paint.get("fill-extrusion-opacity");if(0!==M&&"translucent"===g.renderPass){const T=new m.DepthMode(g.context.gl.LEQUAL,m.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==M||d.paint.get("fill-extrusion-pattern").constantOr(1))Dr(g,r,d,y,T,m.StencilMode.disabled,m.ColorMode.disabled),Dr(g,r,d,y,T,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const A=g.colorModeForRenderPass();Dr(g,r,d,y,T,m.StencilMode.disabled,A)}}},hillshade:function(g,r,d,y){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const M=g.context,T=g.depthModeForSublayer(0,m.DepthMode.ReadOnly),A=g.colorModeForRenderPass(),L=g.terrain&&g.terrain.renderingToTexture,[F,V]="translucent"!==g.renderPass||L?[{},y]:g.stencilConfigForOverlap(y);for(const G of V){const q=r.getTile(G);if(q.needsHillshadePrepare&&"offscreen"===g.renderPass)hn(g,q,d,T,m.StencilMode.disabled,A);else if("translucent"===g.renderPass){const ee=L&&g.terrain?g.terrain.stencilModeForRTTOverlap(G):F[G.overscaledZ];Mn(g,G,q,d,T,ee,A)}}M.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,r,d,y,M,T){if("translucent"!==g.renderPass||0===d.paint.get("raster-opacity")||!y.length)return;const A=g.context,L=A.gl,F=r.getSource(),V=g.useProgram("raster"),G=g.colorModeForRenderPass(),q=g.terrain&&g.terrain.renderingToTexture,[ee,re]=F instanceof Me||q?[{},y]:g.stencilConfigForOverlap(y),ie=re[re.length-1].overscaledZ,J=!g.options.moving;for(const ge of re){const ce=q?m.DepthMode.disabled:g.depthModeForSublayer(ge.overscaledZ-ie,1===d.paint.get("raster-opacity")?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly,L.LESS),pe=ge.toUnwrapped(),_e=r.getTile(ge);if(q&&(!_e||!_e.hasData()))continue;const ye=q?ge.projMatrix:g.transform.calculateProjMatrix(pe,J),ue=g.terrain&&q?g.terrain.stencilModeForRTTOverlap(ge):ee[ge.overscaledZ],xe=T?0:d.paint.get("raster-fade-duration");_e.registerFadeDuration(xe);const Ne=r.findLoadedParent(ge,0),He=Ta(_e,Ne,r,g.transform,xe);let Ye,Xe;g.terrain&&g.terrain.prepareDrawTile();const St="nearest"===d.paint.get("raster-resampling")?L.NEAREST:L.LINEAR;A.activeTexture.set(L.TEXTURE0),_e.texture.bind(St,L.CLAMP_TO_EDGE),A.activeTexture.set(L.TEXTURE1),Ne?(Ne.texture.bind(St,L.CLAMP_TO_EDGE),Ye=Math.pow(2,Ne.tileID.overscaledZ-_e.tileID.overscaledZ),Xe=[_e.tileID.canonical.x*Ye%1,_e.tileID.canonical.y*Ye%1]):_e.texture.bind(St,L.CLAMP_TO_EDGE);const Ie=xr(ye,Xe||[0,0],Ye||1,He,d,F instanceof Me?F.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(A,V,pe),F instanceof Me)F.boundsBuffer&&F.boundsSegments&&V.draw(A,L.TRIANGLES,ce,m.StencilMode.disabled,G,m.CullFaceMode.disabled,Ie,d.id,F.boundsBuffer,g.quadTriangleIndexBuffer,F.boundsSegments);else{const{tileBoundsBuffer:mt,tileBoundsIndexBuffer:ft,tileBoundsSegments:Tt}=g.getTileBoundsBuffers(_e);V.draw(A,L.TRIANGLES,ce,ue,G,m.CullFaceMode.disabled,Ie,d.id,mt,ft,Tt)}}g.resetStencilClippingMasks()},background:function(g,r,d,y){const M=d.paint.get("background-color"),T=d.paint.get("background-opacity");if(0===T)return;const A=g.context,L=A.gl,F=g.transform,V=F.tileSize,G=d.paint.get("background-pattern");if(g.isPatternMissing(G))return;const q=!G&&1===M.a&&1===T&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==q)return;const ee=m.StencilMode.disabled,re=g.depthModeForSublayer(0,"opaque"===q?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly),ie=g.colorModeForRenderPass(),J=g.useProgram(G?"backgroundPattern":"background");let ge,ce=y;ce||(ge=g.getBackgroundTiles(),ce=Object.values(ge).map(_e=>_e.tileID)),G&&(A.activeTexture.set(L.TEXTURE0),g.imageManager.bind(g.context));const pe=d.getCrossfadeParameters();for(const _e of ce){const ye=_e.toUnwrapped(),ue=y?_e.projMatrix:g.transform.calculateProjMatrix(ye);g.prepareDrawTile();const xe=r?r.getTile(_e):ge?ge[_e.key]:new m.Tile(_e,V,F.zoom,g),Ne=G?Zu(ue,T,g,G,{tileID:_e,tileSize:V},pe):Hh(ue,T,M);g.prepareDrawProgram(A,J,ye);const{tileBoundsBuffer:He,tileBoundsIndexBuffer:Ye,tileBoundsSegments:Xe}=g.getTileBoundsBuffers(xe);J.draw(A,L.TRIANGLES,re,ee,ie,m.CullFaceMode.disabled,Ne,d.id,He,Ye,Xe)}},sky:function(g,r,d){const y=g.transform,M="mercator"===y.projection.name||"globe"===y.projection.name?1:m.smoothstep(7,8,y.zoom),T=d.paint.get("sky-opacity")*M;if(0===T)return;const A=g.context,L=d.paint.get("sky-type"),F=new m.DepthMode(A.gl.LEQUAL,m.DepthMode.ReadOnly,[0,1]),V=g.frameCounter/1e3%1;"atmosphere"===L?"offscreen"===g.renderPass?d.needsSkyboxCapture(g)&&(function(G,q,ee,re){const ie=G.context,J=ie.gl;let ge=q.skyboxFbo;if(!ge){ge=q.skyboxFbo=ie.createFramebuffer(32,32,!1),q.skyboxGeometry=new Yl(ie),q.skyboxTexture=ie.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,q.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let ye=0;ye<6;++ye)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+ye,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(ge.framebuffer),ie.viewport.set([0,0,32,32]);const ce=q.getCenter(G,!0),pe=G.useProgram("skyboxCapture"),_e=new Float64Array(16);m.identity(_e),m.rotateY(_e,_e,.5*-Math.PI),Yo(ie,q,pe,_e,ce,0),m.identity(_e),m.rotateY(_e,_e,.5*Math.PI),Yo(ie,q,pe,_e,ce,1),m.identity(_e),m.rotateX(_e,_e,.5*-Math.PI),Yo(ie,q,pe,_e,ce,2),m.identity(_e),m.rotateX(_e,_e,.5*Math.PI),Yo(ie,q,pe,_e,ce,3),m.identity(_e),Yo(ie,q,pe,_e,ce,4),m.identity(_e),m.rotateY(_e,_e,Math.PI),Yo(ie,q,pe,_e,ce,5),ie.viewport.set([0,0,G.width,G.height])}(g,d),d.markSkyboxValid(g)):"sky"===g.renderPass&&function(G,q,ee,re,ie){const J=G.context,ge=J.gl,ce=G.transform,pe=G.useProgram("skybox");J.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_CUBE_MAP,q.skyboxTexture);const _e={u_matrix:ce.skyboxMatrix,u_sun_direction:q.getCenter(G,!1),u_cubemap:0,u_opacity:re,u_temporal_offset:ie};G.prepareDrawProgram(J,pe),pe.draw(J,ge.TRIANGLES,ee,m.StencilMode.disabled,G.colorModeForRenderPass(),m.CullFaceMode.backCW,_e,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(g,d,F,T,V):"gradient"===L&&"sky"===g.renderPass&&function(G,q,ee,re,ie){const J=G.context,ge=J.gl,ce=G.transform,pe=G.useProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new Yl(J)),J.activeTexture.set(ge.TEXTURE0);let _e=q.colorRampTexture;_e||(_e=q.colorRampTexture=new m.Texture(J,q.colorRamp,ge.RGBA)),_e.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const ye=(ue=ce.skyboxMatrix,xe=q.getCenter(G,!1),Ne=q.paint.get("sky-gradient-radius"),He=re,Ye=ie,{u_matrix:ue,u_color_ramp:0,u_center_direction:xe,u_radius:m.degToRad(Ne),u_opacity:He,u_temporal_offset:Ye});var ue,xe,Ne,He,Ye;G.prepareDrawProgram(J,pe),pe.draw(J,ge.TRIANGLES,ee,m.StencilMode.disabled,G.colorModeForRenderPass(),m.CullFaceMode.backCW,ye,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(g,d,F,T,V)},debug:function(g,r,d){for(let y=0;y<d.length;y++)Xu(g,r,d[y])},custom:function(g,r,d){const y=g.context,M=d.implementation;if(g.transform.projection.unsupportedLayers&&g.transform.projection.unsupportedLayers.includes("custom"))m.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===g.renderPass){const T=M.prerender;T&&(g.setCustomLayerDefaults(),y.setColorMode(g.colorModeForRenderPass()),T.call(M,y.gl,g.transform.customLayerMatrix()),y.setDirty(),g.setBaseState())}else if("translucent"===g.renderPass){g.setCustomLayerDefaults(),y.setColorMode(g.colorModeForRenderPass()),y.setStencilMode(m.StencilMode.disabled);const T="3d"===M.renderingMode?new m.DepthMode(g.context.gl.LEQUAL,m.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,m.DepthMode.ReadOnly);y.setDepthMode(T),M.render(y.gl,g.transform.customLayerMatrix()),y.setDirty(),g.setBaseState(),y.bindFramebuffer.set(null)}}};class Yu{constructor(r,d){this.context=new W(r),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=m.SourceCache.maxUnderzooming+m.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Rc,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(r,d){const y=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Kr(this,r));const M=this._terrain;this.transform.elevation=y?M:null,M.update(r,this.transform,d)}_updateFog(r){const d=r.fog;if(!d||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,M]=d.getFovAdjustedRange(this.transform._fov);if(y>M)return void(this.transform.fogCullDistSq=null);const T=y+.78*(M-y);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,d){if(this.width=r*m.exported.devicePixelRatio,this.height=d*m.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._layers[y].resize()}setup(){const r=this.context,d=new m.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(m.EXTENT,0),d.emplaceBack(0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(d,m.posAttributes.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);const y=new m.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(m.EXTENT,0),y.emplaceBack(0,m.EXTENT),y.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=r.createVertexBuffer(y,m.posAttributes.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);const M=new m.StructArrayLayout2i4;M.emplaceBack(-1,-1),M.emplaceBack(1,-1),M.emplaceBack(-1,1),M.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(M,m.posAttributes.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);const T=new m.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(m.EXTENT,0,m.EXTENT,0),T.emplaceBack(0,m.EXTENT,0,m.EXTENT),T.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(T,m.boundsAttributes.members),this.mercatorBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);const A=new m.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(A);const L=new m.StructArrayLayout1ui2;for(const V of[0,1,3,2,0])L.emplaceBack(V);this.debugIndexBuffer=r.createIndexBuffer(L),this.emptyTexture=new m.Texture(r,new m.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=m.create();const F=this.context.gl;this.stencilClearMode=new m.StencilMode({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(m.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,d=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(r,d.TRIANGLES,m.DepthMode.disabled,this.stencilClearMode,m.ColorMode.disabled,m.CullFaceMode.disabled,Wl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(r,d,y){if(!d||this.currentStencilSource===d.id||!r.isTileClipped()||!y||0===y.length)return;const M=[];let T=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const G of y)if(this._tileClippingMaskIDs.has(G.key)||(T=!0),this._skippedStencilTileIDs.has(G.key)){if(!d.getTile(G).getBucket(r))continue;this._skippedStencilTileIDs.delete(G.key),M.push(G)}if(!T&&0===M.length)return}const A=this.context,L=A.gl;A.setColorMode(m.ColorMode.disabled),A.setDepthMode(m.DepthMode.disabled);const F=this.useProgram("clippingMask"),V=G=>{const q=d.getTile(G),{tileBoundsBuffer:ee,tileBoundsIndexBuffer:re,tileBoundsSegments:ie}=this.getTileBoundsBuffers(q);F.draw(A,L.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:L.GREATER,mask:255},this._tileClippingMaskIDs.get(G.key)||0,255,L.KEEP,L.KEEP,L.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,Wl(G.projMatrix),"$clipping",ee,re,ie)};if(!T&&M.length>0)for(const G of M)V(G);else{(0===this._tileClippingMaskIDs.size||this.nextStencilID+y.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const G of y)this._tileClippingMaskIDs.set(G.key,this.nextStencilID++),d.getTile(G).getBucket(r)?V(G):this._skippedStencilTileIDs.add(G.key)}0===this._skippedStencilTileIDs.size&&(this.currentStencilSource=d.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,d=this.context.gl;return new m.StencilMode({func:d.NOTEQUAL,mask:255},r,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const d=this.context.gl;return new m.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs.get(r.key)||0,0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(r){const d=this.context.gl,y=r.sort((A,L)=>L.overscaledZ-A.overscaledZ),M=y[y.length-1].overscaledZ,T=y[0].overscaledZ-M+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const A={};for(let L=0;L<T;L++)A[L+M]=new m.StencilMode({func:d.GEQUAL,mask:255},L+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[A,y]}return[{[M]:m.StencilMode.disabled},y]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new m.ColorMode([r.CONSTANT_COLOR,r.ONE],new m.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?m.ColorMode.unblended:m.ColorMode.alphaBlended}depthModeForSublayer(r,d,y){if(!this.opaquePassEnabledForLayer())return m.DepthMode.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new m.DepthMode(y||this.context.gl.LEQUAL,d,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,d){this.style=r,this.options=d,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(m.exported.now()),this.imageManager.beginFrame();const y=this.style.order,M=this.style._sourceCaches;for(const V in M){const G=M[V];G.used&&G.prepare(this.context)}const T={},A={},L={};for(const V in M){const G=M[V];T[V]=G.getVisibleCoordinates(),A[V]=T[V].slice().reverse(),L[V]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<y.length;V++)if(this.style._layers[y[V]].is3D()){this.opaquePassCutoff=V;break}if(this.terrain&&(this.terrain.updateTileBinding(L),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new m.GlobeSharedBuffers(this.context)),!m.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const V of y){const G=this.style._layers[V],q=r._getLayerSourceCache(G);if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const ee=q?A[q.id]:void 0;("custom"===G.type||G.isSky()||ee&&ee.length)&&this.renderLayer(this,q,G,ee)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let F=m.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(F=this.style.fog.properties.get("color")),this.context.clear({color:d.showOverdrawInspector?m.Color.black:F,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const V=this.style._layers[y[this.currentLayer]],G=r._getLayerSourceCache(V);if(V.isSky())continue;const q=G?A[G.id]:void 0;this._renderTileClippingMasks(V,G,q),this.renderLayer(this,G,V,q)}if(this.renderPass="sky",(m.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const V=this.style._layers[y[this.currentLayer]],G=r._getLayerSourceCache(V);V.isSky()&&this.renderLayer(this,G,V,G?A[G.id]:void 0)}for("globe"===this.transform.projection.name&&function(V){const G=V.context,q=G.gl,ee=V.transform,re=new m.DepthMode(q.LEQUAL,m.DepthMode.ReadOnly,[0,1]),ie=V.useProgram("globeAtmosphere"),J=ee.centerOffset,ge=ee._camera.getCameraToClipPerspective(ee._fov,ee.width/ee.height,ee._nearZ,ee._farZ);ge[8]=2*-J.x/ee.width,ge[9]=2*J.y/ee.height;const ce=m.invert([],ge),pe=m.mul([],ce,ee.projMatrix),_e={u_frustum_tl:Jo([-1,1,1],ce),u_frustum_tr:Jo([1,1,1],ce),u_frustum_br:Jo([1,-1,1],ce),u_frustum_bl:Jo([-1,-1,1],ce),u_globe_pos:Jo([ee.globeMatrix[12],ee.globeMatrix[13],ee.globeMatrix[14]],pe),u_globe_radius:ee.worldSize/2/Math.PI-1,u_opacity:1-m.globeToMercatorTransition(ee.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};V.prepareDrawProgram(G,ie);const ye=V.globeSharedBuffers;ye&&ie.draw(G,q.TRIANGLES,re,m.StencilMode.disabled,m.ColorMode.alphaBlended,m.CullFaceMode.backCW,_e,"skybox",ye.atmosphereVertexBuffer,ye.atmosphereIndexBuffer,ye.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;){const V=this.style._layers[y[this.currentLayer]],G=r._getLayerSourceCache(V);if(V.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(V)){if(V.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const q=G?("symbol"===V.type?L:A)[G.id]:void 0;this._renderTileClippingMasks(V,G,G?T[G.id]:void 0),this.renderLayer(this,G,V,q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let V=null;m.values(this.style._layers).forEach(G=>{const q=r._getLayerSourceCache(G);q&&!G.isHidden(this.transform.zoom)&&(!V||V.getSource().maxzoom<q.getSource().maxzoom)&&(V=q)}),V&&this.options.showTileBoundaries&&Jl.debug(this,V,V.getVisibleCoordinates())}this.options.showPadding&&function(V){const G=V.transform.padding;It(V,V.transform.height-(G.top||0),3,qu),It(V,G.bottom||0,3,$u),fs(V,G.left||0,3,bp),fs(V,V.transform.width-(G.right||0),3,jh);const q=V.transform.centerPoint;var ee,re,ie,J;cl(ee=V,(re=q.x)-1,(ie=V.transform.height-q.y)-10,2,20,J=Wh),cl(ee,re-10,ie-1,20,2,J)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(m.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,d,y,M){y.isHidden(this.transform.zoom)||("background"===y.type||"sky"===y.type||"custom"===y.type||M&&M.length)&&(this.id=y.id,this.gpuTimingStart(y),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(y.type)||Jl[y.type](r,d,y,M,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let y=this.gpuTimers[r.id];y||(y=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),y.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,y.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}queryGpuTimers(r){const d={};for(const y in r){const M=r[y],T=this.context.extTimerQuery,A=T.getQueryObjectEXT(M.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(M.query),d[y]=A}return d}translatePosMatrix(r,d,y,M,T){if(!y[0]&&!y[1])return r;const A=T?"map"===M?this.transform.angle:0:"viewport"===M?-this.transform.angle:0;if(A){const V=Math.sin(A),G=Math.cos(A);y=[y[0]*G-y[1]*V,y[0]*V+y[1]*G]}const L=[T?y[0]:ir(d,y[0],this.transform.zoom),T?y[1]:ir(d,y[1],this.transform.zoom),0],F=new Float32Array(16);return m.translate(F,r,L),F}saveTileTexture(r){const d=this._tileTextures[r.size[0]];d?d.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const d=this._tileTextures[r];return d&&d.length>0?d.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const d=this.imageManager.getPattern(r.from.toString()),y=this.imageManager.getPattern(r.to.toString());return!d||!y}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,d=this.style&&this.style.fog,y=[];return this.terrain&&!this.terrain.renderingToTexture&&y.push("TERRAIN"),d&&!r&&0!==d.getOpacity(this.transform.pitch)&&y.push("FOG"),r&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(r,d,y){this.cache=this.cache||{};const M=y||[],T=this.currentGlobalDefines().concat(M),A=sl.cacheKey(r,T,d);return this.cache[A]||(this.cache[A]=new sl(this.context,r,rl[r],d,Hi[r],T)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,d,y){if(this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const T=M.getOpacity(this.transform.pitch);0!==T&&d.setFogUniformValues(r,((A,L,F,V)=>{const G=L.properties.get("color"),q=A.frameCounter/1e3%1,ee=[G.r/G.a,G.g/G.a,G.b/G.a,V];return{u_fog_matrix:F?A.transform.calculateFogTileMatrix(F):A.identityMat,u_fog_range:L.getFovAdjustedRange(A.transform._fov),u_fog_color:ee,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_temporal_offset:q}})(this,M,y,T))}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,d=r.createTexture();return r.bindTexture(r.TEXTURE_2D,d),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,d=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const M of y)d[M.key]=r[M.key]||new m.Tile(M,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class Ko{constructor(r=0,d=0,y=0,M=0){if(isNaN(r)||r<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(M)||M<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=d,this.left=y,this.right=M}interpolate(r,d,y){return null!=d.top&&null!=r.top&&(this.top=m.number(r.top,d.top,y)),null!=d.bottom&&null!=r.bottom&&(this.bottom=m.number(r.bottom,d.bottom,y)),null!=d.left&&null!=r.left&&(this.left=m.number(r.left,d.left,y)),null!=d.right&&null!=r.right&&(this.right=m.number(r.right,d.right,y)),this}getCenter(r,d){const y=m.clamp((this.left+r-this.right)/2,0,r),M=m.clamp((this.top+d-this.bottom)/2,0,d);return new m.pointGeometry(y,M)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Ko(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function qh(g,r){const d=m.getColumn(g,3);m.fromQuat(g,r),m.setColumn(g,3,d)}function Ju(g,r){const d=m.identity$1([]);return m.rotateZ$1(d,d,-r),m.rotateX$1(d,d,-g),d}function $h(g,r){const d=[g[0],g[1],0],y=[r[0],r[1],0];if(m.length(d)>=1e-15){const A=m.normalize([],d);m.scale$2(y,A,m.dot(y,A)),r[0]=y[0],r[1]=y[1]}const M=m.cross([],r,g);if(m.len(M)<1e-15)return null;const T=Math.atan2(-M[1],M[0]);return Ju(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),T)}class Nc{constructor(r,d){this.position=r,this.orientation=d}get position(){return this._position}set position(r){if(r){const d=r instanceof m.MercatorCoordinate?r:new m.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(d.x=m.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(r,d){if(this.orientation=null,!this.position)return;const y=this._elevation?this._elevation.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(r)):0,M=this.position,T=m.MercatorCoordinate.fromLngLat(r,y),A=[T.x-M.x,T.y-M.y,T.z-M.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=$h(A,d)}setPitchBearing(r,d){this.orientation=Ju(m.degToRad(r),m.degToRad(-d))}}class Vc{constructor(r,d){this._transform=m.identity([]),this.orientation=d,this.position=r}get mercatorPosition(){const r=this.position;return new m.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=m.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var d;r&&m.setColumn(this._transform,3,[(d=r)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||m.identity$1([]),r&&qh(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,d){this._orientation=Ju(r,d),qh(this._transform,this._orientation)}forward(){const r=m.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=m.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=m.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,d){const y=new Float64Array(16);return m.invert(y,this.getWorldToCamera(r,d)),y}getWorldToCameraPosition(r,d,y){const M=this.position;m.scale$2(M,M,-r);const T=new Float64Array(16);return m.fromScaling(T,[y,y,y]),m.translate(T,T,M),T[10]*=d,T}getWorldToCamera(r,d){const y=new Float64Array(16),M=new Float64Array(4),T=this.position;return m.conjugate(M,this._orientation),m.scale$2(T,T,-r),m.fromQuat(y,M),m.translate(y,y,T),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=d,y[9]*=d,y[10]*=d,y[11]*=d,y}getCameraToClipPerspective(r,d,y,M){const T=new Float64Array(16);return m.perspective(T,r,d,y,M),T}getDistanceToElevation(r){const d=0===r?0:m.mercatorZfromAltitude(r,this.position[1]),y=this.forward();return(d-this.position[2])/y[2]}clone(){return new Vc([...this.position],[...this.orientation])}}function Ku(g,r){const d=Gc(g),y=function(T,A,L,F,V){const G=new m.LngLat(L.lng-180*vo,L.lat),q=new m.LngLat(L.lng+180*vo,L.lat),ee=T.project(G.lng,G.lat),re=T.project(q.lng,q.lat),ie=-Math.atan2(re.y-ee.y,re.x-ee.x),J=m.MercatorCoordinate.fromLngLat(L);J.y=m.clamp(J.y,-.999975,.999975);const ge=J.toLngLat(),ce=T.project(ge.lng,ge.lat),pe=m.MercatorCoordinate.fromLngLat(ge);pe.x+=vo;const _e=pe.toLngLat(),ye=T.project(_e.lng,_e.lat),ue=td(ye.x-ce.x,ye.y-ce.y,ie),xe=m.MercatorCoordinate.fromLngLat(ge);xe.y+=vo;const Ne=xe.toLngLat(),He=T.project(Ne.lng,Ne.lat),Ye=td(He.x-ce.x,He.y-ce.y,ie),Xe=Math.abs(ue.x)/Math.abs(Ye.y),St=m.identity([]);m.rotateZ(St,St,-ie*(1-(V?0:F)));const Ie=m.identity([]);return m.scale(Ie,Ie,[1,1-(1-Xe)*F,1]),Ie[4]=-Ye.x/Ye.y*F,m.rotateZ(Ie,Ie,ie),m.multiply$1(Ie,St,Ie),Ie}(g.projection,0,g.center,d,r),M=Qu(g);return m.scale(y,y,[M,M,1]),y}function Qu(g){const r=g.projection,d=Gc(g),y=ed(r,g.center),M=ed(r,m.LngLat.convert(r.center));return Math.pow(2,y*d+(1-d)*M)}function Gc(g){const r=g.projection.range;if(!r)return 0;const d=Math.max(g.width,g.height),y=Math.log(d/1024)/Math.LN2;return m.smoothstep(r[0]+y,r[1]+y,g.zoom)}const vo=1/4e4;function ed(g,r){const d=m.clamp(r.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),y=new m.LngLat(r.lng-180*vo,d),M=new m.LngLat(r.lng+180*vo,d),T=g.project(y.lng,d),A=g.project(M.lng,d),L=m.MercatorCoordinate.fromLngLat(y),F=m.MercatorCoordinate.fromLngLat(M),V=A.x-T.x,G=A.y-T.y,q=F.x-L.x,ee=F.y-L.y,re=Math.sqrt((q*q+ee*ee)/(V*V+G*G));return Math.log(re)/Math.LN2}function td(g,r,d){const y=Math.cos(d),M=Math.sin(d);return{x:g*y-r*M,y:g*M+r*y}}class Hc{constructor(r,d,y,M,T,A,L){this.tileSize=512,this._renderWorldCopies=void 0===T||T,this._minZoom=r||0,this._maxZoom=d||22,this._minPitch=null==y?0:y,this._maxPitch=null==M?60:M,this.setProjection(A),this.setMaxBounds(L),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ko,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Vc,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const r=new Hc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||d)&&this._updateCameraOnTerrain(),(r||d)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return m.pick(this.projection,["name","center","parallels"])}setProjection(r){null==r&&(r={name:"mercator"}),this.projectionOptions=r;const d=this.projection?this.getProjection():void 0;this.projection=m.getProjection(r);const y=this.getProjection();return ct(d,y)?null:(this._calcMatrices(),y)}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new m.pointGeometry(this.width,this.height)}get bearing(){return m.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const d=-r*Math.PI/180;var y,M,T,A,L,F,V,G,q,ee;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(y=new m.ARRAY_TYPE(4),m.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y),M=this.rotationMatrix,A=this.angle,L=(T=this.rotationMatrix)[0],F=T[1],V=T[2],G=T[3],q=Math.sin(A),ee=Math.cos(A),M[0]=L*ee+V*q,M[1]=F*ee+G*q,M[2]=L*-q+V*ee,M[3]=F*-q+G*ee)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const d=m.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const d=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let M=0,T=0;for(let A=0;A<d.length;A++){const L=new m.pointGeometry(d[A][0]*this.width,y+d[A][1]*(this.height-y)),F=r.pointCoordinate(L);if(!F)continue;const V=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);M+=F[3]*V,T+=V}return 0===T?NaN:M/T}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*d,M=this._mercatorZfromZoom(r),T=this._mercatorZfromZoom(this._maxZoom),A=Math.max(M-y,T);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let y;y=r.z<this._camera.position[2]?[d.x,d.y,d.z]:[r.x,r.y,r.z];const M=m.length(m.sub([],this._camera.position,y));return m.clamp(this._zoomFromMercatorZ(M),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let d=!1;if(r.orientation&&!m.exactEquals(r.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(r.orientation)),r.position){const y=[r.position.x,r.position.y,r.position.z];m.exactEquals$1(y,this._camera.position)||(this._setCameraPosition(y),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,d=new Nc;return d.position=new m.MercatorCoordinate(r[0],r[1],r[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(r){if(!m.length$1(r))return!1;m.normalize$1(r,r);const d=m.transformQuat([],[0,0,-1],r),y=m.transformQuat([],[0,-1,0],r);if(y[2]<0)return!1;const M=$h(d,y);return!!M&&(this._camera.orientation=M,!0)}_setCameraPosition(r){const d=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,M=this.cameraToCenterDistance;r[2]=m.clamp(r[2],M/y,M/d),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,d,y){this._unmodified=!1,this._edgeInsets.interpolate(r,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const d=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(r){const d=[new m.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const y=this.pointCoordinate(new m.pointGeometry(0,0)),M=this.pointCoordinate(new m.pointGeometry(this.width,0)),T=this.pointCoordinate(new m.pointGeometry(this.width,this.height)),A=this.pointCoordinate(new m.pointGeometry(0,this.height)),L=Math.floor(Math.min(y.x,M.x,T.x,A.x)),F=Math.floor(Math.max(y.x,M.x,T.x,A.x)),V=1;for(let G=L-V;G<=F+V;G++)0!==G&&d.push(new m.UnwrappedTileID(G,r))}return d}coveringTiles(r){let d=this.coveringZoomLevel(r);const y=d,M=this.elevation&&!r.isTerrainDEM,T="mercator"===this.projection.name;if(void 0!==r.minzoom&&d<r.minzoom)return[];void 0!==r.maxzoom&&d>r.maxzoom&&(d=r.maxzoom);const A=this.locationCoordinate(this.center),L=this.center.lat,F=1<<d,V=[F*A.x,F*A.y,0],G="globe"===this.projection.name,q=!G,ee=m.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,q),re=G?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=F*m.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/m.mercatorZfromAltitude(1,this.center.lat),ge=[F*re.x,F*re.y,J*(q?1:ie)],ce=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),pe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,_e=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ye=r.isTerrainDEM?-_e:this._elevation?this._elevation.getMinElevationBelowMSL():0,ue=this.projection.isReprojectedInTileSpace?Qu(this):1,xe=je=>{const Wt=new m.MercatorCoordinate(je.x+25e-6,je.y,je.z),zt=new m.MercatorCoordinate(je.x,je.y+25e-6,je.z),Ot=je.toLngLat(),Kt=Wt.toLngLat(),li=zt.toLngLat(),Vt=this.locationCoordinate(Ot),oi=this.locationCoordinate(Kt),Mi=this.locationCoordinate(li),pn=Math.hypot(oi.x-Vt.x,oi.y-Vt.y),nr=Math.hypot(Mi.x-Vt.x,Mi.y-Vt.y);return Math.sqrt(pn*nr)*ue/25e-6},Ne=je=>{const $t=_e,Wt=ye;return{aabb:m.tileAABB(this,F,0,0,0,je,Wt,$t,this.projection),zoom:0,x:0,y:0,minZ:Wt,maxZ:$t,wrap:je,fullyVisible:!1}},He=[];let Ye=[];const Xe=d,St=r.reparseOverscaled?y:d,Ie=je=>je*je,mt=Ie((J-this._centerAltitude)*ie),ft=je=>{if(!this._elevation||!je.tileID||!T)return;const $t=this._elevation.getMinMaxForTile(je.tileID),Wt=je.aabb;$t?(Wt.min[2]=$t.min,Wt.max[2]=$t.max,Wt.center[2]=(Wt.min[2]+Wt.max[2])/2):(je.shouldSplit=Tt(je),je.shouldSplit||(Wt.min[2]=Wt.max[2]=Wt.center[2]=this._centerAltitude))},Tt=je=>{if(je.zoom<pe)return!0;if(je.zoom===Xe)return!1;if(null!=je.shouldSplit)return je.shouldSplit;const $t=je.aabb.distanceX(ge),Wt=je.aabb.distanceY(ge);let zt=mt,Ot=1;if(G){zt=Ie(je.aabb.distanceZ(ge));const li=Math.pow(2,je.zoom),Vt=m.latFromMercatorY((je.y+1)/li),oi=m.latFromMercatorY(je.y/li),Mi=Math.min(Math.max(L,Vt),oi),pn=m.circumferenceAtLatitude(Mi)/m.circumferenceAtLatitude(L);Ot=Math.min(pn,1)}else if(M&&(zt=Ie(je.aabb.distanceZ(ge)*ie)),this.projection.isReprojectedInTileSpace&&y<=5){const li=Math.pow(2,je.zoom),Vt=xe(new m.MercatorCoordinate((je.x+.5)/li,(je.y+.5)/li));Ot=Vt>.85?1:Vt}const Kt=$t*$t+Wt*Wt+zt;return Kt<Ie((1<<Xe-je.zoom)*ce*Ot*((li,Vt)=>{if(Vt*Ie(.707)<li)return 1;const oi=Math.sqrt(Vt/li);return oi/(1.4144271570014144+(Math.pow(1.1,oi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(zt,mt),Kt))};if(this.renderWorldCopies)for(let je=1;je<=3;je++)He.push(Ne(-je)),He.push(Ne(je));for(He.push(Ne(0));He.length>0;){const je=He.pop(),$t=je.x,Wt=je.y;let zt=je.fullyVisible;if(!zt){const Ot=je.aabb.intersects(ee);if(0===Ot)continue;zt=2===Ot}if(je.zoom!==Xe&&Tt(je))for(let Ot=0;Ot<4;Ot++){const Kt=($t<<1)+Ot%2,li=(Wt<<1)+(Ot>>1),Vt={aabb:T?je.aabb.quadrant(Ot):m.tileAABB(this,F,je.zoom+1,Kt,li,je.wrap,je.minZ,je.maxZ,this.projection),zoom:je.zoom+1,x:Kt,y:li,wrap:je.wrap,fullyVisible:zt,tileID:void 0,shouldSplit:void 0,minZ:je.minZ,maxZ:je.maxZ};M&&!G&&(Vt.tileID=new m.OverscaledTileID(je.zoom+1===Xe?St:je.zoom+1,je.wrap,je.zoom+1,Kt,li),ft(Vt)),He.push(Vt)}else{const Ot=je.zoom===Xe?St:je.zoom;if(r.minzoom&&r.minzoom>Ot)continue;const Kt=V[0]-(.5+$t+(je.wrap<<je.zoom))*(1<<d-je.zoom),li=V[1]-.5-Wt,Vt=je.tileID?je.tileID:new m.OverscaledTileID(Ot,je.wrap,je.zoom,$t,Wt);Ye.push({tileID:Vt,distanceSq:Kt*Kt+li*li})}}if(this.fogCullDistSq){const je=this.fogCullDistSq,$t=this.horizonLineFromTop();Ye=Ye.filter(Wt=>{const zt=[0,0,0,1],Ot=[m.EXTENT,m.EXTENT,0,1],Kt=this.calculateFogTileMatrix(Wt.tileID.toUnwrapped());m.transformMat4$1(zt,zt,Kt),m.transformMat4$1(Ot,Ot,Kt);const li=m.getAABBPointSquareDist(zt,Ot);if(0===li)return!0;let Vt=!1;const oi=this._elevation;if(oi&&li>je&&0!==$t){const Mi=this.calculateProjMatrix(Wt.tileID.toUnwrapped());let pn;r.isTerrainDEM||(pn=oi.getMinMaxForTile(Wt.tileID)),pn||(pn={min:ye,max:_e});const nr=m.furthestTileCorner(this.rotation),pr=[nr[0]*m.EXTENT,nr[1]*m.EXTENT,pn.max];m.transformMat4(pr,pr,Mi),Vt=(1-pr[1])*this.height*.5<$t}return li<je||Vt})}return Ye.sort((je,$t)=>je.distanceSq-$t.distanceSq).map(je=>je.tileID)}resize(r,d){this.width=r,this.height=d,this.pixelsToGLUnits=[2/r,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const d=m.clamp(r.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),y=this.projection.project(r.lng,d);return new m.pointGeometry(y.x*this.worldSize,y.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,d){let y,M;const T=this.centerPoint;if("globe"===this.projection.name){const L=this.worldSize;y=(d.x-T.x)/L,M=(d.y-T.y)/L}else{const L=this.pointCoordinate(d),F=this.pointCoordinate(T);y=L.x-F.x,M=L.y-F.y}const A=this.locationCoordinate(r);this.setLocation(new m.MercatorCoordinate(A.x-y,A.y-M))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this._coordinatePoint(this.locationCoordinate(r),!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,d){const y=d?m.mercatorZfromAltitude(d,r.lat):void 0,M=this.projection.project(r.lng,r.lat);return new m.MercatorCoordinate(M.x,M.y,y)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,d){const y=null!=d?d:this._centerAltitude,M=[r.x,r.y,0,1],T=[r.x,r.y,1,1];m.transformMat4$1(M,M,this.pixelMatrixInverse),m.transformMat4$1(T,T,this.pixelMatrixInverse);const A=T[3];m.scale$1(M,M,1/M[3]),m.scale$1(T,T,1/A);const L=M[2],F=T[2];return{p0:M,p1:T,t:L===F?0:(y-L)/(F-L)}}screenPointToMercatorRay(r){const d=[r.x,r.y,0,1],y=[r.x,r.y,1,1];return m.transformMat4$1(d,d,this.pixelMatrixInverse),m.transformMat4$1(y,y,this.pixelMatrixInverse),m.scale$1(d,d,1/d[3]),m.scale$1(y,y,1/y[3]),d[2]=m.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,y[2]=m.mercatorZfromAltitude(y[2],this._center.lat)*this.worldSize,m.scale$1(d,d,1/this.worldSize),m.scale$1(y,y,1/this.worldSize),new m.Ray([d[0],d[1],d[2]],m.normalize([],m.sub([],y,d)))}rayIntersectionCoordinate(r){const{p0:d,p1:y,t:M}=r,T=m.mercatorZfromAltitude(d[2],this._center.lat),A=m.mercatorZfromAltitude(y[2],this._center.lat);return new m.MercatorCoordinate(m.number(d[0],y[0],M)/this.worldSize,m.number(d[1],y[1],M)/this.worldSize,m.number(T,A,M))}pointCoordinate(r,d=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,d)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);const d=this.elevation;let y=this.elevation.pointCoordinate(r);if(y)return new m.MercatorCoordinate(y[0],y[1],y[2]);let M=0,T=this.horizonLineFromTop();if(r.y>T)return this.pointCoordinate(r);const A=.02*T,L=r.clone();for(let F=0;F<10&&T-M>A;F++){L.y=m.number(M,T,.66);const V=d.pointCoordinate(L);V?(T=L.y,y=V):M=L.y}return y?new m.MercatorCoordinate(y[0],y[1],y[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){if(this.elevation)return!this.elevation.pointCoordinate(r);{const d=this.horizonLineFromTop();return r.y<d}}_coordinatePoint(r,d){const y=d&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,M=[r.x*this.worldSize,r.y*this.worldSize,y+r.toAltitude(),1];return m.transformMat4$1(M,M,this.pixelMatrix),M[3]>0?new m.pointGeometry(M[0]/M[3],M[1]/M[3]):new m.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,d){const y=new m.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),M=new m.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),T=new m.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),A=new m.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let L=this.pointCoordinate(y,r),F=this.pointCoordinate(M,r);const V=this.pointCoordinate(T,d),G=this.pointCoordinate(A,d),q=(ee,re)=>(re.y-ee.y)/(re.x-ee.x);return L.y>1&&F.y>=0?L=new m.MercatorCoordinate((1-G.y)/q(G,L)+G.x,1):L.y<0&&F.y<=1&&(L=new m.MercatorCoordinate(-G.y/q(G,L)+G.x,0)),F.y>1&&L.y>=0?F=new m.MercatorCoordinate((1-V.y)/q(V,F)+V.x,1):F.y<0&&L.y<=1&&(F=new m.MercatorCoordinate(-V.y/q(V,F)+V.x,0)),(new m.LngLatBounds).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(V))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const d=r.visibleDemTiles.reduce((y,M)=>{if(M.dem){const T=M.dem.tree;y.min=Math.min(y.min,T.minimums[0]),y.max=Math.max(y.max,T.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBounds(d.min*r.exaggeration(),d.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,y=this.height/2-d*(1-this._horizonShift);return r?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-m.MAX_MERCATOR_LATITUDE,this.maxLat=m.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=m.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=m.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=m.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=m.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,d){return this.projection.createTileMatrix(this,d,r)}calculateDistanceTileData(r){const d=r.key,y=this._distanceTileDataCache;if(y[d])return y[d];const M=r.canonical,T=1/this.height,A=this.cameraWorldSize/this.zoomScale(M.z),L=(M.x+Math.pow(2,M.z)*r.wrap)*A,F=M.y*A,V=this.point,G=this.angle,q=Math.sin(-G),ee=-Math.cos(-G);return y[d]={bearing:[q,ee],center:[(V.x-L)*T,(V.y-F)*T],scale:A/m.EXTENT*T},y[d]}calculateFogTileMatrix(r){const d=r.key,y=this._fogTileMatrixCache;if(y[d])return y[d];const M=this.calculatePosMatrix(r,this.cameraWorldSize);return m.multiply$1(M,this.worldToFogMatrix,M),y[d]=new Float32Array(M),y[d]}calculateProjMatrix(r,d=!1){const y=r.key,M=d?this._alignedProjMatrixCache:this._projMatrixCache;if(M[y])return M[y];const T=this.calculatePosMatrix(r,this.worldSize);return m.multiply$1(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,T),M[y]=new Float32Array(T),M[y]}calculatePixelsToTileUnitsMatrix(r){const d=r.tileID.key,y=this._pixelsToTileUnitsCache;if(y[d])return y[d];const M=function(T,A){const{scale:L}=T.tileTransform,F=L*m.EXTENT/(T.tileSize*Math.pow(2,A.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return V=new Float32Array(4),ee=(G=A.inverseAdjustmentMatrix)[1],re=G[2],ie=G[3],ge=(q=[F,F])[1],V[0]=G[0]*(J=q[0]),V[1]=ee*J,V[2]=re*ge,V[3]=ie*ge,V;var V,G,q,ee,re,ie,J,ge}(r,this);return y[d]=M,y[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const d=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),M=this._camera.forward(),T=m.mercatorZfromAltitude(1,this._center.lat);y[2]/=T,M[2]/=T,m.normalize(M,M);const A=r.raycast(y,M,r.exaggeration());if(A){const L=m.scaleAndAdd([],y,M,A),F=new m.MercatorCoordinate(L[0],L[1],m.mercatorZfromAltitude(L[2],m.latFromMercatorY(L[1]))),V=(F.z+m.length([F.x-y[0],F.y-y[1],F.z-y[2]*T]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const d=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),M=r.getAtPointOrZero(new m.MercatorCoordinate(...y)),T=this._minimumHeightOverTerrain()*Math.cos(m.degToRad(this._maxPitch)),A=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*M;if(A<T){const L=this.locationCoordinate(this._center,this._centerAltitude),F=[L.x-y[0],L.y-y[1],L.z-y[2]],V=m.length(F);F[2]-=(T-A)/this._projectionScaler;const G=m.length(F);if(0===G)return;m.scale$2(F,F,V/G*this._projectionScaler),this._camera.position=[L.x-F[0],L.y-F[1],L.z*this._projectionScaler-F[2]],this._camera.orientation=$h(F,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const q=this.center;return q.lat=m.clamp(q.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(q.lng=m.clamp(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const r=this._unmodified,{x:d,y}=this.point;let M=0,T=d,A=y;const L=this.width/2,F=this.height/2,V=this.worldMinY*this.scale,G=this.worldMaxY*this.scale;if(y-F<V&&(A=V+F),y+F>G&&(A=G-F),G-V<this.height&&(M=Math.max(M,this.height/(G-V)),A=(G+V)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,re=this.worldSize/2-(q+ee)/2;T=(d+re+this.worldSize)%this.worldSize-re,T-L<q&&(T=q+L),T+L>ee&&(T=ee-L),ee-q<this.width&&(M=Math.max(M,this.width/(ee-q)),T=(ee+q)/2)}T===d&&A===y||(this.center=this.unproject(new m.pointGeometry(T,A))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCameraAltitude(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this._fov/2,d=this.centerOffset,y=this.pixelsPerMeter;this._projectionScaler=y/(m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(r)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?y:1),T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);T[8]=2*-d.x/this.width,T[9]=2*d.y/this.height;let A=m.mul([],T,M);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),ue=m.identity([]);m.translate(ue,ue,[ye.x*this.worldSize,ye.y*this.worldSize,0]),m.multiply$1(ue,ue,Ku(this)),m.translate(ue,ue,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),m.multiply$1(A,A,ue),this.inverseAdjustmentMatrix=function(xe){const Ne=Ku(xe,!0);return qa([],[Ne[0],Ne[1],Ne[4],Ne[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=m.scale([],A,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=A,this.invProjMatrix=m.invert(new Float64Array(16),this.projMatrix);const L=new Float32Array(16);m.identity(L),m.scale(L,L,[1,-1,1]),m.rotateX(L,L,this._pitch),m.rotateZ(L,L,this.angle);const F=m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-d.x/this.width,F[9]=2*(d.y+V)/this.height,this.skyboxMatrix=m.multiply$1(L,F,L);const G=this.point,q=G.x,ee=G.y,re=this.width%2/2,ie=this.height%2/2,J=Math.cos(this.angle),ge=Math.sin(this.angle),ce=q-Math.round(q)+J*re+ge*ie,pe=ee-Math.round(ee)+J*ie+ge*re,_e=new Float64Array(A);if(m.translate(_e,_e,[ce>.5?ce-1:ce,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=_e,A=m.create(),m.scale(A,A,[this.width/2,-this.height/2,1]),m.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=m.create(),m.scale(A,A,[1,-1,1]),m.translate(A,A,[-1,-1,0]),m.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=m.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=m.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");this.pixelMatrixInverse=A,this.globeMatrix="globe"===this.projection.name?m.calculateGlobeMatrix(this):A,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,d=this.cameraPixelsPerMeter,y=this._camera.position,M=1/this.height,T=[r,r,d];m.scale$2(T,T,M),m.scale$2(y,y,-1),m.multiply$2(y,y,T);const A=m.create();m.translate(A,A,y),m.scale(A,A,T),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,d,M)}_computeCameraPosition(r){const d=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),M=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-r/this.worldSize*this._centerAltitude;return[M.x/this.worldSize-y[0]*T,M.y/this.worldSize-y[1]*T,r/this.worldSize*this._centerAltitude-y[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=r[2];let M=1;y>0&&(M=Math.min((d-this._camera.position[2])/y,1)),this._camera.position=m.scaleAndAdd([],this._camera.position,r,M),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const r=this._camera.position,d=this._camera.forward(),{pitch:y,bearing:M}=this._camera.getPitchBearing(),T=m.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(m.degToRad(this._maxPitch)),L=Math.max((r[2]-T)/Math.cos(y),A),F=this._zoomFromMercatorZ(L);m.scaleAndAdd(r,r,d,L),this._pitch=m.clamp(y,m.degToRad(this.minPitch),m.degToRad(this.maxPitch)),this.angle=m.wrap(M,-Math.PI,Math.PI),this._setZoom(m.clamp(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new m.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(m.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(r,d){const y=Math.min(r.x,d.x),M=Math.max(r.x,d.x),T=Math.min(r.y,d.y),A=Math.max(r.y,d.y);if(T<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const L=[new m.pointGeometry(y,T),new m.pointGeometry(M,A),new m.pointGeometry(y,A),new m.pointGeometry(M,T)],F=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const G of L){const q=this.pointRayIntersection(G);if(q.t<0)return!0;const ee=this.rayIntersectionCoordinate(q);if(ee.x<F||ee.y<0||ee.x>V||ee.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+m.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new m.pointGeometry(0,0),new m.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,d){const y=m.length(m.sub([],this._camera.position,r)),M=this._zoomFromMercatorZ(y)+d;return y-this._mercatorZfromZoom(M)}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.pointGeometry(0,r))}}function Xh(g,r){let d=!1,y=null;const M=()=>{y=null,d&&(g(),y=setTimeout(M,r),d=!1)};return()=>(d=!0,y||M(),y)}class id{constructor(r){this._hashName=r&&encodeURIComponent(r),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xh(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,m.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),m.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(r){const d=this._map;if(!d)return"";const y=d.getCenter(),M=Math.round(100*d.getZoom())/100,T=Math.ceil((M*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,T),L=Math.round(y.lng*A)/A,F=Math.round(y.lat*A)/A,V=d.getBearing(),G=d.getPitch();let q="";if(q+=r?`/${L}/${F}/${M}`:`${M}/${F}/${L}`,(V||G)&&(q+="/"+Math.round(10*V)/10),G&&(q+=`/${Math.round(G)}`),this._hashName){const ee=this._hashName;let re=!1;const ie=m.window.location.hash.slice(1).split("&").map(J=>{const ge=J.split("=")[0];return ge===ee?(re=!0,`${ge}=${q}`):J}).filter(J=>J);return re||ie.push(`${ee}=${q}`),`#${ie.join("&")}`}return`#${q}`}_getCurrentHash(){const r=m.window.location.hash.replace("#","");if(this._hashName){let d;return r.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(d=y)}),(d&&d[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(d[3]||0):r.getBearing();return r.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=m.window.location.href.replace(/(#.+)?$/,this.getHashString());m.window.history.replaceState(m.window.history.state,null,r)}}const xo={linearity:.3,easing:m.bezier(0,0,.3,1)},nd=m.extend({deceleration:2500,maxSpeed:1400},xo),rd=m.extend({deceleration:20,maxSpeed:1400},xo),sd=m.extend({deceleration:1e3,maxSpeed:360},xo),od=m.extend({deceleration:1e3,maxSpeed:90},xo);class ad{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,d=m.exported.now();for(;r.length>0&&d-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new m.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(d.pan.mag()){const T=ji(d.pan.mag(),y,m.extend({},nd,r||{}));M.offset=d.pan.mult(T.amount/d.pan.mag()),M.center=this._map.transform.center,bo(M,T)}if(d.zoom){const T=ji(d.zoom,y,rd);M.zoom=this._map.transform.zoom+T.amount,bo(M,T)}if(d.bearing){const T=ji(d.bearing,y,sd);M.bearing=this._map.transform.bearing+m.clamp(T.amount,-179,179),bo(M,T)}if(d.pitch){const T=ji(d.pitch,y,od);M.pitch=this._map.transform.pitch+T.amount,bo(M,T)}if(M.zoom||M.bearing){const T=void 0===d.pinchAround?d.around:d.pinchAround;M.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),M.noMoveStart=!0,M}}function bo(g,r){(!g.duration||g.duration<r.duration)&&(g.duration=r.duration,g.easing=r.easing)}function ji(g,r,d){const{maxSpeed:y,linearity:M,deceleration:T}=d,A=m.clamp(g*M/(r/1e3),-y,y),L=Math.abs(A)/(T*M);return{easing:d.easing,duration:1e3*L,amount:A*(L/2)}}class dn extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,y,M={}){const T=Xs(d.getCanvasContainer(),y),A=d.unproject(T);super(r,m.extend({point:T,lngLat:A,originalEvent:y},M)),this._defaultPrevented=!1,this.target=d}}class Ca extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,y){const M="touchend"===r?y.changedTouches:y.touches,T=Pi(d.getCanvasContainer(),M),A=T.map(F=>d.unproject(F)),L=T.reduce((F,V,G,q)=>F.add(V.div(q.length)),new m.pointGeometry(0,0));super(r,{points:T,point:L,lngLats:A,lngLat:d.unproject(L),originalEvent:y}),this._defaultPrevented=!1}}class Hm extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,y){super(r,{originalEvent:y}),this._defaultPrevented=!1}}class jm{constructor(r,d){this._map=r,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Hm(r.type,this._map,r))}mousedown(r,d){return this._mousedownPos=d,this._firePreventable(new dn(r.type,this._map,r))}mouseup(r){this._map.fire(new dn(r.type,this._map,r))}preclick(r){const d=m.extend({},r);d.type="preclick",this._map.fire(new dn(d.type,this._map,d))}click(r,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(r),this._map.fire(new dn(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new dn(r.type,this._map,r))}mouseover(r){this._map.fire(new dn(r.type,this._map,r))}mouseout(r){this._map.fire(new dn(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ca(r.type,this._map,r))}touchmove(r){this._map.fire(new Ca(r.type,this._map,r))}touchend(r){this._map.fire(new Ca(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ca(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qo{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new dn(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new dn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new dn(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wp{constructor(r,d){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,d){this.isEnabled()&&r.shiftKey&&0===r.button&&(Fn(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(r,d){if(!this._active)return;const y=d;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const M=this._startPos;this._lastPos=y,this._box||(this._box=yi("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const T=Math.min(M.x,y.x),A=Math.max(M.x,y.x),L=Math.min(M.y,y.y),F=Math.max(M.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${L}px)`,this._box.style.width=A-T+"px",this._box.style.height=F-L+"px")})}mouseupWindow(r,d){if(!this._active||0!==r.button)return;const y=this._startPos,M=d;if(this.reset(),fa(),y.x!==M.x||y.y!==M.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:T=>T.fitScreenCoordinates(y,M,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Mc(),delete this._startPos,delete this._lastPos}_fireEvent(r,d){return this._map.fire(new m.Event(r,{originalEvent:d}))}}function hl(g,r){const d={};for(let y=0;y<g.length;y++)d[g[y].identifier]=r[y];return d}class wo{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),y.length===this.numTouches&&(this.centroid=function(M){const T=new m.pointGeometry(0,0);for(const A of M)T._add(A);return T.div(M.length)}(d),this.touches=hl(y,d)))}touchmove(r,d,y){if(this.aborted||!this.centroid)return;const M=hl(y,d);for(const T in this.touches){const A=this.touches[T],L=M[T];(!L||L.dist(A)>30)&&(this.aborted=!0)}}touchend(r,d,y){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===y.length){const M=!this.aborted&&this.centroid;if(this.reset(),M)return M}}}class ul{constructor(r){this.singleTap=new wo(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,d,y){this.singleTap.touchstart(r,d,y)}touchmove(r,d,y){this.singleTap.touchmove(r,d,y)}touchend(r,d,y){const M=this.singleTap.touchend(r,d,y);if(M){const T=r.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(M)<30;if(T&&A||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=M,this.count===this.numTaps)return this.reset(),M}}}class Bt{constructor(){this._zoomIn=new ul({numTouches:1,numTaps:2}),this._zoomOut=new ul({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,d,y){this._zoomIn.touchstart(r,d,y),this._zoomOut.touchstart(r,d,y)}touchmove(r,d,y){this._zoomIn.touchmove(r,d,y),this._zoomOut.touchmove(r,d,y)}touchend(r,d,y){const M=this._zoomIn.touchend(r,d,y),T=this._zoomOut.touchend(r,d,y);return M?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(M)},{originalEvent:r})}):T?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(T)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Mp={0:1,2:2};class Yh{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,d){return!1}_move(r,d){return{}}mousedown(r,d){if(this._lastPoint)return;const y=Ts(r);this._correctButton(r,y)&&(this._lastPoint=d,this._eventButton=y)}mousemoveWindow(r,d){const y=this._lastPoint;if(y)if(r.preventDefault(),null!=this._eventButton&&function(M,T){const A=Mp[T];return void 0===M.buttons||(M.buttons&A)!==A}(r,this._eventButton))this.reset();else if(this._moved||!(d.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(y,d)}mouseupWindow(r){this._lastPoint&&Ts(r)===this._eventButton&&(this._moved&&fa(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jc extends Yh{mousedown(r,d){super.mousedown(r,d),this._lastPoint&&(this._active=!0)}_correctButton(r,d){return 0===d&&!r.ctrlKey}_move(r,d){return{around:d,panDelta:d.sub(r)}}}class Kl extends Yh{_correctButton(r,d){return 0===d&&r.ctrlKey||2===d}_move(r,d){const y=.8*(d.x-r.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(r){r.preventDefault()}}class ld extends Yh{_correctButton(r,d){return 0===d&&r.ctrlKey||2===d}_move(r,d){const y=-.5*(d.y-r.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(r){r.preventDefault()}}class Sp{constructor(r,d){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),m.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new m.pointGeometry(0,0)}touchstart(r,d,y){return this._calculateTransform(r,d,y)}touchmove(r,d,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===y.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.preventDefault(),this._calculateTransform(r,d,y)}}touchend(r,d,y){this._calculateTransform(r,d,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,d,y){y.length>0&&(this._active=!0);const M=hl(y,d),T=new m.pointGeometry(0,0),A=new m.pointGeometry(0,0);let L=0;for(const V in M){const G=M[V],q=this._touches[V];q&&(T._add(G),A._add(G.sub(q)),L++,M[V]=G)}if(this._touches=M,L<this._minTouches||!A.mag())return;const F=A.div(L);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(L),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=yi("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Jh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,d,y){return{}}touchstart(r,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(r,d,y){const M=this._firstTwoTouches;if(!M)return;r.preventDefault();const[T,A]=M,L=Wc(y,d,T),F=Wc(y,d,A);if(!L||!F)return;const V=this._aroundCenter?null:L.add(F).div(2);return this._move([L,F],V,r)}touchend(r,d,y){if(!this._firstTwoTouches)return;const[M,T]=this._firstTwoTouches,A=Wc(y,d,M),L=Wc(y,d,T);A&&L||(this._active&&fa(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wc(g,r,d){for(let y=0;y<g.length;y++)if(g[y].identifier===d)return r[y]}function cd(g,r){return Math.log(g/r)/Math.LN2}class Tp extends Jh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,d){const y=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(cd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:cd(this._distance,y),pinchAround:d}}}function hd(g,r){return 180*g.angleWith(r)/Math.PI}class Kh extends Jh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,d){const y=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hd(this._vector,y),pinchAround:d}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const d=25/(Math.PI*this._minDiameter)*360,y=hd(r,this._startVector);return Math.abs(y)<d}}function Zc(g){return Math.abs(g.y)>Math.abs(g.x)}class Qh extends Jh{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Zc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,d,y){const M=this._lastPoints;if(!M)return;const T=r[0].sub(M[0]),A=r[1].sub(M[1]);return this._map._cooperativeGestures&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(T,A,y.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(T.y+A.y)/2*-.5})}gestureBeginsVertically(r,d,y){if(void 0!==this._valid)return this._valid;const M=r.mag()>=2,T=d.mag()>=2;if(!M&&!T)return;if(!M||!T)return null==this._firstMove&&(this._firstMove=y),y-this._firstMove<100&&void 0;const A=r.y>0==d.y>0;return Zc(r)&&Zc(d)&&A}}const Ep={panStep:100,bearingStep:15,pitchStep:10};class Cp{constructor(){const r=Ep;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let d=0,y=0,M=0,T=0,A=0;switch(r.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:r.shiftKey?y=-1:(r.preventDefault(),T=-1);break;case 39:r.shiftKey?y=1:(r.preventDefault(),T=1);break;case 38:r.shiftKey?M=1:(r.preventDefault(),A=-1);break;case 40:r.shiftKey?M=-1:(r.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(y=0,M=0),{cameraAnimation:L=>{const F=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Ap,zoom:d?Math.round(F)+d*(r.shiftKey?2:1):F,bearing:L.getBearing()+y*this._bearingStep,pitch:L.getPitch()+M*this._pitchStep,offset:[-T*this._panStep,-A*this._panStep],center:L.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ap(g){return g*(2-g)}const ud=4.000244140625;class Pp{constructor(r,d){this._map=r,this._el=r.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,m.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=r.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const y=m.exported.now(),M=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,0!==d&&d%ud==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":M>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(M*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),r.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=r,this._delta-=d,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Xs(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,d=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const F="wheel"===this._type&&Math.abs(this._delta)>ud?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&0!==V&&(V=1/V);const G=d(),q=Math.pow(2,G),ee="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(ee*V))),"wheel"===this._type&&(this._startZoom=d(),this._easing=this._smoothOutEasing(200)),this._delta=0}const y="number"==typeof this._targetZoom?this._targetZoom:d(),M=this._startZoom,T=this._easing;let A,L=!1;if("wheel"===this._type&&M&&T){const F=Math.min((m.exported.now()-this._lastWheelEventTime)/200,1),V=T(F);A=m.number(M,y,V),F<1?this._frameId||(this._frameId=!0):L=!0}else A=y,L=!0;return this._active=!0,L&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!L,zoomDelta:A-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let d=m.ease;if(this._prevEase){const y=this._prevEase,M=(m.exported.now()-y.start)/y.duration,T=y.easing(M+.01)-y.easing(M),A=.27/Math.sqrt(T*T+1e-4)*.01,L=Math.sqrt(.0729-A*A);d=m.bezier(A,L,.25,1)}return this._prevEase={start:m.exported.now(),duration:r,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=yi("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(m.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!m.window.document.fullscreenElement||!!m.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ip{constructor(r,d){this._clickZoom=r,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Dp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,d){return r.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(r.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dd{constructor(){this._tap=new ul({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,d,y){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=d[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(r,d,y))}touchmove(r,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const M=d[0],T=M.y-this._swipePoint.y;return this._swipePoint=M,r.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(r,d,y)}touchend(r,d,y){this._tapTime?this._swipePoint&&0===y.length&&this.reset():this._tap.touchend(r,d,y)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lp{constructor(r,d,y){this._el=r,this._mousePan=d,this._touchPan=y}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rp{constructor(r,d,y){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class kp{constructor(r,d,y,M){this._el=r,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=M,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qc=g=>g.zoom||g.drag||g.pitch||g.rotate;class pd extends m.Event{}class zp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,d){const y=m.sub([],d,r);this.radius=m.length(y[2]<0?m.div([],y,this.constants):[y[0],y[1],0])}projectRay(r){m.div(r,r,this.constants),m.normalize(r,r),m.mul$1(r,r,this.constants);const d=m.scale$2([],r,this.radius);if(d[2]>0){const y=m.scale$2([],[0,0,1],m.dot(d,[0,0,1])),M=m.scale$2([],m.normalize([],[d[0],d[1],0]),this.radius),T=m.add([],d,m.scale$2([],m.sub([],m.add([],M,y),d),2));d[0]=T[0],d[1]=T[1]}return d}}function Ql(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Op{constructor(r,d){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ad(r),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new zp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),m.bindAll(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[m.window,"blur",void 0]];for(const[M,T,A]of this._listeners)M.addEventListener(T,M===m.window.document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[r,d,y]of this._listeners)r.removeEventListener(d,r===m.window.document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(r){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new jm(d,r));const M=d.boxZoom=new wp(d,r);this._add("boxZoom",M);const T=new Bt,A=new Dp;d.doubleClickZoom=new Ip(A,T),this._add("tapZoom",T),this._add("clickZoom",A);const L=new dd;this._add("tapDragZoom",L);const F=d.touchPitch=new Qh(d);this._add("touchPitch",F);const V=new Kl(r),G=new ld(r);d.dragRotate=new Rp(r,V,G),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",G,["mouseRotate"]);const q=new jc(r),ee=new Sp(d,r);d.dragPan=new Lp(y,q,ee),this._add("mousePan",q),this._add("touchPan",ee,["touchZoom","touchRotate"]);const re=new Kh,ie=new Tp;d.touchZoomRotate=new kp(y,ie,re,L),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qo(d));const J=d.scrollZoom=new Pp(d,this);this._add("scrollZoom",J,["mousePan"]);const ge=d.keyboard=new Cp;this._add("keyboard",ge);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[ce]&&d[ce].enable(r[ce])}_add(r,d,y){this._handlers.push({handlerName:r,handler:d,allowed:y}),this._handlersById[r]=d}stop(r){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qc(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,d,y){for(const M in r)if(M!==y&&(!d||d.indexOf(M)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const d=[];for(const y of r)this._el.contains(y.target)&&d.push(y);return d}handleEvent(r,d){this._updatingCamera=!0;const y="renderFrame"===r.type,M=y?void 0:r,T={needsRenderFrame:!1},A={},L={},F=r.touches?this._getMapTouches(r.touches):void 0,V=F?Pi(this._el,F):y?void 0:Xs(this._el,r);for(const{handlerName:ee,handler:re,allowed:ie}of this._handlers){if(!re.isEnabled())continue;let J;this._blockedByActive(L,ie,ee)?re.reset():re[d||r.type]&&(J=re[d||r.type](r,V,F),this.mergeHandlerResult(T,A,J,ee,M),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||re.isActive())&&(L[ee]=re)}const G={};for(const ee in this._previousActiveHandlers)L[ee]||(G[ee]=M);this._previousActiveHandlers=L,(Object.keys(G).length||Ql(T))&&(this._changes.push([T,A,G]),this._triggerRenderFrame()),(Object.keys(L).length||Ql(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=T;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(r,d,y,M,T){if(!y)return;m.extend(r,y);const A={handlerName:M,originalEvent:y.originalEvent||T};void 0!==y.zoomDelta&&(d.zoom=A),void 0!==y.panDelta&&(d.drag=A),void 0!==y.pitchDelta&&(d.pitch=A),void 0!==y.bearingDelta&&(d.rotate=A)}_applyChanges(){const r={},d={},y={};for(const[M,T,A]of this._changes)M.panDelta&&(r.panDelta=(r.panDelta||new m.pointGeometry(0,0))._add(M.panDelta)),M.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+M.pitchDelta),void 0!==M.around&&(r.around=M.around),void 0!==M.aroundCoord&&(r.aroundCoord=M.aroundCoord),void 0!==M.pinchAround&&(r.pinchAround=M.pinchAround),M.noInertia&&(r.noInertia=M.noInertia),m.extend(d,T),m.extend(y,A);this._updateMapTransform(r,d,y),this._changes=[]}_updateMapTransform(r,d,y){const M=this._map,T=M.transform,A=pe=>[pe.x,pe.y,pe.z];if((pe=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!Ql(r)){const pe=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",pe!==T.zoom&&this._map._update(!0)}if(!Ql(r))return void this._fireEvents(d,y,!0);let{panDelta:L,zoomDelta:F,bearingDelta:V,pitchDelta:G,around:q,aroundCoord:ee,pinchAround:re}=r;void 0!==re&&(q=re),(pe=>d.drag&&!this._eventsInProgress.drag)()&&q&&(this._dragOrigin=A(T.pointCoordinate3D(q)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",M._stop(!0),q=q||M.transform.centerPoint,V&&(T.bearing+=V),G&&(T.pitch+=G),T._updateCameraState();const ie=[0,0,0];if(L){const pe=T.pointCoordinate(q);if("globe"===T.projection.name){const _e=m.latFromMercatorY(pe.y),ye=T.center.lat,ue=Math.min(m.mercatorZfromAltitude(1,_e)/m.mercatorZfromAltitude(1,ye),2);L=L.rotate(-T.angle),ie[0]=-L.x/T.worldSize*ue,ie[1]=-L.y/T.worldSize*ue}else{const _e=T.pointCoordinate(q.sub(L));pe&&_e&&(ie[0]=_e.x-pe.x,ie[1]=_e.y-pe.y)}}const J=T.zoom,ge=[0,0,0];if(F){const pe=A(ee||T.pointCoordinate3D(q)),_e={dir:m.normalize([],m.sub([],pe,T._camera.position))};if(_e.dir[2]<0){const ye=T.zoomDeltaToMovement(pe,F);m.scale$2(ge,_e.dir,ye)}}const ce=m.add(ie,ie,ge);T._translateCameraConstrained(ce),F&&Math.abs(T.zoom-J)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(d,y,!0)}_fireEvents(r,d,y){const M=qc(this._eventsInProgress),T=qc(r),A={};for(const G in r){const{originalEvent:q}=r[G];this._eventsInProgress[G]||(A[`${G}start`]=q),this._eventsInProgress[G]=r[G]}!M&&T&&this._fireEvent("movestart",T.originalEvent);for(const G in A)this._fireEvent(G,A[G]);T&&this._fireEvent("move",T.originalEvent);for(const G in r){const{originalEvent:q}=r[G];this._fireEvent(G,q)}const L={};let F;for(const G in this._eventsInProgress){const{handlerName:q,originalEvent:ee}=this._eventsInProgress[G];this._handlersById[q].isActive()||(delete this._eventsInProgress[G],F=d[q]||ee,L[`${G}end`]=F)}for(const G in L)this._fireEvent(G,L[G]);const V=qc(this._eventsInProgress);if(y&&(M||T)&&!V){this._updatingCamera=!0;const G=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=ee=>0!==ee&&-this._bearingSnap<ee&&ee<this._bearingSnap;G?(q(G.bearing||this._map.getBearing())&&(G.bearing=0),this._map.easeTo(G,{originalEvent:F})):(this._map.fire(new m.Event("moveend",{originalEvent:F})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,d){this._map.fire(new m.Event(r,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new pd("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const eu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class tu extends m.Evented{constructor(r,d){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}getCenter(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,d){return this.jumpTo({center:r},d)}panBy(r,d,y){return r=m.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,m.extend({offset:r},d),y)}panTo(r,d,y){return this.easeTo(m.extend({center:r},d),y)}getZoom(){return this.transform.zoom}setZoom(r,d){return this.jumpTo({zoom:r},d),this}zoomTo(r,d,y){return this.easeTo(m.extend({zoom:r},d),y)}zoomIn(r,d){return this.zoomTo(this.getZoom()+1,r,d),this}zoomOut(r,d){return this.zoomTo(this.getZoom()-1,r,d),this}getBearing(){return this.transform.bearing}setBearing(r,d){return this.jumpTo({bearing:r},d),this}getPadding(){return this.transform.padding}setPadding(r,d){return this.jumpTo({padding:r},d),this}rotateTo(r,d,y){return this.easeTo(m.extend({bearing:r},d),y)}resetNorth(r,d){return this.rotateTo(0,m.extend({duration:1e3},r),d),this}resetNorthPitch(r,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},r),d),this}snapToNorth(r,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,d):this}getPitch(){return this.transform.pitch}setPitch(r,d){return this.jumpTo({pitch:r},d),this}cameraForBounds(r,d){r=m.LngLatBounds.convert(r);const y=d&&d.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),y,d)}_extendCameraOptions(r){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=m.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const y=r.padding;r.padding={top:y,bottom:y,right:y,left:y}}return r.padding=m.extend(d,r.padding),r}_cameraForBoxAndBearing(r,d,y,M){const T=this._extendCameraOptions(M),A=this.transform,L=A.padding,F=A.project(m.LngLat.convert(r)),V=A.project(m.LngLat.convert(d)),G=new m.pointGeometry(F.x,V.y),q=new m.pointGeometry(V.x,F.y),ee=-m.degToRad(y),re=F.rotate(ee),ie=V.rotate(ee),J=G.rotate(ee),ge=q.rotate(ee),ce=new m.pointGeometry(Math.max(re.x,ie.x,J.x,ge.x),Math.max(re.y,ie.y,J.y,ge.y)),pe=new m.pointGeometry(Math.min(re.x,ie.x,J.x,ge.x),Math.min(re.y,ie.y,J.y,ge.y)),_e=ce.sub(pe),ye=(A.width-((L.left||0)+(L.right||0)+T.padding.left+T.padding.right))/_e.x,ue=(A.height-((L.top||0)+(L.bottom||0)+T.padding.top+T.padding.bottom))/_e.y;if(ue<0||ye<0)return void m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const xe=Math.min(A.scaleZoom(A.scale*Math.min(ye,ue)),T.maxZoom),Ne="number"==typeof T.offset.x&&"number"==typeof T.offset.y?new m.pointGeometry(T.offset.x,T.offset.y):m.pointGeometry.convert(T.offset),He=new m.pointGeometry((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(y*Math.PI/180),Ye=Ne.add(He).mult(A.scale/A.zoomScale(xe));return{center:A.unproject(F.add(V).div(2).sub(Ye)),zoom:xe,bearing:y}}_cameraForBox(r,d,y,M,T){const A=this._extendCameraOptions(T);y=y||0,M=M||0,r=m.LngLat.convert(r),d=m.LngLat.convert(d);const L=this.transform.clone();L.padding=A.padding;const F=this.getFreeCameraOptions(),V=new m.LngLat(.5*(r.lng+d.lng),.5*(r.lat+d.lat)),G=.5*(y+M);if(L._camera.position[2]<m.mercatorZfromAltitude(G,V.lat))return void m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");F.lookAtPoint(V),L.setFreeCameraOptions(F);const q=m.MercatorCoordinate.fromLngLat(r),ee=m.MercatorCoordinate.fromLngLat(d),re=L.pointRayIntersection(L.centerPoint,G),ie=[(J=L.rayIntersectionCoordinate(re)).x,J.y,J.z];var J;const ge=L.screenPointToMercatorRay(L.centerPoint),ce="globe"!==L.projection.name;let pe,_e=0;do{const ye=Math.floor(L.zoom),ue=1<<ye,xe=Math.min(ue*q.x,ue*ee.x),Ne=Math.min(ue*q.y,ue*ee.y),He=Math.max(ue*q.x,ue*ee.x),Ye=Math.max(ue*q.y,ue*ee.y),Xe=new m.Aabb([xe,Ne,y],[He,Ye,M]),St=m.Frustum.fromInvProjectionMatrix(L.invProjMatrix,L.worldSize,ye,ce);if(2!==Xe.intersects(St)){pe&&(L._camera.position=m.scaleAndAdd([],L._camera.position,ge.dir,-pe),L._updateStateFromCamera());break}const Ie=m.sub([],L._camera.position,ie);pe=.5*m.length(Ie),L._camera.position=m.scaleAndAdd([],L._camera.position,ge.dir,pe);try{L._updateStateFromCamera()}catch(mt){return void m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++_e<10);return{center:L.center,zoom:L.zoom,bearing:L.bearing,pitch:L.pitch}}fitBounds(r,d,y){return this._fitInternal(this.cameraForBounds(r,d),d,y)}_raycastElevationBox(r,d){const y=this.transform.elevation;if(!y)return;const M=new m.pointGeometry(r.x,d.y),T=new m.pointGeometry(d.x,r.y),A=y.pointCoordinate(r);if(!A)return;const L=y.pointCoordinate(d);if(!L)return;const F=y.pointCoordinate(M);if(!F)return;const V=y.pointCoordinate(T);if(!V)return;const G=new m.MercatorCoordinate(A[0],A[1]).toLngLat(),q=new m.MercatorCoordinate(L[0],L[1]).toLngLat(),ee=new m.MercatorCoordinate(F[0],F[1]).toLngLat(),re=new m.MercatorCoordinate(V[0],V[1]).toLngLat(),ie=Math.min(G.lng,Math.min(q.lng,Math.min(ee.lng,re.lng))),J=Math.min(G.lat,Math.min(q.lat,Math.min(ee.lat,re.lat))),ge=Math.max(G.lng,Math.max(q.lng,Math.max(ee.lng,re.lng))),ce=Math.max(G.lat,Math.max(q.lat,Math.max(ee.lat,re.lat))),pe=Math.min(A[3],Math.min(L[3],Math.min(F[3],V[3]))),_e=Math.max(A[3],Math.max(L[3],Math.max(F[3],V[3])));return{minLngLat:new m.LngLat(ie,J),maxLngLat:new m.LngLat(ge,ce),minAltitude:pe,maxAltitude:_e}}fitScreenCoordinates(r,d,y,M,T){let A,L,F,V;const G=m.pointGeometry.convert(r),q=m.pointGeometry.convert(d),ee=this._raycastElevationBox(G,q);if(ee)A=ee.minLngLat,L=ee.maxLngLat,F=ee.minAltitude,V=ee.maxAltitude;else{if(this.transform.anyCornerOffEdge(G,q))return this;A=this.transform.pointLocation(G),L=this.transform.pointLocation(q)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(m.pointGeometry.convert(r)),this.transform.pointLocation(m.pointGeometry.convert(d)),y,M):this._cameraForBox(A,L,F,V,M),M,T)}_fitInternal(r,d,y){return r?(delete(d=m.extend(r,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this}jumpTo(r,d){this.stop();const y=r.preloadOnly?this.transform.clone():this.transform;let M=!1,T=!1,A=!1;return"zoom"in r&&y.zoom!==+r.zoom&&(M=!0,y.zoom=+r.zoom),void 0!==r.center&&(y.center=m.LngLat.convert(r.center)),"bearing"in r&&y.bearing!==+r.bearing&&(T=!0,y.bearing=+r.bearing),"pitch"in r&&y.pitch!==+r.pitch&&(A=!0,y.pitch=+r.pitch),null==r.padding||y.isPaddingEqual(r.padding)||(y.padding=r.padding),r.preloadOnly?(this._preloadTiles(y),this):(this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),M&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),T&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),A&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||m.warnOnce(eu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,d){const y=this.transform;if(!y.projection.supportsFreeCamera)return m.warnOnce(eu),this;this.stop();const M=y.zoom,T=y.pitch,A=y.bearing;y.setFreeCameraOptions(r);const L=M!==y.zoom,F=T!==y.pitch,V=A!==y.bearing;return this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),L&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),V&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),F&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d)),this}easeTo(r,d){this._stop(!1,r.easeId),(!1===(r=m.extend({offset:[0,0],duration:500,easing:m.ease},r)).animate||!r.essential&&m.exported.prefersReducedMotion)&&(r.duration=0);const y=this.transform,M=this.getZoom(),T=this.getBearing(),A=this.getPitch(),L=this.getPadding(),F="zoom"in r?+r.zoom:M,V="bearing"in r?this._normalizeBearing(r.bearing,T):T,G="pitch"in r?+r.pitch:A,q="padding"in r?r.padding:y.padding,ee=m.pointGeometry.convert(r.offset);let re,ie,J;if("globe"===y.projection.name){const Ye=m.MercatorCoordinate.fromLngLat(y.center),Xe=ee.rotate(-y.angle);Ye.x+=Xe.x/y.worldSize,Ye.y+=Xe.y/y.worldSize;const St=Ye.toLngLat(),Ie=m.LngLat.convert(r.center||St);this._normalizeCenter(Ie),re=y.centerPoint.add(Xe),ie=new m.pointGeometry(Ye.x,Ye.y).mult(y.worldSize),J=new m.pointGeometry(m.mercatorXfromLng(Ie.lng),m.mercatorYfromLat(Ie.lat)).mult(y.worldSize).sub(ie)}else{re=y.centerPoint.add(ee);const Ye=y.pointLocation(re),Xe=m.LngLat.convert(r.center||Ye);this._normalizeCenter(Xe),ie=y.project(Ye),J=y.project(Xe).sub(ie)}const ge=y.zoomScale(F-M);let ce,pe;r.around&&(ce=m.LngLat.convert(r.around),pe=y.locationPoint(ce));const _e=this._zooming||F!==M,ye=this._rotating||T!==V,ue=this._pitching||G!==A,xe=!y.isPaddingEqual(q),Ne=Ye=>Xe=>{if(_e&&(Ye.zoom=m.number(M,F,Xe)),ye&&(Ye.bearing=m.number(T,V,Xe)),ue&&(Ye.pitch=m.number(A,G,Xe)),xe&&(Ye.interpolatePadding(L,q,Xe),re=Ye.centerPoint.add(ee)),ce)Ye.setLocationAtPoint(ce,pe);else{const St=Ye.zoomScale(Ye.zoom-M),Ie=F>M?Math.min(2,ge):Math.max(.5,ge),mt=Math.pow(Ie,1-Xe),ft=Ye.unproject(ie.add(J.mult(Xe*mt)).mult(St));Ye.setLocationAtPoint(Ye.renderWorldCopies?ft.wrap():ft,re)}return r.preloadOnly||this._fireMoveEvents(d),Ye};if(r.preloadOnly){const Ye=this._emulate(Ne,r.duration,y);return this._preloadTiles(Ye),this}const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_e,this._rotating=ye,this._pitching=ue,this._padding=xe,this._easeId=r.easeId,this._prepareEase(d,r.noMoveStart,He),this._ease(Ne(y),Ye=>{y.recenterOnTerrain(),this._afterEase(d,Ye)},r),this}_prepareEase(r,d,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||y.moving||this.fire(new m.Event("movestart",r)),this._zooming&&!y.zooming&&this.fire(new m.Event("zoomstart",r)),this._rotating&&!y.rotating&&this.fire(new m.Event("rotatestart",r)),this._pitching&&!y.pitching&&this.fire(new m.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new m.Event("move",r)),this._zooming&&this.fire(new m.Event("zoom",r)),this._rotating&&this.fire(new m.Event("rotate",r)),this._pitching&&this.fire(new m.Event("pitch",r))}_afterEase(r,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,M=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new m.Event("zoomend",r)),M&&this.fire(new m.Event("rotateend",r)),T&&this.fire(new m.Event("pitchend",r)),this.fire(new m.Event("moveend",r))}flyTo(r,d){if(!r.essential&&m.exported.prefersReducedMotion){const zt=m.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(zt,d)}this.stop(),r=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},r);const y=this.transform,M=this.getZoom(),T=this.getBearing(),A=this.getPitch(),L=this.getPadding(),F="zoom"in r?m.clamp(+r.zoom,y.minZoom,y.maxZoom):M,V="bearing"in r?this._normalizeBearing(r.bearing,T):T,G="pitch"in r?+r.pitch:A,q="padding"in r?r.padding:y.padding,ee=y.zoomScale(F-M),re=m.pointGeometry.convert(r.offset);let ie=y.centerPoint.add(re);const J=y.pointLocation(ie),ge=m.LngLat.convert(r.center||J);this._normalizeCenter(ge);const ce=y.project(J),pe=y.project(ge).sub(ce);let _e=r.curve;const ye=Math.max(y.width,y.height),ue=ye/ee,xe=pe.mag();if("minZoom"in r){const zt=m.clamp(Math.min(r.minZoom,M,F),y.minZoom,y.maxZoom),Ot=ye/y.zoomScale(zt-M);_e=Math.sqrt(Ot/xe*2)}const Ne=_e*_e;function He(zt){const Ot=(ue*ue-ye*ye+(zt?-1:1)*Ne*Ne*xe*xe)/(2*(zt?ue:ye)*Ne*xe);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function Ye(zt){return(Math.exp(zt)-Math.exp(-zt))/2}function Xe(zt){return(Math.exp(zt)+Math.exp(-zt))/2}const St=He(0);let Ie=function(zt){return Xe(St)/Xe(St+_e*zt)},mt=function(zt){return ye*((Xe(St)*(Ye(Ot=St+_e*zt)/Xe(Ot))-Ye(St))/Ne)/xe;var Ot},ft=(He(1)-St)/_e;if(Math.abs(xe)<1e-6||!isFinite(ft)){if(Math.abs(ye-ue)<1e-6)return this.easeTo(r,d);const zt=ue<ye?-1:1;ft=Math.abs(Math.log(ue/ye))/_e,mt=function(){return 0},Ie=function(Ot){return Math.exp(zt*_e*Ot)}}r.duration="duration"in r?+r.duration:1e3*ft/("screenSpeed"in r?+r.screenSpeed/_e:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Tt=T!==V,je=G!==A,$t=!y.isPaddingEqual(q),Wt=zt=>Ot=>{const Kt=Ot*ft,li=1/Ie(Kt);zt.zoom=1===Ot?F:M+zt.scaleZoom(li),Tt&&(zt.bearing=m.number(T,V,Ot)),je&&(zt.pitch=m.number(A,G,Ot)),$t&&(zt.interpolatePadding(L,q,Ot),ie=zt.centerPoint.add(re));const Vt=1===Ot?ge:zt.unproject(ce.add(pe.mult(mt(Kt))).mult(li));return zt.setLocationAtPoint(zt.renderWorldCopies?Vt.wrap():Vt,ie),zt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(d),zt};if(r.preloadOnly){const zt=this._emulate(Wt,r.duration,y);return this._preloadTiles(zt),this}return this._zooming=!0,this._rotating=Tt,this._pitching=je,this._padding=$t,this._prepareEase(d,!1),this._ease(Wt(y),()=>this._afterEase(d),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,d)}if(!r){const y=this.handlers;y&&y.stop(!1)}return this}_ease(r,d,y){!1===y.animate||0===y.duration?(r(1),d()):(this._easeStart=m.exported.now(),this._easeOptions=y,this._onEaseFrame=r,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((m.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,d){r=m.wrap(r,-180,180);const y=Math.abs(r-d);return Math.abs(r-360-d)<y&&(r-=360),Math.abs(r+360-d)<y&&(r+=360),r}_normalizeCenter(r){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const y=r.lng-d.center.lng;r.lng+=y>180?-360:y<-180?360:0}_emulate(r,d,y){const M=Math.ceil(15*d/1e3),T=[],A=r(y.clone());for(let L=0;L<=M;L++){const F=A(L/M);T.push(F.clone())}return T}}class $c{constructor(r={}){this.options=r,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const d=this.options&&this.options.compact;return this._map=r,this._container=yi("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=yi("button","mapboxgl-ctrl-attrib-button",this._container),yi("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=yi("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,d){const y=this._map._getUIString(`AttributionControl.${d}`);r.setAttribute("aria-label",y),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(r){const y=d.reduce((M,T,A)=>(T.value&&(M+=`${T.key}=${T.value}${A<d.length-1?"&":""}`),M),"?");r.href=`${m.config.FEEDBACK_URL}/${y}${this._map._hash?this._map._hash.getHashString(!0):""}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const M=this._map.style.stylesheet;this.styleOwner=M.owner,this.styleId=M.id}const d=this._map.style._sourceCaches;for(const M in d){const T=d[M];if(T.used){const A=T.getSource();A.attribution&&r.indexOf(A.attribution)<0&&r.push(A.attribution)}}r.sort((M,T)=>M.length-T.length),r=r.filter((M,T)=>{for(let A=T+1;A<r.length;A++)if(r[A].indexOf(M)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const y=r.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,r.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class iu{constructor(){m.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=yi("div","mapboxgl-ctrl");const d=yi("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const d in r){const y=r[d].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const d=r[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class md{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const d=++this._id;return this._queue.push({callback:r,id:d,cancelled:!1}),d}remove(r){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const M of y)if(M.id===r)return void(M.cancelled=!0)}run(r=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function nu(g,r,d){if(g=new m.LngLat(g.lng,g.lat),r){const y=new m.LngLat(g.lng-360,g.lat),M=new m.LngLat(g.lng+360,g.lat),T=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),A=d.locationPoint(g).distSqr(r),L=r.x<0||r.y<0||r.x>d.width||r.y>d.height;d.locationPoint(y).distSqr(r)<A&&(L||Math.abs(y.lng-d.center.lng)<T)?g=y:d.locationPoint(M).distSqr(r)<A&&(L||Math.abs(M.lng-d.center.lng)<T)&&(g=M)}for(;Math.abs(g.lng-d.center.lng)>180;){const y=d.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=d.width&&y.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const no={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Xc extends m.Evented{constructor(r,d){if(super(),(r instanceof m.window.HTMLElement||d)&&(r=m.extend({element:r},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=m.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=yi("div");const M=41,T=27,A=ti("svg",{display:"block",height:M*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${M}`},this._element),L=ti("radialGradient",{id:"shadowGradient"},ti("defs",{},A));ti("stop",{offset:"10%","stop-opacity":.4},L),ti("stop",{offset:"100%","stop-opacity":.05},L),ti("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),ti("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),ti("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),ti("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=m.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",M=>{M.preventDefault()}),this._element.addEventListener("mousedown",M=>{M.preventDefault()});const y=this._element.classList;for(const M in no)y.remove(`mapboxgl-marker-anchor-${M}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=m.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const M=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[M,-1*(24.6+M)],"bottom-right":[-M,-1*(24.6+M)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const d=r.code,y=r.charCode||r.keyCode;"Space"!==d&&"Enter"!==d&&32!==y&&13!==y||this.togglePopup()}_onMapClick(r){const d=r.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const r=this._map;if(!r)return;const d=this._pos;if(!d||d.x<0||d.x>r.transform.width||d.y<0||d.y>r.transform.height)return void this._clearFadeTimer();const y=r.unproject(d);let M=!1;if(r.transform._terrainEnabled()&&r.getTerrain()){const A=r.getFreeCameraOptions();if(A.position){const L=A.position.toLngLat();M=L.distanceTo(y)<.9*L.distanceTo(this._lngLat)}}const T=(1-r._queryFogOpacity(y))*(M?.2:1);this._element.style.opacity=`${T}`,this._popup&&this._popup._setOpacity(`${T}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r)return;const d=this._offset.mult(this._scale),y=this._calculatePitch(),M=this._calculateRotation();this._element.style.transform=`\n            translate(${r.x}px, ${r.y}px) ${no[this._anchor]}\n            rotateX(${y}deg) rotateZ(${M}deg)\n            translate(${d.x}px, ${d.y}px)\n        `}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(r){m.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=nu(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),!0===r?this._updateFrameId=m.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!d.getTerrain()&&!d.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=m.pointGeometry.convert(r),this._update(),this}_onMove(r){const d=this._map;if(d){if(!this._isDragging){const y=this._clickTolerance||d._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new m.Event("dragend")),this._state="inactive"}_addDragHandler(r){const d=this._map;d&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos),this._pointerdownPos=r.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const d=this._map;return d&&(r?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&"auto"!==r?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Wm{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const d=m.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,d,y){this._start=this.getValue(d),this._end=r,this._startTime=d,this._endTime=d+y}}const Bp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Yc(g){g.parentNode&&g.parentNode.removeChild(g)}const dl={showCompass:!0,showZoom:!0,visualizePitch:!1};class ru{constructor(r,d,y=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Kl({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,y&&(this.mousePitch=new ld({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(r,d){this.mouseRotate.mousedown(r,d),this.mousePitch&&this.mousePitch.mousedown(r,d),Fn()}move(r,d){const y=this.map,M=this.mouseRotate.mousemoveWindow(r,d),T=M&&M.bearingDelta;if(T&&y.setBearing(y.getBearing()+T),this.mousePitch){const A=this.mousePitch.mousemoveWindow(r,d),L=A&&A.pitchDelta;L&&y.setPitch(y.getPitch()+L)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Mc(),m.window.removeEventListener("mousemove",this.mousemove),m.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(m.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Xs(this.element,r)),m.window.addEventListener("mousemove",this.mousemove),m.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Xs(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=Pi(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=Pi(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Lr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let gs,pl=0,ml=!1;const gd={maxWidth:100,unit:"metric"};function su(g,r,d){const y=d&&d.maxWidth||100,M=g._containerHeight/2,T=g._containerWidth/2-y/2,A=g.unproject([T,M]),L=g.unproject([T+y,M]),F=A.distanceTo(L);if(d&&"imperial"===d.unit){const V=3.2808*F;V>5280?fl(r,y,V/5280,g._getUIString("ScaleControl.Miles"),g):fl(r,y,V,g._getUIString("ScaleControl.Feet"),g)}else d&&"nautical"===d.unit?fl(r,y,F/1852,g._getUIString("ScaleControl.NauticalMiles"),g):F>=1e3?fl(r,y,F/1e3,g._getUIString("ScaleControl.Kilometers"),g):fl(r,y,F,g._getUIString("ScaleControl.Meters"),g)}function fl(g,r,d,y,M){const T=function(L){const F=Math.pow(10,`${Math.floor(L)}`.length-1);let V=L/F;return V=V>=10?10:V>=5?5:V>=3?3:V>=2?2:V>=1?1:function(G){const q=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*q)/q}(V),F*V}(d),A=T/d;M._requestDomTask(()=>{g.style.width=r*A+"px",g.innerHTML=`${T}&nbsp;${y}`})}const Bs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ln=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ec(g=new m.pointGeometry(0,0),r="bottom"){if("number"==typeof g){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(r){case"top":return new m.pointGeometry(0,g);case"top-left":return new m.pointGeometry(d,d);case"top-right":return new m.pointGeometry(-d,d);case"bottom":return new m.pointGeometry(0,-g);case"bottom-left":return new m.pointGeometry(d,-d);case"bottom-right":return new m.pointGeometry(-d,-d);case"left":return new m.pointGeometry(g,0);case"right":return new m.pointGeometry(-g,0)}return new m.pointGeometry(0,0)}return g instanceof m.pointGeometry||Array.isArray(g)?m.pointGeometry.convert(g):m.pointGeometry.convert(g[r]||[0,0])}const tc={version:m.version,supported:k,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:class extends tu{constructor(g){if(null!=(g=m.extend({},fd,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&m.isSafariWithAntialiasingBug(m.window)&&(g.antialias=!1,m.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Hc(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._renderTaskQueue=new md,this._domRenderTaskQueue=new md,this._controls=[],this._markers=[],this._mapId=m.uniqueId(),this._locale=m.extend({},Bp,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Wm(0),this._explicitProjection=null,this._requestManager=new m.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=m.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof m.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&m.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==m.window&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1),m.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Op(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new id("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,m.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new $c({customAttribution:g.customAttribution})),this._logoControl=new iu,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new m.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new m.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(g,r){if(void 0===r&&(r=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[r];return-1!==r.indexOf("bottom")?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(g);return r>-1&&this._controls.splice(r,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new m.Event("movestart",g)).fire(new m.Event("move",g)),this.fire(new m.Event("resize",g)),r&&this.fire(new m.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(m.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=null==g?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=null==g?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=null==g?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=null==g?85:g)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._updateProjection(g)}_updateProjection(g){null===g&&(this._explicitProjection=null);const r=g||this.getProjection(),d=this.transform.setProjection(r);if(g&&(this._explicitProjection=this.transform.getProjection()),d){this.painter.clearBackgroundTiles();for(const y in this.style._sourceCaches)this.style._sourceCaches[y].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(g){return this.transform.locationPoint3D(m.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(m.pointGeometry.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(g,r,d){if("mouseenter"===g||"mouseover"===g){let y=!1;const M=A=>{const L=r.filter(V=>this.getLayer(V)),F=L.length?this.queryRenderedFeatures(A.point,{layers:L}):[];F.length?y||(y=!0,d.call(this,new dn(g,this,A.originalEvent,{features:F}))):y=!1},T=()=>{y=!1};return{layers:new Set(r),listener:d,delegates:{mousemove:M,mouseout:T}}}if("mouseleave"===g||"mouseout"===g){let y=!1;const M=A=>{const L=r.filter(F=>this.getLayer(F));(L.length?this.queryRenderedFeatures(A.point,{layers:L}):[]).length?y=!0:y&&(y=!1,d.call(this,new dn(g,this,A.originalEvent)))},T=A=>{y&&(y=!1,d.call(this,new dn(g,this,A.originalEvent)))};return{layers:new Set(r),listener:d,delegates:{mousemove:M,mouseout:T}}}{const y=M=>{const T=r.filter(L=>this.getLayer(L)),A=T.length?this.queryRenderedFeatures(M.point,{layers:T}):[];A.length&&(M.features=A,d.call(this,M),delete M.features)};return{layers:new Set(r),listener:d,delegates:{[g]:y}}}}on(g,r,d){if(void 0===d)return super.on(g,r);Array.isArray(r)||(r=[r]);const y=this._createDelegatedListener(g,r,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const M in y.delegates)this.on(M,y.delegates[M]);return this}once(g,r,d){if(void 0===d)return super.once(g,r);Array.isArray(r)||(r=[r]);const y=this._createDelegatedListener(g,r,d);for(const M in y.delegates)this.once(M,y.delegates[M]);return this}off(g,r,d){if(void 0===d)return super.off(g,r);r=new Set(Array.isArray(r)?r:[r]);const y=(T,A)=>{if(T.size!==A.size)return!1;for(const L of T)if(!A.has(L))return!1;return!0},M=this._delegatedListeners?this._delegatedListeners[g]:void 0;return M&&(T=>{for(let A=0;A<T.length;A++){const L=T[A];if(L.listener===d&&y(L.layers,r)){for(const F in L.delegates)this.off(F,L.delegates[F]);return T.splice(A,1),this}}})(M),this}queryRenderedFeatures(g,r){return this.style?(void 0!==r||void 0===g||g instanceof m.pointGeometry||Array.isArray(g)||(r=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(g,r){return this.style.querySourceFeatures(g,r)}queryTerrainElevation(g,r){const d=this.transform.elevation;return d?(r=m.extend({},{exaggerated:!0},r),d.getAtPoint(m.MercatorCoordinate.fromLngLat(g),null,r.exaggerated)):null}setStyle(g,r){return!1!==(r=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(g,r))}_getUIString(g){const r=this._locale[g];if(null==r)throw new Error(`Missing UI string '${g}'`);return r}_updateStyle(g,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Nn(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Nn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,r){if("string"==typeof g){const d=this._requestManager.normalizeStyleURL(g),y=this._requestManager.transformRequest(d,m.ResourceType.Style);m.getJSON(y,(M,T)=>{M?this.fire(new m.ErrorEvent(M)):T&&this._updateDiff(T,r)})}else"object"==typeof g&&this._updateDiff(g,r)}_updateDiff(g,r){try{this.style.setState(g)&&this._update(!0)}catch(d){m.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(g,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(m.warnOnce("There is no style added to the map."),!1)}addSource(g,r){return this._lazyInitEmptyStyle(),this.style.addSource(g,r),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const r in g){const d=g[r]._tiles;for(const y in d){const M=d[y];if("loaded"!==M.state&&"errored"!==M.state)return!1}}return!0}addSourceType(g,r,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,r,d)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,r,{pixelRatio:d=1,sdf:y=!1,stretchX:M,stretchY:T,content:A}={}){if(this._lazyInitEmptyStyle(),r instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&r instanceof m.window.ImageBitmap){const{width:L,height:F,data:V}=m.exported.getImageData(r);this.style.addImage(g,{data:new m.RGBAImage({width:L,height:F},V),pixelRatio:d,stretchX:M,stretchY:T,content:A,sdf:y,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:L,height:F}=r,V=r;this.style.addImage(g,{data:new m.RGBAImage({width:L,height:F},new Uint8Array(V.data)),pixelRatio:d,stretchX:M,stretchY:T,content:A,sdf:y,version:0,userImage:V}),V.onAdd&&V.onAdd(this,g)}}updateImage(g,r){const d=this.style.getImage(g);if(!d)return void this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=r instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&r instanceof m.window.ImageBitmap?m.exported.getImageData(r):r,{width:M,height:T}=y;void 0!==M&&void 0!==T?M===d.data.width&&T===d.data.height?(d.data.replace(y.data,!(r instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&r instanceof m.window.ImageBitmap)),this.style.updateImage(g,d)):this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,r){m.getImage(this._requestManager.transformRequest(g,m.ResourceType.Image),(d,y)=>{r(d,y instanceof m.window.HTMLImageElement?m.exported.getImageData(y):y)})}listImages(){return this.style.listImages()}addLayer(g,r){return this._lazyInitEmptyStyle(),this.style.addLayer(g,r),this._update(!0)}moveLayer(g,r){return this.style.moveLayer(g,r),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,r,d){return this.style.setLayerZoomRange(g,r,d),this._update(!0)}setFilter(g,r,d={}){return this.style.setFilter(g,r,d),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,r,d,y={}){return this.style.setPaintProperty(g,r,d,y),this._update(!0)}getPaintProperty(g,r){return this.style.getPaintProperty(g,r)}setLayoutProperty(g,r,d,y={}){return this.style.setLayoutProperty(g,r,d,y),this._update(!0)}getLayoutProperty(g,r){return this.style.getLayoutProperty(g,r)}setLight(g,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(m.LngLat.convert(g),this.transform):0}setFeatureState(g,r){return this.style.setFeatureState(g,r),this._update()}removeFeatureState(g,r){return this.style.removeFeatureState(g,r),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let d,y,M,T=this._container;for(;T&&(!y||!M);){const A=m.window.getComputedStyle(T).transform;A&&"none"!==A&&(d=A.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&"0"!==d[0]&&"1"!==d[0]&&(y=d[0]),d[3]&&"0"!==d[3]&&"1"!==d[3]&&(M=d[3])),T=T.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=M?Math.abs(r/M):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=yi("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=yi("div","mapboxgl-canvas-container",g);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=yi("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=yi("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{y[M]=yi("div",`mapboxgl-ctrl-${M}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,r){const d=m.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(r),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${r}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const r=this._markers.indexOf(g);-1!==r&&this._markers.splice(r,1)}_setupPainter(){const g=m.extend({},k.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);r?(m.storeAuthState(r,!0),this.painter=new Yu(r,this.transform),this.on("data",d=>{"source"===d.dataType&&this.painter.setTileLoadedFlag(!0)}),m.exported$1.testSupport(r)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let r;const d=this.painter.context.extTimerQuery,y=m.exported.now();if(this.listens("gpu-timing-frame")&&(r=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;let M=!1;const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,V=this.transform.pitch,G=m.exported.now();this.style.zoomHistory.update(F,G);const q=new m.EvaluationParameters(F,{now:G,fadeDuration:T,pitch:V,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ee=q.crossFadingFactor();1===ee&&ee===this._crossFadingFactor||(M=!0,this._crossFadingFactor=ee),this.style.update(q)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(y),this.style._updateSources(this.transform),this._forceMarkerUpdate()):A=this._updateAverageElevation(y),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const F=m.exported.now()-y;d.endQueryEXT(d.TIME_ELAPSED_EXT,r),setTimeout(()=>{const V=d.getQueryObjectEXT(r,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(r),this.fire(new m.Event("gpu-timing-frame",{cpuTime:F,gpuTime:V}))},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const V=this.painter.queryGpuTimers(F);this.fire(new m.Event("gpu-timing-layer",{layerTimes:V}))},50)}const L=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(L||this._repaint)this.triggerRepaint();else{const F=!this.isMoving()&&this.loaded();if(F&&(A=this._updateAverageElevation(y,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new m.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const V=this._calculateSpeedIndex();this.fire(new m.Event("speedindexcompleted",{speedIndex:V})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const g of this._markers)g._update()}_updateAverageElevation(g,r=!1){const d=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((r||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const y=this.transform.averageElevation;let M=this.transform.sampleAverageElevation(),T=!1;this.transform.elevation&&(T=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=g;const A=Math.abs(y-M);if(A>1){if(this._isInitialLoad||T)return this._averageElevation.jumpTo(M),d(M);this._averageElevation.easeTo(M,g,300)}else if(A>1e-4)return this._averageElevation.jumpTo(M),d(M)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){m.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===m.AUTH_ERR_MSG||401===g.status)){const r=this.painter.context.gl;m.storeAuthState(r,!1),this._logoControl instanceof iu&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new m.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),m.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const d=this.painter.context.gl,y=d.createFramebuffer();function M(T){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,T,0);const A=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,A),A}return d.bindFramebuffer(d.FRAMEBUFFER,y),this._canvasPixelComparison(M(g),r.canvasCopies.map(M),r.timeStamps)}_canvasPixelComparison(g,r,d){let y=d[1]-d[0];const M=g.length/4;for(let T=0;T<r.length;T++){const A=r[T];let L=0;for(let F=0;F<A.length;F+=4)A[F]===g[F]&&A[F+1]===g[F+1]&&A[F+2]===g[F+2]&&A[F+3]===g[F+3]&&(L+=1);y+=(d[T+2]-d[T+1])*(1-L/M)}return y}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==m.window&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),Yc(this._canvasContainer),Yc(this._controlContainer),Yc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),m.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new m.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=m.exported.frame(r=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(r)}))}_preloadTiles(g){const r=this.style?Object.values(this.style._sourceCaches):[];return m.asyncAll(r,(d,y)=>d._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}_setCacheLimits(g,r){m.setCacheLimits(g,r)}get version(){return m.version}},NavigationControl:class{constructor(g){this.options=m.extend({},dl,g),this._container=yi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),yi("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),yi("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:r}):d.resetNorth({},{originalEvent:r}))}),this._compassIcon=yi("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const r=g.getZoom(),d=r===g.getMaxZoom(),y=r===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ru(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,r){const d=yi("button",g,this._container);return d.type="button",d.addEventListener("click",r),d}_setButtonTitle(g,r){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${r}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends m.Evented{constructor(g){super(),this.options=m.extend({},Lr,g),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xh(this._updateMarkerRotation,20)}onAdd(g){var r;return this._map=g,this._container=yi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==gs?r(gs):void 0!==m.window.navigator.permissions?m.window.navigator.permissions.query({name:"geolocation"}).then(d=>{gs="denied"!==d.state,r(gs)}):(gs=!!m.window.navigator.geolocation,r(gs)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,pl=0,ml=!1}_isOutOfMapMaxBounds(g){const r=this._map.getMaxBounds(),d=g.coords;return!!r&&(d.longitude<r.getWest()||d.longitude>r.getEast()||d.latitude<r.getSouth()||d.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",g)),this._finish()}}_updateCamera(g){const r=new m.LngLat(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,y=this._map.getBearing(),M=m.extend({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(d),M,{geolocateSource:!0})}_updateMarker(g){if(g){const r=new m.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map._containerHeight/2,r=this._map.unproject([0,g]),d=this._map.unproject([100,g]),y=r.distanceTo(d)/100,M=Math.ceil(2*this._accuracy/y);this._circleElement.style.width=`${M}px`,this._circleElement.style.height=`${M}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&ml)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=yi("button","mapboxgl-ctrl-geolocate",this._container),yi("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=yi("div","mapboxgl-user-location"),this._dotElement.appendChild(yi("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(yi("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=yi("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new m.Event("trackuserlocationend")))})}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pl--,ml=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),pl++,pl>1?(g={maximumAge:6e5,timeout:0},ml=!0):(g=this.options.positionOptions,ml=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{m.window.addEventListener("ondeviceorientationabsolute"in m.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==m.window.DeviceMotionEvent&&"function"==typeof m.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&g()}).catch(console.error):g()}_clearWatch(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),m.window.removeEventListener("deviceorientation",this._onDeviceOrientation),m.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:$c,ScaleControl:class{constructor(g){this.options=m.extend({},gd,g),m.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){su(this._map,this._container,this.options)}onAdd(g){return this._map=g,this._container=yi("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(g){this.options.unit=g,su(this._map,this._container,this.options)}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof m.window.HTMLElement?this._container=g.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in m.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=yi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!m.window.document.fullscreenEnabled&&!m.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=yi("button","mapboxgl-ctrl-fullscreen",this._controlContainer);yi("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(m.window.document.fullscreenElement||m.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends m.Evented{constructor(g){super(),this.options=m.extend(Object.create(Bs),g),m.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new m.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new m.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=m.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(m.window.document.createTextNode(g))}setHTML(g){const r=m.window.document.createDocumentFragment(),d=m.window.document.createElement("body");let y;for(d.innerHTML=g;y=d.firstChild,y;)r.appendChild(y);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=yi("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(g),this.options.closeButton){const d=this._closeButton=yi("button","mapboxgl-popup-close-button",r);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let r;return this._classList.delete(g)?r=!1:(this._classList.add(g),r=!0),this._updateClassList(),r}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const r=this._map,d=this._container,y=this._pos;if(!r||!d||!y)return"bottom";const M=d.offsetWidth,T=d.offsetHeight,A=y.x<M/2,L=y.x>r.transform.width-M/2;if(y.y+g<T)return A?"top-left":L?"top-right":"top";if(y.y>r.transform.height-T){if(A)return"bottom-left";if(L)return"bottom-right"}return A?"left":L?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),g.className=r.join(" ")}_update(g){const r=this._map,d=this._content;if(!r||!this._lngLat&&!this._trackPointer||!d)return;let y=this._container;if(y||(y=this._container=yi("div","mapboxgl-popup",r.getContainer()),this._tip=yi("div","mapboxgl-popup-tip",y),y.appendChild(d)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nu(this._lngLat,this._pos,r.transform)),!this._trackPointer||g){const M=this._pos=this._trackPointer&&g?g:r.project(this._lngLat),T=ec(this.options.offset),A=this._anchor=this._getAnchor(T.y),L=ec(this.options.offset,A),F=M.add(L).round();r._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${no[A]} translate(${F.x}px,${F.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(ln);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._content&&(this._content.style.opacity=g),this._tip&&(this._tip.style.opacity=g)}},Marker:Xc,Style:Nn,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.pointGeometry,MercatorCoordinate:m.MercatorCoordinate,FreeCameraOptions:Nc,Evented:m.Evented,config:m.config,prewarm:function(){Rt().acquire(Qt)},clearPrewarmedResources:function(){const g=Dt;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(Qt),Dt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(g){m.config.ACCESS_TOKEN=g},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(g){m.config.API_URL=g},get workerCount(){return Jt.workerCount},set workerCount(g){Jt.workerCount=g},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){m.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){m.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:m.exported.setNow,restoreNow:m.exported.restoreNow};return tc}),Hr}()}}]);